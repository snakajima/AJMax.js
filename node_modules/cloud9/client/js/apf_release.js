var apf={VERSION:"3.0beta",CDN:"",READY:false,NODE_HIDDEN:101,NODE_VISIBLE:102,NODE_O3:103,KEYBOARD:2,KEYBOARD_MOUSE:true,SUCCESS:1,TIMEOUT:2,ERROR:3,OFFLINE:4,debug:false,includeStack:[],initialized:false,AppModules:[],autoLoadSkin:false,started:false,crypto:{},config:{},_GET:{},$asyncObjects:{"apf.oHttp":1,"apf.ajax":1},basePath:"",ns:{apf:"http://ajax.org/2005/aml",aml:"http://ajax.org/2005/aml",xsd:"http://www.w3.org/2001/XMLSchema",xhtml:"http://www.w3.org/1999/xhtml",xslt:"http://www.w3.org/1999/XSL/Transform",xforms:"http://www.w3.org/2002/xforms",ev:"http://www.w3.org/2001/xml-events"},xPathAxis:{self:1,"following-sibling":1,ancestor:1},hasRequireJS:typeof requirejs!=="undefined",availHTTP:[],releaseHTTP:function(http){if(apf.brokenHttpAbort){return;
}if(self.XMLHttpRequestUnSafe&&http.constructor==XMLHttpRequestUnSafe){return;}http.onreadystatechange=function(){};
http.abort();this.availHTTP.push(http);},browserDetect:function(){if(this.$bdetect){return;
}var Browser=this.$bdetect=(function(){var ua=navigator.userAgent.toLowerCase(),platform=navigator.platform.toLowerCase(),UA=ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],mode=UA[1]=="ie"&&document.documentMode;
var b={name:(UA[1]=="version")?UA[3]:UA[1],version:mode||parseFloat((UA[1]=="opera"&&UA[4])?UA[4]:UA[2]),Platform:{name:ua.match(/ip(?:ad|od|hone)/)?"ios":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!(document.evaluate),air:!!(window.runtime),query:!!(document.querySelector),json:!!(window.JSON)},Plugins:{}};
b[b.name]=true;b[b.name+parseInt(b.version,10)]=true;b.Platform[b.Platform.name]=true;
return b;})();var UA=navigator.userAgent.toLowerCase();this.isGecko=!!Browser.firefox;
this.isChrome=!!Browser.chrome;this.isSafari=!!Browser.safari;this.isSafariOld=Browser.safari&&Browser.version===2.4;
this.isWebkit=this.isSafari||this.isChrome||UA.indexOf("konqueror")!=-1;this.isOpera=!!Browser.opera;
this.isIE=!!Browser.ie;this.isWin=Browser.Platform.win;this.isMac=Browser.Platform.mac;
this.isLinux=Browser.Platform.linux;this.isIphone=Browser.Platform.ios||UA.indexOf("aspen simulator")!=-1;
this.isAIR=Browser.Features.air;this.versionWebkit=this.isWebkit?Browser.version:null;
this.versionGecko=this.isGecko?Browser.version:null;this.isGecko3=Browser.firefox3;
this.isGecko35=this.isGecko3&&Browser.version>=3.5;this.versionFF=this.isGecko?Browser.version:null;
this.versionSafari=this.isSafari?Browser.version:null;this.versionChrome=this.isChrome?Browser.version:null;
this.versionOpera=this.isOpera?Browser.version:null;this.isIE6=this.isIE&&Browser.ie6;
this.isIE7=this.isIE&&Browser.ie7;this.isIE8=this.isIE&&Browser.ie8;this.isIE7Emulate=this.isIE&&document.documentMode&&Browser.ie7;
this.isIE=this.isIE?Browser.version:null;},setCompatFlags:function(){this.TAGNAME=apf.isIE?"baseName":"localName";
this.styleSheetRules=apf.isIE?"rules":"cssRules";this.brokenHttpAbort=apf.isIE6;
this.canUseHtmlAsXml=apf.isIE;this.supportNamespaces=!apf.isIE;this.cannotSizeIframe=apf.isIE;
this.hasConditionCompilation=apf.isIE;this.supportOverflowComponent=apf.isIE;this.hasFlexibleBox=apf.versionGecko>=3||(apf.isWebkit&&apf.versionWebkit>=3.2);
this.hasEventSrcElement=apf.isIE;this.canHaveHtmlOverSelects=!apf.isIE6&&!apf.isIE5;
this.hasInnerText=apf.isIE;this.hasMsRangeObject=apf.isIE;this.descPropJs=apf.isIE;
this.hasClickFastBug=apf.isIE;this.hasExecScript=window.execScript?true:false;this.canDisableKeyCodes=apf.isIE;
this.hasTextNodeWhiteSpaceBug=apf.isIE||apf.isIE>=8;this.hasCssUpdateScrollbarBug=apf.isIE;
this.canUseInnerHtmlWithTables=!apf.isIE;this.hasSingleResizeEvent=!apf.isIE;this.hasStyleFilters=apf.isIE;
this.supportOpacity=!apf.isIE||apf.isIE>=9;this.supportPng24=!apf.isIE6&&!apf.isIE5;
this.cantParseXmlDefinition=apf.isIE50;this.hasDynamicItemList=!apf.isIE||apf.isIE>=7;
this.canImportNode=apf.isIE;this.hasSingleRszEvent=!apf.isIE;this.hasXPathHtmlSupport=!apf.isIE;
this.hasFocusBug=apf.isIE;this.hasHeightAutoDrawBug=apf.isIE&&apf.isIE<8;this.hasReadyStateBug=apf.isIE50;
this.dateSeparator=apf.isIE?"-":"/";this.canCreateStyleNode=!apf.isIE;this.supportFixedPosition=!apf.isIE||apf.isIE>=7;
this.hasHtmlIdsInJs=apf.isIE&&apf.isIE<8||apf.isWebkit;this.needsCssPx=!apf.isIE;
this.hasCSSChildOfSelector=!apf.isIE||apf.isIE>=8;this.hasStyleAnchors=!apf.isIE||apf.isIE>=8;
this.styleAttrIsObj=apf.isIE<8;this.hasAutocompleteXulBug=apf.isGecko;this.loadsLocalFilesSync=apf.isIE||apf.isGecko;
this.mouseEventBuffer=apf.isIE?20:6;this.hasComputedStyle=typeof document.defaultView!="undefined"&&typeof document.defaultView.getComputedStyle!="undefined";
this.w3cRange=Boolean(window.getSelection);this.locale=(apf.isIE?navigator.userLanguage:navigator.language).toLowerCase();
this.characterSet=document.characterSet||document.defaultCharset||"utf-8";var t=document.createElement("div");
this.hasContentEditable=(typeof t.contentEditable=="string"||typeof t.contentEditable=="boolean");
apf.hasContentEditableContainerBug=apf.isWebkit;var props=["transform","OTransform","KhtmlTransform","MozTransform","WebkitTransform"],prefixR=["","O","Khtml","Moz","Webkit"],prefixC=["","o-","khtml-","moz-","webkit-"],events=["transitionend","transitionend","transitionend","transitionend","webkitTransitionEnd"],i=0,l=5;
this.supportCSSAnim=false;this.supportCSSTransition=false;for(;i<l&&!this.supportCSSAnim;
++i){if(typeof t.style[props[i]]=="undefined"){continue;}this.supportCSSAnim=props[i];
this.runtimeStylePrefix=prefixR[i];this.classNamePrefix=prefixC[i];this.cssAnimEvent=events[i];
}t=null;delete t;this.supportVML=apf.isIE;this.supportSVG=!apf.isIE||apf.isIE>8;
this.hasHtml5XDomain=apf.versionGecko>=3.5;this.supportCanvas=!!document.createElement("canvas").getContext;
this.supportCanvasText=!!(this.supportCanvas&&typeof document.createElement("canvas").getContext("2d").fillText=="function");
this.hasVideo=!!document.createElement("video")["canPlayType"];this.hasAudio=!!document.createElement("audio")["canPlayType"];
this.supportHashChange=("onhashchange" in self)&&(!apf.isIE||apf.isIE>=8);if(self.XMLHttpRequest){var xhr=new XMLHttpRequest();
this.hasXhrProgress=!!xhr.upload;if(this.hasXhrBinary=!!(xhr.sendAsBinary||xhr.upload)){this.hasHtml5File=!!(File&&File.prototype.getAsDataURL);
this.hasHtml5FileSlice=!!(File&&File.prototype.slice);}}else{this.hasXhrProgress=this.hasXhrBinary=this.hasHtml5File=this.hasHtml5FileSlice=false;
}this.windowHorBorder=this.windowVerBorder=apf.isIE8&&(!self.frameElement||parseInt(self.frameElement.frameBorder))?4:0;
this.enableAnim=!apf.isIE||apf.isIE>8;this.animSteps=apf.isIE?0.3:1;this.animInterval=apf.isIE?7:1;
this.CSSFLOAT=apf.isIE?"styleFloat":"cssFloat";this.CSSPREFIX=apf.isGecko?"Moz":(apf.isWebkit?"webkit":"");
this.CSSPREFIX2=apf.isGecko?"-moz":(apf.isWebkit?"-webkit":"");this.INLINE=apf.isIE&&apf.isIE<8?"inline":"inline-block";
this.needZoomForLayout=apf.isIE&&apf.isIE<8;this.maxHttpRetries=apf.isOpera?0:3;
this.percentageMatch=new RegExp();this.percentageMatch.compile("([\\-\\d\\.]+)\\%","g");
this.reMatchXpath=new RegExp();this.reMatchXpath.compile("(^|\\|)(?!\\@|[\\w-]+::)","g");
},hasGeoLocation:function(){return false;},extend:function(dest,src){var prop,i,x=!dest.notNull;
if(arguments.length==2){for(prop in src){if(x||src[prop]){dest[prop]=src[prop];
}}return dest;}for(i=1;i<arguments.length;i++){src=arguments[i];for(prop in src){if(x||src[prop]){dest[prop]=src[prop];
}}}return dest;},$extend:function(dest,src){for(var prop in src){dest[prop]=src[prop];
}return dest;},ajax:(function(){var f=function(){return this.oHttp.get.apply(this.oHttp,arguments);
};f.exec=function(method,args,callback,options){if(method=="ajax"&&args[0]){var opt=args[1]||{};
return this.oHttp.exec(opt.method||"GET",[args[0]],opt.callback,apf.extend(options||{},opt));
}};return f;})(),start:function(){this.started=true;var sHref=location.href.split("#")[0].split("?")[0];
this.host=location.hostname&&sHref.replace(/(\/\/[^\/]*)\/.*$/,"$1");this.hostPath=sHref.replace(/\/[^\/]*$/,"")+"/";
this.setCompatFlags();if(apf.onstart&&apf.onstart()===false){return false;}if(this.isIE){apf.runIE();
}if(apf.isWebkit){apf.runWebkit();}if(this.isOpera){apf.runOpera();}if(this.isGecko||!this.isIE&&!apf.isWebkit&&!this.isOpera){apf.runGecko();
}for(var i,l2,a,m,n,o,v,p=location.href.split(/[?&]/),l=p.length,k=1;k<l;k++){if(m=p[k].match(/(.*?)(\..*?|\[.*?\])?=([^#]*)/)){n=decodeURI(m[1]).toLowerCase(),o=this._GET;
if(m[2]){for(a=decodeURI(m[2]).replace(/\[\s*\]/g,"[-1]").split(/[\.\[\]]/),i=0,l2=a.length;
i<l2;i++){v=a[i],o=o[n]?o[n]:o[n]=(parseInt(v)==v)?[]:{},n=v.replace(/^["\'](.*)["\']$/,"$1");
}}o[n!="-1"?n:o.length]=unescape(decodeURI(m[3]));}}this.oHttp=new this.http();
this.Init.addConditional(this.parseAppMarkup,apf,["body"]);try{if(apf.isIE){document.execCommand("BackgroundImageCache",false,true);
}}catch(e){}this.started=true;if(this.load_done){this.execDeferred();}this.root=true;
for(var i=0;i<apf.$required.length;i++){apf.include(apf.$required[i]);}apf.require=apf.include;
},nsqueue:{},findPrefix:function(xmlNode,xmlns){var docEl;if(xmlNode.nodeType==9){if(!xmlNode.documentElement){return false;
}if(xmlNode.documentElement.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}docEl=xmlNode.documentElement;}else{if(xmlNode.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}docEl=xmlNode.ownerDocument.documentElement;if(docEl&&docEl.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}while(xmlNode.parentNode){xmlNode=xmlNode.parentNode;if(xmlNode.namespaceURI==xmlns){return xmlNode.prefix||xmlNode.scopeName;
}}}if(docEl){for(var i=0;i<docEl.attributes.length;i++){if(docEl.attributes[i].nodeValue==xmlns){return docEl.attributes[i][apf.TAGNAME];
}}}return false;},importClass:function(ref,strip,win){if(!ref){throw new Error(apf.formatErrorString(1018,null,"importing class","Could not load reference. Reference is null"));
}if(!strip){return apf.jsexec(ref.toString(),win);}var q=ref.toString().replace(/^\s*function\s*\w*\s*\([^\)]*\)\s*\{/,"").replace(/\}\s*$/,"");
return apf.jsexec(q,win);},toString:function(){return"[Ajax.org Platform (apf)]";
},all:[],implement:function(classRef){if(arguments.length==1){classRef.call(this);
}else{for(var a,i=0,l=arguments.length;i<l;i++){a=arguments[i];arguments[i].call(this);
}}return this;},uniqueHtmlIds:0,setUniqueHtmlId:function(oHtml){var id;oHtml.setAttribute("id",id="q"+this.uniqueHtmlIds++);
return id;},getUniqueId:function(){return this.uniqueHtmlIds++;},lookup:function(uniqueId){return this.all[uniqueId];
},findHost:function(o){while(o&&o.parentNode){try{if((o.host||o.host===false)&&typeof o.host!="string"){return o.host;
}}catch(e){}o=o.parentNode;}return null;},setReference:function(name,o){return self[name]&&self[name].hasFeature?0:(self[name]=o);
},console:{debug:function(msg,subtype,data){},time:function(msg,subtype,data){},log:function(msg,subtype,data){},info:function(msg,subtype,data){},warn:function(msg,subtype,data){},error:function(msg,subtype,data){},dir:function(obj){var s=apf.$debugwin.$serializeObject(obj,"Inspected via apf.console.dir");
if(typeof s=="string"){this.write(s,"custom",null,null,null,true);}else{this.write(obj?"Could not serialize object: "+s.message:obj,"error",null,null,null,true);
}}},html_entity_decode:function(s){return s;},htmlentities:function(s){return s;
},formatErrorString:function(number,control,process,message,amlContext,outputname,output){apf.lastErrorMessage=message;
return message;},getDirname:function(url){return((url||"").match(/^([^#]*\/)[^\/]*(?:$|\#)/)||{})[1];
},getFilename:function(url){return((url||"").split("?")[0].match(/(?:\/|^)([^\/]+)$/)||{})[1];
},getAbsolutePath:function(base,url){return url&&url.charAt(0)=="/"?url:(!url||!base||url.match(/^\w+\:\/\//)?url:base.replace(/\/$/,"")+"/"+url.replace(/^\//,""));
},include:function(sourceFile,doBase,type,text,callback){var sSrc=doBase?apf.getAbsolutePath(apf.basePath||"",sourceFile):sourceFile;
var head=document.getElementsByTagName("head")[0],elScript=document.createElement("script");
if(type){elScript.setAttribute("_apf_type",type);}if(text){if(apf.isIE){window.execScript(text);
}else{elScript.text=text;}}else{elScript.src=sSrc;}head.appendChild(elScript);if(callback){elScript[apf.isIE?"onreadystatechange":"onload"]=callback;
}return elScript;},$required:[],require:function(){var dir=apf.getDirname(location.href),i=0,l=arguments.length;
for(;i<l;i++){this.$required.push(apf.getAbsolutePath(dir,arguments[i]));}},Init:{queue:[],cond:{combined:[]},done:{},add:function(func,o){if(this.inited){func.call(o);
}else{if(func){this.queue.push([func,o]);}}},addConditional:function(func,o,strObj){if(typeof strObj!="string"){if(this.checkCombined(strObj)){return func.call(o);
}this.cond.combined.push([func,o,strObj]);}else{if(self[strObj]){func.call(o);}else{if(!this.cond[strObj]){this.cond[strObj]=[];
}this.cond[strObj].push([func,o]);this.checkAllCombined();}}},checkAllCombined:function(){for(var i=0;
i<this.cond.combined.length;i++){if(!this.cond.combined[i]){continue;}if(this.checkCombined(this.cond.combined[i][2])){this.cond.combined[i][0].call(this.cond.combined[i][1]);
this.cond.combined[i]=null;}}},checkCombined:function(arr){for(var i=0;i<arr.length;
i++){if(!this.done[arr[i]]){return false;}}return true;},run:function(strObj){this.inited=this.done[strObj]=true;
this.checkAllCombined();var data=strObj?this.cond[strObj]:this.queue;if(!data){return;
}for(var i=0;i<data.length;i++){data[i][0].call(data[i][1]);}}},amlParts:[],parseStrategy:0,parsePartialAml:function(docElement){var findAml;
if(apf.isIE){findAml=function(htmlNode){try{var tags={IMG:1,LINK:1,META:1,INPUT:1,BR:1,HR:1,AREA:1,BASEFONT:1},regex=new RegExp(htmlNode.outerHTML.replace(/([\(\)\|\\\.\^\$\{\}\[\]])/g,"\\$1")+".*"+htmlNode.tagName),match=htmlNode.parentNode.outerHTML.replace(/\n/g,"").match(regex),strXml=match[0]+">".replace(/(\w+)\s*=\s*([^\>="'\s ]+)( |\s|\>|\/\>)/g,'$1="$2"$3').replace(/ disabled /g," disabled='true' ").replace(/\]\]\&gt;/g,"]]>").replace(/<(\w+)(\s[^>]*[^\/])?>/g,function(m,tag,c){if(tags[tag]){return"<"+tag+(c||"")+"/>";
}else{return m;}});}catch(e){return;}var xmlNode=apf.getAmlDocFromString("<div jid='"+(id++)+"' "+strXmlns+">"+strXml+"</div>").documentElement;
while(xmlNode.childNodes.length>1){xmlNode.removeChild(xmlNode.lastChild);}apf.AppNode.appendChild(xmlNode);
};}else{findAml=function(htmlNode){var strXml=htmlNode.outerHTML.replace(/ _moz-userdefined=""/g,""),xmlNode=apf.getAmlDocFromString("<div jid='"+(id++)+"' "+strXmlns+">"+strXml+"</div>").documentElement;
while(xmlNode.childNodes.length>1){xmlNode.removeChild(xmlNode.lastChild);}if(apf.isWebkit){xmlNode=apf.AppNode.ownerDocument.importNode(xmlNode,true);
}apf.AppNode.appendChild(xmlNode);};}var match=document.body.outerHTML.match(/(\w+)\s*=\s*["']http:\/\/ajax\.org\/2005\/aml["']/);
if(!match){return false;}var strXmlns="xmlns:"+match[0],prefix=(RegExp.$1||"").toUpperCase();
if(apf.isOpera){prefix=prefix.toLowerCase();}if(!prefix){return false;}prefix+=":";
apf.AppNode=apf.getAmlDocFromString("<"+prefix.toLowerCase()+"application "+strXmlns+" />").documentElement;
var temp,loop,cnode,isPrefix=false,id=0,node=document.body;while(node){isPrefix=node.nodeType==1&&node.tagName.substr(0,2)==prefix;
if(isPrefix){findAml(cnode=node);if(apf.isIE){loop=node;var count=1,next=loop.nextSibling;
if(next){loop.parentNode.removeChild(loop);while(next&&(next.nodeType!=1||next.tagName.indexOf(prefix)>-1)){if(next.nodeType==1){count+=next.tagName.charAt(0)=="/"?-1:1;
}if(count==0){if(temp){temp.parentNode.removeChild(temp);}temp=next;break;}next=(loop=next).nextSibling;
if(!next){next=loop;break;}if(loop.nodeType==1){loop.parentNode.removeChild(loop);
if(temp){temp.parentNode.removeChild(temp);temp=null;}}else{if(temp){temp.parentNode.removeChild(temp);
}temp=loop;}}node=next;}else{if(temp){temp.parentNode.removeChild(temp);}temp=loop;
}}else{if(temp){temp.parentNode.removeChild(temp);}temp=node;}if(apf.amlParts.length&&apf.amlParts[apf.amlParts.length-1][1]==cnode){apf.amlParts[apf.amlParts.length-1][1]=-1;
}apf.amlParts.push([node.parentNode,apf.isIE?node.nextSibling:node.nextSibling]);
}else{if(node.tagName=="SCRIPT"&&node.getAttribute("src")&&(node.getAttribute("src").indexOf("ajax.org")>-1)){var strXml=node.outerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/<SCRIPT[^>]*\>\s*<\!\[CDATA\[>?/i,"").replace(/<SCRIPT[^>]*\>(?:<\!\-\-)?/i,"").replace(/(\/\/)?\s*\&\#8211;>\s*<\/SCRIPT>/i,"").replace(/\-\->\s*<\/SCRIPT>/i,"").replace(/\]\](?:\&gt\;|>)\s*<\/SCRIPT>/i,"").replace(/<\/SCRIPT>$/mi,"").replace(/<\/?\s*(?:p|br)\s*\/?>/ig,"").replace(/<\!--\s*.*?\s*-->\s*<script.*/ig,"").replace(/\\+(['"])/g,"$1");
if(strXml.trim()){var xmlNode=apf.getAmlDocFromString("<div jid='"+(id++)+"' "+strXmlns+">"+strXml+"</div>").documentElement;
if(apf.isWebkit){xmlNode=apf.AppNode.ownerDocument.importNode(xmlNode,true);}apf.AppNode.appendChild(xmlNode);
apf.amlParts.push([node.parentNode,node.nextSibling]);}}}if(!isPrefix&&node.firstChild||node.nextSibling){if(!isPrefix&&node.firstChild){node=node.firstChild;
}else{node=node.nextSibling;}}else{do{node=node.parentNode;if(node.tagName=="BODY"){node=null;
}}while(node&&!node.nextSibling);if(node){node=node.nextSibling;}}}if(temp){temp.parentNode.removeChild(temp);
}},parseAppMarkup:function(docElement){var isEmptyDocument=false;if(this.parseStrategy==1||!this.parseStrategy&&!docElement&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){this.parsePartialAml(docElement);
if(this.parseStrategy==1||apf.amlParts.length){apf.isParsingPartial=true;apf.loadAmlIncludes(apf.AppNode);
if(!self.ERROR_HAS_OCCURRED){apf.initialize();}return;}else{isEmptyDocument=true;
}}if(isEmptyDocument&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){return false;
}if(this.parseStrategy==21||!this.parseStrategy&&!docElement){return apf.oHttp.get((apf.alternativeAml||document.body&&document.body.getAttribute("xmlurl")||location.href).split(/#/)[0],{callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){var oError=new Error(apf.formatErrorString(0,null,"Loading XML application data","Could not load XML from remote source: "+extra.message));
if(extra.tpModule.retryTimeout(extra,state,null,oError)===true){return true;}throw oError;
}var str=xmlString.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){str=str.replace(/xmlns\=\"[^"]*\"/g,"");
}if(self.ERROR_HAS_OCCURRED){return;}if(apf.isIE){document.body.innerHTML="";}else{var nodes=document.body.childNodes;
for(var i=nodes.length-1;i>=0;i--){nodes[i].parentNode.removeChild(nodes[i]);}}document.documentElement.style.display="block";
document.body.style.display="block";apf.initialize(str);},ignoreOffline:true});
}else{document.body.style.display="block";if(!self.ERROR_HAS_OCCURRED){apf.initialize(docElement.outerHTML||docElement.xml);
}}},namespaces:{},setNamespace:function(namespaceURI,oNamespace){this.namespaces[namespaceURI]=oNamespace;
oNamespace.namespaceURI=namespaceURI;},initialize:function(xmlStr){apf.console.info("Initializing...");
clearInterval(apf.Init.interval);apf.Init.run();var bodyMarginTop=parseFloat(apf.getStyle(document.body,"marginTop"));
apf.doesNotIncludeMarginInBodyOffset=(document.body.offsetTop!==bodyMarginTop);
if(apf.isParsingPartial){apf.config.setDefaults();apf.hasSingleRszEvent=true;var pHtmlNode=document.body;
var lastChild=pHtmlNode.lastChild;apf.AmlParser.parseMoreAml(apf.AppNode,pHtmlNode,null,true,false);
var pNode,firstNode,next,info,lastBefore=null,loop=pHtmlNode.lastChild;while(loop&&lastChild!=loop){info=apf.amlParts[loop.getAttribute("jid")];
next=loop.previousSibling;if(info){pNode=info[0];if("P".indexOf(pNode.tagName)>-1){lastBefore=pNode.parentNode.insertBefore(apf.getNode(loop,[0]),pNode);
}else{firstNode=apf.getNode(loop,[0]);while(firstNode){if(firstNode){lastBefore=pNode.insertBefore(firstNode,typeof info[1]=="number"?lastBefore:info[1]);
}else{lastBefore=typeof info[1]=="number"?lastBefore:info[1];}firstNode=apf.getNode(loop,[0]);
}}loop.parentNode.removeChild(loop);}loop=next;}$setTimeout("apf.layout.forceResize();");
}else{apf.window.init(xmlStr);}},execDeferred:function(){var len=apf.load_events.length;
while(len--){(apf.load_events.shift())();}},load_events:[],load_timer:null,load_done:false,load_init:null,addDomLoadEvent:function(func){if(!this.$bdetect){this.browserDetect();
}if(apf.load_done){return func();}if(!apf.load_init){apf.load_init=function(){if(apf.load_done){return;
}clearInterval(apf.load_timer);apf.load_timer=null;apf.load_done=true;if(apf.started){apf.execDeferred();
}};}apf.load_events.push(func);if(func&&apf.load_events.length==1){var doc=document,UNDEF="undefined";
if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(doc.getElementsByTagName("body")[0]||doc.body)){return apf.load_init();
}if(doc.addEventListener&&!apf.isOpera){window.addEventListener("DOMContentLoaded",apf.load_init,false);
}else{if(apf.isIE&&window==top){apf.load_timer=setInterval(function(){try{doc.documentElement.doScroll("left");
}catch(ex){$setTimeout(arguments.callee,0);return;}apf.load_init();},10);}else{if(apf.isOpera){doc.addEventListener("DOMContentLoaded",function(){apf.load_timer=setInterval(function(){for(var i=0,l=doc.styleSheets.length;
i<l;i++){if(doc.styleSheets[i].disabled){return;}}apf.load_init();},10);},false);
}else{if(apf.isWebkit&&!apf.isIphone){var aSheets=doc.getElementsByTagName("link"),i=aSheets.length,iSheets;
for(;i>=0;i++){if(!aSheets[i]||aSheets[i].getAttribute("rel")!="stylesheet"){aSheets.splice(i,0);
}}iSheets=aSheets.length;apf.load_timer=setInterval(function(){if(/loaded|complete/.test(doc.readyState)&&doc.styleSheets.length==iSheets){apf.load_init();
}},10);}else{var old_onload=window.onload;window.onload=function(){apf.load_init();
if(old_onload){old_onload();}};}}}}}},fireEvent:function(el,type,e,capture){if(el.dispatchEvent){el.dispatchEvent(type,e,capture);
}else{el.fireEvent("on"+type,e);}},addListener:function(el,type,fn){if(el.addEventListener){el.addEventListener(type,fn,false);
}else{if(el.attachEvent){el.attachEvent("on"+type,fn);}}return this;},removeListener:function(el,type,fn){if(el.removeEventListener){el.removeEventListener(type,fn,false);
}else{if(el.detachEvent){el.detachEvent("on"+type,fn);}}return this;},stopEvent:function(e){this.stopPropagation(e).preventDefault(e);
return false;},stopPropagation:function(e){if(e.stopPropagation){e.stopPropagation();
}else{e.cancelBubble=true;}return this;},preventDefault:function(e){if(e.preventDefault){e.preventDefault();
}else{e.returnValue=false;}return this;},unload:function(exclude){this.isDestroying=true;
this.popup.destroy();var node,i=0,l=this.all.length;for(;i<l;i++){node=this.all[i];
if(node&&node!=exclude&&node.destroy&&!node.apf){node.destroy(false);}}for(i=0,l=this.availHTTP.length;
i<l;i++){this.availHTTP[i]=null;}this.availHTTP.length=0;if(apf.xmldb){apf.xmldb.unbind(apf.window);
}this.isDestroying=false;}};var $xmlns=function(xmlNode,tag,xmlns,prefix){if(!apf.supportNamespaces){if(!prefix){prefix=apf.findPrefix(xmlNode,xmlns);
}if(xmlNode.style||xmlNode==document){return xmlNode.getElementsByTagName(tag);
}else{if(prefix){(xmlNode.nodeType==9?xmlNode:xmlNode.ownerDocument).setProperty("SelectionNamespaces","xmlns:"+prefix+"='"+xmlns+"'");
}return xmlNode.selectNodes(".//"+(prefix?prefix+":":"")+tag);}}return xmlNode.getElementsByTagNameNS(xmlns,tag);
};var $setTimeout=setTimeout;var $setInterval=setInterval;apf.setTimeout=function(f,t){apf.$eventDepth++;
return $setTimeout(function(){f();if(--apf.$eventDepth==0){apf.queue.empty();}},t);
};document.documentElement.className+=" has_apf";document.documentElement.style.display="none";
apf.browserDetect();apf.Init.run("apf");apf.Class=function(){};apf.Class.prototype=new (function(){var FUN="function",OBJ="object",UNDEF="undefined",SEL="model",PROP="prop.",MODEL="model",VALUE="value";
this.$regbase=0;this.hasFeature=function(test){return this.$regbase&test;};this.$initStack=[];
this.$bufferEvents=[];this.$init=function(callback,nodeFunc,struct){if(typeof callback==FUN||callback===true){this.$bufferEvents=this.$bufferEvents.slice();
if(callback===true){return this;}this.$initStack=this.$initStack.slice();this.$initStack.push(callback);
return this;}this.addEventListener=realAddEventListener;if(this.nodeType!=2){this.$uniqueId=apf.all.push(this)-1;
}this.$captureStack={};this.$eventsStack={};this.$funcHandlers={};var i=0,l=this.$initStack.length;
for(;i<l;i++){this.$initStack[i].apply(this,arguments);}for(i=0,l=this.$bufferEvents.length;
i<l;i++){this.addEventListener.apply(this,this.$bufferEvents[i]);}delete realAddEventListener;
delete this.$initStack;delete this.$bufferEvents;if(struct&&(struct.htmlNode||this.nodeFunc==apf.NODE_HIDDEN)){this.$pHtmlNode=struct.htmlNode;
this.ownerDocument.$domParser.$continueParsing(this);apf.queue.empty();}return this;
};this.implement=apf.implement;this.$handlePropSet=function(prop,value){this[prop]=value;
};this.$bindProperty=function(myProp,bObject,bProp,fParsed,bRecip){if(!fParsed){return bObject.$handlePropSet(bProp,this[myProp]);
}var eventName=PROP+myProp,eFunc,isBeingCalled,isLang;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(eFunc=function(e){if(isBeingCalled){return;
}isBeingCalled=true;try{if(fParsed.asyncs){return fParsed.call(bObject,bObject.xmlRoot,function(value){bObject.setProperty(bProp,value,true,false,10);
isBeingCalled=false;});}else{var value=fParsed.call(bObject,bObject.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding for property "+bProp+"\n\n"+e.message);
isBeingCalled=false;return;}bObject.setProperty(bProp,value,true,false,10);isBeingCalled=false;
});if(bRecip){eventName=PROP+bProp;var _self=this;(bObject.$eventsStack[eventName]||(bObject.$eventsStack[eventName]=[])).push(eFunc.recip=function(){if(isBeingCalled){return;
}isBeingCalled=true;_self.setProperty(myProp,bObject[bProp],true,false,10);isBeingCalled=false;
});}return eFunc;};this.$attrExcludePropBind=false;this.$setDynamicProperty=function(prop,pValue){var exclNr=this.$attrExcludePropBind[prop],options;
if(SEL.indexOf(prop)>-1||exclNr==3){options={xpathmode:2};}else{if(exclNr==2){options={nostring:true};
}else{if(exclNr===0){options={parsecode:true};}}}if(this.liveedit){(options||(options={})).liveedit=true;
}if(pValue&&pValue.dataType==apf.FUNCTION){var fParsed=pValue;pValue="";}else{var fParsed=apf.lm.compile(pValue,options);
}if(prop==MODEL){(this.$modelParsed=fParsed).instruction=pValue;}if(fParsed.type==2){this[prop]=!pValue;
return this.setProperty(prop,fParsed.str,null,null,10);}var check=1;if(exclNr==2||fParsed.xpaths.length&&exclNr!=1){if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);
if(this.$attrExcludePropBind[prop]==1){check=0;}}if(check){this.$addAttrBind(prop,fParsed,pValue);
}}var matches=exclNr&&exclNr!=3&&prop!=MODEL?{}:fParsed.props,found=false,_self=this,o,node,bProp,p;
for(p in matches){o=p.split(".");if(o.length>2){bProp=o.pop();try{node=eval(o.join("."));
}catch(e){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);
}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);
_self.$setDynamicProperty(prop,pValue,true);});}continue;}if(!node||typeof node!=OBJ||(!node.$regbase&&node.$regbase!==0)){bProp=o[1];
node=self[o[0]];}else{o.push(bProp);}}else{bProp=o[1];node=self[o[0]]||o[0]=="this"&&this;
}if(!node){if(arguments[2]){apf.console.warn("[287] Could not create property binding:  '"+o[0]+"' does not exist. \n"+pValue.replace(/</g,"&lt;").substr(0,400));
var _self=this;apf.nameserver.waitFor(o[0],function(){_self.$setDynamicProperty(prop,pValue);
});return;}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);
_self.$setDynamicProperty(prop,pValue,true);});return;}}if(!node.$bindProperty){continue;
}if(!this.$funcHandlers[prop]){this.$funcHandlers[prop]=[];}var last;this.$funcHandlers[prop].push(last={amlNode:node,prop:bProp,handler:node.$bindProperty(bProp,this,prop,fParsed,fParsed.type==4&&SEL.indexOf(prop)==-1)});
found=true;}if(found){last.handler({initial:true});}else{if(exclNr){return this.setProperty(prop,pValue,null,null,10);
}try{if(fParsed.asyncs){return fParsed.call(this,this.xmlRoot,function(value){_self.setProperty(prop,value,true,null,10);
});}else{var value=fParsed.call(this,this.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding test or: "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);
return;}this[prop]=!value;this.setProperty(prop,value,true,null,10);}};this.$clearDynamicProperty=function(prop){if(this.$removeAttrBind){this.$removeAttrBind(prop);
}if(this.$inheritProperties){delete this.$inheritProperties[prop];}if(prop==MODEL){this.$modelParsed=null;
}var f,i,l,h=this.$funcHandlers[prop];if(h&&typeof h!=FUN){for(i=0,l=h.length;i<l;
i++){(f=h[i]).amlNode.removeEventListener(PROP+f.prop,f.handler);if(f.handler&&f.handler.recip){this.removeEventListener(PROP+prop,f.handler.recip);
}}delete this.$funcHandlers[prop];}};this.watch=function(propName,callback){var eventName=PROP+propName,wrapper=function(e){callback.call(this,propName,e.oldvalue,e.value);
};wrapper.callback=callback;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(wrapper);
};this.unwatch=function(propName,callback){var list,eventName=PROP+propName;if(!(list=this.$eventsStack[eventName])){return;
}for(var i=0,l=list.length;i<l;i++){if(list[i].callback==callback){list.remove(i);
return;}}};this.getAvailableProperties=function(){return this.$supportedProperties.slice();
};this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){var s,r,arr,e,i,l,oldvalue=this[prop],eventName=PROP+prop;
try{var isChanged=(typeof value==OBJ)?value!=(typeof oldvalue==OBJ?oldvalue:null):String(oldvalue)!==String(value);
}catch(e){var isChanged=true;}if(isChanged){if(!forceOnMe){if(typeof value!=OBJ&&(!(s=this.$attrExcludePropBind[prop]))&&(r=(this.$attrBindings&&this.$attrBindings[prop]||prop!=VALUE&&this.xmlRoot&&this.$bindings[prop]&&this.$bindings[prop][0]))){if(r.cvalue.type==3){return apf.setNodeValue(this.$getDataNode(prop.toLowerCase(),this.xmlRoot,true),value,true);
}}}if(setAttr){this.setAttribute(prop,value,true);}if(this.$handlePropSet(prop,value,forceOnMe)===false){return;
}value=this[prop];}if(arr=this.$eventsStack[eventName]){if(this.dispatchEvent(eventName,{prop:prop,value:value,oldvalue:oldvalue,changed:isChanged})===false){e.returnValue=false;
}}if((aci||(aci=apf.config.$inheritProperties))[prop]){var resetting=value===""||typeof value=="undefined";
if(inherited!=10&&!value){delete this.$inheritProperties[prop];if(this.$setInheritedAttribute&&this.$setInheritedAttribute(prop)){return;
}}else{if(inherited!=10){this.$inheritProperties[prop]=inherited||-1;}}if(this.$amlLoaded&&(!e||e.returnValue!==false)&&this.childNodes){var inheritType=aci[prop];
(function recur(nodes){var i,l,node,n;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.nodeType!=1&&node.nodeType!=7){continue;}n=node.$inheritProperties[prop];
if(inheritType==1&&!n){recur(node.childNodes);}else{if(!(n<0)){if(n==3||inherited==3){var sameValue=node[prop];
node[prop]=null;}node.setProperty(prop,n!=3?value:sameValue,false,false,n||2);}}}})(this.childNodes);
}}return value;};var aci;this.getProperty=function(prop){return this[prop];};apf.$eventDepth=0;
this.$eventDepth=0;this.dispatchEvent=function(eventName,options,e){var arr,result,rValue,i,l;
apf.$eventDepth++;this.$eventDepth++;e=options&&options.name?options:e;if((!e||!e.currentTarget)&&(!options||!options.currentTarget)){if(!(options||(options={})).currentTarget){options.currentTarget=this;
}if(arr=this.$captureStack[eventName]){for(i=0,l=arr.length;i<l;i++){rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));
if(typeof rValue!=UNDEF){result=rValue;}}}}if(options&&options.captureOnly){return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;
}else{if(this["on"+eventName]){result=this["on"+eventName].call(this,e||(e=new apf.AmlEvent(eventName,options)));
}if(arr=this.$eventsStack[eventName]){for(i=0,l=arr.length;i<l;i++){if(!arr[i]){continue;
}rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;
}}}}if((e&&e.bubbles&&!e.cancelBubble||!e&&options&&options.bubbles)&&this!=apf){rValue=(this.parentNode||this.ownerElement||apf).dispatchEvent(eventName,options,e);
if(typeof rValue!=UNDEF){result=rValue;}}if(--apf.$eventDepth==0&&this.ownerDocument&&!this.ownerDocument.$domParser.$parseContext&&!apf.isDestroying&&apf.loaded&&apf.queue){apf.queue.empty();
}this.$eventDepth--;if(options){try{delete options.currentTarget;}catch(ex){options.currentTarget=null;
}}return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;};this.addEventListener=function(a,b,c){this.$bufferEvents.push([a,b,c]);
};var realAddEventListener=function(eventName,callback,useCapture){if(eventName.substr(0,2)=="on"){eventName=eventName.substr(2);
}var s,stack=useCapture?this.$captureStack:this.$eventsStack;if(!(s=stack[eventName])){s=stack[eventName]=[];
}if(s.indexOf(callback)>-1){return;}s.unshift(callback);var f;if(f=this.$eventsStack["$event."+eventName]){f[0].call(this,callback);
}};this.removeEventListener=function(eventName,callback,useCapture){var stack=(useCapture?this.$captureStack:this.$eventsStack)[eventName];
if(stack){if(this.$eventDepth){stack=(useCapture?this.$captureStack:this.$eventsStack)[eventName]=stack.slice();
}stack.remove(callback);if(!stack.length){delete (useCapture?this.$captureStack:this.$eventsStack)[eventName];
}}};this.hasEventListener=function(eventName){return(this.$eventsStack[eventName]&&this.$eventsStack[eventName].length>0);
};this.destroy=function(deep,clean){if(typeof this.$uniqueId==UNDEF&&this.nodeType!=2){return;
}this.$amlLoaded=false;this.$amlDestroyed=true;if(this.$destroy){this.$destroy();
}this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:!apf.isDestroying});
this.dispatchEvent("DOMNodeRemovedFromDocument");apf.all[this.$uniqueId]=undefined;
if(!this.nodeFunc&&!this.nodeType){try{if(this.id||this.name){self[this.id||this.name]=null;
}}catch(ex){}return;}if(this.$ext&&!this.$ext.isNative){if(this.nodeType==1&&this.localName!="a"){this.$ext.oncontextmenu=this.$ext.host=null;
}if(clean){if(this.localName!="collection"){this.$ext.parentNode.removeChild(this.$ext);
}}}if(this.$int&&!this.$int.isNative&&this.$int.nodeType==1&&this.localName!="a"){this.$int.host=null;
}this.$aml=null;if(deep&&this.childNodes){var nodes=this.childNodes;for(i=nodes.length-1;
i>=0;i--){if(nodes[i].destroy){nodes[i].destroy(true,clean&&this.localName=="collection");
}}this.childNodes=null;}if(this.parentNode&&this.removeNode){this.removeNode();
}else{if(this.ownerElement&&!this.ownerElement.$amlDestroyed){this.ownerElement.removeAttributeNode(this);
}}if(this.$focussable&&this.focussable){apf.window.$removeFocus(this);}if(this.attributes){var attr=this.attributes;
for(var i=attr.length-1;i>=0;i--){this.$clearDynamicProperty(attr[i].nodeName);
attr[i].destroy();}}try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}apf.nameserver.remove(this.localName,this);
};})();apf.extend(apf,new apf.Class().$init());apf.Init.run("class");apf.color={colorshex:{aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662680,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14184595,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fixHSB:function(hsb){return{h:Math.min(360,Math.max(0,hsb.h)),s:Math.min(100,Math.max(0,hsb.s)),b:Math.min(100,Math.max(0,hsb.b))};
},fixRGB:function(rgb){return{r:Math.min(255,Math.max(0,rgb.r)),g:Math.min(255,Math.max(0,rgb.g)),b:Math.min(255,Math.max(0,rgb.b))};
},fixHex:function(hex){var len=6-hex.length;if(len>0){var o=[],i=0;for(;i<len;i++){o.push("0");
}o.push(hex);hex=o.join("");}return hex;},hexToRGB:function(hex){hex=parseInt(((hex.indexOf("#")>-1)?hex.substring(1):hex),16);
return{r:hex>>16,g:(hex&65280)>>8,b:(hex&255)};},hexToHSB:function(hex){return this.RGBToHSB(this.hexToRGB(hex));
},RGBToHSB:function(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b),max=Math.max(rgb.r,rgb.g,rgb.b),delta=max-min;
hsb.b=max;if(max!=0){}hsb.s=max!=0?255*delta/max:0;if(hsb.s!=0){if(rgb.r==max){hsb.h=(rgb.g-rgb.b)/delta;
}else{if(rgb.g==max){hsb.h=2+(rgb.b-rgb.r)/delta;}else{hsb.h=4+(rgb.r-rgb.g)/delta;
}}}else{hsb.h=-1;}hsb.h*=60;if(hsb.h<0){hsb.h+=360;}hsb.s*=100/255;hsb.b*=100/255;
return hsb;},HSBToRGB:function(hsb){var rgb={},h=Math.round(hsb.h),s=Math.round(hsb.s*255/100),v=Math.round(hsb.b*255/100);
if(s==0){rgb.r=rgb.g=rgb.b=v;}else{var t1=v,t2=(255-s)*v/255,t3=(t1-t2)*(h%60)/60;
if(h==360){h=0;}if(h<60){rgb.r=t1,rgb.b=t2,rgb.g=t2+t3;}else{if(h<120){rgb.g=t1,rgb.b=t2,rgb.r=t1-t3;
}else{if(h<180){rgb.g=t1,rgb.r=t2,rgb.b=t2+t3;}else{if(h<240){rgb.b=t1,rgb.r=t2,rgb.g=t1-t3;
}else{if(h<300){rgb.b=t1,rgb.g=t2,rgb.r=t2+t3;}else{if(h<360){rgb.r=t1,rgb.g=t2,rgb.b=t1-t3;
}else{rgb.r=0,rgb.g=0,rgb.b=0;}}}}}}}return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)};
},RGBToHex:function(rgb){return("00000"+(rgb.r<<16|rgb.g<<8|rgb.b).toString(16)).slice(-6);
},HSBToHex:function(hsb){return this.RGBToHex(this.HSBToRGB(hsb));}};apf.AbstractEvent=function(event,win){win=win||window;
var doc=win.document;event=event||win.event;if(event.$extended){return event;}this.$extended=true;
this.event=event;this.type=event.type;this.target=event.target||event.srcElement;
while(this.target&&this.target.nodeType==3){this.target=this.target.parentNode;
}if(this.type.indexOf("key")!=-1){this.code=event.which||event.keyCode;}else{if(this.type.match(/(click|mouse|menu)/i)){doc=(!doc.compatMode||doc.compatMode=="CSS1Compat")?doc.html:doc.body;
this.page={x:event.pageX||event.clientX+(doc?doc.scrollLeft:0),y:event.pageY||event.clientY+(doc?doc.scrollTop:0)};
this.client={x:(event.pageX)?event.pageX-win.pageXOffset:event.clientX,y:(event.pageY)?event.pageY-win.pageYOffset:event.clientY};
if(this.type.match(/DOMMouseScroll|mousewheel/)){this.wheel=(event.wheelDelta)?event.wheelDelta/120:-(event.detail||0)/3;
}this.rightClick=(event.which==3)||(event.button==2);this.relatedTarget=null;if(this.type.match(/over|out/)){if(this.type=="mouseover"){this.relatedTarget=event.relatedTarget||event.fromElement;
}else{if(this.type=="mouseout"){this.relatedTarget=event.relatedTarget||event.toElement;
}else{try{while(this.relatedTarget&&this.relatedTarget.nodeType==3){this.relatedTarget=this.relatedTarget.parentNode;
}}catch(e){}}}}}}this.shift=Boolean(event.shiftKey);this.control=Boolean(event.ctrlKey);
this.alt=Boolean(event.altKey);this.meta=Boolean(event.metaKey);this.stop=function(){return this.stopPropagation().preventDefault();
};this.stopPropagation=function(){if(this.event.stopPropagation){this.event.stopPropagation();
}else{this.event.cancelBubble=true;}return this;};this.preventDefault=function(){if(this.event.preventDefault){this.event.preventDefault();
}else{this.event.returnValue=false;}return this;};};apf.AbstractEvent.KEYS={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46,fromCode:function(code){for(var i in this){if(this[i]==code){return i;
}return null;}}};apf.AbstractEvent.stop=function(event){return(new apf.AbstractEvent(event)).stop();
};apf.asyncForEach=function(list,async,callback){var i=0;var len=list.length;if(!len){return callback(null,[]);
}async(list[i],function handler(err){if(err){return callback(err);}i++;if(i<len){async(list[i],handler,i);
}else{callback(null);}},i);};apf.asyncWhile=function(condition,async,callback){var i=0;
async(i,function handler(err){if(err){return callback?callback(err,i):null;}++i;
if(condition(i)){async(i,handler);}else{callback&&callback(null,i);}});};apf.asyncMap=function(list,mapper,callback){var i=0;
var len=list.length;if(!len){return callback(null,[]);}var map=[];async(list[i],function handler(err,value){if(err){return callback(err);
}map[i]=value;i++;if(i<len){async(list[i],handler);}else{callback(null,map);}});
};apf.asyncChain=function(funcs){var i=0;var len=funcs.length;function next(){var f=funcs[i++];
if(i==len){f();}else{f(next);}}next();};if(typeof isFinite=="undefined"){function isFinite(val){return val+1!=val;
}}apf.NUMBER=1;apf.BOOLEAN=2;apf.STRING=3;apf.ARRAY=4;apf.DATE=5;apf.REGEXP=6;apf.FUNCTION=7;
Array.prototype.dataType=apf.ARRAY;Number.prototype.dataType=apf.NUMBER;Date.prototype.dataType=apf.DATE;
Boolean.prototype.dataType=apf.BOOLEAN;String.prototype.dataType=apf.STRING;RegExp.prototype.dataType=apf.REGEXP;
Function.prototype.dataType=apf.FUNCTION;apf.getCgiString=function(args,multicall,mcallname){var vars=[];
function recur(o,stack){var prop;if(apf.isArray(o)){for(var j=0;j<o.length;j++){recur(o[j],stack+"%5B%5D");
}}else{if(typeof o=="object"){for(prop in o){if(apf.isSafariOld&&(!o[prop]||typeof p[prop]!="object")){continue;
}if(typeof o[prop]=="function"){continue;}recur(o[prop],stack+"%5B"+encodeURIComponent(prop)+"%5D");
}}else{vars.push(stack+"="+encodeURIComponent(o));}}}if(multicall){vars.push("func="+mcallname);
for(var i=0;i<args[0].length;i++){recur(args[0][i],"f%5B"+i+"%5D");}}else{for(prop in args){if(apf.isSafariOld&&(!args[prop]||typeof args[prop]=="function")){continue;
}recur(args[prop],prop);}}return vars.join("&");};apf.fromCgiString=function(args){if(!args){return false;
}var obj={};args=args.split("&");for(var data,i=0;i<args.length;i++){data=args[i].split("=");
data[0]=decodeURIComponent(data[0]);var path=data[0].replace(/\]/g,"").split("[");
var spare=obj;for(var j=0;j<path.length;j++){if(spare[path[j]]){spare=spare[path[j]];
}else{if(path.length==j+1){if(path[j]){spare[path[j]]=decodeURIComponent(data[1]);
}else{spare.push(decodeURIComponent(data[1]));}break;}else{spare[path[j]]=!path[j+1]?[]:{};
spare=spare[path[j]];}}}}return obj;};Function.prototype.extend=function(){apf.extend.apply(this,[this].concat(Array.prototype.slice.call(arguments)));
return this;};Function.prototype.bindWithEvent=function(){var __method=this,args=Array.prototype.slice.call(arguments),o=args.shift(),ev=args.shift();
return function(event){if(!event){event=window.event;}if(ev===true){event=new apf.AbstractEvent(event,window);
}return __method.apply(o,[event].concat(args).concat(Array.prototype.slice.call(arguments)));
};};if(!Function.prototype.bind){Function.prototype.bind=function(context){if(typeof this!=="function"){throw new TypeError();
}var _arguments=Array.prototype.slice.call(arguments,1),_this=this,_concat=Array.prototype.concat,_function=function(){return _this.apply(this instanceof _dummy?this:context,_concat.apply(_arguments,arguments));
},_dummy=function(){};_dummy.prototype=_this.prototype;_function.prototype=new _dummy();
return _function;};}Array.prototype.copy=function(){var ar=[];for(var i=0,j=this.length;
i<j;i++){ar[i]=this[i]&&this[i].copy?this[i].copy():this[i];}return ar;};Array.prototype.merge=function(){for(var i=0,k=arguments.length;
i<k;i++){for(var j=0,l=arguments[i].length;j<l;j++){this.push(arguments[i][j]);
}}};Array.prototype.arrayAdd=function(){var s=this.copy();for(var i=0,k=arguments.length;
i<k;i++){for(var j=0,l=s.length;j<l;j++){s[j]+=arguments[i][j];}}return s;};Array.prototype.equals=function(obj){for(var i=0,j=this.length;
i<j;i++){if(this[i]!=obj[i]){return false;}}return true;};Array.prototype.makeUnique=function(){var i,length,newArr=[];
for(i=0,length=this.length;i<length;i++){if(newArr.indexOf(this[i])==-1){newArr.push(this[i]);
}}this.length=0;for(i=0,length=newArr.length;i<length;i++){this.push(newArr[i]);
}return this;};Array.prototype.contains=function(obj,from){return this.indexOf(obj,from)!=-1;
};Array.prototype.indexOf=Array.prototype.indexOf||function(obj,from){var len=this.length;
for(var i=(from<0)?Math.max(0,len+from):from||0;i<len;i++){if(this[i]===obj){return i;
}}return -1;};Array.prototype.lastIndexOf=Array.prototype.lastIndexOf||function(obj,from){var len=this.length;
for(var i=(from>=len)?len-1:(from<0)?from+len:len-1;i>=0;i--){if(this[i]===obj){return i;
}}return -1;};Array.prototype.pushUnique=function(){var item,i=0,l=arguments.length;
for(;i<l;++i){item=arguments[i];if(this.indexOf(item)==-1){this.push(item);}}return this;
};Array.prototype.search=function(){for(var i=0,length=arguments.length;i<length;
i++){if(typeof this[i]!="array"){continue;}for(var j=0;j<length;j++){if(this[i][j]!=arguments[j]){break;
}else{if(j==(length-1)){return this[i];}}}}};Array.prototype.each=Array.prototype.forEach=Array.prototype.forEach||function(fn){for(var i=0,l=this.length;
i<l;i++){fn.call(this,this[i],i,this)===false;}return this;};Array.prototype.remove=function(obj){for(var i=this.length-1;
i>=0;i--){if(this[i]!=obj){continue;}this.splice(i,1);}return this;};Array.prototype.removeIndex=function(i){if(!this.length){return null;
}return this.splice(i,1);};Array.prototype.insertIndex=function(obj,i){this.splice(i,0,obj);
};Array.prototype.invert=Array.prototype.reverse=Array.prototype.reverse||function(){var l=this.length-1;
for(var temp,i=0;i<Math.ceil(0.5*l);i++){temp=this[i];this[i]=this[l-i];this[l-i]=temp;
}return this;};Array.prototype.filter=Array.prototype.filter||function(fn,bind){var results=[];
for(var i=0,l=this.length;i<l;i++){if(fn.call(bind,this[i],i,this)){results.push(this[i]);
}}return results;};Array.prototype.every=Array.prototype.every||function(fn,bind){for(var i=0,l=this.length;
i<l;i++){if(!fn.call(bind,this[i],i,this)){return false;}}return true;};Array.prototype.map=Array.prototype.map||function(fn,bind){var results=[];
for(var i=0,l=this.length;i<l;i++){results[i]=fn.call(bind,this[i],i,this);}return results;
};Array.prototype.some=Array.prototype.some||function(fn,bind){for(var i=0,l=this.length;
i<l;i++){if(fn.call(bind,this[i],i,this)){return true;}}return false;};Number.prototype.toPrettyDigit=Number.prototype.toPrettyDigit||function(){var n=this.toString();
return(n.length==1)?"0"+n:n;};RegExp.prototype.getNativeFlags=function(){return(this.global?"g":"")+(this.ignoreCase?"i":"")+(this.multiline?"m":"")+(this.extended?"x":"")+(this.sticky?"y":"");
};RegExp.prototype.addFlags=function(flags){return new RegExp(this.source,(flags||"")+this.getNativeFlags());
};String.prototype.uCaseFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1);
};String.prototype.trim=function(){return this.replace(/[\s\n\r]*$/,"").replace(/^[\s\n\r]*/,"");
};String.prototype.repeat=function(times){return Array(times+1).join(this);};String.prototype.count=function(str){return this.split(str).length-1;
};String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+>/gi,"");
};String.prototype.escape=function(){return escape(this);};String.prototype.toXml=function(){var node=apf.getXml("<root>"+this+"</root>");
if(node.childNodes.length==1){return node.childNodes[0];}else{var docFrag=node.ownerDocument.createDocumentFragment(),nodes=node.childNodes;
while(nodes.length){docFrag.appendChild(nodes[0]);}return docFrag;}};if(typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement=="function"){String.prototype.escapeHTML=function(){this.escapeHTML.text.data=this;
return this.escapeHTML.div.innerHTML;};String.prototype.unescapeHTML=function(){var div=document.createElement("div");
div.innerHTML=this.stripTags();if(div.childNodes[0]){if(div.childNodes.length>1){var out=[];
for(var i=0;i<div.childNodes.length;i++){out.push(div.childNodes[i].nodeValue);
}return out.join("");}else{return div.childNodes[0].nodeValue;}}return"";};String.prototype.escapeHTML.div=document.createElement("div");
String.prototype.escapeHTML.text=document.createTextNode("");String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);
if("<\n>".escapeHTML()!=="&lt;\n&gt;"){String.prototype.escapeHTML=null;}if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=null;
}}if(!String.prototype.escapeHTML){String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
};}if(!String.prototype.unescapeHTML){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");
};}String.prototype.truncate=function(nr,ellipsis){return this.length>=nr?this.substring(0,nr-(ellipsis?4:1))+(ellipsis?"...":""):this;
};String.prototype.pad=function(len,pad,dir){return dir?(this+Array(len).join(pad)).slice(0,len):(Array(len).join(pad)+this).slice(-len);
};apf.PAD_LEFT=false;apf.PAD_RIGHT=true;String.prototype.splitSafe=function(separator,limit,bLowerCase){return(bLowerCase&&this.toLowerCase()||this).replace(/(?:^\s+|\n|\s+$)/g,"").split(new RegExp("[\\s ]*"+separator+"[\\s ]*","g"),limit||999);
};String.prototype.appendRandomNumber=function(length){for(var arr=[],i=1;i<=length;
i++){arr.push(apf.randomGenerator.generate(1,9));}return this.toString()+arr.join("");
};String.prototype.prependRandomNumber=function(length){for(var arr=[],i=1;i<=length;
i++){arr.push(apf.randomGenerator.generate(1,9));}return arr.join("")+this.toString();
};String.prototype.sprintf=function(){var str=this.toString(),i=0,inx=str.indexOf("%s");
while(inx>=0){var replacement=arguments[i++]||" ";str=str.substr(0,inx)+replacement+str.substr(inx+2);
inx=str.indexOf("%s");}return str;};if(!Date.now){Date.now=function now(){return +new Date();
};}apf.hotkeys={};(function(){var keyMods={ctrl:1,alt:2,option:2,shift:4,meta:8,command:8};
this.keyNames={"8":"Backspace","9":"Tab","13":"Enter","27":"Esc","32":"Space","33":"PageUp","34":"PageDown","35":"End","36":"Home","37":"Left","38":"Up","39":"Right","40":"Down","45":"Insert","46":"Del","107":"+","112":"F1","113":"F2","114":"F3","115":"F4","116":"F5","117":"F6","118":"F7","119":"F8","120":"F9","121":"F10","122":"F11","123":"F12","188":",","219":"[","221":"]"};
var macUnicode={meta:"\u2318",command:"\u2318",alt:"\u2325",option:"\u2325",shift:"\u21E7",esc:"\u238B",control:"\u2303",backspace:"\u232B",del:"\u2326",enter:"\u21A9"};
var macUnicodeHtml={meta:"&#8984;",command:"&#8984;",alt:"&#8997;",option:"&#8997;",shift:"&#8679;",esc:"&#9099;",control:"&#2303;",backspace:"&#232B;",del:"&#2326;",enter:"&#21A9;"};
this.$keys={};var _self=this,trace=0;function register(hotkey,handler){var key,hashId=0,keys=hotkey.splitSafe("\\-",null,true),i=0,l=keys.length;
for(;i<l;++i){if(keyMods[keys[i]]){hashId=hashId|keyMods[keys[i]];}else{key=keys[i]||"-";
}}if(!key){return;}if(!_self.$keys[hashId]){_self.$keys[hashId]={};}_self.$keys[hashId][key]=handler;
}apf.registerHotkey=this.register=function(hotkey,handler){var parts=hotkey.split("|"),i=0,l=parts.length;
for(;i<l;++i){register(parts[i],handler);}};this.$exec=function(eInfo){var hashId=0|(eInfo.ctrlKey?1:0)|(eInfo.altKey?2:0)|(eInfo.shiftKey?4:0)|(eInfo.metaKey?8:0),code=eInfo.keyCode;
var key=_self.keyNames[code]||(code&&code>46&&code!=91?String.fromCharCode(code):null);
if(!hashId||!key){return;}if(_self.$keys[hashId]&&(handler=_self.$keys[hashId][key.toLowerCase()])){handler(eInfo.htmlEvent);
eInfo.returnValue=false;apf.queue.empty();}return eInfo.returnValue;};apf.removeHotkey=this.remove=this.unregister=function(hotkey){var parts=hotkey.split("|"),i=0,l=parts.length;
for(;i<l;++i){register(parts[i],null);}};function toMacNotation(hotkey,bHtml){var t,keys=hotkey.splitSafe("\\-"),i=0,l=keys.length;
for(;i<l;++i){if(!keys[i]){continue;}if(t=(bHtml?macUnicodeHtml:macUnicode)[keys[i].toLowerCase()]){keys[i]=t;
}}return keys.join(" ");}this.toMacNotation=function(hotkey,bHtml){var parts=hotkey.split("|"),i=0,l=parts.length,res=[];
for(;i<l;++i){res.push(toMacNotation(parts[i],bHtml));}return res.join(" | ");};
apf.addEventListener("keydown",function(eInfo){var e=eInfo.htmlEvent;if(
/*eInfo.isTextInput && */
_self.$exec(eInfo)===false||eInfo.returnValue===false){apf.stopEvent(e);
if(apf.canDisableKeyCodes){try{e.keyCode=0;}catch(e){}}return false;}var keys=[];
if(e.altKey){keys.push("Alt");}if(e.ctrlKey){keys.push("Ctrl");}if(e.shiftKey){keys.push("Shift");
}if(e.metaKey){keys.push("Meta");}if(_self.keyNames[e.keyCode]){keys.push(_self.keyNames[e.keyCode]);
}if(keys.length){if(e.keyCode>46&&!_self.keyNames[e.keyCode]){keys.push(String.fromCharCode(e.keyCode));
}apf.setProperty("hotkey",keys.join("-"));}});}).call(apf.hotkeys);apf.json2xml_Obj={};
apf.json2xml_Attr={};apf.json2xml_ObjByAttr={};apf.json2Xml=(function(){var jsonToXml=function(v,name,xml,notag){var i,n,m,t;
function cleanString(s){return s.replace(/&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;");
}if(!notag){if(name!=(m=name.replace(/[^a-zA-Z0-9_-]/g,"_"))){apf.console.warn("Json2XML, invalid characters found in JSON tagname '"+name,"json2Xml");
}name=m;}if(apf.isArray(v)){for(i=0,n=v.length;i<n;i++){jsonToXml(v[i],name,xml);
}}else{if(typeof v=="object"){var hasChild=false,objAttr=null;if(!notag){xml.push("<",name);
}for(i in v){if((n=apf.json2xml_Attr[i])||i.charAt(0)=="@"){if(!n&&!objAttr){objAttr=apf.json2xml_ObjByAttr[i.slice(1)];
}if(!notag){xml.push(" ",n?n:i.slice(1),'="',cleanString(v[i].toString()),'"');
}}else{hasChild=true;}}if(hasChild){if(!notag){xml.push(">");}if(t=(objAttr||apf.json2xml_Obj[name])){if(t==1){t={child:name.replace(/(.*)s$/,"$1")||name,key:"name",value:"value"};
}for(i in v){if(i.charAt(0)!="@"&&!apf.json2xml_Attr[i]){if(typeof(m=v[i])=="object"){if(apf.json2xml_Obj[i]){jsonToXml(m,i,xml);
}else{xml.push("<",t.child," ",t.key,'="',cleanString(i.toString()),'" >');jsonToXml(m,i,xml,true);
xml.push("</",t.child,">\n");}}else{xml.push("<",t.child," ",t.key,'="',i,'" ');
if(t.value){if(t.value==1){xml.push("/>");}else{xml.push(t.value,'="',cleanString(v[i].toString()),'"/>');
}}else{xml.push(">",cleanString(v[i].toString()),"</",t.child,">");}}}}if(!notag){xml.push("</",name,">\n");
}}else{for(i in v){if(!apf.json2xml_Attr[i]&&i.charAt(0)!="@"){if(i.match(/[^a-zA-Z0-9_-]/g)){apf.console.warn("Json2XML, invalid characters found in JSON tagname: '"+i,"json2Xml");
}else{jsonToXml(v[i],i,xml,false);}}}if(!notag){xml.push("</",name,">");}}}else{if(!notag){xml.push("/>");
}}}else{if(!notag){xml.push("<",name,">",cleanString(v.toString()),"</",name,">");
}else{xml.push(cleanString(v.toString()));}}}};return function(strJson,noError,preserveWhiteSpace){var o=(typeof strJson=="string"&&apf.isJson(strJson))?JSON.parse(strJson.replace(/""/g,'" "')):strJson,xml=[],i;
jsonToXml(o,"jsondoc",xml,false);return apf.getXmlDom(xml.join("").replace(/\t|\n/g,""),noError,true);
};})();apf.xml2json=function(xml,noattrs){var filled,out={},o,nodes=xml.childNodes,cn,i,j,n,m,u,v,w,s,t,cn1,u1,v1,t1,name;
if(!noattrs){if(m=(xml.attributes)){for(u=0,v=m.length;u<v;u++){t=apf.json2xml_Attr[w=m[u].nodeName]||("@"+w);
if(t.indexOf("@a_")!=0){out[t]=m[u].nodeValue,filled=true;}}}}for(var i=0,j=nodes.length;
i<j;i++){if((n=nodes[i]).nodeType!=1){continue;}name=n.tagName;filled=true;t=s=null,o={};
if(m=(n.attributes)){for(u=0,v=m.length;u<v;u++){o["@"+(w=m[u].nodeName)]=m[u].nodeValue;
if(!s){s=apf.json2xml_ObjByAttr[w];}}}if(t=s||apf.json2xml_Obj[name]){if(t==1){t={key:"name",value:"value"};
}for(cn=n.childNodes,u=0,v=cn.length;u<v;u++){if((s=cn[u]).nodeType!=1){continue;
}if(t1=apf.json2xml_Obj[s.nodeName]){var o2={};for(cn1=s.childNodes,u1=0,v1=cn1.length;
u1<v1;u1++){if((s1=cn1[u1]).nodeType!=1){continue;}if(w=s1.getAttribute(t1.key)){o2[w]=(t1.value==1?(s1.childNodes.length?apf.xml2json(s1,1):1):(s1.getAttribute(t1.value||"value"))||apf.xml2json(s1,1));
}}o[s.nodeName]=o2;}else{if(w=s.getAttribute(t.key)){o[w]=(t.value==1?(s.childNodes.length?apf.xml2json(s,1):1):(s.getAttribute(t.value||"value"))||apf.xml2json(s,1));
}}}}else{o=apf.xml2json(n);}if(out[name]!==undefined){if((s=out[name]).dataType!=apf.ARRAY){out[name]=[s,o];
}else{out[name].push(o);}}else{out[name]=o;}}return filled?out:apf.queryValue(xml,"text()");
};apf.isJson=(function(){var escapes=/\\["\\\/bfnrtu@]/g,values=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,brackets=/(?:^|:|,)(?:\s*\[)+/g,invalid=/^[\],:{}\s]*$/;
return function(value){if(!value){return false;}return invalid.test(value.replace(escapes,"@").replace(values,"]").replace(brackets,""));
};})();if(!self.JSON){if(!this.JSON){this.JSON={};}(function(){function f(n){return n<10?"0"+n:n;
}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;
};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();
};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];
return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];
if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);
}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);
case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;
for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";
gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;
i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);
}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);
if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";
gap=mind;return v;}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;
gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";
}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");
}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;
function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);
}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");
};}}());}apf.serialize=function(o){return self.JSON.stringify(o);};apf.unserialize=function(str){if(!str){return str;
}return self.JSON.parse(str);};apf.nameserver={lookup:{},add:function(type,item){if(!this.lookup[type]){this.lookup[type]=[];
}return this.lookup[type].push(item)-1;},register:function(type,id,item){if(!this.lookup[type]){this.lookup[type]={};
}if(this.waiting[id]){var list=this.waiting[id];for(var i=0;i<list.length;i++){list[i]();
}delete this.waiting[id];}return(this.lookup[type][id]=item);},waiting:{},waitFor:function(name,callback){(this.waiting[name]||(this.waiting[name]=[])).push(callback);
},remove:function(type,item){var list=this.lookup[type];if(list){for(var prop in list){if(list[prop]==item){delete list[prop];
}}}},get:function(type,id){return this.lookup[type]?this.lookup[type][id]:null;
},getAll:function(type){var name,arr=[],l=this.lookup[type];if(!l){return arr;}if(l.dataType==apf.ARRAY){for(var i=0;
i<l.length;i++){arr.push(l[i]);}}else{for(name in l){arr.push(l[name]);}}return arr;
},getAllNames:function(type){var name,arr=[];for(name in this.lookup[type]){if(parseInt(name)==name){continue;
}arr.push(name);}return arr;}};apf.registry=apf.extend({put:function(key,value,namespace){this.register(namespace,key,value);
},getNamespaces:function(){},getKeys:function(namespace){return this.getAllNames(namespace);
},remove:function(key,namespace){delete this.lookup[namespace][key];},clear:function(namespace){this.lookup={};
},$export:function(storage){var namespace,key;for(namespace in this.lookup){for(key in this.lookup[namespace]){storage.put(key,this.lookup[key][namespace],namespace);
}}}},apf.nameserver);apf.registry.lookup={};apf.registry.get=function(key,namespace){return this.lookup[namespace]?this.lookup[namespace][key]:null;
};apf.Init.run("nameserver");apf.plane={$set:[],$lookup:{},$find:function(id){if(this.$lookup[id]){return this.$lookup[id];
}var item=this.$set.pop();if(!item){item=this.$factory();}this.$lookup[id]=item;
return item;},get:function(options){return this.$find(options&&options.protect||"default");
},show:function(o,reAppend,copyCursor,useRealSize,options){var item=this.$find(options&&options.protect||"default");
item.show(o,reAppend,copyCursor,useRealSize,options);},hide:function(protect,noAnim){var item=this.$lookup[protect||"default"];
if(item){item.hide(noAnim);delete this.$lookup[protect||"default"];this.$set.push(item);
}},$factory:function(){var plane=document.body.appendChild(document.createElement("DIV"));
plane.style.background="url(images/spacer.gif)";plane.style.position="fixed";plane.style.left=0;
plane.style.top=0;plane.host=false;return{host:this,plane:plane,lastCursor:null,show:function(o,reAppend,copyCursor,useRealSize,options){var plane=this.plane;
this.plane.style.background=options&&options.color||"url(images/spacer.gif)";this.animate=options&&options.animate;
this.protect=options&&options.protect;if(this.protect){apf.setProperty("planes",(apf.planes||0)+1);
}if(o){this.current=o;if(reAppend){this.$originalPlace=[o.parentNode,o.nextSibling];
this.plane.appendChild(o);}}apf.window.zManager.set("plane",this.plane,!reAppend&&o);
useRealSize=apf.isIE;var pWidth=(plane.parentNode==document.body?useRealSize?document.documentElement.offsetWidth:apf.getWindowWidth():plane.parentNode.offsetWidth);
var pHeight=(plane.parentNode==document.body?useRealSize?document.documentElement.offsetHeight:apf.getWindowHeight():plane.parentNode.offsetHeight);
if(copyCursor){if(this.lastCursor===null){this.lastCursor=document.body.style.cursor;
}document.body.style.cursor=apf.getStyle(o,"cursor");}this.plane.style.display="block";
var toOpacity=parseFloat(options&&options.opacity)||1;if(this.animate){var _self=this;
apf.setOpacity(this.plane,0);setTimeout(function(){apf.tween.single(_self.plane,{steps:5,interval:10,type:"fade",from:0,to:toOpacity});
},100);}else{apf.setOpacity(this.plane,toOpacity);}var diff=apf.getDiff(plane);
this.plane.style.width="100%";this.plane.style.height="100%";return plane;},hide:function(noAnim){if(this.protect){apf.setProperty("planes",apf.planes-1);
}var isChild;try{isChild=apf.isChildOf(this.plane,document.activeElement);}catch(ex){isChild=false;
}if(this.current&&this.current.parentNode==this.plane){this.$originalPlace[0].insertBefore(this.current,this.$originalPlace[1]);
}if(this.animate&&!noAnim){var _self=this;setTimeout(function(){apf.tween.single(_self.plane,{steps:5,interval:10,type:"fade",from:apf.getOpacity(_self.plane),to:0,onfinish:function(){_self.plane.style.display="none";
if(_self.current){apf.window.zManager.clear(_self.current);}}});},100);}else{apf.setOpacity(this.plane,0);
if(this.current){apf.window.zManager.clear(this.plane,this.current);}this.plane.style.display="none";
}if(isChild&&apf.document.activeElement){if(!apf.isIE){document.activeElement.focus();
}apf.document.activeElement.$focus();}this.current=null;if(this.lastCursor!==null){document.body.style.cursor=this.lastCursor;
this.lastCursor=null;}return this.plane;}};}};apf.popup={cache:{},focusFix:{INPUT:1,TEXTAREA:1,SELECT:1},setContent:function(cacheId,content,style,width,height){if(!this.popup){this.init();
}this.cache[cacheId]={content:content,style:style,width:width,height:height};content.style.position="absolute";
content.onmousedown=function(e){if(!e){e=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(e.srcElement||e.target).tagName]){apf.window.$focusfix();
}};return content.ownerDocument;},removeContent:function(cacheId){this.cache[cacheId]=null;
delete this.cache[cacheId];},init:function(){this.popup={};apf.addEventListener("hotkey",function(e){if(e.keyCode=="27"||e.altKey){apf.popup.forceHide();
}});},show:function(cacheId,options){if(!this.popup){this.init();}options=apf.extend({x:0,y:0,animate:false,ref:null,width:null,height:null,callback:null,draggable:false,resizable:false,allowTogether:false,autoCorrect:true,noleft:false},options);
if((!options.allowTogether||options.allowTogether!==true&&options.allowTogether!=this.last)&&this.last!=cacheId&&this.cache[this.last]&&(!this.cache[this.last].options||this.cache[this.last].options.autohide!==false)){this.hide();
}var o=this.cache[cacheId];o.options=options;var dp,popup=o.content,moveUp=false,fixed=false;
apf.window.zManager.set("popup",o.content);if((dp=o.content.style.display)&&dp.indexOf("none")>-1){o.content.style.display="";
}var x=options.x;var y=options.y;var refNode=options.ref;while(refNode&&refNode.nodeType==1){if(fixed=apf.getStyle(refNode,"position")=="fixed"){break;
}refNode=refNode.parentNode||refNode.$parentNode;}if(!fixed){if(refNode){var pos=apf.getAbsolutePosition(options.ref,o.content.offsetParent||o.content.parentNode);
x=(x||0)+pos[0];y=(y||0)+pos[1];}if(options.width||o.width){popup.style.width=((options.width||o.width)-3)+"px";
}popup.style.position="absolute";var pOverflow=apf.getOverflowParent(o.content);
var edgeY=(pOverflow==document.documentElement?(apf.isIE?pOverflow.offsetHeight:(window.innerHeight+window.pageYOffset))+pOverflow.scrollTop:pOverflow.offsetHeight+pOverflow.scrollTop);
moveUp=options.autoCorrect&&(y+(options.height||o.height||o.content.offsetHeight))>edgeY;
if(moveUp){var value;if(refNode){value=(pos[1]-(options.height||o.height||o.content.offsetHeight));
}else{value=(edgeY-(options.height||o.height||o.content.offsetHeight));}popup.style.top=value<0?y:value+"px";
}else{popup.style.top=y+"px";}if(!options.noleft){var edgeX=(pOverflow==document.documentElement?(apf.isIE?pOverflow.offsetWidth:(window.innerWidth+window.pageXOffset))+pOverflow.scrollLeft:pOverflow.offsetWidth+pOverflow.scrollLeft);
moveLeft=options.autoCorrect&&(x+(options.width||o.width||o.content.offsetWidth))>edgeX;
if(moveLeft){var value=(edgeX-(options.width||o.width||o.content.offsetWidth));
popup.style.left=value<0?x:value+"px";}else{popup.style.left=x+"px";}}}else{pos=apf.getAbsolutePosition(options.ref,refNode);
y=(y||0)+pos[1]+refNode.offsetTop;pos[0]+=refNode.offsetLeft;popup.style.position="fixed";
popup.style.top=y+"px";if(!options.noleft){popup.style.left=x+"px";}}apf.setStyleClass(popup,moveUp?"upward":"downward",[moveUp?"downward":"upward"]);
if(options.animate){if(options.animate=="fade"){apf.tween.single(popup,{type:"fade",from:0,to:1,anim:apf.tween.NORMAL,steps:options.steps||15*apf.animSteps});
}else{var iVal,steps=apf.isIE8?5:7,i=0;iVal=setInterval(function(){var value=++i*((options.height||o.height)/steps);
popup.style.height=value+"px";if(moveUp){popup.style.top=(y-value-(options.y||0))+"px";
}else{(options.container||popup).scrollTop=-1*(i-steps)*((options.height||o.height)/steps);
}popup.style.display="block";if(i>=steps){clearInterval(iVal);if(options.callback){options.callback(popup);
}}},10);}}else{if(!refNode){if(options.height||o.height){popup.style.height=(options.height||o.height)+"px";
}popup.style.top=y+"px";}popup.style.display="block";if(options.callback){options.callback(popup);
}}$setTimeout(function(){apf.popup.last=cacheId;});if(options.draggable){options.id=cacheId;
this.makeDraggable(options);}},hide:function(){if(this.isDragging){return;}var o=this.cache[this.last];
if(o){if(o.content){o.content.style.display="none";}if(o.options&&o.options.onclose){o.options.onclose(apf.extend(o.options,{htmlNode:o.content}));
o.options.onclose=false;}}},isShowing:function(cacheId){return this.last&&this.last==cacheId&&this.cache[this.last]&&this.cache[this.last].content.style.display!="none";
},isDragging:false,makeDraggable:function(options){if(!apf.Interactive||this.cache[options.id].draggable){return;
}var oHtml=this.cache[options.id].content;this.cache[options.id].draggable=true;
var o={$propHandlers:{},minwidth:10,minheight:10,maxwidth:10000,maxheight:10000,dragOutline:false,resizeOutline:false,draggable:true,resizable:options.resizable,$ext:oHtml,oDrag:oHtml.firstChild};
oHtml.onmousedown=oHtml.firstChild.onmousedown=function(e){if(!e){e=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(e.srcElement||e.target).tagName]){apf.window.$focusfix();
}(e||event).cancelBubble=true;};apf.implement.call(o,apf.Interactive);o.$propHandlers.draggable.call(o,true);
o.$propHandlers.resizable.call(o,true);},getCurrentElement:function(){return typeof this.last=="number"&&apf.lookup(this.last);
},forceHide:function(){if(this.last&&!apf.plane.current&&this.isShowing(this.last)&&this.cache[this.last]&&this.cache[this.last].options&&this.cache[this.last].options.autohide!==false){var o=apf.lookup(this.last);
if(!o){this.last=null;}else{if(o.dispatchEvent("popuphide")!==false){this.hide();
}}}},destroy:function(){for(var cacheId in this.cache){if(this.cache[cacheId]){this.cache[cacheId].content.onmousedown=null;
apf.destroyHtmlNode(this.cache[cacheId].content);this.cache[cacheId].content=null;
this.cache[cacheId]=null;}}if(!this.popup){return;}}};apf.setStyleRule=function(name,type,value,stylesheet,win){name=name.toLowerCase();
if(!stylesheet){var sheets=(win||self).document.styleSheets;for(var j=sheets.length-1;
j>=0;j--){try{var rules=sheets[j][apf.styleSheetRules];for(var i=0;i<rules.length;
i++){if(rules.item(i).selectorText.toLowerCase()==name){rules.item(i).style[type]=value;
return true;}}}catch(e){}}}else{var rules=(win||self).document.styleSheets[stylesheet||0][apf.styleSheetRules];
for(var i=0;i<rules.length;i++){if(rules.item(i).selectorText.toLowerCase()==name){rules.item(i).style[type]=value;
return true;}}}return false;};apf.getStyleRule=function(name,type,stylesheet,win){name=name.toLowerCase();
if(!stylesheet){var sheets=(win||self).document.styleSheets;for(var j=sheets.length-1;
j>=0;j--){try{var rules=sheets[j][apf.styleSheetRules];for(var i=0;i<rules.length;
i++){if(rules.item(i).selectorText.toLowerCase()==name){return rules.item(i).style[type];
}}}catch(e){}}}else{var rules=(win||self).document.styleSheets[stylesheet||0][apf.styleSheetRules];
for(var i=0;i<rules.length;i++){if(rules.item(i).selectorText.toLowerCase()==name){return rules.item(i).style[type];
}}}return false;};apf.setStyleClass=function(oHtml,className,exclusion,userAction){if(!oHtml||userAction&&this.disabled){return;
}if(className){if(exclusion){exclusion[exclusion.length]=className;}else{exclusion=[className];
}}var re=new RegExp("(^| +)(?:"+(exclusion?exclusion.join("|"):"")+")","gi");oHtml.className!=null?(oHtml.className=oHtml.className.replace(re," ")+(className?" "+className:"")):oHtml.setAttribute("class",(oHtml.getAttribute("class")||"").replace(re," ")+(className?" "+className:""));
return oHtml;};apf.importCssString=function(cssString,doc,media){doc=doc||document;
var htmlNode=doc.getElementsByTagName("head")[0];if(apf.canCreateStyleNode){var style=doc.createElement("style");
style.appendChild(doc.createTextNode(cssString));if(media){style.setAttribute("media",media);
}htmlNode.appendChild(style);}else{htmlNode.insertAdjacentHTML("beforeend",".<style media='"+(media||"all")+"'>"+cssString+"</style>");
}};apf.getStyleRecur=function(el,prop){var value=apf.hasComputedStyle?document.defaultView.getComputedStyle(el,"").getPropertyValue(prop.replace(/([A-Z])/g,function(m,m1){return"-"+m1.toLowerCase();
})):el.currentStyle[prop];return((!value||value=="transparent"||value=="inherit")&&el.parentNode&&el.parentNode.nodeType==1)?this.getStyleRecur(el.parentNode,prop):value;
};apf.importStylesheet=function(def,win){if(!def.length){return;}var re=new RegExp("^"+document.domain,"g");
var doc=(win||window).document;for(var index=0;index<document.styleSheets.length;
index++){if(!doc.styleSheets[index].href||doc.styleSheets[index].href.match(re)){break;
}}var styleSheet=doc.styleSheets[index];if(!styleSheet){if(doc.createStyleSheet){styleSheet=doc.createStyleSheet();
}else{var elem=doc.createElement("style");elem.type="text/css";doc.getElementsByTagName("head")[0].appendChild(elem);
styleSheet=elem.sheet;}}for(var i=0;i<def.length;i++){if(!def[i][1]){continue;}if(apf.isIE){styleSheet.addRule(def[i][0],def[i][1]);
}else{styleSheet.insertRule(def[i][0]+" {"+def[i][1]+"}",0);}}};apf.isInRect=function(oHtml,x,y){var pos=this.getAbsolutePosition(oHtml);
if(x<pos[0]||y<pos[1]||x>oHtml.offsetWidth+pos[0]-10||y>oHtml.offsetHeight+pos[1]-10){return false;
}return true;};apf.getOverflowParent=function(o){o=o.offsetParent;while(o&&(this.getStyle(o,"overflow")!="hidden"||"absolute|relative".indexOf(this.getStyle(o,"position"))==-1)){o=o.offsetParent;
}return o||document.documentElement;};apf.getPositionedParent=function(o){o=o.offsetParent;
while(o&&o.tagName.toLowerCase()!="body"&&"absolute|relative".indexOf(this.getStyle(o,"position"))==-1){o=o.offsetParent;
}return o||document.documentElement;};apf.getAbsolutePosition=function(o,refParent,inclSelf){if("getBoundingClientRect" in document.documentElement){if(apf.doesNotIncludeMarginInBodyOffset&&o==document.body){return[o.offsetLeft+(parseFloat(apf.getStyle(o,"marginLeft"))||0),+(o.scrollLeft||0),o.offsetTop+(parseFloat(apf.getStyle(o,"marginTop"))||0)+(o.scrollTop||0)];
}var box=o.getBoundingClientRect(),top=box.top,left=box.left,corr=(apf.isIE&&apf.isIE<8);
if(refParent&&refParent!=document.body){var pos=apf.getAbsolutePosition(refParent,null,true);
top-=pos[1];left-=pos[0];}if(!(apf.isIE&&o==document.documentElement)){left+=(refParent||document.body).scrollLeft||document.documentElement.scrollLeft||0;
top+=(refParent||document.body).scrollTop||document.documentElement.scrollTop||0;
}if(inclSelf&&!refParent){left+=parseInt(apf.getStyle(o,"borderLeftWidth"))||0;
top+=parseInt(apf.getStyle(o,"borderTopWidth"))||0;}return[left-(corr?2:0),top-(corr?2:0)];
}var wt=inclSelf?0:o.offsetLeft,ht=inclSelf?0:o.offsetTop;o=inclSelf?o:o.offsetParent||o.parentNode;
if(apf.isIE8&&refParent){bw=this.getStyle(o,"borderLeftWidth");wt-=(apf.isIE&&o.currentStyle.borderLeftStyle!="none"&&bw=="medium"?2:parseInt(bw)||0);
bh=this.getStyle(o,"borderTopWidth");ht-=(apf.isIE&&o.currentStyle.borderTopStyle!="none"&&bh=="medium"?2:parseInt(bh)||0);
}var bw,bh,fl;while(o&&o!=refParent){bw=apf.isOpera||apf.isIE8?0:this.getStyle(o,"borderLeftWidth");
wt+=(apf.isIE&&o.currentStyle.borderLeftStyle!="none"&&bw=="medium"?2:parseInt(bw)||0)+o.offsetLeft;
if(apf.isIE&&!apf.isIE8&&apf.getStyle(o,"styleFloat")=="none"&&apf.getStyle(o,"position")=="relative"){var q=o.previousSibling;
while(q){if(q.nodeType==1){fl=apf.getStyle(q,"styleFloat");if(fl=="left"){wt-=parseInt(apf.getStyle(o,"marginLeft"))||0;
break;}else{if(fl=="right"){break;}}}q=q.previousSibling;}}bh=apf.isOpera||apf.isIE8?0:this.getStyle(o,"borderTopWidth");
ht+=(apf.isIE&&o.currentStyle.borderTopStyle!="none"&&bh=="medium"?2:parseInt(bh)||0)+o.offsetTop;
if(!apf.isGecko&&o!=refParent&&(o.tagName!="HTML"||o.ownerDocument!=document)){wt-=o.scrollLeft;
ht-=o.scrollTop;}if(o.tagName.toLowerCase()=="table"){ht-=parseInt(o.border||0)+parseInt(o.cellSpacing||0);
wt-=parseInt(o.border||0)+parseInt(o.cellSpacing||0)*2;}else{if(o.tagName.toLowerCase()=="tr"){var cp;
ht-=(cp=parseInt(o.parentNode.parentNode.cellSpacing));while(o.previousSibling){ht-=(o=o.previousSibling).offsetHeight+cp;
}}}if(apf.isIE&&!o.offsetParent&&o.parentNode.nodeType==1){wt-=o.parentNode.scrollLeft;
ht-=o.parentNode.scrollTop;}o=o.offsetParent;}return[wt,ht];};apf.getHorBorders=function(oHtml){return Math.max(0,(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0));
};apf.getVerBorders=function(oHtml){return Math.max(0,(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0));
};apf.getWidthDiff=function(oHtml){if(apf.hasFlexibleBox&&apf.getStyle(oHtml,apf.CSSPREFIX+"BoxSizing")!="content-box"){return 0;
}return Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingLeft"))||0)+(parseInt(apf.getStyle(oHtml,"paddingRight"))||0)+(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0));
};apf.getHeightDiff=function(oHtml){if(apf.hasFlexibleBox&&apf.getStyle(oHtml,apf.CSSPREFIX+"BoxSizing")!="content-box"){return 0;
}return Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingTop"))||0)+(parseInt(apf.getStyle(oHtml,"paddingBottom"))||0)+(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0));
};apf.getDiff=function(oHtml){if(apf.hasFlexibleBox&&apf.getStyle(oHtml,apf.CSSPREFIX+"BoxSizing")!="content-box"){return[0,0];
}return[Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingLeft"))||0)+(parseInt(apf.getStyle(oHtml,"paddingRight"))||0)+(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0)),Math.max(0,(parseInt(apf.getStyle(oHtml,"paddingTop"))||0)+(parseInt(apf.getStyle(oHtml,"paddingBottom"))||0)+(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)+(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0))];
};apf.getMargin=function(oHtml){return[(parseInt(apf.getStyle(oHtml,"marginLeft"))||0)+(parseInt(apf.getStyle(oHtml,"marginRight"))||0),(parseInt(apf.getStyle(oHtml,"marginTop"))||0)+(parseInt(apf.getStyle(oHtml,"marginBottom"))||0)];
};apf.getHtmlInnerWidth=function(oHtml){return(oHtml.offsetWidth-(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0)-(parseInt(apf.getStyle(oHtml,"borderRightWidth"))||0));
};apf.getHtmlInnerHeight=function(oHtml){return(oHtml.offsetHeight-(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)-(parseInt(apf.getStyle(oHtml,"borderBottomWidth"))||0));
};apf.getViewPort=function(win){win=win||window;var doc=(!win.document.compatMode||win.document.compatMode=="CSS1Compat")?win.document.html||win.document.documentElement:win.document.body;
return{x:win.pageXOffset||doc.scrollLeft,y:win.pageYOffset||doc.scrollTop,width:win.innerWidth||doc.clientWidth,height:win.innerHeight||doc.clientHeight};
};apf.pasteWindow=function(str){var win=window.open("about:blank");win.document.write(str);
};apf.xmlEntityMap={quot:"34",amp:"38",apos:"39",lt:"60",gt:"62",nbsp:"160",iexcl:"161",cent:"162",pound:"163",curren:"164",yen:"165",brvbar:"166",sect:"167",uml:"168",copy:"169",ordf:"170",laquo:"171",not:"172",shy:"173",reg:"174",macr:"175",deg:"176",plusmn:"177",sup2:"178",sup3:"179",acute:"180",micro:"181",para:"182",middot:"183",cedil:"184",sup1:"185",ordm:"186",raquo:"187",frac14:"188",frac12:"189",frac34:"190",iquest:"191",agrave:"192",aacute:"193",acirc:"194",atilde:"195",auml:"196",aring:"197",aelig:"198",ccedil:"199",egrave:"200",eacute:"201",ecirc:"202",euml:"203",igrave:"204",iacute:"205",icirc:"206",iuml:"207",eth:"208",ntilde:"209",ograve:"210",oacute:"211",ocirc:"212",otilde:"213",ouml:"214",times:"215",oslash:"216",ugrave:"217",uacute:"218",ucirc:"219",uuml:"220",yacute:"221",thorn:"222",szlig:"223",agrave:"224",aacute:"225",acirc:"226",atilde:"227",auml:"228",aring:"229",aelig:"230",ccedil:"231",egrave:"232",eacute:"233",ecirc:"234",euml:"235",igrave:"236",iacute:"237",icirc:"238",iuml:"239",eth:"240",ntilde:"241",ograve:"242",oacute:"243",ocirc:"244",otilde:"245",ouml:"246",divide:"247",oslash:"248",ugrave:"249",uacute:"250",ucirc:"251",uuml:"252",yacute:"253",thorn:"254",yuml:"255",oelig:"338",oelig:"339",scaron:"352",scaron:"353",yuml:"376",fnof:"402",circ:"710",tilde:"732",alpha:"913",beta:"914",gamma:"915",delta:"916",epsilon:"917",zeta:"918",eta:"919",theta:"920",iota:"921",kappa:"922",lambda:"923",mu:"924",nu:"925",xi:"926",omicron:"927",pi:"928",rho:"929",sigma:"931",tau:"932",upsilon:"933",phi:"934",chi:"935",psi:"936",omega:"937",alpha:"945",beta:"946",gamma:"947",delta:"948",epsilon:"949",zeta:"950",eta:"951",theta:"952",iota:"953",kappa:"954",lambda:"955",mu:"956",nu:"957",xi:"958",omicron:"959",pi:"960",rho:"961",sigmaf:"962",sigma:"963",tau:"964",upsilon:"965",phi:"966",chi:"967",psi:"968",omega:"969",thetasym:"977",upsih:"978",piv:"982",ensp:"8194",emsp:"8195",thinsp:"8201",zwnj:"8204",zwj:"8205",lrm:"8206",rlm:"8207",ndash:"8211",mdash:"8212",lsquo:"8216",rsquo:"8217",sbquo:"8218",ldquo:"8220",rdquo:"8221",bdquo:"8222",dagger:"8224",dagger:"8225",bull:"8226",hellip:"8230",permil:"8240",prime:"8242",prime:"8243",lsaquo:"8249",rsaquo:"8250",oline:"8254",frasl:"8260",euro:"8364",image:"8465",weierp:"8472",real:"8476",trade:"8482",alefsym:"8501",larr:"8592",uarr:"8593",rarr:"8594",darr:"8595",harr:"8596",crarr:"8629",larr:"8656",uarr:"8657",rarr:"8658",darr:"8659",harr:"8660",forall:"8704",part:"8706",exist:"8707",empty:"8709",nabla:"8711",isin:"8712",notin:"8713",ni:"8715",prod:"8719",sum:"8721",minus:"8722",lowast:"8727",radic:"8730",prop:"8733",infin:"8734",ang:"8736",and:"8743",or:"8744",cap:"8745",cup:"8746","int":"8747",there4:"8756",sim:"8764",cong:"8773",asymp:"8776",ne:"8800",equiv:"8801",le:"8804",ge:"8805",sub:"8834",sup:"8835",nsub:"8836",sube:"8838",supe:"8839",oplus:"8853",otimes:"8855",perp:"8869",sdot:"8901",lceil:"8968",rceil:"8969",lfloor:"8970",rfloor:"8971",lang:"9001",rang:"9002",loz:"9674",spades:"9824",clubs:"9827",hearts:"9829",diams:"9830"};
apf.htmlentities=function(str){return str.escapeHTML();};apf.xmlentities=function(str){return str.replace(/&([a-z]+);/gi,function(a,m){if(apf.xmlEntityMap[m=m.toLowerCase()]){return"&#"+apf.xmlEntityMap[m]+";";
}return a;});};apf.html_entity_decode=function(str){return(str||"").replace(/\&\#38;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ");
};apf.isCharacter=function(charCode){return(charCode<112||charCode>122)&&(charCode==32||charCode>42||charCode==8);
};apf.randomGenerator={d:new Date(),seed:null,A:48271,M:2147483647,Q:null,R:null,oneOverM:null,generate:function(lnr,unr){if(this.seed==null){this.seed=2345678901+(this.d.getSeconds()*16777215)+(this.d.getMinutes()*65535);
}this.Q=this.M/this.A;this.R=this.M%this.A;this.oneOverM=1/this.M;return Math.floor((unr-lnr+1)*this.next()+lnr);
},next:function(){var hi=this.seed/this.Q;var lo=this.seed%this.Q;var test=this.A*lo-this.R*hi;
if(test>0){this.seed=test;}else{this.seed=test+this.M;}return(this.seed*this.oneOverM);
}};apf.getNoCacheUrl=function(url){return url+(url.indexOf("?")==-1?"?":"&")+"nocache="+new Date().getTime();
};apf.parseExpression=function(str){if(!apf.parseExpression.regexp.test(str)){return str;
}return eval(RegExp.$1);};apf.parseExpression.regexp=/^\{([\s\S]*)\}$/;apf.formatNumber=function(num,prefix){var nr=parseFloat(num);
if(!nr){return num;}var str=new String(Math.round(nr*100)/100).replace(/(\.\d?\d?)$/,function(m1){return m1.pad(3,"0",apf.PAD_RIGHT);
});if(str.indexOf(".")==-1){str+=".00";}return prefix+str;};apf.jsexec=function(str,win){if(!str){return str;
}if(!win){win=self;}if(apf.isO3){eval(str,self);}else{if(apf.hasExecScript){win.execScript(str);
}else{var head=win.document.getElementsByTagName("head")[0];if(head){var script=win.document.createElement("script");
script.setAttribute("type","text/javascript");script.text=str;head.appendChild(script);
head.removeChild(script);}else{eval(str,win);}}}return str;};apf.K=function(){};
apf.isNumber=function(value){return parseFloat(value)==value;};apf.isArray=function(value){return Object.prototype.toString.call(value)==="[object Array]";
};apf.isTrue=function(c){return(c===true||c==="true"||c==="on"||typeof c=="number"&&c>0||c==="1");
};apf.isFalse=function(c){return(c===false||c==="false"||c==="off"||c===0||c==="0");
};apf.isNot=function(c){return(!c&&typeof c!="string"&&c!==0||(typeof c=="number"&&!isFinite(c)));
};apf.removePathContext=function(base,url){if(!url){return"";}if(url.indexOf(base)>-1){return url.substr(base.length);
}return url;};apf.cancelBubble=function(e,o,noPropagate){if(e.stopPropagation){e.stopPropagation();
}else{e.cancelBubble=true;}if(!noPropagate){if(o&&o.$ext&&o.$ext["on"+(e.type||e.name)]){o.$ext["on"+(e.type||e.name)](e);
}apf.window.$mousedown(e);}};apf.destroyHtmlNode=function(element){if(!element){return;
}if(!apf.isIE||element.ownerDocument!=document){if(element.parentNode){element.parentNode.removeChild(element);
}return;}var garbageBin=document.getElementById("IELeakGarbageBin");if(!garbageBin){garbageBin=document.createElement("DIV");
garbageBin.id="IELeakGarbageBin";garbageBin.style.display="none";document.body.appendChild(garbageBin);
}garbageBin.appendChild(element);garbageBin.innerHTML="";};apf.getRules=function(node){var rules={};
for(var w=node.firstChild;w;w=w.nextSibling){if(w.nodeType!=1){continue;}else{if(!rules[w[apf.TAGNAME]]){rules[w[apf.TAGNAME]]=[];
}rules[w[apf.TAGNAME]].push(w);}}return rules;};apf.isCoord=function(n){return n||n===0;
};apf.getCoord=function(n,other){return n||n===0?n:other;};apf.getBox=function(value,base){if(!base){base=0;
}if(value==null||(!parseInt(value)&&parseInt(value)!=0)){return[0,0,0,0];}var x=String(value).splitSafe(" ");
for(var i=0;i<x.length;i++){x[i]=parseInt(x[i])||0;}switch(x.length){case 1:x[1]=x[0];
x[2]=x[0];x[3]=x[0];break;case 2:x[2]=x[0];x[3]=x[1];break;case 3:x[3]=x[1];break;
}return x;};apf.getNode=function(data,tree){var nc=0;if(data!=null){for(var i=0;
i<data.childNodes.length;i++){if(data.childNodes[i].nodeType==1){if(nc==tree[0]){data=data.childNodes[i];
if(tree.length>1){tree.shift();data=this.getNode(data,tree);}return data;}nc++;
}}}return null;};apf.getFirstElement=function(xmlNode){return xmlNode.firstChild.nodeType==1?xmlNode.firstChild:xmlNode.firstChild.nextSibling;
};apf.getLastElement=function(xmlNode){return xmlNode.lastChild.nodeType==1?xmlNode.lastChild:xmlNode.lastChild.previousSibling;
};apf.selectTextHtml=function(oHtml){if(!apf.hasMsRangeObject){return;}var r=document.selection.createRange();
try{r.moveToElementText(oHtml);}catch(e){}r.select();};apf.visibilitymanager=function(){var tree={};
var _self=this;var inited=false;this.check=function(amlNode,type,callback){if(amlNode.$ext.offsetHeight||amlNode.$ext.offsetWidth){return true;
}if(amlNode.$visibleCheck){if(amlNode.$visibleCheck[type]){return;}}else{amlNode.$visibleCheck={};
}function cleanup(setInsertion){var p=amlNode;while(p){p.removeEventListener("prop.visible",check);
p.removeEventListener("DOMNodeRemoved",remove);p.removeEventListener("DOMNodeRemovedFromDocument",remove);
if(setInsertion){p.addEventListener("DOMNodeInserted",add);}p=p.parentNode||p.$parentNode;
}delete amlNode.$visibleCheck[type];}function check(e){if(!amlNode.$ext.offsetHeight&&!amlNode.$ext.offsetWidth){return;
}callback.call(amlNode);cleanup();}function remove(e){if(e.currentTarget!=this){return;
}cleanup(e.name=="DOMNodeRemoved");}function add(){var p=amlNode;while(p){p.addEventListener("prop.visible",check);
p.addEventListener("DOMNodeRemoved",remove);p.addEventListener("DOMNodeRemovedFromDocument",remove);
p.removeEventListener("DOMNodeInserted",add);p=p.parentNode||p.$parentNode;}amlNode.$visibleCheck[type]=true;
}add();return false;};this.permanent=function(amlNode,show,hide){var state=amlNode.$ext&&(amlNode.$ext.offsetHeight||amlNode.$ext.offsetWidth);
function check(e){var newState=amlNode.$ext&&(amlNode.$ext.offsetHeight||amlNode.$ext.offsetWidth);
if(newState==state){return;}if(newState){show();}else{hide();}state=newState;}function cleanup(setInsertion){var p=amlNode;
while(p){p.removeEventListener("prop.visible",check);p.removeEventListener("DOMNodeRemoved",remove);
p.removeEventListener("DOMNodeRemovedFromDocument",remove);if(setInsertion){p.addEventListener("DOMNodeInserted",add);
}p=p.parentNode||p.$parentNode;}check();}function remove(e){if(e.currentTarget!=this){return;
}cleanup(e.name=="DOMNodeRemoved");}function add(){var p=amlNode;while(p){p.addEventListener("prop.visible",check);
p.addEventListener("DOMNodeRemoved",remove);p.addEventListener("DOMNodeRemovedFromDocument",remove);
p.removeEventListener("DOMNodeInserted",add);p=p.parentNode||p.$parentNode;}check();
}add();return state;};this.removePermanent=function(amlNode){};};apf.isChildOf=function(pNode,childnode,orItself){if(!pNode||!childnode){return false;
}if(childnode.nodeType==2){childnode=childnode.ownerElement||childnode.selectSingleNode("..");
}if(orItself&&pNode==childnode){return true;}var loopnode=childnode.parentNode;
while(loopnode){if(loopnode==pNode){return true;}loopnode=loopnode.parentNode;}return false;
};apf.escapeXML=function(str){return((str||"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;"));
};apf.isOnlyChild=function(node,nodeType){if(!node||!node.parentNode||nodeType&&nodeType.indexOf(node.nodeType)==-1){return false;
}var i,l,cnode,nodes=node.parentNode.childNodes;for(i=0,l=nodes.length;i<l;i++){cnode=nodes[i];
if(cnode.nodeType==1&&cnode!=node){return false;}if(cnode.nodeType==3&&!cnode.nodeValue.trim()){return false;
}}return true;};apf.getChildNumber=function(node,fromList){if(!node){return -1;
}var p=node.parentNode,j=0;if(!p){return 0;}if(!fromList){fromList=p.childNodes;
}if(fromList.indexOf){var idx=fromList.indexOf(node);return idx==-1?fromList.length:idx;
}for(var i=0,l=fromList.length;i<l;i++){if(fromList[i]==node){return j;}j++;}return j;
};apf.mergeXml=function(XMLRoot,parentNode,options){if(typeof parentNode!="object"){parentNode=getElementById(parentNode);
}if(options&&options.clearContents){var node,j,i,nodes=parentNode.selectNodes("descendant::node()[@"+apf.xmldb.xmlListenTag+"]");
for(i=nodes.length-1;i>=0;i--){var s=nodes[i].getAttribute(apf.xmldb.xmlListenTag).split(";");
for(j=s.length-1;j>=0;j--){node=apf.all[s[j]];if(!node){continue;}if(node.dataParent&&node.dataParent.xpath){node.dataParent.parent.signalXmlUpdate[node.$uniqueId]=true;
}else{if(node.$model){node.$model.$waitForXml(node);}}}}nodes=parentNode.childNodes;
for(i=nodes.length-1;i>=0;i--){parentNode.removeChild(nodes[i]);}}if(options&&options.start){var reserved,beforeNode,nodes,doc,i,l,marker=options.marker;
if(!marker){}if(marker.getAttribute("start")-options.start==0){marker.setAttribute("start",options.start+options.length);
reserved=parseInt(marker.getAttribute("reserved"));marker.setAttribute("reserved",reserved+options.length);
beforeNode=marker;}else{if(options.start+options.length==marker.getAttribute("end")){marker.setAttribute("end",options.start+options.length);
beforeNode=marker.nextSibling;reserved=parseInt(marker.getAttribute("reserved"))+parseInt(marker.getAttribute("end"))-options.length;
}else{var m2=marker.parentNode.insertBefore(marker.cloneNode(true),marker);m2.setAttribute("end",options.start-1);
marker.setAttribute("start",options.start+options.length);reserved=parseInt(marker.getAttribute("reserved"));
marker.setAttribute("reserved",reserved+options.length);beforeNode=marker;}}nodes=XMLRoot.childNodes;
if(parentNode.ownerDocument.importNode){doc=parentNode.ownerDocument;for(i=0,l=nodes.length;
i<l;i++){parentNode.insertBefore(doc.importNode(nodes[i],true),beforeNode).setAttribute(apf.xmldb.xmlIdTag,options.documentId+"|"+(reserved+i));
}}else{for(i=nodes.length-1;i>=0;i--){parentNode.insertBefore(nodes[0],beforeNode).setAttribute(apf.xmldb.xmlIdTag,options.documentId+"|"+(reserved+i));
}}}else{beforeNode=options&&options.beforeNode?options.beforeNode:apf.getNode(parentNode,[0]);
nodes=XMLRoot.childNodes;if(parentNode.ownerDocument.importNode){doc=parentNode.ownerDocument;
for(i=0,l=nodes.length;i<l;i++){parentNode.insertBefore(doc.importNode(nodes[i],true),beforeNode);
}}else{for(i=nodes.length-1;i>=0;i--){parentNode.insertBefore(nodes[0],beforeNode);
}}}if(options&&options.copyAttributes){var attr=XMLRoot.attributes;for(i=0;i<attr.length;
i++){if(attr[i].nodeName!=apf.xmldb.xmlIdTag){parentNode.setAttribute(attr[i].nodeName,attr[i].nodeValue);
}}}return parentNode;};apf.setNodeValue=function(xmlNode,nodeValue,applyChanges,options){if(!xmlNode){return;
}var undoObj,xpath,newNodes;if(options){undoObj=options.undoObj;xpath=options.xpath;
newNodes=options.newNodes;undoObj.extra.oldValue=options.forceNew?"":apf.queryValue(xmlNode,xpath);
undoObj.xmlNode=xmlNode;if(xpath){xmlNode=apf.createNodeFromXpath(xmlNode,xpath,newNodes,options.forceNew);
}undoObj.extra.appliedNode=xmlNode;}if(xmlNode.nodeType==1){if(!xmlNode.firstChild){xmlNode.appendChild(xmlNode.ownerDocument.createTextNode(""));
}xmlNode.firstChild.nodeValue=apf.isNot(nodeValue)?"":nodeValue;if(applyChanges){apf.xmldb.applyChanges("text",xmlNode,undoObj);
}}else{if(apf.isO3&&xmlNode.nodeType==2){nodeValue=nodeValue.replace(/&/g,"&amp;");
}var oldValue=xmlNode.nodeValue;xmlNode.nodeValue=apf.isNot(nodeValue)?"":nodeValue;
if(undoObj){undoObj.name=xmlNode.nodeName;}if(xmlNode.$triggerUpdate){xmlNode.$triggerUpdate(null,oldValue);
}if(applyChanges){apf.xmldb.applyChanges(xmlNode.nodeType==2?"attribute":"text",xmlNode.parentNode||xmlNode.ownerElement||xmlNode.selectSingleNode(".."),undoObj);
}}};apf.setQueryValue=function(xmlNode,xpath,value,local){var node=apf.createNodeFromXpath(xmlNode,xpath);
if(!node){return null;}apf.setNodeValue(node,value,!local);return node;};apf.removeQueryNode=function(xmlNode,xpath,local){var node=apf.queryNode(xmlNode,xpath);
if(!node){return false;}if(local){node.parentNode.removeChild(node);}else{apf.xmldb.removeNode(node);
}return node;};apf.queryValue=function(xmlNode,xpath){if(!xmlNode){return"";}if(xmlNode.nodeType==2){return xmlNode.nodeValue;
}if(xpath){xmlNode=xmlNode.selectSingleNode(xpath);if(!xmlNode){return"";}}return xmlNode.nodeType==1?(!xmlNode.firstChild?"":xmlNode.firstChild.nodeValue):xmlNode.nodeValue;
};apf.queryValues=function(xmlNode,xpath){var out=[];if(!xmlNode){return out;}var nodes=xmlNode.selectNodes(xpath);
if(!nodes.length){return out;}for(var i=0;i<nodes.length;i++){var n=nodes[i];if(n.nodeType==1){n=n.firstChild;
}out.push(n.nodeValue||"");}return out;};apf.queryNodes=function(contextNode,sExpr){if(contextNode&&(apf.hasXPathHtmlSupport&&contextNode.selectSingleNode||!contextNode.style)){return contextNode.selectNodes(sExpr);
}return apf.XPath.selectNodes(sExpr,contextNode);};apf.queryNode=function(contextNode,sExpr){if(contextNode&&(apf.hasXPathHtmlSupport&&contextNode.selectSingleNode||!contextNode.style)){return contextNode.selectSingleNode(sExpr);
}var nodeList=apf.queryNodes(contextNode?contextNode:null,sExpr+(apf.isIE?"":"[1]"));
return nodeList.length>0?nodeList[0]:null;};apf.getInheritedAttribute=function(xml,attr,func){var result,avalue;
if(xml.nodeType!=1){xml=xml.parentNode;}while(xml&&(xml.nodeType!=1||!(result=attr&&((avalue=xml.getAttribute(attr))||typeof avalue=="string")||func&&func(xml)))){xml=xml.parentNode;
}if(avalue==""){return"";}return !result&&attr&&apf.config?apf.config[attr]:result;
};apf.createNodeFromXpath=function(contextNode,xPath,addedNodes,forceNew){var xmlNode,foundpath="",paths=xPath.replace(/('.*?')|(".*?")|\|/g,function(m,m1,m2){if(m1||m2){return m1||m2;
}return"-%-|-%-";}).split("-%-|-%-")[0].split(/\/(?!\/)/);if(!forceNew&&(xmlNode=contextNode.selectSingleNode(xPath))){return xmlNode;
}var len=paths.length-1;if(forceNew){if(paths[len].trim().match(/^\@(.*)$|^text\(\)$/)){len--;
}}if(!paths[0]){contextNode=contextNode.ownerDocument.documentElement;paths.shift();
paths.shift();len--;len--;}for(var addedNode,isAdding=false,i=0;i<len;i++){if(!isAdding&&contextNode.selectSingleNode(foundpath+(i!=0?"/":"")+paths[i])){foundpath+=(i!=0?"/":"")+paths[i];
continue;}var isAddId=paths[i].match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(isAddId){paths[i]=isAddId[1];
}isAdding=true;addedNode=contextNode.selectSingleNode(foundpath||".").appendChild(contextNode.ownerDocument.createElement(paths[i]));
if(isAddId){addedNode.setAttribute(isAddId[2],isAddId[3]);foundpath+=(foundpath?"/":"")+isAddId[0];
}else{foundpath+=(foundpath?"/":"")+paths[i];}if(addedNodes){addedNodes.push(addedNode);
}}if(!foundpath){foundpath=".";}if(addedNodes){addedNodes.foundpath=foundpath;}var newNode,lastpath=paths[len],doc=contextNode.nodeType==9?contextNode:contextNode.ownerDocument;
do{if(lastpath.match(/^\@(.*)$/)){(newNode||contextNode.selectSingleNode(foundpath)).setAttributeNode(newNode=doc.createAttribute(RegExp.$1));
}else{if(lastpath.trim()=="text()"){newNode=(newNode||contextNode.selectSingleNode(foundpath)).appendChild(doc.createTextNode(""));
}else{var hasId=lastpath.match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(hasId){lastpath=hasId[1];
}newNode=(newNode||contextNode.selectSingleNode(foundpath)).appendChild(doc.createElement(lastpath));
if(hasId){newNode.setAttribute(hasId[2],hasId[3]);}}}if(addedNodes){addedNodes.push(newNode);
}foundpath+=(foundpath?"/":"")+paths[len];}while((lastpath=paths[++len]));return newNode;
};apf.convertMethods={json:function(xml){return JSON.stringify(apf.xml2json(xml));
},cgivars:function(xml,basename){if(!basename){basename="";}var value,name,sameNodes,j,l2,str=[],nodes=xml.childNodes,done={},i=0,l=nodes.length;
for(;i<l;++i){if(nodes[i].nodeType!=1){continue;}name=nodes[i].tagName;if(done[name]){continue;
}sameNodes=xml.selectNodes(name);if(sameNodes.length>1){done[name]=true;for(j=0,l2=sameNodes.length;
j<l2;j++){value=this.cgivars(sameNodes[j],basename+name+"["+j+"]");if(value){str.push(value);
}}}else{value=this.cgivars(nodes[i],basename+name);if(value){str.push(value);}}}var attr=xml.attributes;
for(i=0,l=attr.length;i<l;i++){if(attr[i].nodeValue){if(basename){str.push(basename+"["+attr[i].nodeName+"]="+escape(attr[i].nodeValue));
}else{str.push(attr[i].nodeName+"="+escape(attr[i].nodeValue));}}}if(str.length){return str.join("&");
}value=apf.queryValue(xml,"text()");if(basename&&value){return basename+"="+escape(value);
}return"";},cgiobjects:function(xml,basename,isSub,includeEmpty){if(!basename){basename="";
}var node,name,value,a,i,j,attr,attr_len,isOnly,nodes=xml.childNodes,output=[],tagNames={},nm="";
for(i=0;i<nodes.length;i++){node=nodes[i];if(node.nodeType==1){name=node.tagName;
isOnly=node.parentNode.selectNodes(name).length==1?true:false;if(typeof tagNames[name]=="undefined"){tagNames[name]=0;
}nm=basename+(isSub?"[":"")+name+(isSub?"]":"")+(isOnly?"":"["+tagNames[name]+"]");
attr=node.attributes;attr_len=node.attributes.length;if(attr_len>0){for(j=0;j<attr_len;
j++){if(!(a=attr[j]).nodeValue){continue;}output.push(nm+"[_"+a.nodeName+"]="+escape(a.nodeValue.trim()));
}}value=this.cgiobjects(node,nm,true);if(value.dataType!==1){output.push(value);
}else{if(node.firstChild&&node.firstChild.nodeValue.trim()){output.push(nm+(attr_len>0?"[_]=":"=")+escape(node.firstChild.nodeValue.trim()));
}else{if(attr_len==0){if(includeEmpty){output.push(nm);}}}}tagNames[name]++;}else{if(node.nodeType==3&&isSub){var nval=node.nodeValue;
if(nval&&nval.trim()!==""){output.push(basename+"="+escape(nval));}}}}if(!isSub&&xml.getAttribute("id")){output.push("id="+escape(xml.getAttribute("id")));
}if(output.length){return output.join("&");}return output;}};apf.convertXml=function(xml,to){return apf.convertMethods[to](xml);
};apf.getTextNode=function(x){for(var i=0,l=x.childNodes.length;i<l;++i){if(x.childNodes[i].nodeType==3||x.childNodes[i].nodeType==4){return x.childNodes[i];
}}return false;};apf.getBoundValue=function(amlNode,xmlRoot,applyChanges){if(!xmlRoot&&!amlNode.xmlRoot){return"";
}var xmlNode=amlNode.$getDataNode("value",amlNode.xmlRoot);return xmlNode?apf.queryValue(xmlNode):"";
};apf.getArrayFromNodelist=function(nodelist){for(var nodes=[],j=0,l=nodelist.length;
j<l;++j){nodes.push(nodelist[j]);}return nodes;};apf.serializeChildren=function(xmlNode){var node,s=[],nodes=xmlNode.childNodes,i=0,l=nodes.length;
for(;i<l;++i){s[i]=(node=nodes[i]).nodeType==1?node.xml||node.serialize():(node.nodeType==8?"":node.nodeValue);
}return s.join("");};apf.getXmlString=function(xmlNode){var xml=apf.xmldb.cleanNode(xmlNode.cloneNode(true));
return xml.xml||xml.serialize();};apf.getXml=function(strXml,noError,preserveWhiteSpace){return apf.getXmlDom(strXml,noError,preserveWhiteSpace).documentElement;
};apf.formatXml=function(strXml){strXml=strXml.trim();var lines=strXml.split("\n"),depth=0,i=0,l=lines.length;
for(;i<l;++i){lines[i]=lines[i].trim();}lines=lines.join("\n").replace(/\>\n/g,">").replace(/\>/g,">\n").replace(/\n\</g,"<").replace(/\</g,"\n<").split("\n");
lines.removeIndex(0);lines.removeIndex(lines.length);for(i=0,l=lines.length;i<l;
i++){lines[i]="    ".repeat((lines[i].match(/^\s*\<\//)?(depth==0)?0:--depth:(lines[i].match(/^\s*\<[^\?][^>]+[^\/]\>/)?depth++:depth)))+lines[i];
}if(!strXml){return"";}return lines.join("\n");};apf.xmlToXpath=function(xmlNode,xmlContext,useAID){if(!xmlNode){return"";
}if(useAID===true&&xmlNode.nodeType==1&&xmlNode.getAttribute(apf.xmldb.xmlIdTag)){return"//node()[@"+apf.xmldb.xmlIdTag+"='"+xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"']";
}if(apf!=this&&this.lookup&&this.select){var unique,def=this.lookup[xmlNode.tagName];
if(def){unique=xmlNode.selectSingleNode(def).nodeValue;return"//"+xmlNode.tagName+"["+def+"='"+unique+"']";
}for(var i=0,l=this.select.length;i<l;i++){if(xmlNode.selectSingleNode(this.select[i][0])){unique=xmlNode.selectSingleNode(this.select[i][1]).nodeValue;
return"//"+this.select[i][0]+"["+this.select[i][1]+"='"+unique+"']";}}}if(xmlNode==xmlContext){return".";
}if(xmlNode.nodeType!=2&&!xmlNode.parentNode&&!xmlNode.ownerElement){return false;
}var str=[],lNode=xmlNode;if(lNode.nodeType==2){str.push("@"+lNode.nodeName);lNode=lNode.ownerElement||xmlNode.selectSingleNode("..");
}var id;while(lNode&&lNode.nodeType==1){if(lNode==xmlContext){break;}str.unshift((lNode.nodeType==1?lNode.tagName:"text()")+"["+(useAID&&(id=lNode.nodeType==1&&lNode.getAttribute(apf.xmldb.xmlIdTag))?"@"+apf.xmldb.xmlIdTag+"='"+id+"'":(apf.getChildNumber(lNode,lNode.parentNode.selectNodes(lNode.nodeType==1?lNode.tagName:"text()"))+1))+"]");
lNode=lNode.parentNode;}return(str[0]=="/"||xmlContext&&xmlContext.nodeType==1?"":"/")+str.join("/");
};apf.xpathToXml=function(xpath,xmlNode){if(!xmlNode){return false;}return xmlNode.selectSingleNode(xpath);
};apf.n=function(xml,xpath){return new apf.xmlset(xml,xpath,true);};apf.b=function(xml,xpath){return new apf.xmlset(xml,xpath);
};apf.b.$queue=[];apf.b.$state=0;apf.xmlset=function(xml,xpath,local,previous){if(typeof(xml)=="string"){xml=apf.getXml(xml);
}this.$xml=xml;if(xml){this.$nodes=xml.dataType==apf.ARRAY?xml:(xpath?xml.selectNodes(xpath):[xml]);
}this.$xpath=xpath||".";this.$local=local;this.$previous=previous;};(function(){this.add=function(){};
this.begin=function(){apf.b.$state=1;return this;};this.commit=function(at,rmt,uri){if(apf.b.$queue.length){if(rmt){var _self=this;
rmt.addEventListener("rdbsend",function(e){if(!uri||e.uri==uri){_self.rdbstack=e.message;
rmt.removeEventListener("rdbsend",arguments.callee);}});}at.execute({action:"multicall",args:apf.b.$queue});
if(rmt){rmt.$processQueue(rmt);}}apf.b.$queue=[];apf.b.$state=0;return this;};this.rollback=function(){apf.b.$queue=[];
apf.b.$state=0;return this;};this.getRDBMessage=function(){return this.rdbstack||[];
};this.before=function(el){el=typeof el=="function"?el(i):el;for(var node,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];if(this.$local){node.parentNode.insertBefore(el,node);
}else{apf.xmldb.appendChild(node.parentNode,el,node);}}return this;};this.after=function(el){el=typeof el=="function"?el(i):el;
for(var node,i=0,l=this.$nodes.length;i<l;i++){node=this.$nodes[i];if(this.$local){node.parentNode.insertBefore(el,node.nextSibling);
}else{apf.xmldb.appendChild(node.parentNode,el,node.nextSibling);}}return this;
};this.andSelf=function(){};this.append=function(el){for(var node,child,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];child=typeof el=="function"?el(i,node):el;if(apf.b.$state){apf.b.$queue.push({action:"appendChild",args:[node,child]});
}else{if(this.$local){node.appendChild(child);}else{apf.xmldb.appendChild(node,child);
}}}return this;};this.appendTo=function(target){for(var i=0,l=this.$nodes.length;
i<l;i++){target.appendChild(this.$nodes[i]);}return this;};this.prepend=function(content){for(var node,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];node.insertBefore(typeof el=="function"?el(i,node):el,node.firstChild);
}return this;};this.prependTo=function(content){for(var i=0,l=this.$nodes.length;
i<l;i++){target.insertBefore(this.$nodes[i],target.firstChild);}return this;};this.attr=function(attrName,value){if(value===undefined){return this.$nodes&&this.$nodes[0]&&this.$nodes[0].getAttribute(attrName)||"";
}else{for(var i=0,l=this.$nodes.length;i<l;i++){if(apf.b.$state){apf.b.$queue.push({action:"setAttribute",args:[this.$nodes[i],attrName,value]});
}else{if(this.$local){this.$nodes[i].setAttribute(attrName,value);}else{apf.xmldb.setAttribute(this.$nodes[i],attrName,value);
}}}}return this;};this.removeAttr=function(attrName){for(var i=0,l=this.$nodes.length;
i<l;i++){if(apf.b.$state){apf.b.$queue.push({action:"removeAttribute",args:[this.$nodes[i],attrName]});
}else{if(this.$local){this.$nodes[i].removeAttribute(attrName);}else{apf.xmldb.removeAttribute(this.$nodes[i],attrName);
}}}return this;};this.xml=function(){var str=[];for(var i=0,l=this.$nodes.length;
i<l;i++){str.push(this.$nodes[i].xml);}return str.join("\n");};this.get=this.index=function(idx){if(idx==undefined){return apf.getChildNumber(this.$nodes[0],this.$nodes[0].parentNode.getElementsByTagName("*"));
}};this.eq=function(index){return index<0?this.$nodes[this.$nodes.length-index]:this.$nodes[index];
};this.size=this.length=function(){return this.$nodes.length;};this.load=function(url){};
this.next=function(selector){if(!selector){selector="node()[local-name()]";}return new apf.xmlset(this.$xml,"((following-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[1])[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.nextAll=function(selector){if(!selector){selector="node()[local-name()]";
}return new apf.xmlset(this.$xml,"(following-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.nextUntil=function(){};this.prev=function(selector){if(!selector){selector="node()[local-name()]";
}return new apf.xmlset(this.$xml,"((preceding-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[1])[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.prevAll=function(selector){if(!selector){selector="node()[local-name()]";
}return new apf.xmlset(this.$xml,"(preceding-sibling::"+(this.$xpath=="."?"node()":this.$xpath)+")[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.not=function(){};this.parent=function(selector){return new apf.xmlset(this.$xml.parentNode,this.$local,this);
};this.parents=function(selector){};this.pushStack=function(){};this.replaceAll=function(){};
this.replaceWith=function(el){for(var node,child,i=0,l=this.$nodes.length;i<l;i++){node=this.$nodes[i];
child=typeof el=="function"?el(i,node):el;if(apf.b.$state){apf.b.$queue.push({action:"replaceNode",args:[child,node]});
}else{if(this.$local){node.parentNode.replaceChild(child,node);}else{apf.xmldb.replaceNode(child,node);
}}}return this;};this.siblings=function(selector){};this.text=function(){};this.toArray=function(){var arr=[];
for(var i=0,l=this.$nodes.length;i<l;i++){arr.push(this.$nodes[i]);}return arr;
};this.detach=function(selector){var items=[];for(var node,i=0,l=this.$nodes.length;
i<l;i++){node=this.$nodes[i];if(!node.selectSingleNode("self::node()["+selector+"]")){continue;
}if(apf.b.$state){apf.b.$queue.push({action:"removeNode",args:[node]});}else{if(this.$local){node.parentNode.removeChild(node);
}else{apf.xmldb.removeNode(node);}}items.push(node);}return new apf.xmlset(items,"",this.$local,this);
};this.remove=function(selector){for(var node,n=this.$nodes,i=n.length-1;i>=0;i--){node=n[i];
if(selector&&!node.selectSingleNode("self::node()["+selector+"]")){continue;}if(apf.b.$state){apf.b.$queue.push({action:"removeNode",args:[node]});
}else{if(this.$local){node.parentNode.removeChild(node);}else{apf.xmldb.removeNode(node);
}}}return this;};this.children=function(selector){var nodes=[];for(var node,child,i=0,l=this.$nodes.length;
i<l;i++){var list=(node=this.$nodes[i]).selectNodes(selector);for(var j=0,jl=list.length;
j<jl;j++){nodes.push(list[j]);}}return new apf.xmlset(nodes,null,this.$local,this);
};this.children2=function(selector){return new apf.xmlset(this.$xml,"("+this.$xpath+")/node()[self::"+selector.split("|").join("|self::")+"]",this.$local,this);
};this.has=this.find=function(path){return new apf.xmlset(this.$xml,"("+this.$xpath+")//"+path.split("|").join("|self::"),this.$local,this);
};this.query=function(path){return new apf.xmlset(this.$xml,"("+this.$xpath+")/"+path.split("|").join("|("+this.$xpath+")/"),this.$local,this);
};this.filter=function(filter){var newList=[];for(var i=0,l=this.$nodes.length;
i<l;i++){if(this.$nodes[i].selectSingleNode("self::node()["+filter+"]")){newList.push(this.$nodes[i]);
}}return new apf.xmlset(newList,null,this.$local,this);};this.end=function(){return this.$previous||this;
};this.is=function(selector){return this.filter(selector)?true:false;};this.contents=function(){return this.children("node()");
};this.has=function(){};this.val=function(value){if(value!==undefined){apf.setQueryValue(this.$xml,this.$xpath,value);
return this;}else{return apf.queryValue(this.$xml,this.$xpath);}};this.vals=function(){return apf.queryValues(this.$xml,this.$xpath);
};this.node=function(){return apf.queryNode(this.$xml,this.$xpath);};this.nodes=function(){return apf.queryNodes(this.$xml,this.$xpath);
};this.clone=function(deep){if(this.$nodes.length==1){return new apf.xmlset(this.$nodes[0].cloneNode(true),"",this.$local,this);
}var nodes=[];for(var i=0,l=this.$nodes.length;i<l;i++){nodes.push(this.$nodes[i].cloneNode(deep==undefined?true:deep));
}return new apf.xmlset(nodes,"",this.$local,this);};this.context=function(){return this.$xml;
};this.data=function(data){for(var i=0,l=this.$nodes.length;i<l;i++){apf.setQueryValue(this.$nodes[i],".",data);
}return this;};this.each=function(func){for(var i=0,l=this.$nodes.length;i<l;i++){func.call(this.$nodes[i],i);
}return this;};this.eachrev=function(func){for(var i=this.$nodes.length-1;i>=0;
i--){func.call(this.$nodes[i],i);}return this;};this.map=function(callback){var values=[];
for(var i=0,l=this.$nodes.length;i<l;i++){values.push(callback(this.$nodes[i]));
}return new apf.xmlset(values,"",this.$local,this);};this.empty=function(){this.children().detach();
return this;};this.first=function(){return new apf.xmlset(this.$xml,"("+this.$xpath+")[1]",this.$local,this);
};this.last=function(){return new apf.xmlset(this.$xml,"("+this.$xpath+")[last()]",this.$local,this);
};}).call(apf.xmlset.prototype);apf.xmlDiff=function(doc1,doc2){var debug=true,hash={},rules=[],appendRules=[],reorderRules=[],preserveWhiteSpace=doc1.ownerDocument.$domParser.preserveWhiteSpace,APPEND=1,UPDATE=2,REMOVE=3,SETATTRIBUTE=4,notFoundEl={},notFoundAttr={},foundEl={},foundTxt={},foundAttr={},curNode={include:{}},arr,arrPath,l,lPath,found,path,p,t,j,i,a,item,subitem,arrIndex,lastRule,prop,emptyArr=[],node;
(function createHash(el,curPath,hash){var i,nodes,attr,l,a,e,p;curPath+="/"+el.tagName;
if(l=(nodes=el.childNodes).length){for(i=0;i<l;i++){if((e=nodes[i]).nodeType==1){createHash(nodes[i],curPath,hash);
nodes[i].$childNumber=i;}else{p=curPath+"/"+e.nodeType,(hash[p]||(hash[p]=[])).push(e),e.$isValid=false;
e.$childNumber=i;}}}if(l=(attr=el.attributes).length){for(i=0;i<l;i++){p=curPath+"/@"+(a=attr[i]).nodeName,(hash[p]||(hash[p]=[])).push(a),a.$isValid=false;
}}(hash[curPath]||(hash[curPath]=[])).push(el);el.$isValid=false;if(el.$amlList){delete el.$amlList;
}})(doc1,"",hash);curNode.include[doc1.parentNode.$uniqueId]=doc1;(function match(el,curPath,hash,pNode,curParentNode,childNumber){var total,first,v,jl,item,include,i,nodes,attr,l,a,e,p,s,sh,tn,curNode,pcur,pcurl,id,count,node,max=0,found=[],pInclude={length:0},oldInclude=curParentNode.include;
curPath+="/"+el.tagName;if(!(s=hash[curPath])){(notFoundEl[curPath]||(notFoundEl[curPath]=[])).push({arr:null,node:el,curNode:curParentNode});
return false;}else{include=(curNode={}).include={};for(i=0,l=s.length;i<l;i++){if((item=s[i])){include[item.$uniqueId]=item;
}}include.length=l;}if(l=(nodes=el.childNodes).length){for(i=0;i<l;i++){if((e=nodes[i]).nodeType==1){match(e,curPath,hash,pNode,curNode,i);
}else{if((sh=hash[p=curPath+"/"+e.nodeType])){for(total=0,first=null,v=e.nodeValue,j=0,jl=sh.length;
j<jl;j++){if((tn=sh[j])&&tn.nodeValue==v){if(!first){first={node:e,index:j,arr:sh,curNode:curNode,pcur:[tn.parentNode.$uniqueId],found:[j],childNumber:i};
}else{first.found.push(j),first.pcur.push(tn.parentNode.$uniqueId);}total++;}}if(total){pcur=first.pcur,pcurl=pcur.length;
for(j=0;j<pcurl;j++){if(curNode[pcur[j]]){curNode[pcur[j]]+=(1/total);}else{curNode[pcur[j]]=(1/total);
}}(foundTxt[p]||(foundTxt[p]=[])).push(first);continue;}(notFoundEl[p]||(notFoundEl[p]=[])).push({arr:sh,node:e,curNode:curNode});
continue;}(notFoundEl[p]||(notFoundEl[p]=[])).push({isNew:true,arr:null,node:e,curNode:curNode});
}}}if(l=(attr=el.attributes).length){for(i=0;i<l;i++){pattr=curPath+"/@"+(a=attr[i]).nodeName;
if(sh=hash[pattr]){for(total=0,first=null,v=a.nodeValue,j=0,jl=sh.length;j<jl;j++){if((tn=sh[j])&&tn.nodeValue==v){if(!first){first={node:a,index:j,arr:sh,curNode:curNode,pcur:[tn.ownerElement.$uniqueId],found:[j]};
}else{first.found.push(j),first.pcur.push(tn.ownerElement.$uniqueId);}total++;}}if(total){pcur=first.pcur,pcurl=pcur.length;
for(j=0;j<pcurl;j++){if(curNode[pcur[j]]){curNode[pcur[j]]+=(1/total);}else{curNode[pcur[j]]=(1/total);
}}(foundAttr[pattr]||(foundAttr[pattr]=[])).push(first);continue;}(notFoundAttr[pattr]||(notFoundAttr[pattr]=[])).push({arr:sh,node:a,curNode:curNode});
continue;}(notFoundAttr[pattr]||(notFoundAttr[pattr]=[])).push({isNew:true,arr:null,node:a,curNode:curNode});
}}for(id in curNode){if(curNode[id]>max){max=curNode[id];count=1;}else{if(curNode[id]==max){count++;
}}}if(!max){count=s.length;for(i=count;i>=0;i--){if(!s[i]){continue;}pNode=(node=s[i]).parentNode;
if(node.$isValid||!include[node.$uniqueId]||!oldInclude[pNode.$uniqueId]){delete include[node.$uniqueId],count--;
continue;}if(!pInclude[pNode.$uniqueId]){pInclude[pNode.$uniqueId]=pNode,pInclude.length++;
}found.push(node);}}else{for(id in curNode){if(curNode[id]!=max){continue;}pNode=(node=apf.all[id]).parentNode;
if(node.$isValid||!include[node.$uniqueId]||!oldInclude[pNode.$uniqueId]){delete include[node.$uniqueId];
count--;continue;}if(!pInclude[pNode.$uniqueId]){pInclude[pNode.$uniqueId]=pNode,pInclude.length++;
}found.push(node);}}if(found.length){curParentNode.include=pInclude;}for(first=null,i=0,l=found.length;
i<l;i++){pNode=(item=found[i]).parentNode;if(curParentNode[pNode.$uniqueId]){curParentNode[pNode.$uniqueId]+=1/count;
}else{curParentNode[pNode.$uniqueId]=1/count;}if(count>1){if(!first){first={node:el,arr:s,curNode:curNode,curParentNode:curParentNode,found:found,childNumber:childNumber};
(foundEl[curPath]||(foundEl[curPath]=[])).push(first);}if(count>(item.$matchedNodes||0)){item.$matchedNodes=count;
}}else{item.$isValid=true;for(var j=s.length-1;j>=0;j--){if(s[j]==item){delete s[j];
break;}}}}if(!found.length){var found=[];for(var prop in curNode.include){if(prop=="length"){continue;
}found.push(curNode.include[prop]);}(foundEl[curPath]||(foundEl[curPath]=[])).push({arr:s,node:el,curParentNode:curParentNode,curNode:curNode,found:found,childNumber:childNumber});
}curNode.curNode=found[0],curNode.parent=curParentNode,curNode.curPath=curPath;
})(doc2,"",hash,doc1,curNode);function checkOrder(node1,node2){if(node1.$childNumber!=node2.childNumber){reorderRules.push([node1,node2.childNumber]);
}}function recurEl(path){var pathCollision=foundEl[path];if(!pathCollision){return;
}var curItem,curMatch,l,count,nMatch,j,i,potentialMatches,leastMatchNodes,pl,pNode;
for(i=0,pl=pathCollision.length;i<pl;i++){potentialMatches=(curItem=pathCollision[i]).found,leastMatchNodes=100000;
for(count=j=0,l=potentialMatches.length;j<l;j++){if((curMatch=potentialMatches[j]).$isValid){continue;
}nMatch=curMatch.$matchedNodes;if(nMatch<leastMatchNodes){leastMatchNodes=nMatch,count=1;
}else{if(nMatch==leastMatchNodes){count++;}}}if(count==1){for(j=0,l=potentialMatches.length;
j<l;j++){if(!(curMatch=potentialMatches[j]).$isValid&&curMatch.$matchedNodes==leastMatchNodes){curMatch.$isValid=true,curItem.curNode.curNode=curMatch;
checkOrder(curMatch,curItem);break;}}}else{if(count){var include=curItem.curParentNode.include;
if(include.length==1){pNode=curItem.curParentNode.curNode;for(j=0,l=potentialMatches.length;
j<l;j++){if(!(curMatch=potentialMatches[j]).$isValid&&curMatch.$matchedNodes==leastMatchNodes&&curMatch.parentNode==pNode){curMatch.$isValid=true,curItem.curNode.curNode=curMatch;
checkOrder(curMatch,curItem);break;}}continue;}recurEl(curItem.curParentNode.curPath);
pNode=curItem.curParentNode.curNode;for(j=0,l=potentialMatches.length;j<l;j++){if(!(curMatch=potentialMatches[j]).$isValid&&curMatch.$matchedNodes==leastMatchNodes&&curMatch.parentNode==pNode){curMatch.$isValid=true,curItem.curNode.curNode=curMatch;
checkOrder(curMatch,curItem);break;}}}else{var nodes=hash[path],foundLast=false;
for(var k=0;k<nodes.length;k++){if(nodes[k]&&!nodes[k].$isValid){nodes[k].$isValid=true;
curItem.curNode.curNode=nodes[k];checkOrder(nodes[k],curItem);foundLast=true;break;
}}if(!foundLast){curItem.curNode.isAdding=true;if(!curItem.curParentNode.isAdding){(notFoundEl[path]||(notFoundEl[path]=[])).push({isNew:true,arr:null,node:curItem.node,curNode:curItem.curParentNode});
}}}}}delete foundEl[path];}for(path in foundEl){recurEl(path);}for(path in foundTxt){arr=foundTxt[path],l=arr.length,arrPath=arr[0].arr;
var lost=[];for(i=0;i<l;i++){t=arr[i],arrIndex=t.found;if((p=t.curNode)&&(p=p.curNode)){if(arrPath[t.index]&&p==arrPath[t.index].parentNode){checkOrder(arrPath[t.index],t);
delete arrPath[t.index];}else{for(found=false,j=0;j<arrIndex.length;j++){if(arrPath[arrIndex[j]]&&arrPath[arrIndex[j]].parentNode==p){checkOrder(arrPath[arrIndex[j]],t);
delete arrPath[arrIndex[j]],found=true;break;}}if(!found&&!t.curNode.isAdding){(notFoundEl[path]||(notFoundEl[path]=[])).push(t);
}}}else{if(!t.curNode.isAdding){(notFoundEl[path]||(notFoundEl[path]=[])).push(t);
}}}}for(path in foundAttr){arr=foundAttr[path],l=arr.length,arrPath=arr[0].arr;
for(i=0;i<l;i++){t=arr[i],arrIndex=t.found;if((p=t.curNode)&&(p=p.curNode)){if(arrPath[t.index]&&p==arrPath[t.index].ownerElement){delete arrPath[t.index];
}else{for(found=false,j=0;j<arrIndex.length;j++){if(arrPath[arrIndex[j]]&&arrPath[arrIndex[j]].ownerElement==p){delete arrPath[arrIndex[j]],found=true;
break;}}if(!found&&!t.curNode.isAdding){(notFoundAttr[path]||(notFoundAttr[path]=[])).push(t);
}}}else{if(!t.curNode.isAdding){(notFoundAttr[path]||(notFoundAttr[path]=[])).push(t);
}}}}for(path in notFoundAttr){arr=notFoundAttr[path],l=arr.length,arrPath=arr[0].arr||emptyArr,lPath=arrPath.length;
for(i=0;i<l;i++){a=arr[i];if((p=t.curNode)&&p.isAdding){continue;}if((p=a.curNode)&&(p=p.curNode)){if(a.node.nodeName=="id"){p.setAttribute("id",a.node.nodeValue);
}else{rules.push([SETATTRIBUTE,p,a.node]);}for(j=0;j<lPath;j++){if(arrPath[j]&&arrPath[j].ownerElement==p){delete arrPath[j];
break;}}}else{}}}for(path in notFoundEl){arr=notFoundEl[path],l=arr.length,arrPath=arr[0].arr||emptyArr,lPath=arrPath.length;
for(i=0;i<l;i++){t=arr[i];if((p=t.curNode)&&p.isAdding){continue;}if(p=p.curNode){appendRules.push(lastRule=[APPEND,p,t.node]);
for(j=0;j<lPath;j++){if(arrPath[j]&&arrPath[j].parentNode==p){if(t.node.nodeType!=1){lastRule[0]=UPDATE;
lastRule[1]=arrPath[j];}else{appendRules.length--;}delete arrPath[j];break;}}}else{}}}for(prop in hash){item=hash[prop];
for(i=0,l=item.length;i<l;i++){subitem=item[i];if(subitem&&!subitem.$isValid&&(subitem.parentNode||subitem.ownerElement).$isValid){rules.push([REMOVE,subitem]);
}}}var dt=new Date().getTime();var q={},doc=doc1.ownerDocument;for(i=0,l=appendRules.length;
i<l;i++){switch((item=appendRules[i])[0]){case UPDATE:item[1].$setValue(item[2].nodeValue);
if(item[1].nodeType!=2){var childNr1=apf.getChildNumber(item[1]),childNr2=apf.getChildNumber(item[2]);
if(childNr1!=childNr2){item[1].parentNode.insertBefore(item[1],item[1].parentNode.childNodes[childNr2]);
}}break;case APPEND:if(!item[1].canHaveChildren){item[1].$aml=item[2].parentNode;
if(item[1].$redraw){item[1].$redraw();}continue;}if(item[1].render!="runtime"){var xml=item[1].parentNode;
while(xml&&xml.nodeType==1&&!xml.getAttribute("render")){xml=xml.parentNode;}if(xml&&xml.render){if(xml.$amlList){xml.$amlList.push(item);
}else{xml.$amlList=[item];xml.addEventListener("beforerender",function(e){var nodes=this.$amlList;
this.$amlList=null;for(var item,i=0,l=nodes.length;i<l;i++){item=nodes[i];var childNr=apf.getChildNumber(node=item[2]);
item[1].insertBefore(doc.importNode(node,true),item[1].childNodes[childNr]);}this.$rendered=true;
this.removeEventListener("beforerender",arguments.callee);return false;});xml.$rendered=false;
}}else{(item[1].$amlList||(item[1].$amlList=[]))[apf.getChildNumber(item[2])]=item;
q[item[1].$uniqueId]=item[1];}}else{item[1].$aml=item[2].parentNode;item[1].$rendered=false;
}break;}}var list,newNode;for(var id in q){list=q[id].$amlList;for(var item,i=0;
i<list.length;i++){item=list[i];if(!item){continue;}newNode=doc.importNode(item[2],true);
if(newNode){item[1].insertBefore(newNode,item[1].childNodes[i]);}}}for(i=0,l=rules.length;
i<l;i++){switch((item=rules[i])[0]){case REMOVE:if((node=item[1]).destroy){node.destroy(true,true);
}else{if(node.parentNode){node.parentNode.removeChild(node);}else{node.ownerElement.removeAttributeNode(node);
}}break;case SETATTRIBUTE:item[1].setAttribute((item=item[2]).nodeName,item.nodeValue);
break;}}for(var node,pnode,next,nr,tonr,i=0;i<reorderRules.length;i++){node=reorderRules[i][0];
nr=node.$childNumber;tonr=reorderRules[i][1];pnode=node.parentNode;next=pnode.childNodes[tonr+(nr<tonr?1:0)];
if(node.nextSibling!=next&&node!=next){pnode.insertBefore(node,next);}}apf.queue.empty();
};apf.zmanager=function(){var count={"default":{level:10},plane:{level:100000},popup:{level:200000},notifier:{level:300000},drag:{level:400000},print:{level:1000000}};
this.set=function(type,main,companion){main.style.zIndex=count[type].level++;if(companion){if(companion.$storedZ==undefined){companion.$storedZ=companion.style.zIndex;
}companion.style.zIndex=count[type].level++;}};this.clear=function(main,companion){if(companion.$storedZ==main.style.zIndex+1){companion.style.zIndex=companion.$storedZ;
companion.$storedZ=undefined;}};};apf.history={inited:false,page:null,past:[],future:[],delay:1,init:function(defName,getVar,delay){if(this.inited||window.history.pushState){return;
}if(delay){this.delay=delay;}this.inited=true;var name,_self=this;function preInit(){name=apf.dispatchEvent("hashinit")||location.href.match(/#(.*)$/)&&decodeURI(RegExp.$1)||apf._GET[getVar||-1]||defName;
location.hash=name;_self.hasChanged(name||null);}if(apf.supportHashChange){$setTimeout(function(){preInit();
window.onhashchange=function(){var page=location.hash.replace("#","");apf.history.hasChanged(decodeURI(page));
};});}else{if(apf.isIE){preInit();var str="<style>                    BODY, HTML{margin:0}                    h1{height:100px; margin:0; padding:0; overflow:hidden}                </style>                <body>                    <h1 id='"+name+"'>0</h1>                </body>                <script>                    var lastURL = -1;                    if (document.all)                        document.body.onscroll = checkUrl;                    else                        setInterval('checkUrl()', 200);                                        function checkUrl(){                        var iScr = (document.all ? document.body : document.documentElement).scrollTop;                        if (lastURL == iScr) return;                        top.apf.history.hasChanged(document.getElementsByTagName('h1')[Math.round(iScr / 100)].id, true);                        lastURL = iScr;                        }                    checkUrl();                <\/script>";
if(top==self){document.body.insertAdjacentHTML("beforeend","<iframe name='nav' style2='position:absolute;left:10px;top:10px;height:100px;width:100px;z-index:1000'                       style='width:1px;height:1px;' src='about:blank'></iframe>");
document.frames.nav.document.open();document.frames.nav.document.write(str);document.frames.nav.document.close();
}this.iframe=document.frames.nav;this.timer2=setInterval(function(){if(!apf.history.changingHash&&location.hash!="#"+apf.history.page){var name=location.hash.replace(/^#/,"");
var page=apf.history.page;apf.history.setHash(name,true,true);apf.history.page=page;
apf.history.hasChanged(name);}},apf.history.delay||1);}else{preInit();apf.history.lastUrl=location.href.toString();
this.timer2=setInterval(function(){if(apf.history.lastUrl==location.href.toString()){return;
}apf.history.lastUrl=location.href.toString();var page=location.hash.replace("#","");
apf.history.hasChanged(decodeURI(page));},20);}}},to_name:null,setHash:function(name,timed,force){if(this.changing||this.page==name||!force&&decodeURIComponent(location.hash)=="#"+decodeURIComponent(name)){this.to_name=name;
return;}if(!apf.supportHashChange&&apf.isIE&&!timed){this.to_name=name;return $setTimeout(function(){apf.history.setHash(apf.history.to_name,true,force);
},200);}this.changePage(name);if(!this.inited){return this.init(name);}if(!apf.supportHashChange&&apf.isIE){var h=this.iframe.document.body.appendChild(this.iframe.document.createElement("h1"));
h.id=name;h.innerHTML="1";}(!apf.supportHashChange&&apf.isIE?this.iframe:window).location.href="#"+name;
if(!apf.isIE&&!apf.isGecko&&!apf.isIphone){apf.history.lastUrl=location.href.toString();
}},timer:null,changePage:function(page,force){if(!apf.supportHashChange&&apf.isIE){this.page=page;
this.changingHash=true;clearTimeout(this.timer);this.timer=$setTimeout(function(){location.hash=page;
apf.history.changingHash=false;},1);}},update:function(page){var i,l,idx=0;for(i=0,l=this.past.length;
i<l&&idx===0;i++){if(this.past[i]==page){idx=i+1;}}if(idx>0){this.future=this.past.slice(idx,this.past.length-1).concat(this.future).makeUnique();
this.past.splice(idx,this.past.length-(idx));idx=-idx;}else{for(i=0,l=this.future.length;
i<l&&idx===0;i++){if(this.future[i]==page){idx=i+1;this.past=this.past.concat(this.future.splice(0,this.future.length-idx)).makeUnique();
}}if(idx===0){this.past.push(page);idx=1;}}return idx;},hasChanged:function(page,force){if(page==this.page&&!force){return;
}this.changePage(page,force);this.changing=true;if(apf.dispatchEvent("hashchange",{oldURL:this.page,newURL:page,page:page,index:this.update(page)})===false){page=location.hash=this.page;
}this.changing=false;this.page=page;}};apf.config=new apf.Class().$init();apf.extend(apf.config,{disableRightClick:false,allowSelect:false,allowBlur:true,autoDisableActions:true,autoDisable:false,disableF5:true,autoHideLoading:true,disableSpace:true,defaultPage:"home",disableBackspace:true,undokeys:false,outline:false,dragOutline:false,resizeOutline:false,autoDisableNavKeys:true,disableTabbing:false,resourcePath:null,initdelay:true,liveText:false,skinset:"default",name:apf.isO3?"o3App":self.window&&window.location.href.replace(/[^0-9A-Za-z_]/g,"_"),tags:{},defaults:{},baseurl:"",model:"@default","empty-message":"No items","loading-message":"Loading...","offline-message":"You are currently offline.",setDefaults:function(){if(apf.isParsingPartial){this.disableRightClick=false;
this.allowSelect=true;this.autoDisableActions=true;this.autoDisable=false;this.disableF5=false;
this.autoHideLoading=true;this.disableSpace=false;this.disableBackspace=false;this.undokeys=false;
this.disableTabbing=true;this.allowBlur=true;}},getDefault:function(type,prop){var d=this.defaults[type];
if(!d){return;}for(var i=d.length-1;i>=0;i--){if(d[i][0]==prop){return d[i][1];
}}},$handlePropSet:function(name,value){this[name.replace(/-(\w)/g,function(m,m1){return m1.toUpperCase();
})]=this[name]=value;(this.$propHandlers&&this.$propHandlers[name]||apf.GuiElement.propHandlers[name]||apf.K).call(this,value);
},$inheritProperties:{},$propHandlers:{baseurl:function(value){this.baseurl=apf.parseExpression(value);
},language:function(value){},"resource-path":function(value){this.resourcePath=apf.parseExpression(value||"").replace(/resources\/?|\/$/g,"");
},skinset:function(value){if(this.$amlLoaded){apf.skins.changeSkinset(value);}},outline:function(value){this.dragOutline=this.resizeOutline=this.outline=apf.isTrue(value);
},"drag-outline":function(value){this.dragOutline=value?apf.isTrue(value):false;
},"resize-outline":function(value){this.resizeOutline=value?!apf.isFalse(value):false;
},login:function(value,x){apf.auth.init(x);},debug:function(value){apf.debug=value;
}}});if(apf.history){apf.addEventListener("load",function(){apf.history.init(apf.config.defaultPage,"page");
});}apf.offline={onLine:true};apf.saveData=apf.getData=function(instruction,options){if(!instruction){return false;
}var result,chr=instruction.charAt(0),callback=options.callback;var gCallback=function(data,state,extra){var callback=options.callback;
if(state!=apf.SUCCESS){return callback(data,state,extra||{});}return callback(data,state,extra||{});
};if(!options){options={};}var fParsed=options.fParsed||(instruction.indexOf("{")>-1||instruction.indexOf("[")>-1?apf.lm.compile(instruction,{withopt:true,precall:options.precall,alwayscb:true,simplexpath:true}):{str:instruction,type:2});
if(options.precall&&!options._pc){options.asyncs=fParsed.asyncs;options._pc=1;}if(fParsed.type==3){if(fParsed.xpaths[0]){var model=fParsed.xpaths[0],xpath=fParsed.xpaths[1];
if(model=="#"||xpath=="#"){var m=(apf.lm.compile(instruction,{xpathmode:5}))();
if(typeof m!="string"){model=m.model&&m.model.$isModel&&m.model;if(model){xpath=m.xpath;
}else{if(m.model){model=apf.xmldb.findModel(m.model);xpath=apf.xmlToXpath(m.model,model.data)+(m.xpath?"/"+m.xpath:"");
}else{return;}}}else{model=null;}}else{model=apf.nameserver.get("model",model);
}return gCallback(model.data.selectSingleNode(xpath),apf.SUCCESS,{});}else{return gCallback(options.xmlNode.data.selectSingleNode(fParsed.xpaths[1]),apf.SUCCESS,{});
}}if(chr=="<"){if(fParsed.type==2){result=fParsed.str;}else{return fParsed(options.xmlNode,gCallback,options);
}}else{if((chr=="["||chr=="{")){return fParsed(options.xmlNode,gCallback,options);
}else{if(fParsed.type==1||fParsed.type==3){var callback2=callback;callback=options.callback=function(data,state,extra){if(options._pc===true){return;
}if(state!=apf.SUCCESS){return callback2.apply(this,arguments);}var url=data.split(" "),method="get";
if(url.length>1&&url[0].length<10){method=url.shift();url=url.join(" ");}else{url=data;
}callback=options.callback=callback2;apf.oHttp.exec(method,[url],gCallback,options);
};fParsed(options.xmlNode,gCallback,options);}else{if(options._pc===true){return;
}var url=instruction.split(" "),method="get";if(url.length>1&&url[0].length<10){method=url.shift();
url=url.join(" ");}else{url=instruction;}apf.oHttp.exec(method,[url.replace(/\\/g,"")],gCallback,options);
}}}if(result){if(callback){gCallback(result,apf.SUCCESS,{});}else{return result;
}}};apf.setModel=function(instruction,amlNode){if(!instruction){return;}var fParsed=instruction.indexOf("{")>-1||instruction.indexOf("[")>-1?apf.lm.compile(instruction,{alwayscb:true}):{type:2,str:instruction};
if(instruction=="@default"||fParsed.type==2){var model=apf.nameserver.get("model",instruction);
if(model){return model.register(amlNode);}else{if(instruction=="@default"){return;
}}if(instruction.indexOf(".")==-1&&instruction.indexOf("/")==-1){return;}}if(fParsed.type==3){if(fParsed.models){if(fParsed.xpaths.length==2&&fParsed.xpaths[0]!="#"&&fParsed.xpaths[1]!="#"){apf.nameserver.get("model",fParsed.xpaths[0]).register(amlNode,fParsed.xpaths[1]);
return;}}}if(amlNode.clear){amlNode.clear("loading");}apf.getData(instruction,{parsed:fParsed,xmlNode:amlNode&&amlNode.xmlRoot,callback:function(data,state,extra){if(state!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,null,"Loading new data","Could not load data into model.                 \nMessage: "+extra.message+"                \nInstruction: '"+instruction+"'"));
}if(!data){return amlNode.clear&&amlNode.clear();}if(typeof data=="string"){if(data.charAt(0)=="<"){data=apf.getXml(data);
}else{if(data.indexOf("http://")==0){return apf.setModel(data,amlNode);}else{throw new Error("Invalid data from server");
}}}if(data.nodeFunc){data.register(amlNode);return;}var model=apf.xmldb.findModel(data);
if(model){model.register(amlNode,apf.xmlToXpath(data,model.data));}else{new apf.model().register(amlNode).load(data);
}}});};(function(){var $C={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};
var $D=Date,$P=$D.prototype,p=function(s,l){if(!l){l=2;}return("000"+s).slice(l*-1);
};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);
this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();
this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());
this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();
};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);
}else{if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;
}else{throw new TypeError(date1+" - "+date2);}}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);
};$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();
for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;
}}return -1;};$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();
for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;
}}return -1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);
};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];
};$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;
i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}return null;};$D.getTimezoneOffset=function(name){var z=$C.timezones,p;
for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;
}}return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);
};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();
};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);
};$P.isToday=$P.isSameDay=function(date){return this.clone().clearTime().equals((date||new Date()).clone().clearTime());
};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value*1);
return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);
};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);
};$P.addDays=function(value){this.setDate(this.getDate()+value*1);return this;};
$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();
this.setDate(1);this.setMonth(this.getMonth()+value*1);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));
return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;
return this;}var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);
}if(x.seconds){this.addSeconds(x.seconds);}if(x.minutes){this.addMinutes(x.minutes);
}if(x.hours){this.addHours(x.hours);}if(x.weeks){this.addWeeks(x.weeks);}if(x.months){this.addMonths(x.months);
}if(x.years){this.addYears(x.years);}if(x.days){this.addDays(x.days);}return this;
};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;
$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);
c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;
b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;
f=$d+((153*($m-3)+2)/5)+58+s;}g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);
}else{if(n>364+s){w=1;}else{w=(n/7|0)+1;}}$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();
$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());
};var validate=function(n,min,max,name){if(typeof n=="undefined"){return false;
}else{if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else{if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");
}}}return true;};$D.validateMillisecond=function(value){return validate(value,0,999,"millisecond");
};$D.validateSecond=function(value){return validate(value,0,59,"second");};$D.validateMinute=function(value){return validate(value,0,59,"minute");
};$D.validateHour=function(value){return validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return validate(value,1,$D.getDaysInMonth(year,month),"day");
};$D.validateMonth=function(value){return validate(value,0,11,"month");};$D.validateYear=function(value){return validate(value,0,9999,"year");
};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());
}if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());
}if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());
}if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());
}if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());
}if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());
}if(config.timezone){this.setTimezone(config.timezone);}if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);
}if(config.week&&validate(config.week,0,53,"week")){this.setWeek(config.week);}return this;
};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});
};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;
}else{if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);
}return this;}}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);
};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;
return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;
return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;
};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());
};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;
return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));
};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());
};$P.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset();
};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();
return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);
}};$P.getUTCTime=function(){return Date.UTC(this.getUTCFullYear(),this.getUTCMonth(),this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds(),this.getUTCMilliseconds());
};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?"0"+n:n;
}return'"'+this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+'Z"';
};}$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$C.formatPatterns;
x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);
case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);
case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);
case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);
}}var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";
case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");
}x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));
case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());
case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();
case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);
case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];
case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];
case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));
case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);
case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());
default:return m;}}):this._toString();};}());apf.htmlCleaner=(function(){var prepareRE=null,exportRE=null,noMarginTags={table:1,TABLE:1},selfClosing={br:1,img:1,input:1,hr:1};
return{prepare:function(html,bNoEnclosing){if(!prepareRE){prepareRE=[/<(\/?)strong>|<strong( [^>]+)>/gi,/<(\/?)em>|<em( [^>]+)>/gi,/&apos;/g,/(<(\/?)(span|strong|em|u|i|b|a|strike|sup|sub|font|img)(?:\s+[\s\S]*?)?>)|(<br[\s\S]*?>)|(<(\/?)([\w\-]+)(?:\s+[\s\S]*?)?>)|([^<>]*)/gi,/(<a[^>]*href=)([^\s^>]+)*([^>]*>)/gi,/<p><\/p>/gi,/<a( )([^>]+)\/>|<a\/>/gi];
}if(apf.isGecko){html=html.replace(prepareRE[0],"<$1b$2>").replace(prepareRE[1],"<$1i$2>");
}else{if(apf.isIE){html=html.replace(prepareRE[2],"&#39;").replace(prepareRE[4],"$1$2 _apf_href=$2$3");
var str=[],capture=false,strP=[],depth=[],bdepth=[],lastBlockClosed=false;html.replace(prepareRE[3],function(m,inline,close,tag,br,block,bclose,btag,any){if(inline){var id=strP.push(inline);
tag=tag.toLowerCase();if(!selfClosing[tag]){if(close){if(!depth[depth.length-1]||depth[depth.length-1][0]!=tag){strP.length--;
}else{depth.length--;}}else{depth.push([tag,id]);}}capture=true;}else{if(any){strP.push(any);
capture=true;}else{if(br){if(capture){if(depth.length){strP.push(br);}else{str.push("<p>",strP.join(""),"</p>");
strP=[];}if(!depth.length){capture=false;}}else{if((bdepth.length||lastBlockClosed)&&br.indexOf("_apf_marker")>-1){}else{str.push("<p>&nbsp;</p>");
}}}else{if(block){if(bclose){if(bdepth[bdepth.length-1]!=btag.toLowerCase()){return;
}else{bdepth.length--;}if(strP.length){str.push(strP.join(""));strP=[];}lastBlockClosed=2;
}else{var useStrP=strP.length&&strP.join("").trim();var last=useStrP?strP:str;if(!noMarginTags[btag]){if(last[last.length-1]=="<p>&nbsp;</p>"){last[last.length-1]="";
}else{if(useStrP&&!bdepth.length){last.push("<p></p>");}}}if(strP.length){if(!useStrP||bdepth.length){str.push(strP.join(""));
strP=[];}else{str.push("<p>",strP.join(""),"</p>");strP=[];}}bdepth.push(btag.toLowerCase());
}str.push(block);capture=false;}}}}lastBlockClosed=lastBlockClosed==2?1:false;});
var s;if((s=strP.join("")).trim()){str.push(bNoEnclosing?s:"<p>"+s+"</p>");}html=str.join("");
}}html=(apf.xmlentities?apf.xmlentities(html):html).replace(prepareRE[6],"<a$1$2></a>");
return html;},parse:function(html,noEntities,noParagraph){if(!exportRE){exportRE=[/<br[^>]*><\/li>/gi,/<br[^>]*_apf_placeholder="1"\/?>/gi,/<(a|span|div|h1|h2|h3|h4|h5|h6|pre|address)>[\s\n\r\t]*<\/(a|span|div|h1|h2|h3|h4|h5|h6|pre|address)>/gi,/<(tr|td)>[\s\n\r\t]*<\/(tr|td)>/gi,/[\s]*_apf_href="?[^\s^>]+"?/gi,/(".*?"|'.*?')|(\w)=([^'"\s>]+)/gi,/<((?:br|input|hr|img)(?:[^>]*[^\/]|))>/ig,/<p>&nbsp;$/mig,/(<br[^>]*?>(?:[\r\n\s]|&nbsp;)*<br[^>]*?>)|(<(\/?)(span|strong|em|u|i|b|a|br|strike|sup|sub|font|img)(?:\s+.*?)?>)|(<(\/?)([\w\-]+)(?:\s+.*?)?>)|([^<>]*)/gi,/<\/p>/gi,/<p>/gi,/<\s*\/?\s*(?:\w+:\s*)?[\w-]*[\s>\/]/g];
}if(apf.isIE){html=html.replace(exportRE[7],"<p></p>").replace(exportRE[9],"<br />").replace(exportRE[10],"");
}else{if(html=="<br>"){html="";}}html=(!noEntities&&apf.xmlentities?apf.xmlentities(html):html).replace(exportRE[0],"</li>").replace(exportRE[1],"").replace(exportRE[2],"").replace(exportRE[3],"<$1>&nbsp;</$2>").replace(exportRE[4],"").replace(exportRE[6],"<$1 />").replace(exportRE[11],function(m){return m.toLowerCase();
});if(apf.isIE&&!noParagraph){var str=[],capture=true,strP=[],depth=[],bdepth=[];
html.replace(exportRE[8],function(m,br,inline,close,tag,block,bclose,btag,any){if(inline){if(apf.isIE){inline=inline.replace(exportRE[5],function(m1,str,m2,v){return str||m2+'="'+v+'"';
});}var id=strP.push(inline);if(!selfClosing[tag]){if(close){if(!depth[depth.length-1]||depth[depth.length-1][0]!=tag){strP.length--;
}else{depth.length--;}}else{depth.push([tag,id]);}}capture=true;}else{if(any){strP.push(any);
capture=true;}else{if(br){if(capture){if(depth.length){strP.push(br);}else{str.push("<p>",strP.join("").trim()||"&nbsp;","</p>");
strP=[];capture=false;}}else{str.push("<p>&nbsp;</p>");}}else{if(block){if(bclose){if(bdepth[bdepth.length-1]!=btag){return;
}else{bdepth.length--;}if(strP.length){str.push(strP.join(""));strP=[];}}else{if(apf.isIE){block=block.replace(exportRE[5],function(m1,str,m2,v){return str||m2+'="'+v+'"';
});}var last=strP.length?strP:str;if(last[last.length-1]=="<p>&nbsp;</p>"){last.length--;
}if(strP.length){var s;if(bdepth.length||(s=strP.join("").trim()).replace(/<.*?>/g,"").trim()==""){str.push(s||strP.join(""));
strP=[];}else{str.push("<p>",(s||strP.join("").trim()||"&nbsp;").replace(/<br \/>[\s\r\n]*$/,""),"</p>");
strP=[];}}bdepth.push(btag);}str.push(block);capture=false;}}}}});if(strP.length){str.push("<p>"+strP.join("").replace(/<br \/>[\s\r\n]*$/,"")+"</p>");
}html=str.join("");}else{html=html.replace(/<br[^>]*_apf_marker="1"[^>]*>/gi,"<br />");
}return html;}};})();apf.layout={compile:function(oHtml){var l=this.layouts[oHtml.getAttribute("id")];
if(!l){return false;}var root=l.root.copy();l.layout.compile(root);l.layout.reset();
},removeAll:function(aData){aData.children.length=null;var htmlId=this.getHtmlId(aData.pHtml);
if(!this.rules[htmlId]){delete this.qlist[htmlId];}},timer:null,qlist:{},dlist:[],$hasQueue:false,queue:function(oHtml,obj,compile,q){if(!q){this.$hasQueue=true;
q=this.qlist;}var id;if(!(id=this.getHtmlId(oHtml))){id=apf.setUniqueHtmlId(oHtml);
}if(q[id]){if(obj){q[id][2].push(obj);}if(compile){q[id][1]=compile;}return;}q[id]=[oHtml,compile,[obj]];
if(!this.timer){this.timer=apf.setZeroTimeout(function(){apf.layout.processQueue();
});}},processQueue:function(){var i,id,l,qItem,list;for(i=0;i<this.dlist.length;
i++){if(this.dlist[i].hidden){this.dlist[i].hide();}else{this.dlist[i].show();}}do{var newq={};
var qlist=this.qlist;this.qlist={};this.$hasQueue=false;for(id in qlist){qItem=qlist[id];
if(qItem[1]){apf.layout.compileAlignment(qItem[1]);}list=qItem[2];for(i=0,l=list.length;
i<l;i++){if(list[i]){if(list[i].$amlDestroyed){continue;}list[i].$updateLayout();
}}apf.layout.activateRules(qItem[0]);}}while(this.$hasQueue);if(apf.hasSingleRszEvent){apf.layout.forceResize();
}this.dlist=[];clearTimeout(this.timer);this.timer=null;},rules:{},onresize:{},getHtmlId:function(oHtml){return oHtml.getAttribute?oHtml.getAttribute("id"):1;
},setRules:function(oHtml,id,rules,overwrite){if(!this.getHtmlId(oHtml)){apf.setUniqueHtmlId(oHtml);
}if(!this.rules[this.getHtmlId(oHtml)]){this.rules[this.getHtmlId(oHtml)]={};}var ruleset=this.rules[this.getHtmlId(oHtml)][id];
if(!overwrite&&ruleset){this.rules[this.getHtmlId(oHtml)][id]=rules+"\n"+ruleset;
}else{this.rules[this.getHtmlId(oHtml)][id]=rules;}},getRules:function(oHtml,id){return id?this.rules[this.getHtmlId(oHtml)][id]:this.rules[this.getHtmlId(oHtml)];
},removeRule:function(oHtml,id){var htmlId=this.getHtmlId(oHtml);if(!this.rules[htmlId]){return;
}var ret=this.rules[htmlId][id]||false;delete this.rules[htmlId][id];var prop;for(prop in this.rules[htmlId]){}if(!prop){delete this.rules[htmlId];
}if(apf.hasSingleRszEvent){if(this.onresize[htmlId]){this.onresize[htmlId]=null;
}else{var p=oHtml.parentNode;while(p&&p.nodeType==1&&!this.onresize[p.getAttribute("id")]){p=p.parentNode;
}if(p&&p.nodeType==1){var x=this.onresize[p.getAttribute("id")];if(x.children){delete x.children[htmlId];
}}}}return ret;},activateRules:function(oHtml,no_exec){if(!oHtml){var prop,obj;
for(prop in this.rules){obj=document.getElementById(prop);if(!obj||obj.onresize){continue;
}this.activateRules(obj);}if(apf.hasSingleRszEvent&&apf.layout.$onresize){apf.layout.$onresize();
}return;}var rsz,id,rule,rules,strRules=[];if(!apf.hasSingleRszEvent){rules=this.rules[this.getHtmlId(oHtml)];
if(!rules){oHtml.onresize=null;return false;}for(id in rules){if(typeof rules[id]!="string"){continue;
}strRules.push(rules[id]);}rsz=apf.needsCssPx?new Function(strRules.join("\n")):new Function(strRules.join("\n").replace(/ \+ 'px'|try\{\}catch\(e\)\{\}\n/g,""));
oHtml.onresize=rsz;if(!no_exec){rsz();}}else{var htmlId=this.getHtmlId(oHtml);rules=this.rules[htmlId];
if(!rules){return false;}for(id in rules){if(typeof rules[id]!="string"){continue;
}strRules.push(rules[id]);}var p=oHtml.parentNode;while(p&&p.nodeType==1&&!this.onresize[p.getAttribute("id")]){p=p.parentNode;
}var f=new Function(strRules.join("\n"));if(this.onresize[htmlId]){f.children=this.onresize[htmlId].children;
}if(p&&p.nodeType==1){var x=this.onresize[p.getAttribute("id")];this.onresize[htmlId]=(x.children||(x.children={}))[htmlId]=f;
}else{this.onresize[htmlId]=f;}if(!no_exec){f();}if(!apf.layout.$onresize){var rsz=function(f){try{var c=[];
for(var name in f){if(f[name]){c.unshift(f[name]);}}for(var i=0;i<c.length;i++){c[i]();
if(c[i].children){rsz(c[i].children);}}}catch(e){}};apf.addListener(window,"resize",apf.layout.$onresize=function(){rsz(apf.layout.onresize);
});}}},forceResize:function(oHtml){if(apf.hasSingleRszEvent){return apf.layout.$onresize&&apf.layout.$onresize();
}var rsz=oHtml.onresize;if(rsz){rsz();}var els=oHtml.getElementsByTagName("*");
for(var i=0,l=els.length;i<l;i++){if(els[i]&&els[i].onresize){els[i].onresize();
}}},paused:{},pause:function(oHtml,replaceFunc){if(apf.hasSingleRszEvent){var htmlId=this.getHtmlId(oHtml);
this.paused[htmlId]=this.onresize[htmlId]||true;if(replaceFunc){this.onresize[htmlId]=replaceFunc;
this.onresize[htmlId].children=this.paused[htmlId].children;replaceFunc();}else{delete this.onresize[htmlId];
}}else{this.paused[this.getHtmlId(oHtml)]=oHtml.onresize||true;if(replaceFunc){oHtml.onresize=replaceFunc;
replaceFunc();}else{oHtml.onresize=null;}}},play:function(oHtml){if(!this.paused[this.getHtmlId(oHtml)]){return;
}if(apf.hasSingleRszEvent){var htmlId=this.getHtmlId(oHtml);var oldFunc=this.paused[htmlId];
if(typeof oldFunc=="function"){this.onresize[htmlId]=oldFunc;}else{delete this.onresize[htmlId];
}if(apf.layout.$onresize){apf.layout.$onresize();}this.paused[this.getHtmlId(oHtml)]=null;
}else{var oldFunc=this.paused[this.getHtmlId(oHtml)];if(typeof oldFunc=="function"){oHtml.onresize=oldFunc;
oldFunc();}else{oHtml.onresize=null;}this.paused[this.getHtmlId(oHtml)]=null;}}};
apf.getWindowWidth=function(){return apf.isIE?document.documentElement.offsetWidth-apf.windowHorBorder:window.innerWidth;
};apf.getWindowHeight=function(){return apf.isIE?document.documentElement.offsetHeight-apf.windowVerBorder:window.innerHeight;
};apf.setZeroTimeout=!window.postMessage?function(){setTimeout.apply(null,arguments);
}:(function(){var timeouts=[];var messageName="zero-timeout-message";function setZeroTimeout(fn){timeouts.push(fn);
window.postMessage(messageName,"*");}function handleMessage(e){if(!e){e=event;}if(e.source==window&&e.data==messageName){apf.stopPropagation(e);
if(timeouts.length>0){timeouts.shift()();}}}apf.addListener(window,"message",handleMessage,true);
return setZeroTimeout;})();apf.queue={q:{},timer:null,add:function(id,f){this.q[id]=f;
if(!this.timer){this.timer=apf.setZeroTimeout(function(){apf.queue.empty();});}},remove:function(id){delete this.q[id];
},empty:function(prop){clearTimeout(this.timer);this.timer=null;if(apf.layout&&apf.layout.$hasQueue){apf.layout.processQueue();
}if(apf.xmldb&&apf.xmldb.$hasQueue){apf.xmldb.notifyQueued();}var q=this.q;this.q={};
for(var prop in q){var f=q[prop];if(f){delete q[prop];f();}}}};apf.resize=function(){this.scales={scalex:false,scaley:false,scaleratio:false,dwidth:0,dheight:0,snap:false,gridW:48,gridH:48};
this.htmlElement;var squares=[];this.init=function(){squares=[new apf.resize.square("top","left",this),new apf.resize.square("top","middle",this),new apf.resize.square("top","right",this),new apf.resize.square("middle","left",this),new apf.resize.square("middle","right",this),new apf.resize.square("bottom","left",this),new apf.resize.square("bottom","middle",this),new apf.resize.square("bottom","right",this)];
};this.grab=function(oHtml,scales){this.htmlElement=oHtml;this.scales=scales;if(!squares.length){this.init();
}this.show();};this.hide=function(){for(var i=0,l=squares.length;i<l;i++){squares[i].visible=false;
squares[i].repaint();}};this.show=function(){var sx=this.scales.scalex;var sy=this.scales.scaley;
var sr=this.scales.scaleratio;for(var i=0,l=squares.length,s;i<l;i++){s=squares[i];
s.visible=sx&&sy?true:(sy&&!sx?(s.posX=="middle"?true:false):(sx&&!sy?(s.posY=="middle"?true:false):(sr?((s.posY=="top"||s.posY=="bottom")&&s.posX!=="middle"?true:false):false)));
s.repaint();}};this.destroy=function(){for(var i=0;i<squares.length;i++){squares[i].destroy();
}};};apf.resize.square=function(posY,posX,objResize){this.visible=true;this.posX=posX;
this.posY=posY;var margin=0;var _self=this;this.htmlElement=objResize.htmlElement.parentNode.appendChild(document.createElement("div"));
apf.setStyleClass(this.htmlElement,"square");this.repaint=function(){if(this.visible){var block=objResize.htmlElement;
this.htmlElement.style.display="block";var bw=parseInt(block.style.width)+apf.getDiff(block)[0];
var bh=parseInt(block.style.height)+apf.getDiff(block)[1];var bt=parseInt(block.style.top);
var bl=parseInt(block.style.left);var sw=this.htmlElement.offsetWidth;var sh=this.htmlElement.offsetHeight;
var t=posY=="top"?bt-margin-sh:posY=="middle"?bt+bh/2-sh/2:bt+bh+margin;var l=posX=="left"?bl-margin-sw:posX=="middle"?bl+bw/2-sw/2:bl+bw+margin;
var c=(posY=="middle"?"w-resize":(posX=="middle"?"n-resize":(posY+posX=="topleft"||posY+posX=="bottomright")?"nw-resize":"ne-resize"));
this.htmlElement.style.top=(t-1)+"px";this.htmlElement.style.left=(l-1)+"px";this.htmlElement.style.cursor=c;
}else{var sw=this.htmlElement.offsetWidth;this.htmlElement.style.display="none";
}};this.destroy=function(){apf.destroyHtmlNode(this.htmlElement);};this.htmlElement.onmouseover=function(e){apf.setStyleClass(_self.htmlElement,"squareHover");
};this.htmlElement.onmouseout=function(e){apf.setStyleClass(_self.htmlElement,"",["squareHover"]);
};this.htmlElement.onmousedown=function(e){e=(e||event);var block=objResize.htmlElement,sx=e.clientX,sy=e.clientY,pt=block.parentNode.offsetTop,pl=block.parentNode.offsetLeft,dw=objResize.scales.dwidth,dh=objResize.scales.dheight,snap=objResize.scales.snap,gridH=objResize.scales.gridH,gridW=objResize.scales.gridW,objBlock=apf.flow.isBlock(block),r=objBlock.other.ratio,posX=_self.posX,posY=_self.posY,width,height,top,left,dx,dy,prev_w,prev_h,l=parseInt(block.style.left),t=parseInt(block.style.top),w=parseInt(block.style.width),h=parseInt(block.style.height),resized=false;
objResize.onresizedone(w,h,t,l);if(e.preventDefault){e.preventDefault();}document.onmousemove=function(e){e=(e||event);
dx=e.clientX-sx;dy=e.clientY-sy;var shiftKey=e.shiftKey,proportion=r;if(shiftKey){if(posX=="right"&&posY=="bottom"){width=w+dx;
height=width/proportion;left=l;top=t;}else{if(posX=="right"&&posY=="top"){width=w+dx;
height=width/proportion;left=l;top=t-dx/proportion;}else{if(posX=="left"&&posY=="bottom"){width=w-dx;
height=width/proportion;left=l+dx;top=t;}else{if(posX=="left"&&posY=="top"){width=w-dx;
height=width/proportion;left=l+dx;top=t+dx/proportion;}}}}if(width>=dw&&height>=dh){width=prev_w=Math.max(dw,width);
height=prev_h=Math.max(dh,height);}else{width=prev_w;height=prev_h;return false;
}}else{width=posX=="right"?w+dx:(posX=="left"?w-dx:w);height=posY=="bottom"?h+dy:(posY=="top"?h-dy:h);
left=posX=="right"?l:(posX=="left"?Math.min(l+w-dw,l+dx):l);top=posY=="bottom"?t:(posY=="top"?Math.min(t+h-dh,t+dy):t);
width=Math.max(dw,width);height=Math.max(dh,height);}if(snap){left=Math.floor(left/gridW)*gridW;
top=Math.floor(top/gridH)*gridH;width=Math.ceil(width/gridW)*gridW;height=Math.ceil(height/gridH)*gridH;
}if(objResize.onresize){objResize.onresize(block,top,left,width,height);}objResize.show();
resized=true;};document.onmouseup=function(e){document.onmousemove=null;if(objResize.onresizedone&&resized){objResize.onresizedone(width,height,top,left);
objBlock.other.ratio=width/height;resized=false;}};};};apf.skins={skins:{},css:[],events:["onmousemove","onmousedown","onmouseup","onmouseout","onclick","ondragcopy","ondragstart","ondblclick"],Init:function(xmlNode,refNode,path){var name=(refNode?refNode.getAttribute("id"):null)||xmlNode.getAttribute("id");
var base=(refNode?refNode.getAttribute("src").match(/\//)||path:"")?(path||refNode.getAttribute("src")).replace(/\/[^\/]*$/,"")+"/":"";
var mediaPath=null,iconPath=null;mediaPath=xmlNode.getAttribute("media-path");if(mediaPath!==null){mediaPath=apf.getAbsolutePath(base||apf.hostPath,mediaPath);
}else{if(refNode){mediaPath=refNode.getAttribute("media-path");if(mediaPath!==null){mediaPath=apf.getAbsolutePath(apf.hostPath,mediaPath);
}else{mediaPath=apf.getAbsolutePath(base||apf.hostPath,"images/");}}}iconPath=xmlNode.getAttribute("icon-path");
if(iconPath!==null){iconPath=apf.getAbsolutePath(base||apf.hostPath,iconPath);}else{if(refNode){iconPath=refNode.getAttribute("icon-path");
if(iconPath!==null){iconPath=apf.getAbsolutePath(apf.hostPath,iconPath);}else{iconPath=apf.getAbsolutePath(base||apf.hostPath,"icons/");
}}}if(!name){name="default";}if(xmlNode.getAttribute("id")){document.body.className+=" "+xmlNode.getAttribute("id");
}var names=name.split("|");name=names[0];if(!this.skins[name]||name=="default"){this.skins[name]={base:base,name:name,iconPath:iconPath,mediaPath:mediaPath,templates:{},originals:{},xml:xmlNode};
if(names.length>1){for(var i=0;i<names.length;i++){this.skins[names[i]]=this.skins[name];
}}}if(!this.skins["default"]&&this.$first==refNode){this.skins["default"]=this.skins[name];
}var nodes=xmlNode.childNodes;for(var i=nodes.length-1;i>=0;i--){if(nodes[i].nodeType!=1){continue;
}this.skins[name].templates[nodes[i].getAttribute("name")]=nodes[i];if(nodes[i].ownerDocument){this.importSkinDef(nodes[i],base,name);
}}this.purgeCss(mediaPath,iconPath);if(this.queue[name]){for(var prop in this.queue[name]){this.queue[name][prop]();
}}},loadStylesheet:function(filename,title){var o;with(o=document.getElementsByTagName("head")[0].appendChild(document.createElement("LINK"))){rel="stylesheet";
type="text/css";href=filename;title=title;}return o;},importSkinDef:function(xmlNode,basepath,name){var i,l,nodes=$xmlns(xmlNode,"style",apf.ns.aml),tnode,node;
for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.getAttribute("src")){this.loadStylesheet(apf.getAbsolutePath(basepath,node.getAttribute("src")));
}else{var test=true;if(node.getAttribute("condition")){try{test=eval(node.getAttribute("condition"));
}catch(e){test=false;}}if(test){tnode=node.firstChild;while(tnode){this.css.push(tnode.nodeValue);
tnode=tnode.nextSibling;}}}}nodes=$xmlns(xmlNode,"alias",apf.ns.apf);var t=this.skins[name].templates;
for(i=0;i<nodes.length;i++){if(!nodes[i].firstChild){continue;}t[nodes[i].firstChild.nodeValue.toLowerCase()]=xmlNode;
}},loadedCss:"",purgeCss:function(imagepath,iconpath){if(!this.css.length){return;
}var cssString=this.css.join("\n").replace(/images\//g,imagepath).replace(/icons\//g,iconpath);
apf.importCssString(cssString);this.css=[];},loadCssInWindow:function(skinName,win,imagepath,iconpath){this.css=[];
var name=skinName.split(":");var skin=this.skins[name[0]];var template=skin.templates[name[1]];
this.importSkinDef(template,skin.base,skin.name);var cssString=this.css.join("\n").replace(/images\//g,imagepath).replace(/icons\//g,iconpath);
apf.importCssString(cssString);this.css=[];},setSkinPaths:function(skinName,amlNode){skinName=skinName.split(":");
var name=skinName[0];var type=skinName[1];amlNode.iconPath=this.skins[name].iconPath;
amlNode.mediaPath=this.skins[name].mediaPath;},getTemplate:function(skinName,noError){skinName=skinName.split(":");
var name=skinName[0];var type=skinName[1];if(!this.skins[name]){if(noError){return false;
}return false;}if(!this.skins[name].templates[type]){return false;}var skin=this.skins[name].templates[type];
var originals=this.skins[name].originals[type];if(!originals){originals=this.skins[name].originals[type]={};
var nodes=$xmlns(skin,"presentation",apf.ns.aml)[0].childNodes;for(var i=0;i<nodes.length;
i++){if(nodes[i].nodeType!=1){continue;}originals[nodes[i].baseName||nodes[i][apf.TAGNAME]]=nodes[i];
}}return originals;},getCssString:function(skinName){return apf.queryValue($xmlns(this.skins[skinName.split(":")[0]].xml,"style",apf.ns.aml)[0],"text()");
},changeSkinset:function(value){var node=apf.document.documentElement;while(node){if(node&&node.nodeFunc==apf.NODE_VISIBLE&&node.hasFeature(apf.__PRESENTATION__)&&!node.skinset){node.$propHandlers.skinset.call(node,value);
node.skinset=null;}if(node.firstChild||node.nextSibling){node=node.firstChild||node.nextSibling;
}else{do{node=node.parentNode;}while(node&&!node.nextSibling);if(node){node=node.nextSibling;
}}}},queue:{},waitForSkin:function(skinset,id,callback){if(this.skins[skinset]){return;
}(this.queue[skinset]||(this.queue[skinset]={}))[id]=callback;return true;},setIcon:function(oHtml,strQuery,iconPath){if(!strQuery){oHtml.style.backgroundImage="";
return;}if(oHtml.tagName.toLowerCase()=="img"){oHtml.setAttribute("src",strQuery?(iconPath||"")+strQuery:"");
return;}oHtml.style.backgroundImage="url("+(iconPath||"")+strQuery+")";}};apf.Sort=function(xmlNode){var settings={};
this.parseXml=function(xmlNode,clear){if(clear){settings={};}settings.order=xmlNode.order;
settings.getValue=xmlNode.csort||xmlNode.$compile("sort");settings.getNodes=self[xmlNode["nodes-method"]];
settings.ascending=(settings.order||"").indexOf("desc")==-1;settings.order=null;
if(xmlNode["data-type"]){settings.method=sort_methods[xmlNode["data-type"]];}else{if(xmlNode["sort-method"]){settings.method=self[xmlNode["sort-method"]];
}else{settings.method=sort_methods.alpha;}}var str=xmlNode["date-format"];if(str){settings.sort_dateFmtStr=str;
settings.method=sort_methods.date;var result=str.match(/(D+|Y+|M+|h+|m+|s+)/g);
if(result){for(var pos={},i=0;i<result.length;i++){pos[result[i].substr(0,1)]=i+1;
}settings.dateFormat=new RegExp(str.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));
settings.dateReplace="$"+pos.M+"/$"+pos.D+"/$"+pos.Y;if(pos.h){settings.dateReplace+=" $"+pos.h+":$"+pos.m+":$"+pos.s;
}}}};this.set=function(struct,clear){if(clear){settings={};}apf.extend(settings,struct);
if(settings.ascending==undefined){settings.ascending=struct.order?struct.order.indexOf("desc")==-1:true;
}settings.order=null;if(struct.type){settings.method=sort_methods[struct.type];
}else{if(struct.method){settings.method=self[struct.method];}else{if(!settings.method){settings.method=sort_methods.alpha;
}}}if(struct.format){settings.sort_dateFmtStr=struct.format;var result=str.match(/(D+|Y+|M+|h+|m+|s+)/g);
if(result){for(var pos={},i=0;i<result.length;i++){pos[result[i].substr(0,1)]=i+1;
}settings.dateFormat=new RegExp(str.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));
settings.dateReplace="$"+pos.M+"/$"+pos.D+"/$"+pos.Y;if(pos.h){settings.dateReplace+=" $"+pos.h+":$"+pos.m+":$"+pos.s;
}}}if(!settings.getValue){settings.getValue=function(item){return apf.queryValue(item,settings.xpath);
};}};this.get=function(){return apf.extend({},settings);};this.findSortSibling=function(pNode,xmlNode){var nodes=getNodes?getNodes(pNode,xmlNode):this.getTraverseNodes(pNode);
for(var i=0;i<nodes.length;i++){if(!compare(xmlNode,nodes[i],true,sortSettings)){return nodes[i];
}}return null;};var sort_intmask=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000"];
var sort_methods={alpha:function(n){return n.toString().toLowerCase();},number:function(t){return(t.length<sort_intmask.length?sort_intmask[sort_intmask.length-t.length]:"")+t;
},date:function(t,args){var sort_dateFormat=settings.dateFormat;var sort_dateReplace=settings.dateReplace;
var sort_dateFmtStr=settings.sort_dateFmtStr;var d;if(!sort_dateFormat){d=new Date(t);
}else{if(sort_dateFmtStr=="*"){d=apf.date.getDateTime(t);}else{d=(new Date(t.replace(sort_dateFormat,sort_dateReplace))).getTime();
}}t=""+d.getTime();if(t=="NaN"){t="0";}return(t.length<sort_intmask.length?sort_intmask[sort_intmask.length-t.length]:"")+t;
}};this.apply=function(n,args,func,start,len){var sa=[],i=n.length;while(i--){var v=settings.getValue(n[i]);
if(n){sa[sa.length]={toString:function(){return this.v;},xmlNode:n[i],v:(settings.method||sort_methods.alpha)(v||"",args,n[i])};
}}sa.sort();var end=len?Math.min(sa.length,start+len):sa.length;if(!start){start=0;
}if(func){if(settings.ascending){for(i=start;i<end;i++){f(i,end,sa[i].xmlNode,sa[i].v);
}}else{for(i=end-1;i>=start;i--){f(end-i-1,end,sa[i].xmlNode,sa[i].v);}}}else{var res=[];
if(settings.ascending){for(i=start;i<end;i++){res[res.length]=sa[i].xmlNode;}}else{for(i=end-1;
i>=start;i--){res[res.length]=sa[i].xmlNode;}}return res;}};if(xmlNode){this.parseXml(xmlNode);
}};apf.tween=(function(apf){var modules={left:function(oHtml,value){oHtml.style.left=value+PX;
},right:function(oHtml,value){oHtml.style.left="";oHtml.style.right=value+PX;},top:function(oHtml,value){oHtml.style.top=value+PX;
},bottom:function(oHtml,value){oHtml.style.top="";oHtml.style.bottom=value+PX;},width:function(oHtml,value,center){oHtml.style.width=value+PX;
},height:function(oHtml,value,center){oHtml.style.height=value+PX;},scrollTop:function(oHtml,value,center){oHtml.scrollTop=value;
},scrollLeft:function(oHtml,value,center){oHtml.scrollLeft=value;},"height-rsz":function(oHtml,value,center){oHtml.style.height=value+PX;
if(apf.hasSingleResizeEvent&&apf.layout.$onresize){apf.layout.$onresize();}},mwidth:function(oHtml,value,info){var diff=apf.getDiff(oHtml);
oHtml.style.width=value+PX;oHtml.style.marginLeft=-1*(value/2+(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||diff[0]/2)+(info.margin||0))+PX;
},mheight:function(oHtml,value,info){var diff=apf.getDiff(oHtml);oHtml.style.height=value+PX;
oHtml.style.marginTop=(-1*value/2-(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||diff[1]/2)+(info.margin||0))+PX;
},scrollwidth:function(oHtml,value){oHtml.style.width=value+PX;oHtml.scrollLeft=oHtml.scrollWidth;
},scrollheight_old:function(oHtml,value){try{oHtml.style.height=value+PX;oHtml.scrollTop=oHtml.scrollHeight;
}catch(e){alert(value);}},scrollheight:function(oHtml,value,info){var diff=apf.getHeightDiff(oHtml),oInt=info.$int||oHtml;
oHtml.style.height=Math.max((value+(info.diff||0)),0)+PX;oInt.scrollTop=oInt.scrollHeight-oInt.offsetHeight-diff+(info.diff||0)-(apf.isGecko?16:0);
},scrolltop:function(oHtml,value){oHtml.style.height=value+PX;oHtml.style.top=(-1*value-2)+PX;
oHtml.scrollTop=0;},clipright:function(oHtml,value,center){oHtml.style.clip="rect(auto, auto, auto, "+value+"px)";
oHtml.style.marginLeft=(-1*value)+PX;},fade:function(oHtml,value){if(!apf.supportOpacity&&apf.hasStyleFilters){oHtml.style.filter=value==1?"":"alpha(opacity="+parseInt(value*100)+")";
}else{oHtml.style.opacity=value;}},bgcolor:function(oHtml,value){oHtml.style.backgroundColor=value;
},textcolor:function(oHtml,value){oHtml.style.color=value;},htmlcss:function(oHtml,value,obj){if(apf.hasStyleFilters&&obj.type=="filter"){oHtml.style.filter=value==1?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+value+")";
}else{oHtml.style[obj.type]=value+(obj.needsPx?PX:"");}},transformscale:function(oHtml,value,obj){oHtml.style[obj.type]=SCALEA+parseFloat(value)+SCALEB;
},transformrotate:function(oHtml,value,obj){oHtml.style[obj.type]=ROTATEA+parseFloat(value)+ROTATEB;
},transformvalscale:function(value){return SCALEA+parseFloat(value)+SCALEB;},transformvalrotate:function(value){return ROTATEA+parseFloat(value)+ROTATEB;
}};var ID="id",PX="px",NUM="number",TRANSVAL="transformval",TRANSFORM="transform",SCALE="scale",SCALEA="scale(",ROTATEA="rotate(",SCALEB=")",ROTATEB="deg)",CSSTIMING=["linear","ease-in","ease-out","ease","ease-in-out","cubic-bezier"],CSSPROPS={left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",scrollTop:false,scrollLeft:false,mwidth:false,mheight:false,scrollwidth:false,scrollheight:false,fade:"opacity",opacity:"opacity",bgcolor:"background-color",textcolor:"color",transform:"transform"},__pow=Math.pow,__round=Math.round,queue={},current=null,setQueue=function(oHtml,stepFunction){var id=oHtml.getAttribute(ID);
if(!id){apf.setUniqueHtmlId(oHtml);id=oHtml.getAttribute(ID);}if(!queue[id]){queue[id]=[];
}queue[id].push(stepFunction);if(queue[id].length==1){stepFunction(0);}},nextQueue=function(oHtml){var q=queue[oHtml.getAttribute(ID)];
if(!q){return;}q.shift();if(q.length){q[0](0);}},clearQueue=function(oHtml,bStop){var q=queue[oHtml.getAttribute(ID)];
if(!q){return;}if(bStop&&current&&current.control){current.control.stop=true;}q.length=0;
},purgeQueue=function(oHtml){var id=oHtml.getAttribute(ID);if(!id){apf.setUniqueHtmlId(oHtml);
id=oHtml.getAttribute(ID);}for(var i in queue){if(i==id){queue[i]=[];}}},calcSteps=function(func,fromValue,toValue,nrOfSteps){var i=0,l=nrOfSteps-1,steps=[fromValue];
if(typeof func==NUM){if(!func){func=apf.tween.linear;}else{if(func==1){func=apf.tween.easeInCubic;
}else{if(func==2){func=apf.tween.easeOutCubic;}}}}for(i=0;i<l;++i){steps.push(func(i/nrOfSteps,fromValue,toValue-fromValue));
}steps.push(toValue);return steps;},calcColorSteps=function(animtype,fromValue,toValue,nrOfSteps){var d2,d1,c=apf.color.colorshex,a=parseInt((c[fromValue]||fromValue).slice(1),16),b=parseInt((c[toValue]||toValue).slice(1),16),i=0,out=[];
for(;i<nrOfSteps;i++){d1=i/(nrOfSteps-1),d2=1-d1;out[out.length]="#"+("000000"+((__round((a&255)*d2+(b&255)*d1)&255)|(__round((a&65280)*d2+(b&65280)*d1)&65280)|(__round((a&16711680)*d2+(b&16711680)*d1)&16711680)).toString(16)).slice(-6);
}return out;},single=function(oHtml,info){info=apf.extend({steps:10,interval:5,anim:apf.tween.linear,control:{}},info);
info.steps=Math.ceil(info.steps*apf.animSteps);info.interval=Math.ceil(info.interval*apf.animInterval);
if(oHtml.nodeFunc>100){info.$int=oHtml.$int;oHtml=oHtml.$ext;}try{if("fixed|absolute|relative".indexOf(apf.getStyle(oHtml,"position"))==-1){oHtml.style.position="relative";
}}catch(e){}var useCSSAnim=(apf.supportCSSAnim&&apf.supportCSSTransition&&CSSPROPS[info.type]),isTransform=(info.type==TRANSFORM);
info.method=useCSSAnim?info.type:isTransform?modules[TRANSFORM+(info.subType||SCALE)]:modules[info.type]?modules[info.type]:(info.needsPx=needsPix[info.type]||false)?modules.htmlcss:modules.htmlcss;
if(useCSSAnim){var type=CSSPROPS[info.type];if(type===false){return apf.tween;}info.type=type||info.type;
if(isTransform){if(!info.subType){info.subType=SCALE;}info.type=apf.supportCSSAnim;
}var transform=(isTransform)?modules[TRANSVAL+(info.subType||SCALE)]:null;oHtml.style[info.type]=isTransform?transform(info.from):info.from+(needsPix[info.type]?PX:"");
$setTimeout(function(){oHtml.style[info.type]=isTransform?transform(info.to):info.to+(needsPix[info.type]?PX:"");
oHtml.offsetTop;oHtml.style[apf.cssPrefix+"Transition"]=info.type+" "+((info.steps*info.interval)/1000)+"s "+CSSTIMING[info.anim||0];
var f=function(){if(info.onfinish){info.onfinish(oHtml,info.userdata);}oHtml.style[apf.cssPrefix+"Transition"]="";
oHtml.removeEventListener(apf.cssAnimEvent,f);};oHtml.addEventListener(apf.cssAnimEvent,f);
});return apf.tween;}if(info.control){info.control.state=apf.tween.RUNNING;info.control.stop=function(){info.control.state=apf.tween.STOPPING;
clearQueue(oHtml);if(info.onstop){info.onstop(oHtml,info.userdata);}};}var steps=info.color?calcColorSteps(info.anim,info.from,info.to,info.steps):calcSteps(info.anim,parseFloat(info.from),parseFloat(info.to),info.steps),stepFunction=function(step){if(info.control&&info.control.state){info.control.state=apf.tween.STOPPED;
return;}current=info;if(info.onbeforeeach&&info.onbeforeeach(oHtml,info.userdata)===false){return;
}try{info.method(oHtml,steps[step],info);}catch(e){}if(info.oneach){info.oneach(oHtml,info.userdata);
}if(step<info.steps){return $setTimeout(function(){stepFunction(step+1);},info.interval);
}current=null;if(info.control){info.control.state=apf.tween.STOPPED;}if(info.onfinish){info.onfinish(oHtml,info.userdata);
}nextQueue(oHtml);};if(info.type.indexOf("scroll")>-1){purgeQueue(oHtml);}setQueue(oHtml,stepFunction);
return apf.tween;},multi=function(oHtml,info){info=apf.extend({steps:10,interval:5,anim:apf.tween.linear,control:{}},info);
info.steps=Math.ceil(info.steps*apf.animSteps);info.interval=Math.ceil(info.interval*apf.animInterval);
if(oHtml.nodeFunc>100){info.$int=oHtml.$int;oHtml=oHtml.$ext;}var animCSS,isTransform,useCSSAnim=apf.supportCSSAnim&&apf.supportCSSTransition,hasCSSAnims=false,cssDuration=((info.steps*info.interval)/1000),cssAnim=CSSTIMING[info.anim||0],steps=[],stepsTo=[],i=0,l=info.tweens.length;
for(;i<l;i++){var data=info.tweens[i];if(data.oHtml&&data.oHtml.nodeFunc>100){data.$int=data.oHtml.$int;
data.oHtml=data.oHtml.$ext;}animCSS=(useCSSAnim&&CSSPROPS[data.type]);isTransform=(data.type==TRANSFORM);
if(isTransform){if(!data.subType){data.subType=SCALE;}data.type=apf.supportCSSAnim;
}data.method=animCSS?data.type:isTransform?modules[TRANSFORM+(data.subType)]:modules[data.type]?modules[data.type]:(data.needsPx=needsPix[data.type]||false)?modules.htmlcss:modules.htmlcss;
if(animCSS){var type=isTransform?data.type:CSSPROPS[data.type];data.type=type||data.type;
var transform=modules[TRANSVAL+(data.subType)];oHtml.style[data.type]=isTransform?transform(data.from):data.from+(needsPix[data.type]?PX:"");
stepsTo.push([data.type,isTransform?transform(data.to):data.to+(needsPix[data.type]?PX:"")]);
steps.push(data.type+" "+cssDuration+"s "+cssAnim+" 0");hasCSSAnims=true;}else{steps.push(data.color?calcColorSteps(info.anim,data.from,data.to,info.steps):calcSteps(info.anim,parseFloat(data.from),parseFloat(data.to),info.steps));
}}if(hasCSSAnims){oHtml.style[apf.cssPrefix+"Transition"]=steps.join(",");oHtml.offsetTop;
var count=0,func=function(){count++;if(count==stepsTo.length){if(info.onfinish){info.onfinish(oHtml,info.userdata);
}oHtml.style[apf.cssPrefix+"Transition"]="";oHtml.removeEventListener(apf.cssAnimEvent,func);
}};oHtml.addEventListener(apf.cssAnimEvent,func,false);for(var k=0,j=stepsTo.length;
k<j;k++){oHtml.style[stepsTo[k][0]]=stepsTo[k][1];}return apf.tween;}if(info.control){info.control.state=apf.tween.RUNNING;
info.control.stop=function(){info.control.state=apf.tween.STOPPING;clearQueue(oHtml);
if(info.onstop){info.onstop(oHtml,info.userdata);}};}var tweens=info.tweens,stepFunction=function(step){if(info.control&&info.control.state){info.control.state=apf.tween.STOPPED;
return;}current=info;try{for(var i=0;i<steps.length;i++){tweens[i].method(tweens[i].oHtml||oHtml,steps[i][step],tweens[i]);
}}catch(e){}if(info.oneach){info.oneach(oHtml,info.userdata);}if(step<info.steps){return $setTimeout(function(){stepFunction(step+1);
},info.interval);}current=null;if(info.control){info.control.state=apf.tween.STOPPED;
}if(info.onfinish){info.onfinish(oHtml,info.userdata);}nextQueue(oHtml);};setQueue(oHtml,stepFunction);
return apf.tween;},css=function(oHtml,className,info,remove){(info=info||{}).tweens=[];
if(oHtml.nodeFunc>100){oHtml=oHtml.$ext;}if(remove){apf.setStyleClass(oHtml,"",[className]);
}var resetAnim=function(remove,callback){if(remove){apf.setStyleClass(oHtml,"",[className]);
}else{apf.setStyleClass(oHtml,className);}for(var i=0;i<info.tweens.length;i++){if(info.tweens[i].type=="filter"){continue;
}oHtml.style[info.tweens[i].type]="";}if(callback){callback.apply(this,arguments);
}};var onfinish=info.onfinish,onstop=info.onstop;info.onfinish=function(){resetAnim(remove,onfinish);
};info.onstop=function(){resetAnim(!remove,onstop);};var result,newvalue,curvalue,j,isColor,style,rules,i,tweens={};
for(i=0;i<document.styleSheets.length;i++){rules=document.styleSheets[i][apf.styleSheetRules];
for(j=rules.length-1;j>=0;j--){var rule=rules[j];if(!rule.style||!rule.selectorText.match("."+className+"$")){continue;
}for(style in rule.style){if(!rule.style[style]||cssProps.indexOf("|"+style+"|")==-1){continue;
}if(style=="filter"){if(!rule.style[style].match(/opacity\=([\d\.]+)/)){continue;
}newvalue=RegExp.$1;result=(apf.getStyleRecur(oHtml,style)||"").match(/opacity\=([\d\.]+)/);
curvalue=result?RegExp.$1:100;isColor=false;if(newvalue==curvalue){if(remove){curvalue=100;
}else{newvalue=100;}}}else{newvalue=remove&&oHtml.style[style]||rule.style[style];
if(remove){oHtml.style[style]="";}curvalue=apf.getStyleRecur(oHtml,style);isColor=style.match(/color/i)?true:false;
}tweens[style]={type:style,from:(isColor?String:parseFloat)(remove?newvalue:curvalue),to:(isColor?String:parseFloat)(remove?curvalue:newvalue),color:isColor,needsPx:needsPix[style.toLowerCase()]||false};
}}}for(var prop in tweens){info.tweens.push(tweens[prop]);}if(remove){apf.setStyleClass(oHtml,className);
}return multi(oHtml,info);},cssRemove=function(oHtml,className,info){css(oHtml,className,info,true);
},needsPix={left:true,top:true,bottom:true,right:true,width:true,height:true,fontSize:true,lineHeight:true,textIndent:true,marginLeft:true,marginTop:true,marginRight:true,marginBottom:true},cssProps="|backgroundColor|backgroundPosition|color|width|filter|height|left|top|bottom|right|fontSize|letterSpacing|lineHeight|textIndent|opacity|paddingLeft|paddingTop|paddingRight|paddingBottom|borderLeftWidth|borderTopWidth|borderRightWidth|borderBottomWidth|borderLeftColor|borderTopColor|borderRightColor|borderBottomColor|marginLeft|marginTop|marginRight|marginBottom|transform|",cssTransforms="|scale|rotate|";
return{single:single,multi:multi,css:css,cssRemove:cssRemove,clearQueue:clearQueue,addModule:function(name,func,force){if(typeof name!="string"||typeof func!="function"||(modules[name]&&!force)){return this;
}modules[name]=func;return this;},NORMAL:0,EASEIN:1,EASEOUT:2,RUNNING:0,STOPPING:1,STOPPED:2,calcColorSteps:calcColorSteps,linear:function(t,x_min,dx){return dx*t+x_min;
},easeInQuad:function(t,x_min,dx){return dx*__pow(t,2)+x_min;},easeOutQuad:function(t,x_min,dx){return -dx*t*(t-2)+x_min;
},easeInOutQuad:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*t*t+x_min;}return -dx/2*((--t)*(t-2)-1)+x_min;
},easeInCubic:function(t,x_min,dx){return dx*__pow(t,3)+x_min;},easeOutCubic:function(t,x_min,dx){return dx*(__pow(t-1,3)+1)+x_min;
},easeInOutCubic:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*__pow(t,3)+x_min;
}return dx/2*(__pow(t-2,3)+2)+x_min;},easeInQuart:function(t,x_min,dx){return dx*__pow(t,4)+x_min;
},easeOutQuart:function(t,x_min,dx){return -dx*(__pow(t-1,4)-1)+x_min;},easeInOutQuart:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*__pow(t,4)+x_min;
}return -dx/2*(__pow(t-2,4)-2)+x_min;},easeInQuint:function(t,x_min,dx){return dx*__pow(t,5)+x_min;
},easeOutQuint:function(t,x_min,dx){return dx*(__pow(t-1,5)+1)+x_min;},easeInOutQuint:function(t,x_min,dx){if((t/=0.5)<1){return dx/2*__pow(t,5)+x_min;
}return dx/2*(__pow(t-2,5)+2)+x_min;},easeInSine:function(t,x_min,dx){return -dx*Math.cos(t*(Math.PI/2))+dx+x_min;
},easeOutSine:function(t,x_min,dx){return dx*Math.sin(t*(Math.PI/2))+x_min;},easeInOutSine:function(t,x_min,dx){return -dx/2*(Math.cos(Math.PI*t)-1)+x_min;
},easeInExpo:function(t,x_min,dx){return(t==0)?x_min:dx*__pow(2,10*(t-1))+x_min;
},easeOutExpo:function(t,x_min,dx){return(t==1)?x_min+dx:dx*(-__pow(2,-10*t)+1)+x_min;
},easeInOutExpo:function(t,x_min,dx){if(t==0){return x_min;}if(t==1){return x_min+dx;
}if((t/=0.5)<1){return dx/2*__pow(2,10*(t-1))+x_min;}return dx/2*(-__pow(2,-10*--t)+2)+x_min;
},easeInCirc:function(t,x_min,dx){return -dx*(Math.sqrt(1-t*t)-1)+x_min;},easeOutCirc:function(t,x_min,dx){return dx*Math.sqrt(1-(t-=1)*t)+x_min;
},easeInOutCirc:function(t,x_min,dx){if((t/=0.5)<1){return -dx/2*(Math.sqrt(1-t*t)-1)+x_min;
}return dx/2*(Math.sqrt(1-(t-=2)*t)+1)+x_min;},easeInElastic:function(t,x_min,dx){var s=1.70158,p=0.3,a=dx;
if(t==0){return x_min;}if(t==1){return x_min+dx;}if(!a||a<Math.abs(dx)){a=dx;s=p/4;
}else{s=p/(2*Math.PI)*Math.asin(dx/a);}return -(a*__pow(2,10*(t-=1))*Math.sin((t*1-s)*(2*Math.PI)/p))+x_min;
},easeOutElastic:function(t,x_min,dx){var s=1.70158,p=0.3,a=dx;if(t==0){return x_min;
}if(t==1){return x_min+dx;}if(a<Math.abs(dx)){a=dx;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(dx/a);
}return a*__pow(2,-10*t)*Math.sin((t-s)*(2*Math.PI)/p)+dx+x_min;},easeInOutElastic:function(t,x_min,dx){var s=1.70158,p=0,a=dx;
if(t==0){return x_min;}if((t/2)==2){return x_min+dx;}if(!p){p=0.3*1.5;}if(a<Math.abs(dx)){a=dx;
s=p/4;}else{s=p/(2*Math.PI)*Math.asin(dx/a);}if(t<1){return -0.5*(a*__pow(2,10*(t-=1))*Math.sin((t-s)*(2*Math.PI)/p))+x_min;
}return a*__pow(2,-10*(t-=1))*Math.sin((t-s)*(2*Math.PI)/p)*0.5+dx+x_min;},easeInBack:function(t,x_min,dx){var s=1.70158;
return dx*__pow(t,2)*((s+1)*t-s)+x_min;},easeOutBack:function(t,x_min,dx){var s=1.70158;
return dx*((t-=1)*t*((s+1)*t+s)+1)+x_min;},easeInOutBack:function(t,x_min,dx){var s=1.70158;
if((t/2)<1){return dx/2*(t*t*(((s*=(1.525))+1)*t-s))+x_min;}return dx/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+x_min;
},easeInBounce:function(t,x_min,dx){return dx-apf.tween.easeOutBounce(1-t,0,dx)+x_min;
},easeOutBounce:function(t,x_min,dx){if(t<(1/2.75)){return dx*(7.5625*t*t)+x_min;
}else{if(t<(2/2.75)){return dx*(7.5625*(t-=(1.5/2.75))*t+0.75)+x_min;}else{if(t<(2.5/2.75)){return dx*(7.5625*(t-=(2.25/2.75))*t+0.9375)+x_min;
}else{return dx*(7.5625*(t-=(2.625/2.75))*t+0.984375)+x_min;}}}},easeInOutBounce:function(t,x_min,dx){if(t<1/2){return apf.tween.easeInBounce(t*2,0,dx)*0.5+x_min;
}return apf.tween.easeOutBounce(t*2-1,0,dx)*0.5+dx*0.5+x_min;}};})(apf);apf.xmldb=new (function(){this.xmlDocTag="a_doc";
this.xmlIdTag="a_id";this.xmlListenTag="a_listen";this.htmlIdTag="id";this.disableRDB=false;
this.$xmlDocLut=[];this.$nodeCount={};var cleanRE=/(?:a_doc|a_id|a_listen|a_loaded)=(?:"|')[^'"]+(?:"|')/g,whiteRE=/>[\s\n\r\t]+</g;
this.getElementById=function(id,doc){if(!doc){doc=this.$xmlDocLut[id.split("|")[0]];
}if(!doc){return false;}return doc.selectSingleNode("descendant-or-self::node()[@"+this.xmlIdTag+"='"+id+"']");
};this.getNode=function(htmlNode){if(!htmlNode||!htmlNode.getAttribute(this.htmlIdTag)){return false;
}return this.getElementById(htmlNode.getAttribute(this.htmlIdTag).split("|",2).join("|"));
};this.getNodeById=function(id,doc){var q=id.split("|");q.pop();return this.getElementById(q.join("|"),doc);
};this.getDocumentById=function(id){return this.$xmlDocLut[id];};this.getDocument=function(node){return this.$xmlDocLut[node.getAttribute(this.xmlIdTag).split("|")[0]];
};this.getID=function(xmlNode,o){return xmlNode.getAttribute(this.xmlIdTag)+"|"+o.$uniqueId;
};this.getElement=function(parent,nr){var nodes=parent.childNodes;for(var j=0,i=0;
i<nodes.length;i++){if(nodes[i].nodeType!=1){continue;}if(j++==nr){return nodes[i];
}}};this.setModel=function(model){apf.nameserver.register("model",model.data.ownerDocument.documentElement.getAttribute(this.xmlDocTag),model);
};this.findModel=function(xmlNode){return apf.nameserver.get("model",xmlNode.ownerDocument.documentElement.getAttribute(this.xmlDocTag));
};this.getXmlId=function(xmlNode){return xmlNode.getAttribute(this.xmlIdTag)||this.nodeConnect(apf.xmldb.getXmlDocId(xmlNode),xmlNode);
};this.getHtmlNode=function(xmlNode,oComp){if(xmlNode&&xmlNode.nodeType==1&&xmlNode.getAttribute(this.xmlIdTag)){return oComp.$findHtmlNode(xmlNode.getAttribute(this.xmlIdTag)+"|"+oComp.$uniqueId);
}return null;};this.findHtmlNode=function(xmlNode,oComp){do{if(xmlNode.nodeType==1&&xmlNode.getAttribute(this.xmlIdTag)){return oComp.$findHtmlNode(xmlNode.getAttribute(this.xmlIdTag)+"|"+oComp.$uniqueId);
}if(xmlNode==oComp.xmlRoot){return null;}xmlNode=xmlNode.parentNode;}while(xmlNode&&xmlNode.nodeType!=9);
return null;};this.findXmlNode=function(htmlNode){if(!htmlNode){return false;}var id;
while(htmlNode&&htmlNode.nodeType==1&&(htmlNode.tagName.toLowerCase()!="body"&&!(id=htmlNode.getAttribute(this.htmlIdTag))||(id||(id=htmlNode.getAttribute(this.htmlIdTag)))&&id.match(/^q/))){if(htmlNode.host&&htmlNode.host.$ext==htmlNode){return htmlNode.host.xmlRoot;
}htmlNode=htmlNode.parentNode;}if(!htmlNode||htmlNode.nodeType!=1){return false;
}if(htmlNode.tagName.toLowerCase()=="body"){return false;}return this.getNode(htmlNode);
};this.getXml=apf.getXml;this.nodeConnect=function(documentId,xmlNode,htmlNode,o){if(!this.$nodeCount[documentId]){this.$nodeCount[documentId]=0;
}var xmlId;xmlId=xmlNode.getAttribute(this.xmlIdTag)||xmlNode.setAttribute(this.xmlIdTag,(xmlId=documentId+"|"+ ++this.$nodeCount[documentId]))||xmlId;
if(!o){return xmlId;}var htmlId=xmlId+"|"+o.$uniqueId;if(htmlNode){htmlNode.setAttribute(this.htmlIdTag,htmlId);
}return htmlId;};this.$listeners=[null];this.addNodeListener=function(xmlNode,o,uId){var id,listen=String(xmlNode.getAttribute(this.xmlListenTag)||"");
if(!uId){uId=String(o.$uniqueId);}if(uId.charAt(0)=="p"){var sUId=uId.split("|");
id=this.$listeners.push(function(args){var amlNode=apf.all[sUId[1]];if(amlNode){var model=apf.all[sUId[3]];
if(!model){return;}var xpath=model.$propBinds[sUId[1]][sUId[2]].listen;var node=xpath?apf.queryNode(model.data,xpath):xmlNode;
if(node){amlNode.$execProperty(sUId[2],node,args[3]);}}})-1;this.$listeners[uId]=id;
}else{id="e"+uId;if(!this.$listeners[id]){this.$listeners[id]=function(args){var amlNode=apf.all[uId];
if(amlNode){amlNode.$xmlUpdate.apply(amlNode,args);}};}if(xmlNode.$regbase){var lut={DOMCharacterDataModified:"text",DOMAttrModified:"attribute",DOMNodeInserted:"add",DOMNodeRemoved:"remove"};
var rFn=this.$listeners[id].rFn||(this.$listeners[id].rFn=function(e){var node=e.relatedNode&&e.relatedNode.nodeType!=1?e.relatedNode:e.currentTarget;
if(node.nodeName&&node.nodeName.substr(0,2)=="a_"){return;}var action=lut[e.name];
if(node.nodeType!=1){action=node.nodeType==2?"attribute":"text";node=node.parentNode||node.ownerElement;
}apf.xmldb.$listeners[id]([action,node,this,null,node.parentNode]);});xmlNode.addEventListener("DOMCharacterDataModified",rFn);
xmlNode.addEventListener("DOMAttrModified",rFn);xmlNode.addEventListener("DOMNodeInserted",rFn);
xmlNode.addEventListener("DOMNodeRemoved",rFn);return;}}if(!listen||listen.indexOf(";"+id+";")==-1){xmlNode.setAttribute(this.xmlListenTag,(listen?listen+id:";"+id)+";");
}return xmlNode;};this.removeNodeListener=function(xmlNode,o,id){var listen=xmlNode.getAttribute(this.xmlListenTag);
var nodes=(listen?listen.split(";"):[]);if(id&&id.charAt(0)=="p"){id=this.$listeners[id];
delete this.$listeners[id];}else{id="e"+o.$uniqueId;if(xmlNode.$regbase){var rFn=this.$listeners[id].rFn;
xmlNode.removeEventListener("DOMCharacterDataModified",rFn);xmlNode.removeEventListener("DOMAttrModified",rFn);
xmlNode.removeEventListener("DOMNodeInserted",rFn);xmlNode.removeEventListener("DOMNodeRemoved",rFn);
}}for(var newnodes=[],i=0;i<nodes.length;i++){if(nodes[i]!=id){newnodes.push(nodes[i]);
}}xmlNode.setAttribute(this.xmlListenTag,newnodes.join(";"));return xmlNode;};this.setTextNode=apf.setTextNode=function(pNode,value,xpath,undoObj,range){var tNode;
if(xpath){tNode=pNode.selectSingleNode(xpath);if(!tNode){return;}pNode=tNode.nodeType==1?tNode:null;
}if(pNode.nodeType!=1){tNode=pNode;}else{if(pNode||!tNode){tNode=pNode.selectSingleNode("text()");
if(!tNode){tNode=pNode.appendChild(pNode.ownerDocument.createTextNode(""));}}}if(undoObj&&!undoObj.$filled){undoObj.extra.oldValue=tNode.nodeValue;
undoObj.$filled=true;}if(range){undoObj.extra.range=range;}else{tNode.nodeValue=value;
if(tNode.$regbase){tNode.$setValue(value);}}this.applyChanges("text",tNode.parentNode,undoObj);
};this.setAttribute=apf.setAttribute=function(xmlNode,name,value,xpath,undoObj,range){if(undoObj&&!undoObj.$filled){undoObj.name=name;
undoObj.$filled=true;}if(range){undoObj.extra.range=range;}else{(xpath?xmlNode.selectSingleNode(xpath):xmlNode).setAttribute(name,value);
}this.applyChanges("attribute",xmlNode,undoObj);};this.removeAttribute=apf.removeAttribute=function(xmlNode,name,xpath,undoObj){if(undoObj&&!undoObj.$filled){undoObj.name=name;
undoObj.$filled=true;}(xpath?xmlNode.selectSingleNode(xpath):xmlNode).removeAttribute(name);
this.applyChanges("attribute",xmlNode,undoObj);};this.replaceNode=apf.replaceNode=function(newNode,oldNode,xpath,undoObj){if(xpath){oldNode=oldNode.selectSingleNode(xpath);
}if(oldNode.ownerDocument.importNode&&newNode.ownerDocument!=oldNode.ownerDocument){newNode=oldNode.ownerDocument.importNode(newNode,true);
}if(undoObj&&!undoObj.$filled){undoObj.$filled=true;undoObj.oldNode=oldNode;undoObj.xmlNode=newNode;
}this.cleanNode(newNode);var parentNode=oldNode.parentNode;if(!parentNode){return;
}parentNode.replaceChild(newNode,oldNode);this.copyConnections(oldNode,newNode);
this.applyChanges("replacenode",newNode,undoObj);return newNode;};this.addChildNode=apf.addChildNode=function(pNode,tagName,attr,beforeNode,undoObj){var xmlNode=pNode.insertBefore(pNode.ownerDocument.createElement(tagName),beforeNode);
for(var i=0;i<attr.length;i++){xmlNode.setAttribute(attr[i][0],attr[i][1]);}if(undoObj&&!undoObj.$filled){undoObj.extra.addedNode=xmlNode;
undoObj.$filled=true;}this.applyChanges("add",xmlNode,undoObj);return xmlNode;};
this.appendChild=apf.appendChild=function(pNode,xmlNode,beforeNode,unique,xpath,undoObj){if(pNode==xmlNode.parentNode){return apf.xmldb.moveNode(pNode,xmlNode,beforeNode,null,xpath,undoObj);
}if(unique&&pNode.selectSingleNode(xmlNode.tagName)){return false;}if(undoObj&&!undoObj.$filled){undoObj.$filled=true;
this.cleanNode(xmlNode);}else{this.cleanNode(xmlNode);}if(pNode.ownerDocument.importNode&&pNode.ownerDocument!=xmlNode.ownerDocument){xmlNode=pNode.ownerDocument.importNode(xmlNode,true);
}if(xpath){var addedNodes=[];pNode=apf.createNodeFromXpath(pNode,xpath,addedNodes);
if(addedNodes.length){pNode.appendChild(xmlNode);while(addedNodes.length){if(pNode==addedNodes.pop()&&addedNodes.length){pNode=pNode.parentNode;
}}}}else{if(xmlNode.parentNode){this.removeNode(xmlNode);}}pNode.insertBefore(xmlNode,beforeNode);
this.applyChanges("add",xmlNode,undoObj);return xmlNode;};this.moveNode=apf.moveNode=function(pNode,xmlNode,beforeNode,xpath,undoObj){if(!undoObj){undoObj={extra:{}};
}undoObj.extra.oldParent=xmlNode.parentNode;undoObj.extra.beforeNode=xmlNode.nextSibling;
undoObj.extra.parent=(xpath?pNode.selectSingleNode(xpath):pNode);this.applyChanges("move-away",xmlNode,undoObj);
if(pNode.ownerDocument.importNode&&pNode.ownerDocument!=xmlNode.ownerDocument){xmlNode=pNode.ownerDocument.importNode(xmlNode,true);
}undoObj.extra.parent.insertBefore(xmlNode,beforeNode);this.applyChanges("move",xmlNode,undoObj);
};this.removeNode=apf.removeNode=function(xmlNode,xpath,undoObj){if(xpath){xmlNode=xmlNode.selectSingleNode(xpath);
}if(undoObj&&!undoObj.$filled){undoObj.$filled=true;undoObj.extra.parent=xmlNode.parentNode;
undoObj.extra.removedNode=xmlNode;undoObj.extra.beforeNode=xmlNode.nextSibling;
}this.applyChanges("remove",xmlNode,undoObj);var p=xmlNode.parentNode;if(!p){return;
}p.removeChild(xmlNode);this.applyChanges("redo-remove",xmlNode,null,p);};this.removeNodeList=apf.removeNodeList=function(xmlNodeList,undoObj){for(var rData=[],i=0;
i<xmlNodeList.length;i++){if(undoObj){rData.push({pNode:xmlNodeList[i].parentNode,removedNode:xmlNodeList[i],beforeNode:xmlNodeList[i].nextSibling});
}this.applyChanges("remove",xmlNodeList[i],undoObj);var p=xmlNodeList[i].parentNode;
p.removeChild(xmlNodeList[i]);this.applyChanges("redo-remove",xmlNodeList[i],null,p);
}if(undoObj&&!undoObj.$filled){undoObj.$filled=true;undoObj.extra.removeList=rData;
}};var notifyQueue={},notifyTimer;this.$hasQueue=false;this.applyChanges=function(action,xmlNode,undoObj,nextloop){if(undoObj&&undoObj.$dontapply){return;
}if(undoObj&&!undoObj.xmlNode){undoObj.xmlNode=xmlNode;}var oParent=nextloop,loopNode=(xmlNode.nodeType==1?xmlNode:xmlNode.parentNode);
if(!this.delayUpdate&&"|remove|move-away|".indexOf("|"+action+"|")>-1){this.notifyQueued();
}var listen,uId,uIds,i,j,hash,info,amlNode,runTimer,found,done={};while(loopNode&&loopNode.nodeType==1){listen=loopNode.getAttribute(this.xmlListenTag);
if(listen){uIds=listen.split(";");for(i=0;i<uIds.length;i++){uId=uIds[i];if(!uId||done[uId]){continue;
}done[uId]=true;hash=notifyQueue[uId];if(!hash){notifyQueue[uId]=hash=[];}if(!apf.isO3&&"|update|attribute|text|".indexOf("|"+action+"|")>-1){found=false;
for(j=0;j<hash.length;j++){if(hash[j]&&xmlNode==hash[j][1]&&"|update|attribute|text|".indexOf("|"+hash[j][0]+"|")>-1){hash[j]=null;
found=true;continue;}}hash.push([action,xmlNode,loopNode,undoObj,oParent]);runTimer=true;
continue;}if(apf.isO3||"|remove|move-away|move|add|".indexOf("|"+action+"|")>-1){if(this.$listeners[uId]){this.$listeners[uId]([action,xmlNode,loopNode,undoObj,oParent]);
}}else{hash.push([action,xmlNode,loopNode,undoObj,oParent]);runTimer=true;}}}loopNode=loopNode.parentNode||nextloop;
if(loopNode==nextloop){nextloop=null;}}if(undoObj&&!this.delayUpdate){apf.xmldb.notifyQueued();
}else{if(runTimer){clearTimeout(notifyTimer);this.$hasQueue=true;notifyTimer=apf.setZeroTimeout(function(){apf.xmldb.notifyQueued();
});}}};this.notifyQueued=function(){this.$hasQueue=false;var myQueue=notifyQueue;
notifyQueue={};clearTimeout(notifyTimer);for(var uId in myQueue){if(!uId){continue;
}var q=myQueue[uId];var func=this.$listeners[uId];if(!q||!func){continue;}for(var i=0;
i<q.length;i++){if(!q[i]){continue;}func(q[i]);}}};this.notifyListeners=function(xmlNode){var listen=xmlNode.getAttribute(apf.xmldb.xmlListenTag);
if(listen){listen=listen.split(";");for(var j=0;j<listen.length;j++){apf.all[listen[j]].$xmlUpdate("synchronize",xmlNode,xmlNode);
}}};this.copyConnections=function(fromNode,toNode){try{toNode.setAttribute(this.xmlListenTag,fromNode.getAttribute(this.xmlListenTag));
}catch(e){}try{toNode.setAttribute(this.xmlIdTag,fromNode.getAttribute(this.xmlIdTag));
}catch(e){}};this.cleanXml=function(xml){if(typeof xml!="string"){return xml;}return xml.replace(cleanRE,"").replace(whiteRE,"><");
};this.cleanNode=function(xmlNode){try{var i,nodes=xmlNode.selectNodes("descendant-or-self::node()[@"+this.xmlListenTag+"]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute(this.xmlListenTag);}nodes=xmlNode.selectNodes("descendant-or-self::node()[@"+this.xmlIdTag+"]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute(this.xmlIdTag);}nodes=xmlNode.selectNodes("descendant-or-self::node()[@"+this.xmlDocTag+"]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute(this.xmlDocTag);}nodes=xmlNode.selectNodes("descendant-or-self::node()[@a_loaded]");
for(i=nodes.length-1;i>=0;i--){nodes[i].removeAttribute("a_loaded");}}catch(e){}return xmlNode;
};this.copy=this.getCleanCopy=apf.getCleanCopy=function(xmlNode){return apf.xmldb.cleanNode(xmlNode.cloneNode(true));
};this.unbind=function(frm){for(var lookup={},i=0;i<frm.apf.all.length;i++){if(frm.apf.all[i]&&frm.apf.all[i].unloadBindings){lookup[frm.apf.all[i].unloadBindings()]=true;
}}for(var k=0;k<this.$xmlDocLut.length;k++){if(!this.$xmlDocLut[k]){continue;}var Nodes=this.$xmlDocLut[k].selectNodes("//self::node()[@"+this.xmlListenTag+"]");
if(!Nodes){continue;}for(var i=0;i<Nodes.length;i++){var listen=Nodes[i].getAttribute(this.xmlListenTag).split(";");
for(var nListen=[],j=0;j<listen.length;j++){if(!lookup[listen[j]]){nListen.push(listen[j]);
}}if(nListen.length!=listen.length){Nodes[i].setAttribute(this.xmlListenTag,nListen.join(";"));
}}}};this.getXmlDocId=function(xmlNode,model){var docEl=xmlNode.ownerDocument.documentElement;
if(!apf.isChildOf(docEl,xmlNode)){docEl=xmlNode;}var docId=(docEl||xmlNode).getAttribute(this.xmlDocTag)||this.$xmlDocLut.indexOf(docEl||xmlNode.ownerDocument||xmlNode);
if(model&&apf.nameserver.get("model",docId)!=model){docId=null;docEl=xmlNode;}if(!docId||docId==-1){docId=this.$xmlDocLut.push(docEl||xmlNode.ownerDocument||xmlNode)-1;
if(docEl){docEl.setAttribute(this.xmlDocTag,String(docId));}}if(model){apf.nameserver.register("model",docId,model);
}return docId;};});apf.http=function(){this.queue=[null];this.callbacks={};this.cache={};
this.timeout=this.timeout||10000;this.autoroute=this.autoroute||false;this["route-server"]=this["route-server"]||null;
if(!this.$uniqueId){this.$uniqueId=apf.all.push(this)-1;}this.toString=this.toString||function(){return"[Ajax.org Teleport Component : (HTTP)]";
};this.getXml=function(url,callback,options){if(!options){options={};}options.useXML=true;
options.callback=callback;return this.get(url,options);};this.getJSON=function(url,callback,options){if(!options){options={};
}options.callback=callback;options.useJSON=true;return this.get(url,options);};
this.get=this.$get=function(url,options){if(!options){options={};}var _self=this;
var id=options.id;var binary=apf.hasXhrBinary&&options.binary;var async=options.async=(options.async||binary||typeof options.async=="undefined"||apf.isOpera||false);
if(apf.isWebkit){url=apf.html_entity_decode(url);}var data=options.data||"";if(apf.isNot(id)){var http=apf.getHttpReq();
id=this.queue.push({http:http,url:url,callback:options.callback,retries:0,options:options})-1;
}else{var http=this.queue[id].http;http.abort();}if(async){http.onreadystatechange=function(){if(!_self.queue[id]||http.readyState!=4){return;
}if(async&&arguments.callee.caller){setTimeout(function(){_self.receive(id);});
}else{_self.receive(id);}};}var autoroute=this.autoroute&&apf.isOpera?true:(options.autoroute||this.shouldAutoroute),httpUrl=autoroute?this["route-server"]:url;
var headers=[];function setRequestHeader(name,value){http.setRequestHeader(name,value);
}var errorFound=false;try{if(options.nocache){httpUrl=apf.getNoCacheUrl(httpUrl);
}if(apf.config.queryAppend){httpUrl+=(httpUrl.indexOf("?")==-1?"?":"&")+apf.config.queryAppend;
}if(apf.hasHtml5XDomain&&httpUrl.match(/^http:\/\//)&&!new apf.url(httpUrl).isSameLocation()){throw new Error(apf.formatErrorString(0,this,"Communication error","Url: "+httpUrl+"\nReason: Same origin policy in effect"));
}http.open(this.method||options.method||"GET",httpUrl,async);if(options.username){setRequestHeader("Authorization","Basic "+apf.crypto.Base64.encode(options.username+":"+options.password));
}setRequestHeader("X-Requested-With","XMLHttpRequest");if(!options.headers||!options.headers["Content-type"]){setRequestHeader("Content-type",options.contentType||this.contentType||(this.useXML||options.useXML?"text/xml":"text/plain"));
}if(autoroute){setRequestHeader("X-Route-Request",url);setRequestHeader("X-Proxy-Request",url);
setRequestHeader("X-Compress-Response","gzip");}if(binary){setRequestHeader("Cache-Control","no-cache");
setRequestHeader("X-File-Name",binary.filename);setRequestHeader("X-File-Size",binary.filesize);
setRequestHeader("Content-Type","application/octet-stream");}}catch(e){errorFound=e.message;
}if(errorFound){var useOtherXH=false;if(!useOtherXH&&this.autoroute&&!autoroute){this.shouldAutoroute=true;
options.autoroute=true;return this.get(url,options);}if(!useOtherXH){var noClear=options.callback?options.callback(null,apf.ERROR,{userdata:options.userdata,http:http,url:url,tpModule:this,id:id,message:"Permission denied accessing remote resource: "+url+"\nMessage: "+errorFound}):false;
if(!noClear){this.clearQueueItem(id);}return;}}if(this.$headerHook){this.$headerHook(http);
}if(options.headers){for(var name in options.headers){setRequestHeader(name,options.headers[name]);
}}function handleError(){var msg=self.navigator&&self.navigator.onLine?"File or Resource not available "+url:"Browser is currently working offline";
var state=self.navigator&&navigator.onLine?apf.ERROR:apf.TIMEOUT;var noClear=options.callback?options.callback(null,state,{userdata:options.userdata,http:http,url:url,tpModule:_self,id:id,message:msg}):false;
if(!noClear){_self.clearQueueItem(id);}}function send(isLocal){var hasError;if(apf.isIE&&isLocal){var oldWinOnerror=window.onerror;
window.onerror=function(){if(arguments.caller&&arguments.caller.callee==send){window.onerror=oldWinOnerror;
return true;}else{window.onerror=oldWinOnerror;if(oldWinOnerror){return oldWinOnerror.apply(window,arguments);
}}};http.send(data);window.onerror=oldWinOnerror;}else{try{if(binary&&http.sendAsBinary){binary.blob=getBinaryBlob(data,http,binary);
http.sendAsBinary(binary.blob.data);}else{http.send(data);}}catch(e){hasError=true;
}}if(hasError){handleError();return;}else{if(binary&&http.upload){http.upload.onprogress=function(e){apf.dispatchEvent("http.uploadprogress",{loaded:e.loaded-binary.blob.size,extra:e,bubbles:true});
};}}}if(!async){send.call(this);return this.receive(id);}else{if(apf.loadsLocalFilesSync&&location.protocol=="file:"&&url.indexOf("http://")==-1){$setTimeout(function(){send.call(_self,true);
});}else{send.call(_self);}return id;}};if(!this.exec){this.exec=function(method,args,callback,options){if(!options){options={};
}var url=args[0],query="";if(!options.method){options.method=method.toUpperCase();
}if(!options.callback){options.callback=callback;}this.contentType="application/x-www-form-urlencoded";
this.$get(apf.getAbsolutePath(apf.config.baseurl,url),options.method=="GET"?options:apf.extend({data:query},options));
};}function getBinaryBlob(data,http,binary){var boundary="----apfbound".appendRandomNumber(5),dashdash="--",crlf="\r\n",multipartBlob="",multipartSize=0;
if(binary.multipart){http.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary);
multipartBlob+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+(binary.filedataname||binary.filename)+'"; filename="'+binary.filename+'"'+crlf+"Content-Type: application/octet-stream"+crlf+crlf+data+crlf+dashdash+boundary+dashdash+crlf;
multipartSize=multipartBlob.length-data.length;data=multipartBlob;}return{size:multipartSize,data:data};
}this.receive=function(id){if(!this.queue[id]){return false;}var qItem=this.queue[id],http=qItem.http,callback=qItem.callback;
if(self.navigator&&navigator.onLine===false&&(location.protocol!="file:"||qItem.url.indexOf("http://")>-1)){return false;
}if(qItem.async){try{if(http.status){}}catch(e){var _self=this;return $setTimeout(function(){_self.receive(id);
},10);}}var errorMessage=[],extra={tpModule:this,http:http,status:http.status,url:qItem.url,callback:callback,id:id,retries:qItem.retries||0,userdata:qItem.options.userdata};
if(http.status>600){return this.$timeout(id);}extra.data=qItem.options.useJSON?eval("("+http.responseText+")"):http.responseText;
if(http.status>=400&&http.status<600||http.status<10&&(http.status!=0||!apf.isIE&&!http.responseText)){if(http.status==401){var auth=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(auth){var wasDelayed=qItem.isAuthDelayed;qItem.isAuthDelayed=true;if(auth.authRequired(extra,wasDelayed)===true){return;
}}}errorMessage.push("HTTP error ["+id+"]:"+http.status+"\n"+http.responseText);
}if(qItem.options.useXML||this.useXML){if((http.responseText||"").replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){errorMessage.push("Received an empty XML document (0 bytes)");
}else{try{var xmlDoc=(http.responseXML&&http.responseXML.documentElement)?apf.xmlParseError(http.responseXML):apf.getXmlDom(http.responseText);
if(!apf.supportNamespaces){xmlDoc.setProperty("SelectionLanguage","XPath");}extra.data=xmlDoc.documentElement;
}catch(e){errorMessage.push("Received invalid XML\n\n"+e.message);}}}if(errorMessage.length){extra.message=errorMessage.join("\n");
if(!callback||!callback(extra.data,apf.ERROR,extra)){this.clearQueueItem(id);}return;
}if(!callback||!callback(extra.data,apf.SUCCESS,extra)){this.clearQueueItem(id);
}return extra.data;};this.$timeout=function(id){if(!this.queue[id]){return false;
}var qItem=this.queue[id],http=qItem.http;try{if(http.status){}}catch(e){var _self=this;
return $setTimeout(function(){_self.$timeout(id);},10);}var callback=qItem.callback;
http.abort();var extra;var noClear=callback?callback(null,apf.TIMEOUT,extra={userdata:qItem.options.userdata,http:http,url:qItem.url,tpModule:this,id:id,message:"HTTP Call timed out",retries:qItem.retries||0}):false;
if(!noClear){this.clearQueueItem(id);}};this.retryTimeout=function(extra,state,amlNode,oError,maxRetries){if(state==apf.TIMEOUT&&extra.retries<(maxRetries||apf.maxHttpRetries)){return extra.tpModule.retry(extra.id);
}oError=oError||new Error(apf.formatErrorString(0,this,"Communication "+(state==apf.TIMEOUT?"timeout":"error"),"Url: "+extra.url+"\nInfo: "+extra.message));
if((amlNode||apf).dispatchEvent("error",apf.extend({error:oError,state:state,extra:extra,bubbles:true},extra))===false){return 2;
}};this.clearQueueItem=function(id){if(!this.queue[id]){return false;}if(apf.releaseHTTP&&!apf.isGecko){apf.releaseHTTP(this.queue[id].http);
}this.queue[id]=null;delete this.queue[id];return true;};this.retry=function(id){if(!this.queue[id]){return false;
}var qItem=this.queue[id];qItem.retries++;qItem.options.id=id;this.get(qItem.url,qItem.options);
return true;};this.cancel=function(id){if(id===null){id=this.queue.length-1;}if(!this.queue[id]){return false;
}if(apf.isGecko){this.queue[id].http.abort();}this.clearQueueItem(id);};if(!this.$loadAml&&!this.instantiate&&!this.call){this.$loadAml=function(x){var receive=this["receive"];
for(var i=0,l=this.childNodes.length;i<l;i++){if(this.childNodes[i].nodeType!=1){continue;
}var url=this.childNodes[i].getAttribute("url"),callback=self[this.childNodes[i].getAttribute("receive")||receive],options={useXML:this.childNodes[i].getAttribute("type")=="XML",async:!apf.isFalse(this.childNodes[i].getAttribute("async"))};
this[this.childNodes[i].getAttribute("name")]=function(data,userdata){options.userdata=userdata;
options.data=data;return this.get(url,options);};}};this.instantiate=function(x){var url=x.getAttribute("src"),options={async:x.getAttribute("async")!="false",nocache:true};
this.getURL=function(data,userdata){options.data=data;options.userdata=userdata;
options.callback=this.callbacks.getURL;return this.get(url,options);};var name="http"+Math.round(Math.random()*100000);
apf.setReference(name,this);return name+".getURL()";};this.call=function(method,args){this[method].call(this,args);
};}};apf.Init.run("http");apf.DOMParser=function(){};apf.DOMParser.prototype=new (function(){this.caseInsensitive=true;
this.preserveWhiteSpace=false;this.$shouldWait=0;var RE=[/\<\!(DOCTYPE|doctype)[^>]*>/,/&nbsp;/g,/<\s*\/?\s*(?:\w+:\s*)[\w-]*[\s>\/]/g],XPATH="//@*[not(contains(local-name(), '.')) and not(translate(local-name(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz') = local-name())]";
this.parseFromString=function(xmlStr,mimeType,options){var xmlNode;if(this.caseInsensitive){var str=xmlStr.replace(RE[0],"").replace(RE[2],function(m){return m.toLowerCase();
});if(!this.supportNamespaces){str=str.replace(/xmlns\=\"[^"]*\"/g,"");}xmlNode=apf.getXmlDom(str,null,this.preserveWhiteSpace||apf.debug).documentElement;
var i,l,nodes=xmlNode.selectNodes(XPATH);for(i=0,l=nodes.length;i<l;i++){(nodes[i].ownerElement||nodes[i].selectSingleNode("..")).setAttribute(nodes[i].nodeName.toLowerCase(),nodes[i].nodeValue);
}}else{xmlNode=apf.getXmlDom(xmlStr,null,this.preserveWhiteSpace||apf.debug).documentElement;
}return this.parseFromXml(xmlNode,options);};this.parseFromXml=function(xmlNode,options){var doc,docFrag,amlNode,beforeNode;
if(!options){options={};}if(!options.delayedRender&&!options.include){if(options.doc){doc=options.doc;
docFrag=options.docFrag||doc.createDocumentFragment();}else{doc=new apf.AmlDocument();
doc.$aml=xmlNode;doc.$domParser=this;}if(options.host){doc.$parentNode=options.host;
}amlNode=this.$createNode(doc,xmlNode.nodeType,xmlNode);(docFrag||doc).appendChild(amlNode);
if(options.htmlNode){amlNode.$int=options.htmlNode;}}else{amlNode=options.amlNode;
doc=options.doc;if(options.include){var n=amlNode.childNodes;var p=n.indexOf(options.beforeNode);
var rest=p?n.splice(p,n.length-p):[];}}this.$parseContext=[amlNode,options];var nodes,nodelist={},prios=[],_self=this;
var recur;(recur=function(amlNode,nodes){var cL,newNode,node,nNodes,cNodes=amlNode.childNodes,i=0,l=nodes.length;
for(;i<l;i++){newNode=_self.$createNode(doc,(node=nodes[i]).nodeType,node);if(!newNode){continue;
}cNodes[cL=cNodes.length]=newNode;newNode.parentNode=amlNode;if(cL>0){(newNode.previousSibling=cNodes[cL-1]).nextSibling=newNode;
}if(!newNode.render&&newNode.canHaveChildren&&(nNodes=node.childNodes).length){recur(newNode,nNodes);
}if(newNode.$parsePrio){if(newNode.$parsePrio=="001"){newNode.dispatchEvent("DOMNodeInsertedIntoDocument");
continue;}(nodelist[newNode.$parsePrio]||(prios.push(newNode.$parsePrio)&&(nodelist[newNode.$parsePrio]=[]))).push(newNode);
}}amlNode.firstChild=cNodes[0];amlNode.lastChild=cNodes[cL];})(amlNode,xmlNode.childNodes);
if(options.include&&rest.length){var index=n.length-1;n.push.apply(n,rest);var last=n[index];
var next=n[index+1];(next.previousSibling=last).nextSibling=next;amlNode.lastChild=n[n.length-1];
}if(options.delay){amlNode.$parseOptions={prios:prios,nodelist:nodelist};return(docFrag||doc);
}prios.sort();var i,j,l,l2;for(i=0,l=prios.length;i<l;i++){nodes=nodelist[prios[i]];
for(j=0,l2=nodes.length;j<l2;j++){nodes[j].dispatchEvent("DOMNodeInsertedIntoDocument");
}}if(this.$shouldWait){return(docFrag||doc);}if(options.timeout){$setTimeout(function(){_self.$continueParsing(amlNode,options);
});}else{this.$continueParsing(amlNode,options);}return(docFrag||doc);};this.$callCount=0;
this.$continueParsing=function(amlNode,options){if(this.$shouldWait&&--this.$shouldWait!=0){return false;
}if(!options){options={};}this.$callCount++;if(amlNode.$parseOptions){var prios=amlNode.$parseOptions.prios,nodelist=amlNode.$parseOptions.nodelist,i,j,l,l2,node;
delete amlNode.$parseOptions;prios.sort();for(i=0,l=prios.length;i<l;i++){nodes=nodelist[prios[i]];
for(j=0,l2=nodes.length;j<l2;j++){if(!(node=nodes[j]).parentNode||node.$amlLoaded){continue;
}nodes[j].dispatchEvent("DOMNodeInsertedIntoDocument");}}}if(!options.ignoreSelf&&!amlNode.$amlLoaded){amlNode.dispatchEvent("DOMNodeInsertedIntoDocument");
}(function _recur(nodes){var node,nNodes;for(var i=0,l=nodes.length;i<l;i++){if(!(node=nodes[i]).$parsePrio&&!node.$amlLoaded){node.dispatchEvent("DOMNodeInsertedIntoDocument");
}if(!node.render&&(nNodes=node.childNodes).length){_recur(nNodes);}}})(amlNode.childNodes);
if(!--this.$callCount&&!options.delay){apf.queue.empty();}if(options.callback){options.callback.call(amlNode.ownerDocument);
}delete this.$parseContext;};this.$createNode=function(doc,nodeType,xmlNode,namespaceURI,nodeName,nodeValue){var o;
switch(nodeType){case 1:var id,prefix;if(xmlNode){if((namespaceURI=xmlNode.namespaceURI||apf.ns.xhtml)&&!(prefix=doc.$prefixes[namespaceURI])){doc.$prefixes[prefix=xmlNode.prefix||xmlNode.scopeName||""]=namespaceURI;
doc.$namespaceURIs[namespaceURI]=prefix;if(!doc.namespaceURI&&!prefix){doc.namespaceURI=namespaceURI;
doc.prefix=prefix;}}nodeName=xmlNode.baseName||xmlNode.localName||xmlNode.tagName.split(":").pop();
}else{prefix=doc.$prefixes[namespaceURI]||"";}var els=apf.namespaces[namespaceURI].elements;
o=new (els[nodeName]||els["@default"])(null,nodeName);o.prefix=prefix||"";o.namespaceURI=namespaceURI;
o.tagName=prefix?prefix+":"+nodeName:nodeName;if(xmlNode){if(id=xmlNode.getAttribute("id")){o.$propHandlers.id.call(o,o.id=id);
}var attr=xmlNode.attributes,n;for(var a,i=0,l=attr.length;i<l;i++){o.attributes.push(new apf.AmlAttr(o,(n=(a=attr[i]).nodeName),a.nodeValue));
if(n=="render"){o.render=true;}}}break;case 2:o=new apf.AmlAttr();o.name=o.nodeName=nodeName;
if(nodeValue||(nodeValue=xmlNode&&xmlNode.nodeValue)){o.value=o.nodeValue=nodeValue;
}if(xmlNode){if(xmlNode.namespaceURI&&!(o.prefix=doc.$namespaceURIs[o.namespaceURI=xmlNode.namespaceURI])){doc.$prefixes[o.prefix=xmlNode.prefix||xmlNode.scopeName]=o.namespaceURI;
}}else{o.prefix=doc.$prefixes[namespaceURI];}break;case 3:if(xmlNode){nodeValue=xmlNode&&xmlNode.nodeValue;
}if(!this.preserveWhiteSpace&&!(nodeValue||"").trim()){return;}o=new apf.AmlText();
o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;break;case 7:var target=nodeName||xmlNode&&xmlNode.nodeName;
o=new apf.aml.processingInstructions[target]();o.target=o.nodeName=target;o.data=o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;
break;case 4:o=new apf.AmlCDATASection();o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;
break;case 5:o=new apf.AmlNode();o.nodeType=nodeType;break;case 6:o=new apf.AmlNode();
o.nodeType=nodeType;break;case 8:o=new apf.AmlComment();o.nodeValue=nodeValue||xmlNode&&xmlNode.nodeValue;
break;case 9:o=new apf.AmlDocument();o.$domParser=this;break;case 10:o=new apf.AmlNode();
o.nodeType=nodeType;break;case 11:o=new apf.AmlDocumentFragment();break;}o.ownerDocument=doc;
o.$aml=xmlNode;return o;};})();apf.AmlNamespace=function(){this.elements={};this.processingInstructions={};
};apf.AmlNamespace.prototype={setElement:function(tagName,fConstr){return this.elements[tagName]=fConstr;
},setProcessingInstruction:function(target,fConstr){this.processingInstructions[target]=fConstr;
}};apf.aml=new apf.AmlNamespace();apf.setNamespace("http://ajax.org/2005/aml",apf.aml);
apf.__AMLNODE__=1<<14;apf.AmlNode=function(){this.$init(function(){this.childNodes=[];
});};(function(){this.toString=function(){if(this.nodeName){return"["+this.nodeName.uCaseFirst()+" Node]";
}return"["+this.localName.uCaseFirst()+" Element Node, <"+(this.prefix?this.prefix+":":"")+this.localName+" "+this.attributes.join(" ")+" /> : "+(this.name||this.$uniqueId||"")+"]";
};this.$regbase=this.$regbase|apf.__AMLNODE__;this.NODE_ELEMENT=1;this.NODE_ATTRIBUTE=2;
this.NODE_TEXT=3;this.NODE_CDATA_SECTION=4;this.NODE_ENTITY_REFERENCE=5;this.NODE_ENTITY=6;
this.NODE_PROCESSING_INSTRUCTION=7;this.NODE_COMMENT=8;this.NODE_DOCUMENT=9;this.NODE_DOCUMENT_TYPE=10;
this.NODE_DOCUMENT_FRAGMENT=11;this.NODE_NOTATION=12;this.ownerDocument=null;this.nodeValue="";
this.namespaceURI="";this.appendChild=this.insertBefore=function(amlNode,beforeNode,noHtmlDomEdit){if(this.nodeType==this.NODE_DOCUMENT){if(this.childNodes.length){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Only one top level element is allowed in an AML document."));
}else{this.documentElement=amlNode;}}if(this==amlNode){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Cannot append node as a child of itself."));
}if(amlNode.nodeType==this.NODE_DOCUMENT_FRAGMENT){var nodes=amlNode.childNodes.slice(0);
for(var i=0,l=nodes.length;i<l;i++){this.insertBefore(nodes[i],beforeNode);}return amlNode;
}var isMoveWithinParent=amlNode.parentNode==this,oldParentHtmlNode=amlNode.$pHtmlNode,oldParent=amlNode.parentNode,index=-1,_self=this;
if(beforeNode){index=this.childNodes.indexOf(beforeNode);if(index<0){return false;
}}if(!amlNode.ownerDocument){amlNode.ownerDocument=this.ownerDocument||apf.ownerDocument;
}if(amlNode.parentNode){amlNode.removeNode(isMoveWithinParent,noHtmlDomEdit);}amlNode.parentNode=this;
if(beforeNode){index=this.childNodes.indexOf(beforeNode);}if(beforeNode){amlNode.nextSibling=beforeNode;
amlNode.previousSibling=beforeNode.previousSibling;beforeNode.previousSibling=amlNode;
if(amlNode.previousSibling){amlNode.previousSibling.nextSibling=amlNode;}}if(index>=0){this.childNodes=this.childNodes.slice(0,index).concat(amlNode,this.childNodes.slice(index));
}else{index=this.childNodes.push(amlNode)-1;amlNode.nextSibling=null;if(index>0){amlNode.previousSibling=this.childNodes[index-1];
amlNode.previousSibling.nextSibling=amlNode;}else{amlNode.previousSibling=null;
}}this.firstChild=this.childNodes[0];this.lastChild=this.childNodes[this.childNodes.length-1];
var initialAppend=!amlNode.$amlLoaded;function triggerUpdate(){amlNode.$pHtmlNode=_self.canHaveChildren?_self.$int:document.body;
var nextNode=beforeNode;if(!initialAppend&&!noHtmlDomEdit&&amlNode.$ext&&!amlNode.$coreHtml){nextNode=beforeNode;
while(nextNode&&!(nextNode.$altExt||nextNode.$ext)){nextNode=nextNode.nextSibling;
}amlNode.$pHtmlNode.insertBefore(amlNode.$altExt||amlNode.$ext,nextNode&&(nextNode.$altExt||nextNode.$ext)||null);
}amlNode.dispatchEvent("DOMNodeInserted",{$beforeNode:beforeNode,relatedNode:_self,$isMoveWithinParent:isMoveWithinParent,$oldParentHtmlNode:oldParentHtmlNode,$oldParent:oldParent,bubbles:true});
if(initialAppend&&!noHtmlDomEdit&&beforeNode&&amlNode.$ext&&!amlNode.$coreHtml){nextNode=beforeNode;
while(nextNode&&!(nextNode.$altExt||nextNode.$ext)){nextNode=nextNode.nextSibling;
}amlNode.$pHtmlNode.insertBefore(amlNode.$altExt||amlNode.$ext,nextNode&&(nextNode.$altExt||nextNode.$ext)||null);
}}var doc=this.nodeType==this.NODE_DOCUMENT?this:this.ownerDocument;if(!doc||doc.$domParser.$shouldWait){return amlNode;
}if(this.nodeType==this.NODE_DOCUMENT_FRAGMENT){return;}if(initialAppend&&!amlNode.render){(this.ownerDocument||this).$domParser.$continueParsing(amlNode,{delay:true});
}triggerUpdate();return amlNode;};this.removeNode=function(doOnlyAdmin,noHtmlDomEdit){if(!this.parentNode||!this.parentNode.childNodes){return this;
}this.parentNode.childNodes.remove(this);if(this.$amlLoaded&&!apf.isDestroying){this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:true,$doOnlyAdmin:doOnlyAdmin});
if(!noHtmlDomEdit&&!doOnlyAdmin&&this.$ext&&this.$ext.parentNode){this.$ext.parentNode.removeChild(this.$ext);
}}if(this.parentNode.firstChild==this){this.parentNode.firstChild=this.nextSibling;
}if(this.parentNode.lastChild==this){this.parentNode.lastChild=this.previousSibling;
}if(this.nextSibling){this.nextSibling.previousSibling=this.previousSibling;}if(this.previousSibling){this.previousSibling.nextSibling=this.nextSibling;
}this.$pHtmlNode=this.parentNode=this.previousSibling=this.nextSibling=null;return this;
};this.removeChild=function(childNode){childNode.removeNode();return this;};this.replaceChild=function(){};
this.cloneNode=function(deep){if(deep&&this.nodeType==1){return this.ownerDocument.$domParser.parseFromXml(this,{doc:this.ownerDocument,delay:true}).childNodes[0];
}else{return this.ownerDocument.$domParser.$createNode(this.ownerDocument,this.nodeType,this);
}};this.canDispatch=function(namespaceURI,type){};this.compareDocumentPosition=function(otherNode){};
this.hasAttributes=function(){return this.attributes&&this.attributes.length;};
this.hasChildNodes=function(){return this.childNodes&&this.childNodes.length;};
this.isDefaultNamespace=function(namespaceURI){if(node.nodeType==1){if(!this.prefix){return this.namespaceURI==namespaceURI;
}}var node=this.parentNode||this.ownerElement;return node&&node.isDefaultNamespace(namespaceURI);
};this.lookupNamespaceURI=function(prefix){if(node.nodeType==1){if(this.namespaceURI&&prefix==this.prefix){return this.namespaceURI;
}}var node=this.parentNode||this.ownerElement;return node&&node.lookupNamespaceURI(prefix);
};this.lookupPrefix=function(namespaceURI){if(this.nodeType==1){if(namespaceURI==this.namespaceURI&&this.prefix){return this.prefix;
}}var node=this.parentNode||this.ownerElement;return node&&node.lookupPrefix(namespaceURI);
};this.normalize=function(){};this.selectNodes=function(sExpr,contextNode){if(!apf){return;
}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(sExpr,contextNode||(this.nodeType==9?this.documentElement:this));
};this.selectSingleNode=function(sExpr,contextNode){if(!apf){return;}if(!apf.XPath){apf.runXpath();
}return apf.XPath.selectNodes(sExpr,contextNode||(this.nodeType==9?this.documentElement:this))[0];
};}).call(apf.AmlNode.prototype=new apf.Class());apf.AmlElement=function(struct,tagName){var $init=this.$init;
this.$init=function(tagName,nodeFunc,struct){this.$supportedProperties=this.$supportedProperties.slice();
var prop,p,q;p=this.$propHandlers;q=this.$propHandlers={};for(prop in p){q[prop]=p[prop];
}p=this.$booleanProperties;q=this.$booleanProperties={};for(prop in p){q[prop]=p[prop];
}$init.call(this,tagName,nodeFunc,struct);};this.$init(function(tagName,nodeFunc,struct){this.$events={};
this.$inheritProperties={};this.attributes=new apf.AmlNamedNodeMap(this);this.nodeFunc=nodeFunc;
this.localName=tagName;if(struct){var nodes,prop,i,l;if(struct.childNodes){nodes=struct.childNodes;
delete struct.childNodes;}for(prop in struct){if(prop=="htmlNode"){continue;}this.attributes.push(new apf.AmlAttr(this,prop,struct[prop]));
}if(!this.ownerDocument){this.ownerDocument=apf.document;this.prefix="a";this.namespaceURI=apf.ns.aml;
this.tagName=tagName;}if(nodes){this.childNodes=nodes;for(i=0,l=nodes.length;i<l;
i++){nodes[i].nextSibling=nodes[i+1]||null;nodes[i].previousSibling=nodes[i-1]||null;
nodes[i].parentNode=this;}this.firstChild=nodes[0]||null;this.lastChild=nodes[nodes.length-1]||null;
}this.$aml=apf.$emptyNode||(apf.$emptyNode=apf.getXml("<empty />"));}});if(tagName){$init.call(this,tagName,apf.NODE_HIDDEN,struct);
}};(function(){this.nodeType=this.NODE_ELEMENT;this.canHaveChildren=true;this.$propHandlers={id:function(value){if(this.name==value){return;
}if(self[this.name]==this){self[this.name]=null;}if(!self[value]||!self[value].hasFeature){try{self[value]=this;
}catch(ex){}}apf.nameserver.register(this.localName,value,this);this.name=value;
}};this.$booleanProperties={};this.$inheritProperties={};this.$supportedProperties=[];
this.getElementsByTagName=function(tagName,norecur){tagName=tagName.toLowerCase();
var node,i,l,nodes=this.childNodes,result=[];for(i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeType!=1){continue;
}if(node.tagName==tagName||tagName=="*"){result.push(node);}if(!norecur&&node.nodeType==1){result=result.concat(node.getElementsByTagName(tagName));
}}return result;};this.getElementsByTagNameNS=function(namespaceURI,localName,norecur){localName=localName.toLowerCase();
var node,i,l,nodes=this.childNodes,result=[];for(i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeType!=1){continue;
}if(node.namespaceURI==namespaceURI&&(node.localName==localName||localName=="*")){result.push(node);
}if(!norecur&&node.nodeType==1){result=result.concat(node.getElementsByTagNameNS(namespaceURI,localName));
}}return result;};this.setAttribute=function(name,value,noTrigger){name=name.toLowerCase();
var a=this.attributes.getNamedItem(name);if(!a){this.attributes.push(a=new apf.AmlAttr(this,name,value));
if(!this.$amlLoaded){return;}if(noTrigger){a.$setValue(value);}else{a.dispatchEvent("DOMNodeInsertedIntoDocument",{relatedNode:this});
a.dispatchEvent("DOMNodeInserted",{relatedNode:this,bubbles:true});}return;}var oldValue=a.nodeValue;
a.$setValue(value);if(noTrigger||!this.$amlLoaded){return;}a.$triggerUpdate(null,oldValue);
};this.setAttributeNode=function(attrNode){this.attributes.setNamedItem(attrNode);
};this.setAttributeNS=function(namespaceURI,name,value){return this.setAttribute(name,value);
};this.hasAttribute=function(name){return this.getAttributeNode(name)?true:false;
};this.hasAttributeNS=function(namespaceURI,name){return this.hasAttribute(name);
};this.removeAttribute=function(name){this.attributes.removeNamedItem(name);return this;
};this.removeAttributeNS=function(namespaceURI,name){return this.removeAttribute(name);
};this.removeAttributeNode=function(attrNode){this.attributes.removeNamedItem(attrNode.name);
};this.getAttribute=function(name,inherited){var item=this.attributes.getNamedItem(name);
return item?(inherited?item.inheritedValue||item.nodeValue:item.nodeValue):null;
};this.getAttributeNode=function(name){return this.attributes.getNamedItem(name);
};this.getBoundingClientRect=function(){return new apf.AmlTextRectangle(this);};
this.querySelector=function(){};this.querySelectorAll=function(){};this.scrollIntoView=function(){};
this.replaceMarkup=function(amlDefNode,options){if(!options){options={};}if(!options.$intAML){options.$intAML=this.$aml;
}if(!options.$int){options.$int=this.$int;}options.clear=true;for(var i=this.childNodes.length-1;
i>=0;i--){var oItem=this.childNodes[i];if(oItem.destroy){oItem.destroy(true);}if(oItem.$ext!=this.$int){apf.destroyHtmlNode(oItem.$ext);
}}this.childNodes.length=0;this.$int.innerHTML="<div class='loading'>loading...</div>";
this.insertMarkup(amlDefNode,options);};this.insertMarkup=function(amlDefNode,options){var _self=this;
var include=new apf.XiInclude();if(amlDefNode.trim().charAt(0)=="<"){amlDefNode=apf.getXml(amlDefNode);
}include.setAttribute("href",amlDefNode);if(options&&options.clear){include.setAttribute("clear",true);
}include.options=options;include.callback=options&&options.callback||function(){_self.dispatchEvent("afteramlinserted",{src:amlDefNode});
};this.appendChild(include);};this.serialize=function(shallow){if(shallow||!this.firstChild){return"<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes&&this.attributes.length?" ":"")+(this.attributes&&this.attributes.join(" ")||"")+"/>";
}else{var str=["<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes&&this.attributes.length?" ":"")+(this.attributes&&this.attributes.join(" ")||"")+">"];
for(var i=this.firstChild;i;i=i.nextSibling){str.push(i.serialize());}return str.join("")+"</"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">";
}};this.$setInheritedAttribute=function(prop){var value,node=this,isInherit=false;
value=node.getAttribute(prop);if(!value){node=node.parentNode;while(node&&node.nodeType==1&&!(value=node.getAttribute(prop,true))){node=node.parentNode;
}isInherit=true;}if(!value&&apf.config&&prop){value=apf.config[prop];}if(value){this.$clearDynamicProperty(prop);
if(isInherit){this.$inheritProperties[prop]=2;}if(typeof value=="string"&&(value.indexOf("{")>-1||value.indexOf("[")>-1)){this.$setDynamicProperty(prop,value);
}else{this.setProperty(prop,value,false,false,2);}}return value;};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget!=this||e.$isMoveWithinParent||!e.$oldParent){return;
}var vOld,vNew;var aci=apf.config.$inheritProperties;for(var prop in aci){vOld=apf.getInheritedAttribute(e.$oldParent,prop);
vNew=apf.getInheritedAttribute(this.parentNode,prop);if(vOld!=vNew){(function recur(nodes){var i,l,node,n;
for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.nodeType!=1&&node.nodeType!=7){continue;
}n=node.$inheritProperties[prop];if(aci[prop]==1&&!n){recur(node.childNodes);}else{if(!(n<0)){if(n==3){var sameValue=node[prop];
node[prop]=null;}node.setProperty(prop,n!=3?vNew:sameValue,false,false,n);}}}})([this]);
}}});this.$handlePropSet=function(prop,value,force){if(value&&this.$booleanProperties[prop]){value=apf.isTrue(value);
}this[prop]=value;var handler;return(handler=this.$propHandlers&&this.$propHandlers[prop]||this.nodeFunc==apf.NODE_VISIBLE&&apf.GuiElement&&apf.GuiElement.propHandlers[prop]||null)&&handler.call(this,value,prop,force);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var a,i,l,attr=this.attributes;
var defs=apf.nameserver.getAll("defaults_"+this.localName);if(defs.length){for(var j=0,jl=defs.length;
j<jl;j++){var d=defs[j].attributes,di;for(i=0,l=d.length;i<l;i++){a=attr.getNamedItem((di=d[i]).nodeName);
if(a){if(a.value){continue;}a.$setValue(di.nodeValue);this.$inheritProperties[di.nodeName]=2;
}else{this.attributes.push(new apf.AmlAttr(this,di.nodeName,di.nodeValue));this.$inheritProperties[di.nodeName]=2;
}}}}for(i=0,l=attr.length;i<l;i++){attr[i].dispatchEvent("DOMNodeInsertedIntoDocument");
}this.$amlLoaded=true;},true);}).call(apf.AmlElement.prototype=new apf.AmlNode());
apf.AmlCharacterData=function(){this.data="";this.length=0;this.$init(true);this.appendData=function(sValue){this.dispatchEvent("DOMCharacterDataModified",{value:sValue});
};this.deleteData=function(nOffset,nCount){this.dispatchEvent("DOMCharacterDataModified",{offset:nOffset,count:nCount});
};this.insertData=function(nOffset,nCount){this.dispatchEvent("DOMCharacterDataModified",{offset:nOffset,count:nCount});
};this.replaceData=function(nOffset,nCount,sValue){this.dispatchEvent("DOMCharacterDataModified",{offset:nOffset,count:nCount,value:sValue});
};this.substringData=function(nOffset,nCount){};};apf.AmlCharacterData.prototype=new apf.AmlNode();
apf.AmlText=function(isPrototype){this.$init(isPrototype);};(function(){this.nodeType=this.NODE_TEXT;
this.nodeName="#text";this.serialize=function(){return apf.xmlentities(this.nodeValue).replace(/</g,"&lt;").replace(/>/g,"&gt;");
};this.$setValue=function(value){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,prevValue:this.nodeValue,newValue:this.nodeValue=value});
if(this.$amlLoaded&&this.$ext){this.$ext.nodeValue=value;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)||this.parentNode.hasFeature(apf.__CHILDVALUE__)){return;
}this.$amlLoaded=true;var nodeValue=this.nodeValue;if(apf.config.liveText&&!this.parentNode.hasFeature(apf.__CHILDVALUE__)&&(nodeValue.indexOf("{")>-1||nodeValue.indexOf("[")>-1)){this.$supportedProperties=[];
this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};this.$propHandlers.calcdata=apf.LiveMarkupPi.prototype.$propHandlers.calcdata;
this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.implement(apf.StandardBinding);
pHtmlNode.appendChild(this.$ext=document.createElement("span"));this.$setDynamicProperty("calcdata",this.nodeValue);
return;}if(apf.hasTextNodeWhiteSpaceBug){var nodeValue=nodeValue.replace(/[\t\n\r ]+/g," ");
if(nodeValue&&nodeValue!=" "){this.$ext=pHtmlNode.appendChild(pHtmlNode.ownerDocument.createTextNode(nodeValue));
}}else{this.$ext=pHtmlNode.appendChild(pHtmlNode.ownerDocument.createTextNode(nodeValue));
}},true);}).call(apf.AmlText.prototype=new apf.AmlCharacterData());apf.AmlAttr=function(ownerElement,name,value){this.$init();
if(ownerElement){this.ownerElement=ownerElement;this.ownerDocument=ownerElement.ownerDocument;
}this.nodeName=this.name=name;this.nodeValue=this.value=value;};(function(){this.nodeType=this.NODE_ATTRIBUTE;
this.MODIFICATION=1;this.ADDITION=2;this.REMOVAL=3;this.serialize=this.toString=function(){return this.name+'="'+apf.xmlentities(String(this.value)).replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"';
};this.$setValue=function(value){this.nodeValue=this.value=value;this.specified=true;
this.ownerElement.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:this.name,newValue:value,prevValue:this.$lastValue||"",bubbles:true});
this.$lastValue=value;};this.$triggerUpdate=function(e,oldValue){var name=this.name,value=this.value||this.nodeValue,host=this.ownerElement;
if(name=="id"&&!this.specified&&host.id){this.specified=true;return;}if(name.substr(0,2)=="on"){if(host.$events[name]){host.removeEventListener(name.replace(/^on/,""),host.$events[name]);
}if(value){host.addEventListener(name,(host.$events[name]=(typeof value=="string"?apf.lm.compile(value,{event:true,parsecode:true}):value)));
}return;}if(this.specified){host.$clearDynamicProperty(name);}if(typeof value=="string"&&(host.$attrExcludePropBind[name]||(value.indexOf("{")>-1||value.indexOf("[")>-1))){host.$setDynamicProperty(name,value);
}else{host.setProperty(name,value);}if(this.specified){host.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:name,newValue:value,prevValue:this.$lastValue||"",bubbles:true});
}else{this.specified=true;}this.$lastValue=value;};this.addEventListener("DOMNodeInsertedIntoDocument",this.$triggerUpdate);
}).call(apf.AmlAttr.prototype=new apf.AmlNode());apf.AmlCDATASection=function(isPrototype){this.nodeType=this.NODE_CDATA_SECTION;
this.nodeName="#cdata-section";this.$init(isPrototype);};apf.AmlCDATASection.prototype=new apf.AmlText(true);
apf.AmlCDATASection.prototype.serialize=function(){return"<![CDATA["+this.nodeValue+"]]>";
};apf.AmlComment=function(isPrototype){this.nodeType=this.NODE_COMMENT;this.nodeName="#comment";
this.$init(isPrototype);};(function(){this.serialize=function(){return"<!--"+this.nodeValue+"-->";
};this.$setValue=function(value){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,newValue:value,prevValue:this.nodeValue});
};}).call(apf.AmlComment.prototype=new apf.AmlCharacterData());apf.AmlConfiguration=function(isPrototype){this.parameterNames=[];
this.$init(isPrototype);};(function(){this.setParameter=this.setProperty;this.getParameter=this.getProperty;
this.canSetParameter=function(name,value){return this.parameterNames.indexOf(name)>-1;
};}).call(apf.AmlConfiguration.prototype=new apf.Class());apf.AmlDocument=function(){this.$prefixes={};
this.$namespaceURIs={};this.domConfig=new apf.AmlConfiguration();this.$init();};
(function(){this.nodeType=this.NODE_DOCUMENT;this.nodeFunc=apf.NODE_HIDDEN;this.nodeName="#document";
this.$amlLoaded=true;this.activeElement=null;this.doctype=null;this.domConfig=null;
this.implementation=null;this.characterSet=apf.characterSet;this.documentElement=null;
this.getElementById=function(id){return self[id];};this.getElementsByTagName=function(tagName){var docEl,res=(docEl=this.documentElement).getElementsByTagName(tagName);
if(tagName=="*"||docEl.tagName==tagName){res.unshift(docEl);}return res;};this.getElementsByTagNameNS=function(nameSpaceURI,tagName){var docEl,res=(docEl=this.documentElement).getElementsByTagNameNS(nameSpaceURI,tagName);
if(tagName=="*"||docEl.tagName==tagName&&docEl.namespaceURI==nameSpaceURI){res.unshift(docEl);
}return res;};this.createElement=function(qualifiedName){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,this.namespaceURI,qualifiedName);
};this.createElementNS=function(namespaceURI,qualifiedName){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,namespaceURI,qualifiedName);
};this.importNode=function(node,deep){if(deep&&node.nodeType==1){return this.$domParser.parseFromXml(node,{doc:this,delay:true}).childNodes[0];
}else{return this.$domParser.$createNode(this,node.nodeType,node);}};this.createAttribute=function(nodeName){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,this.nameSpaceURI,nodeName);
};this.createAttributeNS=function(nameSpaceURI,nodeName){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,nameSpaceURI,nodeName);
};this.createEvent=function(){return new apf.AmlEvent();};this.createComment=function(nodeValue){return this.$domParser.$createNode(this,this.NODE_COMMENT,null,null,null,nodeValue);
};this.createProcessingInstruction=function(target,data){return this.$domParser.$createNode(this,this.NODE_PROCESSING_INSTRUCTION,null,null,target,data);
};this.createCDATASection=function(nodeValue){return this.$domParser.$createNode(this,this.NODE_CDATA_SECTION,null,null,null,nodeValue);
};this.createTextNode=function(nodeValue){return this.$domParser.$createNode(this,this.NODE_TEXT,null,null,null,nodeValue);
};this.createDocumentFragment=function(){return this.$domParser.$createNode(this,this.NODE_DOCUMENT_FRAGMENT);
};this.querySelector=function(){};this.querySelectorAll=function(){};this.evaluate=function(sExpr,contextNode,nsResolver,type,x){var result=apf.XPath.selectNodes(sExpr,contextNode||this.documentElement);
return{snapshotLength:result.length,snapshotItem:function(i){return result[i];}};
};this.createNSResolver=function(contextNode){return{};};this.hasFocus=function(){};
}).call(apf.AmlDocument.prototype=new apf.AmlNode());apf.AmlDocumentFragment=function(isPrototype){this.$init(isPrototype);
};apf.AmlDocumentFragment.prototype=new apf.AmlNode();apf.AmlDocumentFragment.prototype.nodeName="#document-fragment";
apf.AmlDocumentFragment.prototype.nodeType=apf.AmlDocumentFragment.prototype.NODE_DOCUMENT_FRAGMENT;
apf.AmlEvent=function(name,data){this.name=name;var prop;for(prop in data){this[prop]=data[prop];
}};apf.AmlEvent.prototype={bubbles:false,cancelBubble:false,preventDefault:function(){this.returnValue=false;
},stopPropagation:function(){this.cancelBubble=true;},stop:function(){this.returnValue=false;
this.cancelBubble=true;}};apf.AmlNamedNodeMap=function(host){this.$host=host;};
(function(){this.getNamedItem=function(name){for(var i=0;i<this.length;i++){if(this[i].name==name){return this[i];
}}return false;};this.setNamedItem=function(node){var name=node.name;for(var item,i=this.length-1;
i>=0;i--){if(this[i].name==name){this[i].ownerElement=null;this.splice(i,1);break;
}}this.push(node);node.ownerElement=this.$host;node.ownerDocument=this.$host.ownerDocument;
node.$triggerUpdate();};this.removeNamedItem=function(name){for(var item,i=this.length-1;
i>=0;i--){if(this[i].name==name){item=this[i];this.splice(i,1);break;}}if(!item){return false;
}var oldValue=item.nodeValue;item.nodeValue=item.value="";item.$triggerUpdate(null,oldValue);
item.ownerElement=null;item.nodeValue=item.value=oldValue;return item;};this.item=function(i){return this[i];
};this.length=0;this.splice=function(pos,length){for(var i=pos,l=this.length-length;
i<l;i++){this[i]=this[i+1];}delete this[i];this.length-=length;};this.push=function(o){this[this.length++]=o;
return this.length;};this.join=function(glue){var x=[];for(var e,a,i=0,l=this.length;
i<l;i++){if((e=(a=this[i]).ownerElement)&&e.$inheritProperties[a.nodeName]!=2){x.push(this[i]);
}}return x.join(glue);};}).call(apf.AmlNamedNodeMap.prototype={});apf.AmlProcessingInstruction=function(isPrototype){this.$init(isPrototype);
};(function(){this.nodeType=this.NODE_PROCESSING_INSTRUCTION;this.data=null;this.target=null;
this.serialize=function(){return"<?"+this.target+"\n"+apf.xmlentities(this.nodeValue)+"\n?>";
};this.reload=function(){this.$handlePropSet("data",this.data);};this.$attrExcludePropBind=apf.extend({calcdata:0},this.$attrExcludePropBind);
this.getAttribute=function(){};this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;
this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};
this.$setValue=function(value){this.setProperty("data",value);};this.$handlePropSet=function(prop,value,force){this[prop]=value;
if(prop=="data"){this.$clearDynamicProperty("calcdata");this.$setDynamicProperty("calcdata",value);
}else{if(prop=="target"){}else{if(this.$propHandlers[prop]){this.$propHandlers[prop].call(this,value,prop);
}}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode=e.pHtmlNode;
if(!pHtmlNode&&(this.parentNode.$bindingRule||!(pHtmlNode=this.parentNode.$int))){return;
}pHtmlNode.appendChild(this.$ext=document.createElement("span"));this.$ext.host=this;
this.$setDynamicProperty("calcdata",this.data);},true);this.$destroy=function(){this.$clearDynamicProperty("calcdata");
this.$propHandlers.calcdata.call(this,"");};}).call(apf.AmlProcessingInstruction.prototype=new apf.AmlNode());
apf.AmlSelection=function(doc){this.$init();this.$ownerDocument=doc;var _self=this;
var monitor=false;this.$monitorRange=function(){apf.queue.add("selrange"+this.$uniqueId,function(){var range=_self.$ranges[0];
_self.anchorNode=range.startContainer;_self.anchorOffset=range.startOffset;range=_self.$ranges[_self.rangeCount-1];
_self.focusNode=range.endContainer;_self.focusOffset=range.endOffset;monitor=false;
});monitor=true;};var update=false;this.$update=function(){if(!update){apf.queue.add("selupdate"+this.$uniqueId,function(){_self.dispatchEvent("update");
update=false;});update=true;}};};(function(){this.anchorNode=null;this.anchorOffset=0;
this.focusNode=null;this.focusOffset=null;this.rangeCount=0;this.$ranges=[];this.toString=function(){return"[apf.AmlSelection]";
};this.isCollapsed=function(){return !this.rangeCount||this.rangeCount==1&&this.$ranges[0].collapsed;
};this.collapse=function(parentNode,offset,noEvent){for(var i=0,l=this.$ranges.length;
i<l;i++){(range=this.$ranges[i]).removeEventListener("update",this.$monitorRange);
range.detach();}var range;this.$ranges=[range=new apf.AmlRange(this.ownerDocument)];
range.addEventListener("update",this.$monitorRange);range.setStart(parentNode,offset);
range.setEnd(parentNode,offset);this.rangeCount=1;this.focusNode=this.anchorNode=parentNode;
this.anchorOffset=this.focusOffset=offset;if(!noEvent){this.dispatchEvent("update");
}};this.collapseToStart=function(){var range=this.$ranges[0];this.collapse(range.startContainer,range.startOffset);
};this.collapseToEnd=function(){var range=this.$ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset);
};this.selectAllChildren=function(parentNode){this.collapse(parentNode,0,true);
var range=this.$ranges[0];range.selectNodeContents(parseNode);this.focusNode=this.anchorNode=parentNode;
this.anchorOffset=0;this.focusOffset=range.endOffset;this.$update();};this.deleteFromDocument=function(){for(var i=0,l=this.$ranges.length;
i<l;i++){this.$ranges[i].deleteContents();}var range=this.$ranges[0];this.anchorNode=range.startContainer;
this.anchorOffset=range.startOffset;range=this.$ranges[this.rangeCount-1];this.focusNode=range.endContainer;
this.focusOffset=range.endOffset;this.$update();};this.getRangeAt=function(index){return this.$ranges[index];
};this.addRange=function(range){this.rangeCount=this.$ranges.push(range);this.focusNode=range.endContainer;
this.focusOffset=range.endOffset;range.addEventListener("update",this.$monitorRange);
this.$update();return range;};this.removeRange=function(range){this.$ranges.remove(range);
this.rangeCount=this.$ranges.length;range.removeEventListener("update",this.$monitorRange);
var range=this.$ranges[0];this.anchorNode=range.startContainer;this.anchorOffset=range.startOffset;
range=this.$ranges[this.rangeCount-1];this.focusNode=range.endContainer;this.focusOffset=range.endOffset;
this.$update();};this.removeAllRanges=function(){for(var range,i=0,l=this.$ranges.length;
i<l;i++){(range=this.$ranges[i]).removeEventListener("update",this.$monitorRange);
range.detach();}this.$ranges=[];this.rangeCount=0;this.anchorNode=null;this.anchorOffset=0;
this.focusNode=null;this.focusOffset=0;this.$update();};this.$getNodeList=function(){var nodes=[];
for(var r,i=0;i<this.rangeCount;i++){nodes.push((r=this.$ranges[i]).startContainer.childNodes[r.startOffset]);
}return nodes;};this.$selectList=function(list){this.removeAllRanges();for(var i=0;
i<list.length;i++){this.addRange(new apf.AmlRange(this)).selectNode(list[i]);}};
this.$getFirstNode=function(){var r;return(r=this.$ranges[0]).startContainer.childNodes[r.startOffset];
};}).call(apf.AmlSelection.prototype=new apf.Class());apf.AmlTextRectangle=function(host){var _self=this;
function handler(){var pos=_self.getAbsolutePosition(_self.$ext);_self.setProperty("left",pos[0]);
_self.setProperty("top",pos[1]);_self.setProperty("right",document.documentElement.offsetWidth-pos[0]);
_self.setProperty("bottom",document.documentElement.offsetWidth-pos[1]);}host.addEventListener("prop.width",handler);
host.addEventListener("prop.height",handler);host.addEventListener("prop.left",handler);
host.addEventListener("prop.top",handler);handler.call(host);};apf.AmlTextRectangle.prototype=new apf.Class();
apf.xhtml=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/1999/xhtml",apf.xhtml);
apf.XhtmlElement=function(struct,tagName){this.$init(tagName||true,apf.NODE_VISIBLE,struct);
this.$xoe=this.addEventListener;this.addEventListener=this.$xae;this.removeEventListener=this.$xre;
var _self=this;this.$de=function(e){_self.dispatchEvent(e.type,null,e);};};(function(){var excludedEvents={contextmenu:1,keydown:1,keypress:1,keyup:1,DOMNodeInserted:2,DOMNodeInsertedIntoDocument:2,DOMNodeRemoved:2,DOMNodeRemovedFromDocument:2};
this.$xae=function(type,fn){this.$xoe.apply(this,arguments);if(excludedEvents[type]>(this.editable?0:1)||type.substr(0,5)=="prop."){return;
}if(this.$ext){if(type.substr(0,2)=="on"){type=type.substr(2);}apf.addListener(this.$ext,type,this.$de);
}};this.$xre=function(type,fn){apf.AmlElement.prototype.removeEventListener.apply(this,arguments);
if(this.$ext){apf.removeListener(this.$ext,type,this.$de);}};this.$handlePropSet=function(name,value,force,inherit){if(this.$booleanProperties[name]){value=apf.isTrue(value);
}this[name]=value;var handler=this.$propHandlers&&this.$propHandlers[name]||apf.GuiElement.propHandlers[name];
if(handler){handler.call(this,value,null,name);}else{if(this.$int&&(force||this.$amlLoaded)){this.$int.setAttribute(apf.isIE&&apf.isIE<8&&name=="class"?"className":name,value);
}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.$pHtmlNode=this.parentNode.$int)){return;}var str,aml=this.$aml;
if(aml){if(aml.serialize){str=aml.serialize();}else{aml=aml.cloneNode(false);str=aml.xml||aml.nodeValue;
}str=str.replace(/ on\w+="[^"]*"| on\w+='[^']*'/g,"");this.$ext=this.$int=apf.insertHtmlNode(null,pHtmlNode,null,apf.html_entity_decode(str));
}else{this.$ext=this.$int=pHtmlNode.appendChild(document.createElement(this.localName));
}if(this.localName!="a"){this.$ext.host=this;}this.style=this.$ext.style;},true);
this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$amlLoaded=true;
if(this.$setLayout){this.$setLayout();}});}).call(apf.XhtmlElement.prototype=new apf.AmlElement());
apf.Init.addConditional(function(){if(apf.isO3){return;}var prot=apf.XhtmlElement.prototype;
prot.implement(apf.Anchoring);prot.$drawn=true;prot.$setLayout=apf.GuiElement.prototype.$setLayout;
prot.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this&&"vbox|hbox|table".indexOf(this.parentNode.localName)==-1){this.$setLayout();
}});},null,["interactive"]);apf.xhtml.setElement("@default",apf.XhtmlElement);apf.XhtmlBodyElement=function(struct,tagName){this.$init(tagName||"body",apf.NODE_VISIBLE,struct);
};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.ownerDocument.body){this.ownerDocument.body=this;
}this.$ext=this.$int=document.body;},true);}).call(apf.XhtmlBodyElement.prototype=new apf.AmlElement());
apf.Init.addConditional(function(){if(apf.isO3){return;}var prot=apf.XhtmlBodyElement.prototype;
},null,["interactive"]);apf.xhtml.setElement("body",apf.XhtmlBodyElement);apf.XhtmlHtmlElement=function(struct,tagName){this.$init(tagName||"html",apf.NODE_VISIBLE,struct);
this.$ext=document.documentElement;this.$ext.host=this;this.$int=document.body;
this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;
this.$isWindowContainer=true;this.implement(apf.Focussable);apf.window.$addFocus(this);
this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var i,l,n,a,c,attr=this.attributes,doc=this.ownerDocument;
for(i=0,l=attr.length;i<l;i++){n=(a=attr[i]).nodeName.split(":");if(n[0]=="xmlns"){if(c=n[1]){doc.$prefixes[c]=a.nodeValue;
doc.$namespaceURIs[a.nodeValue]=c;}else{doc.namespaceURI=a.nodeValue;}}}if(!doc.namespaceURI){doc.namespaceURI=apf.ns.xhtml;
}});};apf.XhtmlHtmlElement.prototype=new apf.XhtmlElement();apf.xhtml.setElement("html",apf.XhtmlHtmlElement);
apf.XhtmlIgnoreElement=function(struct,tagName){this.$init(tagName,apf.NODE_VISIBLE,struct);
};apf.XhtmlIgnoreElement.prototype=new apf.AmlElement();apf.xhtml.setElement("script",apf.XhtmlIgnoreElement);
apf.xhtml.setElement("noscript",apf.XhtmlIgnoreElement);apf.xhtml.setElement("head",apf.XhtmlIgnoreElement);
apf.xhtml.setElement("meta",apf.XhtmlIgnoreElement);apf.XhtmlInputElement=function(struct,tagName){this.$init(tagName||"input",apf.NODE_VISIBLE,struct);
};(function(){this.$xae=apf.XhtmlElement.prototype.$xae;this.$xre=apf.XhtmlElement.prototype.$xre;
this.$handlePropSet=function(name,value,force){if(name=="type"){return;}return apf.XhtmlElement.prototype.$handlePropSet.call(this,name,value,force);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),pHtmlNode);
}else{this.$ext=this.$int=document.createElement(this.localName);if(this.getAttribute("type")){this.$int.setAttribute("type",this.getAttribute("type"));
}pHtmlNode.appendChild(this.$int);}},true);}).call(apf.XhtmlInputElement.prototype=new apf.AmlElement());
apf.xhtml.setElement("input",apf.XhtmlInputElement);apf.XhtmlOptionElement=function(struct,tagName){this.$init(tagName||"option",apf.NODE_VISIBLE,struct);
};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$ext=this.$int=this.parentNode.$int.appendChild(this.parentNode.$int.ownerDocument.createElement("option"));
if(this.value){this.$int.setAttribute("value",this.value);}},true);}).call(apf.XhtmlOptionElement.prototype=new apf.AmlElement());
apf.xhtml.setElement("option",apf.XhtmlOptionElement);apf.XhtmlSkipChildrenElement=function(struct,tagName){this.$init(tagName,apf.NODE_VISIBLE,struct);
};(function(){this.canHaveChildren=false;this.$redraw=function(){var _self=this;
apf.queue.add("redraw"+this.$uniqueId,function(){var pHtmlNode=_self.$ext.parentNode;
var beforeNode=_self.$ext.nextSibling;pHtmlNode.removeChild(_self.$ext);_self.$ext=apf.insertHtmlNode(null,pHtmlNode,beforeNode,_self.$aml?(_self.$aml.serialize?_self.$aml.serialize():_self.$aml.xml):_self.serialize());
});};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,pHtmlNode,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());
},true);}).call(apf.XhtmlSkipChildrenElement.prototype=new apf.AmlElement());apf.xhtml.setElement("object",apf.XhtmlSkipChildrenElement);
apf.xhtml.setElement("embed",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("table",apf.XhtmlSkipChildrenElement);
apf.xhtml.setElement("pre",apf.XhtmlSkipChildrenElement);apf.xsd=new apf.AmlNamespace();
apf.setNamespace("http://www.w3.org/2001/XMLSchema",apf.xsd);apf.xsd.typeHandlers={"http://www.w3.org/2001/XMLSchema":{dateTime:function(value){value=value.replace(/-/g,"/");
value.match(/^(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2}):(\d{2})$/);if(!RegExp.$3||RegExp.$3.length<4){return false;
}var dt=new Date(value);if(dt.getFullYear()!=parseFloat(RegExp.$3)){return false;
}if(dt.getMonth()!=parseFloat(RegExp.$2)-1){return false;}if(dt.getDate()!=parseFloat(RegExp.$1)){return false;
}if(dt.getHours()!=parseFloat(RegExp.$4)){return false;}if(dt.getMinutes()!=parseFloat(RegExp.$5)){return false;
}if(dt.getSeconds()!=parseFloat(RegExp.$5)){return false;}return true;},time:function(value){value.match(/^(\d{2}):(\d{2}):(\d{2})$/);
var dt=new Date("21/06/1980 "+value);if(dt.getHours()!=parseFloat(RegExp.$1)){return false;
}if(dt.getMinutes()!=parseFloat(RegExp.$2)){return false;}if(dt.getSeconds()!=parseFloat(RegExp.$3)){return false;
}return true;},date:function(value){value=value.replace(/-/g,"/");value.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
if(!RegExp.$3||RegExp.$3.length<4){return false;}var dt=new Date(RegExp.$2+"/"+RegExp.$1+"/"+RegExp.$3);
if(dt.getFullYear()!=parseFloat(RegExp.$3)){return false;}if(dt.getMonth()!=parseFloat(RegExp.$2)-1){return false;
}if(dt.getDate()!=parseFloat(RegExp.$1)){return false;}return true;},gYearMonth:function(value){value=value.replace(/-/g,"/");
value.match(/^\/?(\d{4})(?:\d\d)?\/(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);if(!RegExp.$1||RegExp.$1.length<4){return false;
}var dt=new Date(value);if(dt.getFullYear()!=parseFloat(RegExp.$)){return false;
}if(dt.getMonth()!=parseFloat(RegExp.$2)-1){return false;}return true;},gYear:function(value){value.match(/^\/?(\d{4})(?:\d\d)?(?:\w|[\+\-]\d{2}:\d{2})?$/);
if(!RegExp.$1||RegExp.$1.length<4){return false;}var dt=new Date(value);if(dt.getFullYear()!=parseFloat(RegExp.$1)){return false;
}return true;},gMonthDay:function(value){value=value.replace(/-/g,"/");value.match(/^\/\/(\d{2})\/(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);
var dt=new Date(value);if(dt.getMonth()!=parseFloat(RegExp.$1)-1){return false;
}if(dt.getDate()!=parseFloat(RegExp.$2)){return false;}return true;},gDay:function(value){value=value.replace(/-/g,"/");
value.match(/^\/{3}(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);var dt=new Date(value);if(dt.getDate()!=parseFloat(RegExp.$1)){return false;
}return true;},gMonth:function(value){value=value.replace(/-/g,"/");value.match(/^\/{2}(\d{2})(?:\w|[\+\-]\d{2}:\d{2})?$/);
var dt=new Date(value);if(dt.getMonth()!=parseFloat(RegExp.$1)-1){return false;
}return true;},string:function(value){return typeof value=="string";},"boolean":function(value){return/^(true|false)$/i.test(value);
},base64Binary:function(value){return true;},hexBinary:function(value){return/^(?:0x|x|#)?[A-F0-9]{0,8}$/i.test(value);
},"float":function(value){return parseFloat(value)==value;},decimal:function(value){return/^[0-9\.\-,]+$/.test(value);
},"double":function(value){return parseFloat(value)==value;},anyURI:function(value){return/^(?:\w+:\/\/)?(?:(?:[\w\-]+\.)+(?:[a-z]+)|(?:(?:1?\d?\d?|2[0-4]9|25[0-5])\.){3}(?:1?\d\d|2[0-4]9|25[0-5]))(?:\:\d+)?(?:\/([^\s\\\%]+|%[\da-f]{2})*)?$/i.test(value);
},QName:function(value){return true;},normalizedString:function(value){return true;
},token:function(value){return true;},language:function(value){return true;},Name:function(value){return true;
},NCName:function(value){return true;},ID:function(value){return true;},IDREF:function(value){return true;
},IDREFS:function(value){return true;},NMTOKEN:function(value){return true;},NMTOKENS:function(value){return true;
},integer:function(value){return parseInt(value)==value;},nonPositiveInteger:function(value){return parseInt(value)==value&&value<=0;
},negativeInteger:function(value){return parseInt(value)==value&&value<0;},"long":function(value){return parseInt(value)==value&&value>=-2147483648&&value<=2147483647;
},"int":function(value){return parseInt(value)==value;},"short":function(value){return parseInt(value)==value&&value>=-32768&&value<=32767;
},"byte":function(value){return parseInt(value)==value&&value>=-128&&value<=127;
},nonNegativeInteger:function(value){return parseInt(value)==value&&value>=0;},unsignedLong:function(value){return parseInt(value)==value&&value>=0&&value<=4294967295;
},unsignedInt:function(value){return parseInt(value)==value&&value>=0;},unsignedShort:function(value){return parseInt(value)==value&&value>=0&&value<=65535;
},unsignedByte:function(value){return parseInt(value)==value&&value>=0&&value<=255;
},positiveInteger:function(value){return parseInt(value)==value&&value>0;}},"http://ajax.org/2005/aml":{url:function(value){return/\b(https?|ftp):\/\/([\-A-Z0-9.]+)(\/[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?(\?[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?/i.test(value.trim());
},website:function(value){return/^(?:http:\/\/)?([\w-]+\.)+\w{2,4}$/.test(value.trim());
},email:function(value){return/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i.test(value.trim());
},creditcard:function(value){value=value.replace(/ /g,"");value=value.pad(21,"0",apf.PAD_LEFT);
for(var total=0,r,i=value.length;i>=0;i--){r=value.substr(i,1)*(i%2+1);total+=r>9?r-9:r;
}return total%10===0;},expdate:function(value){value=value.replace(/-/g,"/");value=value.split("/");
var dt=new Date(value[0]+"/01/"+value[1]);if(dt.getYear()!=parseFloat(value[1])){return false;
}if(dt.getMonth()!=parseFloat(value[0])-1){return false;}return true;},wechars:function(value){return/^[0-9A-Za-z\xC0-\xCF\xD1-\xD6\xD8-\xDD\xDF-\xF6\xF8-\xFF -\.',]+$/.test(value);
},phonenumber:function(value){return/^[\d\+\- \(\)]+$/.test(value);},faxnumber:function(value){return/^[\d\+\- \(\)]+$/.test(value);
},mobile:function(value){return/^[\d\+\- \(\)]+$/.test(value);}}};apf.xsd.custumTypeHandlers={};
apf.xsd.matchType=function(value,type){var split=type.split(":"),prefix=split[0],doc=apf.document,ns=doc.$prefixes[prefix];
type=split[1];if(prefix=="xsd"){ns="http://www.w3.org/2001/XMLSchema";}if(!ns){ns=doc.namespaceURI||apf.ns.xhtml;
}var c=this.typeHandlers[ns];if(c&&c[type]){return c[type](value);}throw new Error(apf.formatErrorString(0,null,"Validating XSD Type","Could not find type: "+type));
return true;};apf.xsd.checkType=function(type,xmlNode){var value=typeof xmlNode=="object"?apf.queryValue(xmlNode):xmlNode;
if(type.indexOf(":")>-1){var split=type.split(":"),prefix=split[0],name=split[1],doc=apf.document,ns=doc.$prefixes[prefix];
if(prefix=="xsd"){ns="http://www.w3.org/2001/XMLSchema";}if(!ns){ns=doc.namespaceURI||apf.ns.xhtml;
}var c=this.typeHandlers[ns];if(c&&c[name]){return c[name](value);}}if(this.custumTypeHandlers[type]){return this.custumTypeHandlers[type](value);
}else{}};apf.html5=new apf.AmlNamespace();apf.setNamespace("",apf.html5);apf.HTML5INPUT={email:"textbox",url:"textbox",password:"textbox",datetime:"spinner",date:"calendar",month:"spinner",week:"spinner",time:"spinner",number:"spinner",range:"slider",checkbox:"checkbox",radio:"radiobutton",file:"upload",submit:"submit",image:"submit",reset:"button"};
apf.xinclude=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/2001/XInclude",apf.xinclude);
apf.XiInclude=function(struct,tagName){this.$init(tagName||"include",apf.NODE_HIDDEN,struct);
};apf.xinclude.setElement("include",apf.XiInclude);apf.aml.setElement("include",apf.XiInclude);
(function(){this.$parsePrio="002";this.$propHandlers.href=this.$propHandlers.src=function(value){if(typeof value!="string"){return finish.call(this,value);
}if(value.trim().charAt(0)=="<"){loadIncludeFile.call(this,value.trim());return;
}this.$path=value.charAt(0)=="{"?value:apf.getAbsolutePath(apf.hostPath,value);
var domParser=this.ownerDocument.$domParser;if(!this.defer){domParser.$shouldWait++;
this.$parseContext=domParser.$parseContext||[this.parentNode];}loadIncludeFile.call(this,this.$path);
};function done(xmlNode){if(this.callback){this.callback({xmlNode:xmlNode,amlNode:this.parentNode,addedNode:this.previousSibling||this.nextSibling});
}if(this.parentNode){this.parentNode.removeChild(this);}}function finish(xmlNode){var domParser=this.ownerDocument.$domParser;
if(this.clear){this.parentNode.$int.innerHTML="";}if(xmlNode){domParser.parseFromXml(xmlNode,{doc:this.ownerDocument,amlNode:this.parentNode,beforeNode:this,include:true});
if(!this.defer&&this.$parseContext){var o=(this.$parseContext[1]||(this.$parseContext[1]={})),cb=o.callback,_self=this;
o.callback=function(){done.call(_self,xmlNode);if(cb){cb.call(_self.ownerDocument);
}};if(domParser.$continueParsing.apply(domParser,this.$parseContext)===false){var o2=(domParser.$parseContext[1]||(domParser.$parseContext[1]={})),cb2=o.callback;
o2.callback=function(){if(cb){cb.call(_self.ownerDocument);}domParser.$continueParsing.apply(domParser,_self.$parseContext);
};}}else{done.call(this,xmlNode);}}else{if(!this.defer){domParser.$continueParsing.apply(domParser,this.$parseContext);
}done.call(this,xmlNode);}}function loadIncludeFile(path){var _self=this;apf.getData(path,apf.extend(this.options||{},{callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){var oError=new Error(apf.formatErrorString(1007,_self,"Loading Includes","Could not load Include file '"+(path||_self.src)+"'\nReason: "+extra.message));
if(extra.tpModule.retryTimeout(extra,state,null,oError)===true){return true;}apf.console.error(oError.message);
finish.call(_self,null);return;}xmlString=xmlString.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");
if(!apf.supportNamespaces){xmlString=xmlString.replace(/xmlns\=\"[^"]*\"/g,"");
}if(xmlString.indexOf("<a:application")==-1){xmlString="<a:application xmlns:a='"+apf.ns.aml+"'>"+xmlString+"</a:application>";
}var xmlNode=apf.getXml(xmlString,null,true);if(!xmlNode){throw new Error(apf.formatErrorString(0,null,"Loading include","Could not parse include file. Maybe the file does not exist?",xmlNode));
}xmlNode.setAttribute("filename",extra.url);finish.call(_self,xmlNode);},async:true,ignoreOffline:true}));
}}).call(apf.XiInclude.prototype=new apf.AmlElement());apf.__LIVEEDIT__=1<<23;apf.__ANCHORING__=1<<13;
apf.Anchoring=function(){this.$regbase=this.$regbase|apf.__ANCHORING__;this.$anchors=[];
var VERTICAL=1;var HORIZONTAL=2;this.$updateQueue=0;this.$inited=this.$parsed=this.$anchoringEnabled=false;
this.$hordiff=this.$verdiff=0;this.$rule_v=this.$rule_h=this.$rule_header="";var l=apf.layout;
this.$supportedProperties.push("anchors");var propHandlers={right:function(value,prop){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;
}if(!value&&value!==0){this.$ext.style[prop]="";}if(!this.$updateQueue){l.queue(this.$pHtmlNode,this);
}this.$updateQueue=this.$updateQueue|HORIZONTAL;},bottom:function(value,prop){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;
}if(!value&&value!==0){this.$ext.style[prop]="";}if(!this.$updateQueue){l.queue(this.$pHtmlNode,this);
}this.$updateQueue=this.$updateQueue|VERTICAL;}};propHandlers.left=propHandlers.width=propHandlers.right;
propHandlers.top=propHandlers.height=propHandlers.bottom;this.$propHandlers.anchors=function(value){this.$anchors=value?value.splitSafe("(?:, *| )"):[];
if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!this.$updateQueue&&apf.loaded){l.queue(this.$pHtmlNode,this);
}this.$updateQueue=this.$updateQueue|HORIZONTAL|VERTICAL;};this.$disableAnchoring=function(activate){if(!this.$inited||!this.$anchoringEnabled||!this.$pHtmlNode){return;
}l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");if(l.queue){l.queue(this.$pHtmlNode);
}for(var prop in propHandlers){delete this.$propHandlers[prop];}this.removeEventListener("DOMNodeRemoved",remove);
this.removeEventListener("DOMNodeInserted",reparent);if(this.$ext){this.$ext.style.left=this.$ext.style.right=this.$ext.style.top=this.$ext.style.bottom=this.$ext.style.width=this.$ext.style.height=this.$ext.style.position="";
}this.removeEventListener("prop.visible",visibleHandler);this.$inited=false;this.$anchoringEnabled=false;
};this.$enableAnchoring=function(){if(this.$inited){return;}apf.extend(this.$propHandlers,propHandlers);
this.addEventListener("DOMNodeRemoved",remove);this.addEventListener("DOMNodeInserted",reparent);
this.addEventListener("prop.visible",visibleHandler);this.$updateQueue=0|((this.left||this.width||this.right||this.anchors)&&HORIZONTAL)|((this.top||this.height||this.bottom||this.anchors)&&VERTICAL);
if(this.$updateQueue){l.queue(this.$pHtmlNode,this);}this.$inited=true;this.$anchoringEnabled=true;
};function visibleHandler(e){if(!(this.$rule_header||this.$rule_v||this.$rule_h)){return;
}if(e.value){if(this.$rule_v||this.$rule_h){var rules=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;
l.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",rules);l.queue(this.$pHtmlNode,this);
}l.processQueue();}else{l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");
l.queue(this.$pHtmlNode);}}function remove(e){if(e&&(e.$doOnlyAdmin||e.currentTarget!=this)){return;
}if(l.queue&&this.$pHtmlNode){l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");
l.queue(this.$pHtmlNode);}}function reparent(e){if(!this.$amlLoaded||e.currentTarget!=this){return;
}if(!e.$isMoveWithinParent&&this.$parsed){this.$moveAnchoringRules(e.$oldParentHtmlNode);
}}this.$moveAnchoringRules=function(oldParent,updateNow){var rules=oldParent&&l.removeRule(oldParent,this.$uniqueId+"_anchors");
if(rules){l.queue(oldParent);}if(!this.$rule_v&&!this.$rule_h&&!this.$rule_header){return;
}this.$rule_header=getRuleHeader.call(this);rules=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;
l.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",rules);l.queue(this.$pHtmlNode,this);
};this.$hasAnchorRules=function(){return this.$rule_v||this.$rule_h?true:false;
};function getRuleHeader(){if(!this.$pHtmlDoc){return"";}return"try{            var oHtml = "+(apf.hasHtmlIdsInJs?this.$ext.getAttribute("id"):"document.getElementById('"+this.$ext.getAttribute("id")+"')")+";                        var pWidth = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowWidth()":"apf.getHtmlInnerWidth(oHtml.parentNode)")+";                        var pHeight = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowHeight()":"apf.getHtmlInnerHeight(oHtml.parentNode)")+";            }catch(e){            }";
}function setPercentage(expr,value){return String(expr).replace(apf.percentageMatch,"(("+value+" * $1)/100)");
}this.$recalcAnchoring=function(queueDelay){this.$updateQueue=this.$updateQueue|HORIZONTAL|VERTICAL;
this.$updateLayout();l.queue(this.$pHtmlNode,this);if(!queueDelay){l.processQueue();
}};function visCheck(){if(this.$updateQueue){this.$updateLayout();apf.layout.activateRules(this.$ext.parentNode);
}}this.$updateLayout=function(){if(!this.$anchoringEnabled){return;}if(!apf.window.vManager.check(this,"anchoring",visCheck)){return;
}if(!this.$parsed){if(!this.$ext.getAttribute("id")){apf.setUniqueHtmlId(this.$ext);
}this.$rule_header=getRuleHeader.call(this);this.$parsed=true;}if(!this.$updateQueue){if(this.visible&&this.$ext.style.display=="none"){this.$ext.style.display="";
}return;}if(this.draggable=="relative"){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";
}}else{if(this.left||this.left===0||this.top||this.top===0||this.right||this.right===0||this.bottom||this.bottom===0||this.$anchors.length){if("absolute|fixed".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";
}}else{if(!this.center){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="relative";
}if(!this.width){this.$ext.style.width="";}if(!this.height){this.$ext.style.height="";
}}}}var rules;if(this.$updateQueue&HORIZONTAL){rules=[];this.$hordiff=apf.getWidthDiff(this.$ext);
var left=this.$anchors[3]||this.left,right=this.$anchors[1]||this.right,width=this.width,hasLeft=left||left===0,hasRight=right||right===0,hasWidth=width||width===0;
if(right&&typeof right=="string"){right=setPercentage(right,"pWidth");}if(hasLeft){if(parseInt(left)!=left){left=setPercentage(left,"pWidth");
rules.push("oHtml.style.left = ("+left+") + 'px'");}else{this.$ext.style.left=left+"px";
}}if((apf.hasStyleAnchors||!hasLeft)&&hasRight){if(parseInt(right)!=right){right=setPercentage(right,"pWidth");
rules.push("oHtml.style.right = ("+right+") + 'px'");}else{this.$ext.style.right=right+"px";
}}if(hasLeft&&hasRight){if(!apf.hasStyleAnchors){rules.push("oHtml.style.width = (pWidth - ("+right+") - ("+left+") - "+this.$hordiff+") + 'px'");
}else{this.$ext.style.width="";}}else{if(hasWidth&&typeof this.maxwidth=="number"&&typeof this.minwidth=="number"){if(parseInt(width)!=width){width=setPercentage(width,"pWidth");
rules.push("oHtml.style.width = Math.max("+(this.minwidth-this.$hordiff)+", Math.min("+(this.maxwidth-this.$hordiff)+", "+width+" - "+this.$hordiff+")) + 'px'");
}else{this.$ext.style.width=((width>this.minwidth?(width<this.maxwidth?width:this.maxwidth):this.minwidth)-this.$hordiff)+"px";
}}}this.$rule_h=(rules.length?"try{"+rules.join(";}catch(e){};try{")+";}catch(e){};":"");
}if(this.$updateQueue&VERTICAL){rules=[];this.$verdiff=apf.getHeightDiff(this.$ext);
var top=this.$anchors[0]||this.top,bottom=this.$anchors[2]||this.bottom,height=this.height,hasTop=top||top===0,hasBottom=bottom||bottom===0,hasHeight=height||height===0;
if(bottom&&typeof bottom=="string"){bottom=setPercentage(bottom,"pHeight");}if(hasTop){if(parseInt(top)!=top){top=setPercentage(top,"pHeight");
rules.push("oHtml.style.top = ("+top+") + 'px'");}else{this.$ext.style.top=top+"px";
}}if((apf.hasStyleAnchors||!hasTop)&&hasBottom){if(parseInt(bottom)!=bottom){rules.push("oHtml.style.bottom = ("+bottom+") + 'px'");
}else{this.$ext.style.bottom=bottom+"px";}}if(hasTop&&hasBottom){if(!apf.hasStyleAnchors){rules.push("oHtml.style.height = (pHeight - ("+bottom+") - ("+top+") - "+this.$verdiff+") + 'px'");
}else{this.$ext.style.height="";}}else{if(hasHeight&&typeof this.minheight=="number"){if(parseInt(height)!=height){height=setPercentage(height,"pHeight");
rules.push("oHtml.style.height = Math.max("+(this.minheight-this.$verdiff)+", Math.min("+(this.maxheight-this.$verdiff)+", "+height+" - "+this.$verdiff+")) + 'px'");
}else{this.$ext.style.height=Math.max(0,(height>this.minheight?(height<this.maxheight?height:this.maxheight):this.minheight)-this.$verdiff)+"px";
}}}this.$rule_v=(rules.length?"try{"+rules.join(";}catch(e){};try{")+";}catch(e){};":"");
}if(this.$rule_v||this.$rule_h){l.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h,true);
}else{l.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");}this.$updateQueue=0;
if(this.$box&&!apf.hasFlexibleBox){apf.layout.forceResize(this.$ext);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){});
this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$disableAnchoring();
});};apf.__CONTENTEDITABLE__=1<<24;apf.__GUIELEMENT__=1<<15;apf.__VALIDATION__=1<<6;
apf.GuiElement=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__GUIELEMENT__;
this.$focussable=apf.KEYBOARD_MOUSE;this.visible=2;this.$booleanProperties["disable-keyboard"]=true;
this.$booleanProperties.visible=true;this.$booleanProperties.focussable=true;this.$supportedProperties.push("draggable","resizable");
this.$supportedProperties.push("focussable","zindex","disabled","tabindex","disable-keyboard","contextmenu","visible","autosize","loadaml","actiontracker","alias","width","left","top","height","tooltip");
this.$setLayout=function(type,insert){if(!this.$drawn||!this.$pHtmlNode){return false;
}if(this.parentNode){if(this.parentNode.localName=="table"){if(this.$disableCurrentLayout){this.$disableCurrentLayout();
}this.parentNode.register(this,insert);this.$disableCurrentLayout=null;return type=="table";
}else{if("vbox|hbox".indexOf(this.parentNode.localName)>-1){if(this.$disableCurrentLayout){this.$disableCurrentLayout();
}this.parentNode.register(this,insert);this.$disableCurrentLayout=null;return type==this.parentNode.localName;
}}}if(!this.$anchoringEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();
}this.$enableAnchoring();this.$disableCurrentLayout=this.$disableAnchoring;}return type=="anchoring";
};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this&&"vbox|hbox|table".indexOf(this.parentNode.localName)==-1){this.$setLayout();
}});this.implement(apf.Anchoring);this.setWidth=function(value){this.setProperty("width",value,false,true);
return this;};this.setHeight=function(value){this.setProperty("height",value,false,true);
return this;};this.setLeft=function(value){this.setProperty("left",value,false,true);
return this;};this.setTop=function(value){this.setProperty("top",value,false,true);
return this;};if(!this.show){this.show=function(){this.setProperty("visible",true,false,true);
return this;};}if(!this.hide){this.hide=function(){this.setProperty("visible",false,false,true);
return this;};}this.getWidth=function(){return(this.$ext||{}).offsetWidth;};this.getHeight=function(){return(this.$ext||{}).offsetHeight;
};this.getLeft=function(){return(this.$ext||{}).offsetLeft;};this.getTop=function(){return(this.$ext||{}).offsetTop;
};this.enable=function(){this.setProperty("disabled",false,false,true);return this;
};this.disable=function(){this.setProperty("disabled",true,false,true);return this;
};this.sendToBack=function(){this.setProperty("zindex",0,false,true);return this;
};this.bringToFront=function(){this.setProperty("zindex",apf.all.length+1,false,true);
return this;};this.sendBackwards=function(){this.setProperty("zindex",this.zindex-1,false,true);
return this;};this.bringForward=function(){this.setProperty("zindex",this.zindex+1,false,true);
return this;};this.hasFocus=function(){};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var x=this.$aml;
if(this.parentNode){if(this.localName=="item"&&this.parentNode.hasFeature(apf.__MULTISELECT__)){this.$pHtmlNode=this.parentNode.$container;
}else{this.$pHtmlNode=this.parentNode.$int;}}if(!this.$pHtmlNode){return;}this.$pHtmlDoc=this.$pHtmlNode.ownerDocument||document;
if(this.$initSkin){this.$initSkin(x);}if(this.$draw){this.$draw();}if(e.id){this.$ext.setAttribute("id",e.id);
}if(typeof this.visible=="undefined"){this.visible=true;}if(this.$focussable&&typeof this.focussable=="undefined"){apf.GuiElement.propHandlers.focussable.call(this);
}this.$drawn=true;},true);var f=function(e){if(!this.$pHtmlNode){return;}this.$setLayout();
if(this.$ext){var hasPres=(this.hasFeature(apf.__PRESENTATION__))||false;var type=this.$isLeechingSkin?this.localName:"main";
if(this.minwidth==undefined){this.minwidth=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"minwidth")),0);
}if(this.minheight==undefined){this.minheight=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"minheight")),0);
}if(this.maxwidth==undefined){this.maxwidth=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"maxwidth")),10000);
}if(this.maxheight==undefined){this.maxheight=apf.getCoord(hasPres&&parseInt(this.$getOption(type,"maxheight")),10000);
}var diff=apf.getDiff(this.$ext);this.$ext.style.minWidth=Math.max(0,this.minwidth-diff[0])+"px";
this.$ext.style.minHeight=Math.max(0,this.minheight-diff[1])+"px";this.$ext.style.maxWidth=Math.max(0,this.maxwidth-diff[0])+"px";
this.$ext.style.maxHeight=Math.max(0,this.maxheight-diff[1])+"px";if(this.$altExt&&apf.isGecko){this.$altExt.style.minHeight=this.$ext.style.minHeight;
this.$altExt.style.maxHeight=this.$ext.style.maxHeight;this.$altExt.style.minWidth=this.$ext.style.minWidth;
this.$altExt.style.maxWidth=this.$ext.style.maxWidth;}}if(this.$loadAml){this.$loadAml(this.$aml);
}};this.addEventListener("DOMNodeInsertedIntoDocument",f);this.addEventListener("$skinchange",f);
var f;this.addEventListener("$event.resize",f=function(c){apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.dispatchEvent('resize');",true);
apf.layout.queue(this.$ext);this.removeEventListener("$event.resize",f);});this.addEventListener("contextmenu",function(e){if(!this.contextmenus){return;
}if(this.hasFeature(apf.__DATABINDING__)){var contextmenu;var xmlNode=this.hasFeature(apf.__MULTISELECT__)?this.selected:this.xmlRoot;
var i,l,m,isRef,sel,menuId,cm,result;for(i=0,l=this.contextmenus.length;i<l;i++){isRef=(typeof(cm=this.contextmenus[i])=="string");
result=null;if(!isRef&&cm.match&&xmlNode){result=(cm.cmatch||(cm.cmatch=apf.lm.compile(cm.match,{xpathmode:3,injectself:true})))(xmlNode);
}if(isRef||xmlNode&&result||!cm.match){menuId=isRef?cm:cm.menu;if(!self[menuId]){return;
}self[menuId].display(e.x,e.y,null,this,xmlNode);e.returnValue=false;e.cancelBubble=true;
break;}}}else{menuId=typeof this.contextmenus[0]=="string"?this.contextmenus[0]:this.contextmenus[0].getAttribute("menu");
if(!self[menuId]){return;}self[menuId].display(e.x,e.y,null,this);e.returnValue=false;
e.cancelBubble=true;}});}).call(apf.GuiElement.prototype=new apf.AmlElement());
apf.GuiElement.propHandlers={focussable:function(value){this.focussable=typeof value=="undefined"||value;
if(!this.hasFeature(apf.__FOCUSSABLE__)){this.implement(apf.Focussable);}if(this.focussable){apf.window.$addFocus(this,this.tabindex);
}else{apf.window.$removeFocus(this);}},zindex:function(value){this.$ext.style.zIndex=value;
},visible:function(value){if(apf.isFalse(value)||typeof value=="undefined"){if(this.$ext){this.$ext.style.display="none";
}if(apf.document.activeElement==this||this.canHaveChildren==2&&apf.isChildOf(this,apf.document.activeElement,false)){if(apf.config.allowBlur&&this.hasFeature(apf.__FOCUSSABLE__)){this.blur();
}else{apf.window.moveNext();}}this.visible=false;}else{if(this.$ext){this.$ext.style.display="";
if(!this.$ext.offsetHeight){this.$ext.style.display=this.$display||"block";}}if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);
}this.visible=true;}},disabled:function(value){if(!this.$drawn){var _self=this;
apf.queue.add("disable"+this.$uniqueId,function(e){_self.disabled=value;apf.GuiElement.propHandlers.disabled.call(_self,value);
});return;}else{apf.queue.remove("disable"+this.$uniqueId);}if(this.canHaveChildren){if(value!=-1){value=this.disabled=apf.isTrue(value);
}var nodes=this.childNodes;for(var node,i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.nodeFunc==apf.NODE_VISIBLE){if(value&&node.disabled!=-1){node.$disabled=node.disabled||false;
}node.setProperty("disabled",value?-1:false);}}if(this.$isWindowContainer){return;
}}if(value==-1||value==false){}else{if(typeof this.$disabled=="boolean"){if(value===null){value=this.$disabled;
this.$disabled=null;}else{this.$disabled=value||false;return;}}}if(apf.isTrue(value)||value==-1){this.disabled=false;
if(apf.document.activeElement==this){apf.window.moveNext(true);if(apf.document.activeElement==this){this.$blur();
}}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,this.$baseCSSname+"Disabled");
}if(this.$disable){this.$disable();}this.disabled=value;}else{if(this.hasFeature(apf.__DATABINDING__)&&apf.config.autoDisable&&!(!this.$bindings||this.xmlRoot)){return false;
}this.disabled=false;if(apf.document.activeElement==this){this.$focus();}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,null,[this.$baseCSSname+"Disabled"]);
}if(this.$enable){this.$enable();}}},enabled:function(value){this.setProperty("disabled",!value);
},"disable-keyboard":function(value){this.disableKeyboard=apf.isTrue(value);},tooltip:function(value){this.$ext.setAttribute("title",value+(this.hotkey?" ("+this.hotkey+")":""));
},contextmenu:function(value){this.contextmenus=[value];},actiontracker:function(value){if(!value){this.$at=null;
}else{if(value.localName=="actiontracker"){this.$at=value;}else{this.$at=typeof value=="string"&&self[value]?apf.nameserver.get("actiontracker",value)||self[value].getActionTracker():apf.setReference(value,apf.nameserver.register("actiontracker",value,new apf.actiontracker()));
if(!this.$at.name){this.$at.name=value;}}}},aml:function(value){this.replaceMarkup(value);
}};apf.__PRESENTATION__=1<<9;apf.Presentation=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__PRESENTATION__;
this.$supportedProperties.push("skin");this.$propHandlers.skinset=this.$propHandlers.skin=function(value){if(!this.$amlLoaded){return;
}if(!this.$skinTimer){var _self=this;clearTimeout(this.$skinTimer);this.$skinTimer=$setTimeout(function(){changeSkin.call(_self,_self.skin);
delete _self.$skinTimer;});}};this.$propHandlers.style=function(value){if(!this.styleAttrIsObj&&this.$amlLoaded){this.$ext.setAttribute("style",value);
}};this.$propHandlers.border=function(value){if(!value){this.$ext.style.borderWidth="";
}else{this.$ext.style.borderWidth=apf.getBox(value).join("px ")+"px";}};this.$propHandlers.margin=function(value){if(!value){this.$ext.style.margin="";
}else{this.$ext.style.margin=apf.getBox(value).join("px ")+"px";}};this.$propHandlers["class"]=function(value){this.$setStyleClass(this.$ext,value,this.$lastClassValue?[this.$lastClassValue]:null);
this.$lastClassValue=value;};this.$forceSkinChange=function(skin,skinset){changeSkin.call(this,skin,skinset);
};function changeSkin(skin,skinset){clearTimeout(this.$skinTimer);if(this.selectable){var valueList=this.getSelection();
}var oExt=this.$ext,oInt=this.$int,pNode=this.$ext.parentNode,beforeNode=oExt.nextSibling,idExt=this.$ext.getAttribute("id"),idInt=this.$int&&this.$int.getAttribute("id"),oldBase=this.$baseCSSname;
if(oExt.parentNode){oExt.parentNode.removeChild(oExt);}if(this.$destroy){this.$destroy(true);
}this.skin=skin;this.$loadSkin(skinset?skinset+":"+skin:null);if(this.$draw){this.$draw(true);
}if(idExt){this.$ext.setAttribute("id",idExt);}if(beforeNode||pNode!=this.$ext.parentNode){pNode.insertBefore(this.$ext,beforeNode);
}var i,l,newclasses=[],classes=(oExt.className||"").splitSafe("\\s+");for(i=0;i<classes.length;
i++){if(classes[i]&&classes[i].indexOf(oldBase)!=0){newclasses.push(classes[i].replace(oldBase,this.$baseCSSname));
}}apf.setStyleClass(this.$ext,newclasses.join(" "));var en,ev=apf.skins.events;
for(i=0,l=ev.length;i<l;i++){en=ev[i];if(typeof oExt[en]=="function"&&!this.$ext[en]){this.$ext[en]=oExt[en];
}}this.$ext.style.left=oExt.style.left;this.$ext.style.top=oExt.style.top;this.$ext.style.width=oExt.style.width;
this.$ext.style.height=oExt.style.height;this.$ext.style.right=oExt.style.right;
this.$ext.style.bottom=oExt.style.bottom;this.$ext.style.zIndex=oExt.style.zIndex;
this.$ext.style.position=oExt.style.position;this.$ext.style.display=oExt.style.display;
if(idInt){this.$int.setAttribute("id",idInt);}if(this.$int&&this.$int!=oInt){var node,newNode=this.$int,nodes=oInt.childNodes;
for(var i=nodes.length-1;i>=0;i--){if((node=nodes[i]).host){node.host.$pHtmlNode=newNode;
if(node.host.$isLeechingSkin){setLeechedSkin.call(node.host);}}newNode.insertBefore(node,newNode.firstChild);
}}if(this.hasFeature(apf.__DRAGDROP__)){if(document.elementFromPointAdd){document.elementFromPointRemove(oExt);
document.elementFromPointAdd(this.$ext);}}if(this.disabled){this.$disable();}if(this.$focussable&&apf.document.activeElement==this){this.$focus();
}this.dispatchEvent("$skinchange",{ext:oExt,"int":oInt});if(this.hasFeature(apf.__DATABINDING__)&&this.xmlRoot){this.reload();
}else{if(this.value){this.$propHandlers.value.call(this,this.value);}}if(this.hasFeature(apf.__MULTISELECT__)){if(this.selectable){this.selectList(valueList,true);
}}if(!apf.hasSingleRszEvent){apf.layout.activateRules(this.$ext);if(this.$int){apf.layout.activateRules(this.$int);
}}if(this.draggable&&this.$propHandlers.draggable){this.$propHandlers.draggable.call(this,this.draggable);
}if(this.resizable&&this.$propHandlers.resizable){this.$propHandlers.resizable.call(this,this.resizable);
}apf.layout.forceResize(this.$ext);}this.$setStyleClass=apf.setStyleClass;function setLeechedSkin(e){if(!this.$amlLoaded||e&&(e.$isMoveWithinParent||e.currentTarget!=this||!e.$oldParent)){return;
}this.$setInheritedAttribute(this,"skinset");if(this.attributes.getNamedItem("skin")){return;
}var skinName,pNode=this.parentNode,skinNode;if((skinName=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&pNode.$originalNodes&&(skinNode=pNode.$originalNodes[skinName])&&skinNode.getAttribute("inherit")){var link=skinNode.getAttribute("link");
this.$isLeechingSkin=true;if(link){this.$forceSkinChange(link);}else{var skin=pNode.skinName.split(":");
this.$forceSkinChange(skin[1],skin[0]);}}else{if(this.$isLeechingSkin){delete this.skin;
this.$isLeechingSkin=false;this.$forceSkinChange();}}}this.$initSkin=function(x){if(this.$canLeechSkin){this.addEventListener("DOMNodeInserted",setLeechedSkin);
}if(!this.skin){this.skin=this.getAttribute("skin");}var skinName,pNode=this.parentNode,skinNode;
if(this.$canLeechSkin&&!this.skin&&(skinName=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&pNode.$originalNodes&&(skinNode=pNode.$originalNodes[skinName])&&skinNode.getAttribute("inherit")){var link=skinNode.getAttribute("link");
this.$isLeechingSkin=true;if(link){this.skin=link;this.$loadSkin();}else{this.$loadSkin(pNode.skinName);
}}else{if(!this.skinset){this.skinset=this.getAttribute("skinset");}this.$loadSkin(null,this.$canLeechSkin);
}};this.$loadSkin=function(skinName,noError){this.baseSkin=skinName||(this.skinset||this.$setInheritedAttribute("skinset"))+":"+(this.skin||this.localName);
clearTimeout(this.$skinTimer);if(this.skinName){this.$blur();this.$baseCSSname=null;
}this.skinName=this.baseSkin;this.$pNodes={};this.$originalNodes=apf.skins.getTemplate(this.skinName,true);
if(!this.$originalNodes){var skin=this.skin;if(skin){var skinset=this.skinName.split(":")[0];
this.baseName=this.skinName="default:"+skin;this.$originalNodes=apf.skins.getTemplate(this.skinName);
if(!this.$originalNodes&&skinset!="default"){this.baseName=this.skinName=skinset+":"+this.localName;
this.$originalNodes=apf.skins.getTemplate(this.skinName,true);}}if(!this.$originalNodes){this.baseName=this.skinName="default:"+this.localName;
this.$originalNodes=apf.skins.getTemplate(this.skinName);}if(!this.$originalNodes){if(noError){return(this.baseName=this.skinName=this.originalNode=null);
}throw new Error(apf.formatErrorString(1077,this,"Presentation","Could not load skin: "+this.baseSkin));
}}if(this.$originalNodes){apf.skins.setSkinPaths(this.skinName,this);}};this.$getNewContext=function(type,amlNode){this.$pNodes[type]=this.$originalNodes[type].cloneNode(true);
};this.$hasLayoutNode=function(type){return this.$originalNodes[type]?true:false;
};this.$getLayoutNode=function(type,section,htmlNode){var node=this.$pNodes[type]||this.$originalNodes[type];
if(!node){return false;}if(!section){return htmlNode||apf.getFirstElement(node);
}var textNode=node.getAttribute(section);if(!textNode){return null;}return(htmlNode?apf.queryNode(htmlNode,textNode):apf.getFirstElement(node).selectSingleNode(textNode));
};this.$getOption=function(type,section){type=type.toLowerCase();var node=this.$pNodes[type]||this.$originalNodes[type];
if(!section||!node){return node;}var option=node.selectSingleNode("@"+section);
return option?option.nodeValue:"";};this.$getExternal=function(tag,pNode,func,aml){if(!pNode){pNode=this.$pHtmlNode;
}if(!tag){tag="main";}tag=tag.toLowerCase();this.$getNewContext(tag);var oExt=this.$getLayoutNode(tag);
var node;if(node=(aml||this).getAttributeNode("style")){oExt.setAttribute("style",node.nodeValue);
}if(func){func.call(this,oExt);}oExt=apf.insertHtmlNode(oExt,pNode);oExt.host=this;
if(node=(aml||this).getAttributeNode("bgimage")){oExt.style.backgroundImage="url("+apf.getAbsolutePath(this.mediaPath,node.nodeValue)+")";
}if(!this.$baseCSSname){this.$baseCSSname=oExt.className.trim().split(" ")[0];}return oExt;
};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");
};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext){return;
}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$fixScrollBug=function(){if(this.$int!=this.$ext){this.oFocus=this.$int;
}else{this.oFocus=this.$int=this.$ext.appendChild(document.createElement("div"));
this.$int.style.height="100%";this.$int.className="focusbug";}};}).call(apf.Presentation.prototype=new apf.GuiElement());
apf.config.$inheritProperties.skinset=1;apf.__VALIDATION__=1<<6;apf.validator={macro:{datatype:"apf.xsd.matchType(value, '",datatype_:"')",pattern:"value.match(",pattern_:")",custom:"(",custom_:")",min:"parseInt(value) >= ",max:"parseInt(value) <= ",maxlength:"value.toString().length <= ",minlength:"value.toString().length >= ",notnull:"value.toString().length > 0",checkequal:"!(temp = ",checkequal_:").isValid() || temp.getValue() == value"},compile:function(options){var m=this.macro,s=["var temp, valid = true;             if (!validityState)                 validityState = new apf.validator.validityState(); "];
if(options.required){s.push("if (checkRequired && (!value || value.toString().trim().length == 0)) {                validityState.$reset();                validityState.valueMissing = true;                valid = false;            }");
}s.push("validityState.$reset();            if (value) {");for(prop in options){if(!m[prop]){continue;
}s.push("if (!(",m[prop],options[prop],m[prop+"_"]||"",")){                validityState.$set('",prop,"');                valid = false;            }");
}s.push("};validityState.valid = valid; return validityState;");return new Function("value","checkRequired","validityState",s.join(""));
}};apf.validator.validityState=function(){this.valueMissing=false,this.typeMismatch=false,this.patternMismatch=false,this.tooLong=false,this.rangeUnderflow=false,this.rangeOverflow=false,this.stepMismatch=false,this.customError=false,this.valid=true,this.$reset=function(){for(var prop in this){if(prop.substr(0,1)=="$"){continue;
}this[prop]=false;}this.valid=true;},this.$set=function(type){switch(type){case"min":this.rangeUnderflow=true;
break;case"max":this.rangeOverflow=true;break;case"minlength":this.tooShort=true;
break;case"maxlength":this.tooLong=true;break;case"pattern":this.patternMismatch=true;
break;case"datatype":this.typeMismatch=true;break;case"notnull":this.typeMismatch=true;
break;case"checkequal":this.typeMismatch=true;break;}};};apf.Validation=function(){this.$regbase=this.$regbase|apf.__VALIDATION__;
this.isValid=function(checkRequired){if(!this.$vOptions){return true;}(this.$vOptions.isValid||(this.$vOptions.isValid=apf.validator.compile(this.$vOptions))).call(this,typeof this.getValue=="function"?this.getValue(null,true):null,checkRequired,this.validityState||(this.validityState=new apf.validator.validityState()));
var valid=this.validityState.valid;this.dispatchEvent(!valid?"invalid":"valid",this.validityState);
return valid;};this.setCustomValidity=function(message){};this.showMe=function(){var p=this.parentNode;
while(p){if(p.show){p.show();}p=p.parentNode;}};this.checkValidity=this.validate=function(ignoreReq,nosetError,force){if(force||!this.isValid(!ignoreReq)&&!nosetError){this.setError();
return false;}else{this.clearError();return true;}};this.setError=function(value){if(!this.$validgroup){this.$propHandlers.validgroup.call(this,"vg"+this.parentNode.$uniqueId);
}var errBox=this.$validgroup.getErrorBox(this);if(!this.$validgroup.allowMultipleErrors){this.$validgroup.hideAllErrors();
}errBox.setMessage(this.invalidmsg||value);apf.setStyleClass(this.$ext,this.$baseCSSname+"Error");
this.showMe();if(this.invalidmsg||value){errBox.display(this);}if(this.hasFeature(apf.__MULTISELECT__)&&this.validityState.$errorXml){this.select(this.validityState.$errorXml);
}if(apf.document.activeElement&&apf.document.activeElement!=this){this.focus(null,{mouse:true});
}};this.clearError=function(value){if(this.$setStyleClass){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Error"]);
}if(this.$validgroup){var errBox=this.$validgroup.getErrorBox(null,true);if(!errBox||errBox.host!=this){return;
}errBox.hide();}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){if(this.$validgroup){this.$validgroup.unregister(this);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.validgroup){this.$setInheritedAttribute("validgroup");
}});this.$attrExcludePropBind=apf.extend({pattern:1,validtest:3},this.$attrExcludePropBind);
this.$booleanProperties.required=true;this.$supportedProperties.push("validgroup","required","datatype","pattern","min","max","maxlength","minlength","validtest","notnull","checkequal","invalidmsg","requiredmsg");
this.$fValidate=function(){if(this.liveedit){return;}if(!this.$validgroup){this.validate(true);
}else{var errBox=this.$validgroup.getErrorBox(this);if(!errBox.visible||errBox.host!=this){this.validate(true);
}}};this.addEventListener("blur",this.$fValidate);this.$propHandlers.validgroup=function(value){if(value){var vgroup;
if(typeof value!="string"){this.$validgroup=value.name;vgroup=value;}else{vgroup=apf.nameserver.get("validgroup",value);
}this.$validgroup=vgroup||new apf.ValidationGroup(value);this.$validgroup.register(this);
}else{this.$validgroup.unregister(this);this.$validgroup=null;}};this.$propHandlers.pattern=function(value,prop){if(value.substr(0,1)!="/"){value="/"+value+"/";
}(this.$vOptions||(this.$vOptions={}))[prop]=value;delete this.$vOptions.isValid;
};this.$propHandlers.datatype=this.$propHandlers.required=this.$propHandlers.custom=this.$propHandlers.min=this.$propHandlers.max=this.$propHandlers.maxlength=this.$propHandlers.minlength=this.$propHandlers.notnull=this.$propHandlers.checkequal=function(value,prop){(this.$vOptions||(this.$vOptions={}))[prop]=value;
delete this.$vOptions.isValid;};this.$propHandlers.validtest=function(value){var _self=this,rvCache={};
this.removeValidationCache=function(){rvCache={};};this.$checkRemoteValidation=function(){var value=this.getValue();
if(typeof rvCache[value]=="boolean"){return rvCache[value];}if(rvCache[value]==-1){return true;
}rvCache[value]=-1;apf.getData(this.validtest.toString(),{xmlNode:this.xmlRoot,value:this.getValue(),callback:function(data,state,extra){if(state!=apf.SUCCESS){if(state==apf.TIMEOUT&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}else{var commError=new Error(apf.formatErrorString(0,_self,"Validating entry at remote source","Communication error: \n\n"+extra.message));
if(_self.dispatchEvent("error",apf.extend({error:commError,state:status},extra))!==false){throw commError;
}return;}}rvCache[value]=apf.isTrue(data);if(!rvCache[value]){if(!_self.hasFocus()){_self.setError();
}}else{_self.clearError();}}});return true;};(this.$vOptions||(this.$vOptions={})).custom="apf.lookup("+this.$uniqueId+").$checkRemoteValidation()";
delete this.$vOptions.isValid;};};apf.GuiElement.propHandlers.datatype=apf.GuiElement.propHandlers.required=apf.GuiElement.propHandlers.pattern=apf.GuiElement.propHandlers.min=apf.GuiElement.propHandlers.max=apf.GuiElement.propHandlers.maxlength=apf.GuiElement.propHandlers.minlength=apf.GuiElement.propHandlers.notnull=apf.GuiElement.propHandlers.checkequal=apf.GuiElement.propHandlers.validtest=function(value,prop){this.implement(apf.Validation);
this.$propHandlers[prop].call(this,value,prop);};apf.ValidationGroup=function(name){this.$init();
this.childNodes=[];if(name){apf.setReference(name,this);}this.name=name||"validgroup"+this.$uniqueId;
apf.nameserver.register("validgroup",this.name,this);};(function(){this.validateVisibleOnly=false;
this.allowMultipleErrors=false;this.register=function(o){if(o.hasFeature(apf.__VALIDATION__)){this.childNodes.push(o);
}};this.unregister=function(o){this.childNodes.remove(o);};this.toString=function(){return"[APF Validation Group]";
};var errbox;this.getErrorBox=function(o,no_create){if(this.allowMultipleErrors||!errbox&&!no_create){errbox=new apf.errorbox();
errbox.$pHtmlNode=o.$ext.parentNode;errbox.skinset=apf.getInheritedAttribute(o.parentNode,"skinset");
errbox.dispatchEvent("DOMNodeInsertedIntoDocument");}return errbox;};this.hideAllErrors=function(){if(errbox&&errbox.host){errbox.host.clearError();
}};function checkValidChildren(oParent,ignoreReq,nosetError){var found;for(var v,i=0;
i<oParent.childNodes.length;i++){var oEl=oParent.childNodes[i];if(!oEl){continue;
}if(!oEl.disabled&&(!this.validateVisibleOnly&&oEl.visible||!oEl.$ext||oEl.$ext.offsetHeight)&&(oEl.hasFeature(apf.__VALIDATION__)&&oEl.isValid&&!oEl.isValid(!ignoreReq))){if(!nosetError){if(!found){oEl.validate(true,null,true);
found=true;if(!this.allowMultipleErrors){return true;}}else{if(oEl.errBox&&oEl.errBox.host==oEl){oEl.errBox.hide();
}}}else{if(!this.allowMultipleErrors){return true;}}}if(oEl.canHaveChildren&&oEl.childNodes.length){found=checkValidChildren.call(this,oEl,ignoreReq,nosetError)||found;
if(found&&!this.allowMultipleErrors){return true;}}}return found;}this.checkValidity=this.validate=this.isValid=function(ignoreReq,nosetError,page){var found=checkValidChildren.call(this,page||this,ignoreReq,nosetError);
if(page){if(page.validation&&!eval(page.validation)){alert(page.invalidmsg);found=true;
}}return !found;};}).call(apf.ValidationGroup.prototype=new apf.Class());apf.config.$inheritProperties.validgroup=1;
apf.__DATABINDING__=1<<1;apf.DataBinding=function(){this.$init(true);this.$loadqueue=this.$dbTimer=null;
this.$regbase=this.$regbase|apf.__DATABINDING__;this.$mainBind="value";this.$bindings=this.$cbindings=this.$attrBindings=false;
this.$attrExcludePropBind=apf.extend({model:1,each:1},this.$attrExcludePropBind);
this.setQueryValue=function(xpath,value,type){var node=apf.createNodeFromXpath(this[type||"xmlRoot"],xpath);
if(!node){return null;}apf.setNodeValue(node,value,true);return node;};this.queryValue=function(xpath,type){return apf.queryValue(this[type||"xmlRoot"],xpath);
};this.queryValues=function(xpath,type){return apf.queryValues(this[type||"xmlRoot"],xpath);
};this.queryNode=function(xpath,type){var n=this[type||"xmlRoot"];return n?n.selectSingleNode(xpath):null;
};this.queryNodes=function(xpath,type){var n=this[type||"xmlRoot"];return n?n.selectNodes(xpath):[];
};this.$checkLoadQueue=function(){if(this.$loadqueue){if(!this.caching){this.xmlRoot=null;
}var q=this.load(this.$loadqueue[0],{cacheId:this.$loadqueue[1]});if(!q||q.dataType!=apf.ARRAY||q!=this.$loadqueue){this.$loadqueue=null;
}}else{return false;}};this.$execProperty=function(prop,xmlNode,undoObj){var attr=this.$attrBindings[prop];
if(this.nodeType==7){if(xmlNode!=this.xmlRoot){this.xmlRoot=xmlNode;}}try{if(attr.cvalue.asyncs){var _self=this;
return attr.cvalue.call(this,xmlNode,function(value){_self.setProperty(prop,value,true);
});}else{var value=attr.cvalue.call(this,xmlNode);}}catch(e){apf.console.warn("[400] Could not execute binding for property "+prop+"\n\n"+e.message);
return;}this.setProperty(prop,undoObj&&undoObj.extra.range||value,true);};this.$applyBindRule=function(name,xmlNode,defaultValue,callback,oHtml){var handler=this.$attrBindings[name]&&this.$attrBindings[name].cvalue||this.$cbindings[name];
return handler?handler.call(this,xmlNode,callback):defaultValue||"";};this.addEventListener("$clear",function(){var queue;
if(!this.$amlBindQueue||!(queue=this.$amlBindQueue.caption)){return;}for(var id in queue){var lm=queue[id];
if(lm.destroy){lm.parentNode=lm.$focusParent=lm.$model=lm.xmlRoot=null;lm.destroy();
}delete queue[id];}});var afterloadUpdate;this.addEventListener("afterload",afterloadUpdate=function(){var queue;
if(!this.$amlBindQueue||!(queue=this.$amlBindQueue.caption||this.$amlBindQueue.column)){return;
}var div,doc=this.ownerDocument;for(var lm,i=0,l=queue.length;i<l;i++){if(!queue[i]){continue;
}div=document.getElementById("placeholder_"+this.$uniqueId+"_"+i);lm=doc.createProcessingInstruction("lm",this.$cbindings.caption||this.$cbindings.column);
lm.$model=this.$model;lm.xmlRoot=queue[i];lm.$noInitModel=true;lm.$focusParent=this;
lm.parentNode=this;lm.dispatchEvent("DOMNodeInsertedIntoDocument",{pHtmlNode:div});
queue[lm.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)]=lm;delete queue[i];}queue.length=0;
});this.addEventListener("xmlupdate",function(e){if(e.xmlNode!=e.traverseNode){return;
}if("insert|add|synchronize|move".indexOf(e.action)>-1){afterloadUpdate.call(this,e);
}else{if("remove|move-away".indexOf(e.action)>-1){var queue;if(!this.$amlBindQueue||!(queue=this.$amlBindQueue.caption)){return;
}var lm=queue[e.xmlNode.getAttribute(apf.xmldb.xmlIdTag)];lm.parentNode=lm.$focusParent=lm.$model=lm.xmlRoot=null;
lm.destroy();}}});this.$hasBindRule=function(name){return this.$attrBindings[name]||this.$bindings&&this.$bindings[name];
};this.$getBindRule=function(name,xmlNode){return this.$attrBindings[name]||this.$bindings&&this.$bindings.getRule(name,xmlNode);
};var ruleIsMatch={drag:1,drop:1,dragcopy:1};this.$getDataNode=function(name,xmlNode,createNode,ruleList,multiple){var node,rule=this.$attrBindings[name];
if(rule){if(rule.cvalue.type!=3){return false;}var func=rule.cvalue2||rule.compile("value",{xpathmode:multiple?4:3,parsecode:1,injectself:ruleIsMatch[name]});
if(func&&(node=func(xmlNode,createNode))){if(ruleList){ruleList.push(rule);}return node;
}return false;}return this.$bindings&&this.$bindings.getDataNode(name,xmlNode,createNode,ruleList,multiple);
};this.setModel=function(model){this.setAttribute("model",model,false,true);};this.getModel=function(doRecur){if(doRecur&&!this.$model){return this.dataParent?this.dataParent.parent.getModel(true):null;
}return this.$model;};this.reload=this.reload||function(){this.load(this.xmlRoot,{cacheId:this.cacheId,force:true});
};this.load=function(xmlNode,options){if(options){var cacheId=options.cacheId,forceNoCache=options.force,noClearMsg=options.noClearMsg;
}if(cacheId&&cacheId==this.cacheId&&!forceNoCache){return;}if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();
}if(xmlNode){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){xmlNode=apf.getXmlDom(xmlNode).documentElement;
}else{return apf.model.prototype.$loadFrom.call(this,xmlNode,options);}}else{if(xmlNode.nodeType==9){xmlNode=xmlNode.documentElement;
}else{if(xmlNode.nodeType==3||xmlNode.nodeType==4){xmlNode=xmlNode.parentNode;}else{if(xmlNode.nodeType==2){xmlNode=xmlNode.ownerElement||xmlNode.parentNode||xmlNode.selectSingleNode("..");
}}}}}if(this.$preventDataLoad||!this.$canLoadData&&((!this.$bindings&&(!this.$canLoadDataAttr||!this.each))||!this.$amlLoaded)&&(!this.hasFeature(apf.__MULTISELECT__)||!this.each)||this.$canLoadData&&!this.$canLoadData()){if(!this.caching||!this.hasFeature(apf.__CACHE__)){this.xmlRoot=xmlNode;
this.setProperty("root",this.xmlRoot);}return this.$loadqueue=[xmlNode,cacheId];
}if(this.dataParent&&this.dataParent.xpath){this.dataParent.parent.signalXmlUpdate[this.$uniqueId]=!xmlNode;
}if(!xmlNode&&(!cacheId||!this.$isCached||!this.$isCached(cacheId))){this.clear(noClearMsg);
if(apf.config.autoDisable&&this.$createModel===false){this.setProperty("disabled",true);
}return;}if(!this.caching&&!forceNoCache&&xmlNode&&!this.$loadqueue&&xmlNode==this.xmlRoot){return;
}var disabled=this.disabled;this.disabled=false;if(this.dispatchEvent("beforeload",{xmlNode:xmlNode})===false){return false;
}this.clear(true,true);this.cacheId=cacheId;if(this.dispatchEvent("$load",{forceNoCache:forceNoCache,xmlNode:xmlNode})===false){return;
}this.documentId=apf.xmldb.getXmlDocId(xmlNode);this.xmlRoot=xmlNode;this.setProperty("root",this.xmlRoot);
this.$load(xmlNode);this.$loadSubData(xmlNode);if(this.$createModel===false){this.disabled=true;
this.setProperty("disabled",false);}else{this.disabled=disabled;}this.dispatchEvent("afterload",{xmlNode:xmlNode});
};this.$loadSubData=function(xmlRootNode){if(this.$hasLoadStatus(xmlRootNode)&&!this.$hasLoadStatus(xmlRootNode,"potential")){return;
}var rule=this.$getBindRule("load",xmlRootNode);if(rule&&(!rule[1]||rule[1](xmlRootNode))){this.$setLoadStatus(xmlRootNode,"loading");
if(this.$setClearMessage){this.$setClearMessage(this["loading-message"],"loading");
}var mdl=this.getModel(true);var amlNode=this;if(mdl.$insertFrom(rule.getAttribute("get"),{xmlNode:xmlRootNode,insertPoint:xmlRootNode,amlNode:this,callback:function(){amlNode.setProperty(amlNode.hasFeature(apf.__MULTISELECT__)?"selected":"root",xmlRootNode);
}})===false){this.clear(true);if(apf.config.autoDisable){this.setProperty("disabled",true);
}}}};this.clear=function(nomsg,doEvent,fakeClear){if(!this.$container){return;}if(this.clearSelection){this.clearSelection(true);
}var lastHeight=this.$container.offsetHeight;if(this.dispatchEvent("$clear")!==false){this.$container.innerHTML="";
}if(typeof nomsg=="string"){var msgType=nomsg;nomsg=false;if(!this[msgType+"-message"]){this.$setInheritedAttribute(msgType+"-message");
}}this.$lastClearType=msgType||null;if(!nomsg&&this.$setClearMessage){this.$setClearMessage(msgType?this[msgType+"-message"]:this["empty-message"],msgType||"empty",lastHeight);
}else{if(this.$removeClearMessage){this.$removeClearMessage();}}if(!fakeClear){this.documentId=this.xmlRoot=this.cacheId=null;
}if(!nomsg){if(this.hasFeature(apf.__MULTISELECT__)){this.setProperty("length",0);
}}};this.clearMessage=function(msg){this.customMsg=msg;this.clear("custom");};this.$setLoadStatus=function(xmlNode,state,remove){var group=this.loadgroup||"default";
var re=new RegExp("\\|(\\w+)\\:"+group+":(\\d+)\\|");var loaded=xmlNode.getAttribute("a_loaded")||"";
var m;if(!remove&&(m=loaded.match(re))&&m[1]!="potential"&&m[2]!=this.$uniqueId){return;
}var ostatus=loaded.replace(re,"");if(!remove){ostatus+="|"+state+":"+group+":"+this.$uniqueId+"|";
}xmlNode.setAttribute("a_loaded",ostatus);};this.$removeLoadStatus=function(xmlNode){this.$setLoadStatus(xmlNode,null,true);
};this.$hasLoadStatus=function(xmlNode,state,unique){if(!xmlNode){return false;
}var ostatus=xmlNode.getAttribute("a_loaded");if(!ostatus){return false;}var group=this.loadgroup||"default";
var re=new RegExp("\\|"+(state||"\\w+")+":"+group+":"+(unique?this.$uniqueId:"\\d+")+"\\|");
return ostatus.match(re)?true:false;};this.insert=function(xmlNode,options){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){if(options.whitespace===false){xmlNode=xmlNode.replace(/>[\s\n\r]*</g,"><");
}xmlNode=apf.getXmlDom(xmlNode).documentElement;}else{if(!options.insertPoint){options.insertPoint=this.xmlRoot;
}return apf.model.prototype.$insertFrom.call(this,xmlNode,options);}}var insertPoint=options.insertPoint||this.xmlRoot;
if(this.dispatchEvent("beforeinsert",{xmlParentNode:insertPoint})===false){return false;
}if(typeof options.copyAttributes=="undefined"){options.copyAttributes=true;}var newNode=apf.mergeXml(xmlNode,insertPoint,options);
apf.xmldb.applyChanges("insert",insertPoint);if(this.selectable&&this.autoselect){if(this.xmlNode==newNode){this.$selectDefault(this.xmlNode);
}}else{if(this.xmlNode==newNode){this.setProperty("root",this.xmlNode);}}if(this.$hasLoadStatus(insertPoint,"loading")){this.$setLoadStatus(insertPoint,"loaded");
}this.dispatchEvent("afterinsert");};this.$booleanProperties["render-root"]=true;
this.$supportedProperties.push("empty-message","loading-message","offline-message","render-root","smartbinding","bindings","actions");
this.$propHandlers["render-root"]=function(value){this.renderRoot=value;};this.$propHandlers["empty-message"]=function(value){this["empty-message"]=value;
if(this.$updateClearMessage){this.$updateClearMessage(this["empty-message"],"empty");
}};this.$propHandlers["loading-message"]=function(value){this["loading-message"]=value;
if(this.$updateClearMessage){this.$updateClearMessage(this["loading-message"],"loading");
}};this.$propHandlers["offline-message"]=function(value){this["offline-message"]=value;
if(this.$updateClearMessage){this.$updateClearMessage(this["offline-message"],"offline");
}};this.$propHandlers.smartbinding=this.$propHandlers.actions=this.$propHandlers.bindings=function(value,prop){var local="$"+prop+"Element";
if(this[local]){this[local].unregister(this);}if(!value){return;}apf.nameserver.get(prop,value).register(this);
if(prop!="actions"&&this.$checkLoadQueue()===false&&this.$amlLoaded){1+1;}};var eachBinds={caption:1,icon:1,select:1,css:1,sort:1,drop:2,drag:2,dragcopy:2,eachvalue:1};
this.$addAttrBind=function(prop,fParsed,expression){if(fParsed.models){if(this.hasFeature(apf.__MULTISELECT__)){}}var i,xpath,modelId,model,paths=fParsed.xpaths,list={};
for(i=0;i<paths.length;i+=2){if(!list[(modelId=paths[i])]){list[modelId]=1;}else{list[modelId]++;
}}if(!this.$propsUsingMainModel){this.$propsUsingMainModel={};}var rule=(this.$attrBindings||(this.$attrBindings={}))[prop]={cvalue:fParsed,value:expression,compile:apf.BindingRule.prototype.$compile,models:[]};
delete this.$propsUsingMainModel[prop];for(xpath,i=0;i<paths.length;i+=2){modelId=paths[i];
if(list[modelId]==-1){continue;}xpath=paths[i+1];if(modelId=="#"||xpath=="#"){var m=(rule.cvalue3||(rule.cvalue3=apf.lm.compile(rule.value,{xpathmode:5})))(this.xmlRoot);
if(typeof m!="string"){model=m.model&&m.model.$isModel&&m.model;if(model){xpath=m.xpath;
}else{if(m.model){model=typeof m.model=="string"?apf.xmldb.findModel(m.model):m.model;
xpath=apf.xmlToXpath(m.model,model.data)+(m.xpath?"/"+m.xpath:"");}else{this.addEventListener("prop."+prop,function(e){var m=(rule.cvalue3||(rule.cvalue3=apf.lm.compile(rule.value,{xpathmode:5})))(this.xmlRoot);
if(m.model){this.removeEventListener("prop."+prop,arguments.callee);var _self=this;
setTimeout(function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,expression);
},10);}});continue;}}}else{model=null;}}else{model=null;}if(!model){if(modelId){model=apf.nameserver.get("model",modelId)||apf.setReference(modelId,apf.nameserver.register("model",modelId,new apf.model()));
}else{if(!this.$model&&!this.$initingModel){initModel.call(this);}model=this.$model;
if(!this.hasFeature(apf.__MULTISELECT__)&&eachBinds[prop]!=2||!eachBinds[prop]){this.$propsUsingMainModel[prop]={xpath:xpath,optimize:list[modelId]==1};
}}}if(model&&(!this.hasFeature(apf.__MULTISELECT__)&&eachBinds[prop]!=2||!eachBinds[prop])){model.$bindXmlProperty(this,prop,xpath,list[modelId]==1);
rule.models.push(model);}list[modelId]=-1;}rule.xpath=xpath;this.$canLoadDataAttr=eachBinds[prop]==1;
this.$checkLoadQueue();};this.$removeAttrBind=function(prop){var rule=this.$attrBindings[prop];
if(!rule){return;}delete this.$attrBindings[prop];delete this.$propsUsingMainModel[prop];
var models=rule.models;if(models.length){for(var i=0;i<models.length;i++){models[i].$unbindXmlProperty(this,prop);
}}else{if(this.$model){this.$model.$unbindXmlProperty(this,prop);}}};this.$initingModel;
function initModel(){this.$initingModel=true;this.$setInheritedAttribute("model");
}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.model&&this.$setClearMessage&&!this.value){this.$setClearMessage(this["empty-message"],"empty");
}this.$amlLoaded=true;this.$checkLoadQueue();});this.$propHandlers.model=function(value){if(!value&&!this.$modelParsed){if(this.$model){this.clear();
this.$model.unregister(this);this.$model=null;this.lastModelId="";}else{if(this.dataParent){this.dataParent.parent=null;
}}return;}this.$initingModel=true;var fParsed;if((fParsed=this.$modelParsed)&&fParsed.type!=2){var found,pb=fParsed.props;
if(this.dataParent){this.dataParent=null;}for(var prop in pb){this.dataParent={parent:self[prop.split(".")[0]],xpath:null,model:this.$modelParsed.instruction};
found=true;break;}if(found){if(this.dataParent&&!this.dataParent.signalXmlUpdate){this.dataParent.signalXmlUpdate={};
}}this.$modelParsed=null;}var model;if(typeof value=="object"){if(value.dataType==apf.ARRAY){model=apf.nameserver.get("model",value[0]);
model.register(this,value[1]);return;}else{if(value.$isModel){model=value;value=this.model=model.name;
if(!value){model.setProperty("id",value=this.model="model"+model.$uniqueId);}}else{if(this.dataParent){this.model=this.dataParent.model;
}model=apf.xmldb.findModel(value);if(!model){return;}var xpath=apf.xmlToXpath(value,null,true)||".";
model.register(this,xpath);return;}}}else{if(value.indexOf("[::")>-1){var model,pNode=this;
do{pNode=pNode.parentNode;model=pNode.getAttribute("model");}while(pNode.parentNode&&pNode.parentNode.nodeType==1&&(!model||model==value));
if(model&&typeof model=="object"){model=model.id;}this.$inheritProperties.model=3;
if(model){value=value.replace(/\[\:\:/g,"["+model+"::");}else{apf.console.warn("No found model on any of the parents for this element while trying to overload model: "+value);
return;}}}clearTimeout(this.$dbTimer);if(!this.$amlLoaded&&this.nodeType==1){var _self=this;
this.$dbTimer=$setTimeout(function(){if(!_self.$amlDestroyed){apf.setModel(value,_self);
}});}else{apf.setModel(value,this);}};this.$propHandlers.viewport=function(value){if(value!="virtual"){return;
}this.implement(apf.VirtualViewport);};};apf.DataBinding.prototype=new apf[apf.Presentation?"Presentation":"AmlElement"]();
apf.config.$inheritProperties.model=1;apf.config.$inheritProperties["empty-message"]=1;
apf.config.$inheritProperties["loading-message"]=1;apf.config.$inheritProperties["offline-message"]=1;
apf.config.$inheritProperties.noloading=1;apf.Init.run("databinding");apf.MultiselectBinding=function(){if(!this.setQueryValue){this.implement(apf.DataBinding);
}this.$regbase=this.$regbase|apf.__MULTISELECT__;this.$init(function(){this.$selectTimer={};
});};(function(){this.length=0;this.$attrExcludePropBind=apf.extend({caption:2,icon:2,eachvalue:2,select:2,css:2,sort:2,drag:2,drop:2,dragcopy:2,selected:3,each:1,selection:3,"selection-unique":3,"selection-constructor":3},this.$attrExcludePropBind);
this.resort=function(options,clear,noReload){if(!this.$sort){this.$sort=new apf.Sort();
}this.$sort.set(options,clear);if(this.clearAllCache){this.clearAllCache();}if(noReload){return;
}var _self=this;(function sortNodes(xmlNode,htmlParent){if(!xmlNode){return;}var sNodes=_self.$sort.apply(apf.getArrayFromNodelist(xmlNode.selectNodes(_self.each)));
for(var i=0;i<sNodes.length;i++){if(_self.$isTreeArch||_self.$withContainer){var htmlNode=apf.xmldb.findHtmlNode(sNodes[i],_self);
var container=_self.$findContainer(htmlNode);htmlParent.appendChild(htmlNode);if(!apf.isChildOf(htmlNode,container,true)){htmlParent.appendChild(container);
}sortNodes(sNodes[i],container);}else{htmlParent.appendChild(apf.xmldb.findHtmlNode(sNodes[i],_self));
}}})(this.xmlRoot,this.$container);return options;};this.toggleSortOrder=function(){return this.resort({ascending:!this.$sort.get().ascending}).ascending;
};this.getSortSettings=function(){return this.$sort.get();};this.$propHandlers.simpledata=function(value){if(value){this.getTraverseNodes=function(xmlNode){return(xmlNode||this.xmlRoot).childNodes;
};this.getFirstTraverseNode=function(xmlNode){return(xmlNode||this.xmlRoot).childNodes[0];
};this.getLastTraverseNode=function(xmlNode){var nodes=(xmlNode||this.xmlRoot).childNodes;
return nodes[nodes.length-1];};this.getTraverseParent=function(xmlNode){if(!xmlNode.parentNode||xmlNode==this.xmlRoot){return false;
}return xmlNode.parentNode;};}else{delete this.getTraverseNodes;delete this.getFirstTraverseNode;
delete this.getLastTraverseNode;delete this.getTraverseParent;}};this.getTraverseNodes=function(xmlNode){if(this.$sort){var nodes=apf.getArrayFromNodelist((xmlNode||this.xmlRoot).selectNodes(this.each));
return this.$sort.apply(nodes);}return(xmlNode||this.xmlRoot).selectNodes(this.each);
};this.getFirstTraverseNode=function(xmlNode){if(this.$sort){var nodes=(xmlNode||this.xmlRoot).selectNodes(this.each);
return this.$sort.apply(nodes)[0];}return(xmlNode||this.xmlRoot).selectSingleNode(this.each);
};this.getLastTraverseNode=function(xmlNode){var nodes=this.getTraverseNodes(xmlNode||this.xmlRoot);
return nodes[nodes.length-1];};this.isTraverseNode=function(xmlNode){var nodes=this.getTraverseNodes(this.getTraverseParent(xmlNode)||this.xmlRoot);
for(var i=0;i<nodes.length;i++){if(nodes[i]==xmlNode){return true;}}return false;
};this.getNextTraverseSelected=function(xmlNode,up,count){if(!xmlNode){xmlNode=this.selected;
}if(!count){count=1;}var i=0;var nodes=this.getTraverseNodes(this.getTraverseParent(xmlNode)||this.xmlRoot);
while(nodes[i]&&nodes[i]!=xmlNode){i++;}var node=(up==null)?nodes[i+count]||nodes[i-count]:(up?nodes[i+count]:nodes[i-count]);
return node||count&&(i<count||(i+1)>Math.floor(nodes.length/count)*count)?node:(up?nodes[nodes.length-1]:nodes[0]);
};this.getNextTraverse=function(xmlNode,up,count){if(!count){count=1;}if(!xmlNode){xmlNode=this.selected;
}var i=0;var nodes=this.getTraverseNodes(this.getTraverseParent(xmlNode)||this.xmlRoot);
while(nodes[i]&&nodes[i]!=xmlNode){i++;}var ind=i+(up?-1*count:count);return nodes[ind<0?0:ind];
};this.getTraverseParent=function(xmlNode){if(!xmlNode.parentNode||xmlNode==this.xmlRoot){return false;
}if(xmlNode.$regbase){return xmlNode.parentNode;}var x,id=xmlNode.getAttribute(apf.xmldb.xmlIdTag);
if(!id){xmlNode.setAttribute(apf.xmldb.xmlIdTag,"temp");id="temp";}x=xmlNode.selectSingleNode("ancestor::node()[(("+this.each+")/@"+apf.xmldb.xmlIdTag+")='"+id+"']");
if(id=="temp"){xmlNode.removeAttribute(apf.xmldb.xmlIdTag);}return x;};if(!this.$findHtmlNode){this.$findHtmlNode=function(id){return this.$pHtmlDoc.getElementById(id);
};}this.$setClearMessage=function(msg,className,lastHeight){if(this.more&&this.$addMoreItem){this.$addMoreItem();
}if(!this.$empty){if(!this.$hasLayoutNode("empty")){return;}this.$getNewContext("empty");
var xmlEmpty=this.$getLayoutNode("empty");if(!xmlEmpty){return;}this.$empty=apf.insertHtmlNode(xmlEmpty,this.$container);
}else{this.$container.appendChild(this.$empty);}var empty=this.$getLayoutNode("empty","caption",this.$empty);
if(empty){apf.setNodeValue(empty,msg||"");}this.$empty.setAttribute("id","empty"+this.$uniqueId);
apf.setStyleClass(this.$empty,className,["loading","empty","offline"]);var extH=apf.getStyle(this.$ext,"height");
this.$empty.style.height=(lastHeight&&(!extH||extH=="auto")&&className!="empty")?(Math.max(10,(lastHeight-apf.getHeightDiff(this.$empty)-apf.getHeightDiff(this.$ext)))+"px"):"";
};this.$updateClearMessage=function(msg,className){if(!this.$empty||this.$empty.parentNode!=this.$container||this.$empty.className.indexOf(className)==-1){return;
}var empty=this.$getLayoutNode("empty","caption",this.$empty);if(empty){apf.setNodeValue(empty,msg||"");
}};this.$removeClearMessage=function(){if(!this.$empty){this.$empty=document.getElementById("empty"+this.$uniqueId);
}if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);
}};this.$load=function(XMLRoot){apf.xmldb.addNodeListener(XMLRoot,this);var length=this.getTraverseNodes(XMLRoot).length;
if(!this.renderRoot&&!length){return this.clear(null,null,true);}var nodes=this.$addNodes(XMLRoot,null,null,this.renderRoot,null,"load");
this.$fill(nodes);if(this.selectable){if(this.autoselect){if(!this.selected){if(this.renderRoot){this.select(XMLRoot,null,null,null,true);
}else{if(nodes.length){this.$selectDefault(XMLRoot);}}}}else{this.clearSelection(true);
var xmlNode=this.renderRoot?this.xmlRoot:this.getFirstTraverseNode();if(xmlNode){this.setCaret(xmlNode);
}if(this.selected){this.setProperty("selected",null);}if(this.choosen){this.setProperty("choosen",null);
}}}if(this.focussable){apf.document.activeElement==this?this.$focus():this.$blur();
}if(length!=this.length){this.setProperty("length",length);}};var actionFeature={insert:127,replacenode:127,attribute:255,add:251,remove:46,"redo-remove":79,synchronize:127,"move-away":233,move:77};
this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj,lastParent){if(!this.xmlRoot){return;
}var result,length,pNode,htmlNode,startNode=xmlNode;if(!listenNode){listenNode=this.xmlRoot;
}if(action=="redo-remove"){lastParent.appendChild(xmlNode);var eachNode=this.isTraverseNode(xmlNode);
lastParent.removeChild(xmlNode);if(!eachNode){xmlNode=lastParent;}}do{if(action=="add"&&this.isTraverseNode(xmlNode)&&startNode==xmlNode){break;
}if(xmlNode.getAttribute(apf.xmldb.xmlIdTag)){htmlNode=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
if(xmlNode==listenNode&&!this.renderRoot){if(xmlNode==this.xmlRoot&&action!="insert"&&action!="replacenode"){this.dispatchEvent("xmlupdate",{action:action,xmlNode:xmlNode,UndoObj:UndoObj});
return;}break;}if(htmlNode&&actionFeature[action]&2&&!this.isTraverseNode(xmlNode)){action="remove";
}else{if(!htmlNode&&actionFeature[action]&4&&this.isTraverseNode(xmlNode)){action="add";
break;}else{if(htmlNode&&(startNode!=xmlNode||xmlNode==this.xmlRoot)){if(actionFeature[action]&1){action="update";
}else{if(action=="remove"){return;}}}}}if(htmlNode||action=="move"){break;}}else{if(actionFeature[action]&8&&this.isTraverseNode(xmlNode)){action="add";
break;}}if(xmlNode==listenNode){if(actionFeature[action]&128){return;}break;}xmlNode=xmlNode.parentNode;
}while(xmlNode&&xmlNode.nodeType!=9);if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){if(!this.$isInViewport(xmlNode)){return;
}}var foundNode=xmlNode;if(xmlNode&&xmlNode.nodeType==9){xmlNode=startNode;}if(action=="replacenode"){if(UndoObj?UndoObj.args[1]==this.xmlRoot:!this.xmlRoot.parentNode){return this.load(UndoObj?UndoObj.xmlNode:listenNode,{force:true});
}var nodes=this.getTraverseNodes();for(var i=0,l=nodes.length;i<l;i++){if(apf.isChildOf(startNode,nodes[i])){return this.load(this.xmlRoot,{force:true});
}}}if(UndoObj&&xmlNode&&!UndoObj.xmlNode){UndoObj.xmlNode=xmlNode;}if(action=="move"&&foundNode==startNode){var isInThis=apf.isChildOf(this.xmlRoot,xmlNode.parentNode,true);
var wasInThis=apf.isChildOf(this.xmlRoot,UndoObj.extra.parent,true);if(isInThis&&wasInThis){this.$moveNode(xmlNode,htmlNode,UndoObj.extra.oldParent);
}else{if(isInThis){action="add";}else{if(wasInThis){action="remove";}}}}else{if(action=="move-away"){var goesToThis=apf.isChildOf(this.xmlRoot,UndoObj.extra.parent,true);
if(!goesToThis){action="remove";}}}if(this.$removeClearMessage&&this.$setClearMessage){if(this.getFirstTraverseNode()){this.$removeClearMessage();
}else{this.$setClearMessage(this["empty-message"],"empty");}}if(action=="insert"&&(this.$isTreeArch||xmlNode==this.xmlRoot)){if(!xmlNode){return;
}if(this.$hasLoadStatus(xmlNode)&&this.$removeLoading){this.$removeLoading(xmlNode);
}if(this.$container.firstChild&&!apf.xmldb.getNode(this.$container.firstChild)){this.$container.innerHTML="";
if(!this.renderRoot){length=this.getTraverseNodes().length;if(!length){this.clear();
}}}result=this.$addNodes(xmlNode,null,true,false,null,null,"insert");this.$fillParentHtml=(this.$getParentNode?this.$getParentNode(htmlNode):htmlNode);
this.$fillParent=xmlNode;this.$fill(result);if(this.selectable&&(length===0||!this.xmlRoot.selectSingleNode(this.each))){return;
}}else{if(action=="add"){var parentHTMLNode;pNode=this.getTraverseParent(xmlNode);
if(pNode==this.xmlRoot){parentHTMLNode=this.$container;}if(!parentHTMLNode&&this.$isTreeArch){parentHTMLNode=this.$findHtmlNode(pNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}if(!parentHTMLNode&&this.getCacheItem){parentHTMLNode=this.getCacheItem(pNode.getAttribute(apf.xmldb.xmlIdTag)||(pNode.getAttribute(apf.xmldb.xmlDocTag)?"doc"+pNode.getAttribute(apf.xmldb.xmlDocTag):false));
}if(parentHTMLNode||this.$isTreeArch&&pNode==this.xmlRoot){parentHTMLNode=(this.$findContainer&&parentHTMLNode?this.$findContainer(parentHTMLNode):parentHTMLNode)||this.$container;
result=this.$addNodes(xmlNode,parentHTMLNode,true,true,apf.xmldb.getHtmlNode(this.getNextTraverse(xmlNode),this));
if(parentHTMLNode){this.$fill(result);}}}else{if(action=="remove"){if(htmlNode){this.$deInitNode(xmlNode,htmlNode);
}else{if(startNode==this.xmlRoot){return this.load(null,{noClearMsg:!this.dataParent||!this.dataParent.autoselect});
}}}else{if(htmlNode){if(this.$sort){this.$moveNode(xmlNode,htmlNode);}this.$updateNode(xmlNode,htmlNode);
if(action=="replacenode"&&this.hasFeature(apf.__MULTISELECT__)&&this.selected&&xmlNode.getAttribute(apf.xmldb.xmlIdTag)==this.selected.getAttribute(apf.xmldb.xmlIdTag)){this.selected=xmlNode;
}}else{if(action=="redo-remove"){var testNode=this.xmlRoot;while(testNode&&testNode.nodeType!=9){testNode=testNode.parentNode;
}if(!testNode){var model=this.getModel(true);return model.$waitForXml(this);}}}}}}pNode=xmlNode?xmlNode.parentNode:lastParent;
if(this.$isTreeArch&&!this.$preventRecursiveUpdate&&pNode&&pNode.nodeType==1){do{htmlNode=this.$findHtmlNode(pNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
if(htmlNode){this.$updateNode(pNode,htmlNode);}}while((pNode=this.getTraverseParent(pNode))&&pNode.nodeType==1);
}if(actionFeature[action]&32&&this.selectable&&startNode==xmlNode&&(action!="insert"||xmlNode==this.xmlRoot)){clearTimeout(this.$selectTimer.timer);
if(action=="remove"&&apf.isChildOf(xmlNode,this.selected,true)||xmlNode==this.$selectTimer.nextNode){this.$selectTimer.nextNode=this.getDefaultNext(xmlNode,this.$isTreeArch);
}var _self=this;this.$selectTimer.timer=$setTimeout(function(){_self.$checkSelection(_self.$selectTimer.nextNode);
_self.$selectTimer.nextNode=null;});}if(actionFeature[action]&64){if(!length){length=this.xmlRoot.selectNodes(this.each).length;
}if(length!=this.length){this.setProperty("length",length);}}if(this.signalXmlUpdate&&actionFeature[action]&16){var uniqueId;
for(uniqueId in this.signalXmlUpdate){if(parseInt(uniqueId)!=uniqueId){continue;
}var o=apf.lookup(uniqueId);if(!this.selected){continue;}xmlNode=this.selected.selectSingleNode(o.dataParent.xpath);
if(!xmlNode){continue;}o.load(xmlNode);}}this.dispatchEvent("xmlupdate",{action:action,xmlNode:startNode,traverseNode:xmlNode,result:result,UndoObj:UndoObj});
};this.$addNodes=function(xmlNode,parent,checkChildren,isChild,insertBefore,depth,action){var htmlNode,lastNode;
isChild=(isChild&&(this.renderRoot&&xmlNode==this.xmlRoot||this.isTraverseNode(xmlNode)));
var nodes=isChild?[xmlNode]:this.getTraverseNodes(xmlNode);var cId,cItem;if(this.$isTreeArch&&this.caching&&(!this.$bindings||!this.$bindings.each||!this.$bindings.each.filter)&&(cItem=this.cache[(cId=xmlNode.getAttribute(apf.xmldb.xmlIdTag))])){if(this.$subTreeCacheContext||this.$needsDepth){this.clearCacheItem(cId);
}else{this.$subTreeCacheContext={oHtml:cItem,container:parent,parentNode:null,beforeNode:null};
var htmlNode;while(cItem.childNodes.length){(parent||this.$container).appendChild(htmlNode=cItem.childNodes[0]);
}return nodes;}}if(this.$isTreeArch&&depth===null&&action=="insert"){depth=0,loopNode=xmlNode;
while(loopNode&&loopNode!=this.xmlRoot){depth++;loopNode=this.getTraverseParent(loopNode);
}}for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1){continue;}if(checkChildren){htmlNode=this.$findHtmlNode(nodes[i].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}if(!htmlNode){var Lid=apf.xmldb.nodeConnect(this.documentId,nodes[i],null,this);
var beforeNode=isChild?insertBefore:(lastNode?lastNode.nextSibling:null),parentNode=this.$add(nodes[i],Lid,isChild?xmlNode.parentNode:xmlNode,beforeNode?parent||this.$container:parent,beforeNode,(!beforeNode&&i==nodes.length-1),depth,nodes[i+1],action);
if(parentNode===false){break;}}if(checkChildren){lastNode=htmlNode;}}return nodes;
};this.$handleBindingRule=function(value,prop){if(!value){this[prop]=null;}if(prop=="each"){value=value.charAt(0)=="["&&value.charAt(value.length-1)=="]"?value.replace(/^\[|\]$/g,""):value;
if(value.indexOf("::")>-1){var model=value.split("::");if(!apf.xPathAxis[model[0]]){this.setProperty("model",model[0]);
this.each=model[1];}else{this.each=value;}}else{this.each=value;}if(this.each==this.$lastEach){return;
}this.$lastEach=value;if(!this.$model&&!this.$initingModel){this.$initingModel=true;
this.$setInheritedAttribute("model");return;}if(this.$checkLoadQueue()!==false){return;
}}if(this.xmlRoot&&!this.$bindRuleTimer&&this.$amlLoaded){var _self=this;apf.queue.add("reload"+this.$uniqueId,function(){_self.reload();
});}};this.$select=function(o){if(this.renaming){this.stopRename(null,true);}if(!o||!o.style){return;
}return this.$setStyleClass(o,"selected");};this.$deselect=function(o){if(this.renaming){this.stopRename(null,true);
if(this.ctrlselect){return false;}}if(!o){return;}return this.$setStyleClass(o,"",["selected","indicate"]);
};this.$indicate=function(o){if(this.renaming){this.stopRename(null,true);}if(!o){return;
}return this.$setStyleClass(o,"indicate");};this.$deindicate=function(o){if(this.renaming){this.stopRename(null,true);
}if(!o){return;}return this.$setStyleClass(o,"",["indicate"]);};this.$propHandlers.each=this.$propHandlers.caption=this.$propHandlers.eachvalue=this.$propHandlers.icon=this.$propHandlers.tooltip=this.$handleBindingRule;
this.$propHandlers.sort=function(value){if(value){this.$sort=new apf.Sort();this.$sort.set({getValue:apf.lm.compile(value)});
}else{this.$sort=null;}};}).call(apf.MultiselectBinding.prototype=new apf.DataBinding());
apf.StandardBinding=function(){this.$init(true);if(apf.Validation){this.implement(apf.Validation);
}if(!this.setQueryValue){this.implement(apf.DataBinding);}if(!this.defaultValue){this.defaultValue="";
}this.$load=function(xmlNode){apf.xmldb.addNodeListener(xmlNode,this);var b,lrule,rule,bRules,bRule,value;
if(b=this.$bindings){for(rule in b){lrule=rule.toLowerCase();if(this.$supportedProperties.indexOf(lrule)>-1){bRule=(bRules=b[lrule]).length==1?bRules[0]:this.$getBindRule(lrule,xmlNode);
value=bRule.value||bRule.match;this.$clearDynamicProperty(lrule);if(value.indexOf("{")>-1||value.indexOf("[")>-1){this.$setDynamicProperty(lrule,value);
}else{if(this.setProperty){this.setProperty(lrule,value,true);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();
}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){if(action=="redo-remove"){var retreatToListenMode=false,model=this.getModel(true);
if(model){var xpath=model.getXpathByAmlNode(this);if(xpath){xmlNode=model.data.selectSingleNode(xpath);
if(xmlNode!=this.xmlRoot){retreatToListenMode=true;}}}if(retreatToListenMode||this.xmlRoot==xmlNode){return model.$waitForXml(this);
}}if(UndoObj&&!UndoObj.xmlNode){UndoObj.xmlNode=this.xmlRoot;}var b,lrule,rule,bRules,bRule,value;
if(b=this.$bindings){for(rule in b){lrule=rule.toLowerCase();if(this.$supportedProperties.indexOf(lrule)>-1){bRule=(bRules=b[lrule]).length==1?bRules[0]:this.$getBindRule(lrule,xmlNode);
value=bRule.value||bRule.match;this.$clearDynamicProperty(lrule);if(value.indexOf("{")>-1||value.indexOf("[")>-1){this.$setDynamicProperty(lrule,value);
}else{if(this.setProperty){this.setProperty(lrule,value);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();
}this.dispatchEvent("xmlupdate",{action:action,xmlNode:xmlNode,UndoObj:UndoObj});
};this.addEventListener("$clear",function(nomsg,do_event){if(this.$propHandlers&&this.$propHandlers.value){this.value=-99999;
this.$propHandlers.value.call(this,"");}});};apf.StandardBinding.prototype=new apf.DataBinding();
apf.Init.run("standardbinding");apf.__MULTISELECT__=1<<8;apf.MultiSelect=function(){this.$init(function(){this.$valueList=[];
this.$selectedList=[];});};(function(){this.$regbase=this.$regbase|apf.__MULTISELECT__;
this.sellength=0;this.selected=null;this.$selected=null;this.caret=null;this.$caret=null;
this.useindicator=true;this.remove=function(nodeList){if(!nodeList){nodeList=this.$valueList;
}if(nodeList.nodeType){nodeList=[nodeList];}if(!nodeList||!nodeList.length){return;
}var changes=[];for(var i=0;i<nodeList.length;i++){changes.push({action:"removeNode",args:[nodeList[i]]});
}if(this.$actions.removegroup){return this.$executeAction("multicall",changes,"removegroup",nodeList[0]);
}else{return this.$executeAction("multicall",changes,"remove",nodeList[0],null,null,nodeList.length>1?nodeList:null);
}};this.add=function(xmlNode,pNode,beforeNode,userCallback){var rule;if(this.$actions){if(xmlNode&&xmlNode.nodeType){rule=this.$actions.getRule("add",xmlNode);
}else{if(typeof xmlNode=="string"){if(xmlNode.trim().charAt(0)=="<"){xmlNode=apf.getXml(xmlNode);
rule=this.$actions.getRule("add",xmlNode);}else{var rules=this.$actions.add;for(var i=0,l=rules.length;
i<l;i++){if(rules[i].getAttribute("type")==xmlNode){xmlNode=null;rule=rules[i];
break;}}}}}if(!rule){rule=(this.$actions.add||{})[0];}}else{rule=null;}var refNode=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot,amlNode=this,callback=function(addXmlNode,state,extra){if(state!=apf.SUCCESS){var oError;
oError=new Error(apf.formatErrorString(1032,amlNode,"Loading xml data","Could not add data for control "+amlNode.name+"["+amlNode.tagName+"] \nUrl: "+extra.url+"\nInfo: "+extra.message+"\n\n"+xmlNode));
if(extra.tpModule.retryTimeout(extra,state,amlNode,oError)===true){return true;
}throw oError;}if(typeof addXmlNode!="object"){addXmlNode=apf.getXmlDom(addXmlNode).documentElement;
}if(addXmlNode.getAttribute(apf.xmldb.xmlIdTag)){addXmlNode.setAttribute(apf.xmldb.xmlIdTag,"");
}var actionNode=amlNode.$actions&&amlNode.$actions.getRule("add",amlNode.$isTreeArch?amlNode.selected:amlNode.xmlRoot);
if(!pNode){if(actionNode&&actionNode.parent){pNode=(actionNode.cparent||actionNode.compile("parent",{xpathmode:2,injectself:true}))(amlNode.$isTreeArch?amlNode.selected||amlNode.xmlRoot:amlNode.xmlRoot);
}else{pNode=amlNode.$isTreeArch?amlNode.selected||amlNode.xmlRoot:amlNode.xmlRoot;
}}if(!pNode){pNode=amlNode.xmlRoot;}if(apf.isWebkit&&pNode.ownerDocument!=addXmlNode.ownerDocument){addXmlNode=pNode.ownerDocument.importNode(addXmlNode,true);
}if(amlNode.$executeAction("appendChild",[pNode,addXmlNode,beforeNode],"add",addXmlNode)!==false&&amlNode.autoselect){amlNode.select(addXmlNode);
}if(userCallback){userCallback.call(amlNode,addXmlNode);}return addXmlNode;};if(xmlNode){return callback(xmlNode,apf.SUCCESS);
}else{if(rule.get){return apf.getData(rule.get,{xmlNode:refNode,callback:callback});
}else{}}return addXmlNode;};if(!this.setValue){this.setValue=function(value,disable_event){noEvent=disable_event;
this.setProperty("value",value,false,true);noEvent=false;};}this.findXmlNodeByValue=function(value){var nodes=this.getTraverseNodes(),bindSet=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(!bindSet){return false;}for(var i=0;i<nodes.length;i++){if(this.$applyBindRule(bindSet,nodes[i])==value){return nodes[i];
}}};if(!this.getValue){this.getValue=function(xmlNode,noError){return this.value;
};}this.reselect=function(){if(this.selected){this.select(this.selected,null,this.ctrlselect,null,true);
}};this.select=function(xmlNode,ctrlKey,shiftKey,fakeselect,force,noEvent,userAction){if(!this.selectable||userAction&&this.disabled){return;
}if(parseInt(fakeselect)==fakeselect){if(fakeselect==2){fakeselect=true;userAction=true;
}else{fakeselect=false;userAction=true;}}if(this.$skipSelect){this.$skipSelect=false;
return;}if(this.ctrlselect&&!shiftKey){ctrlKey=true;}if(!this.multiselect){ctrlKey=shiftKey=false;
}if(!this.xmlRoot){if(!this.$buffered){var f;this.addEventListener("afterload",f=function(){this.select.apply(this,this.$buffered);
this.removeEventListener("afterload",f);delete this.$buffered;});}this.$buffered=Array.prototype.slice.call(arguments);
return;}var htmlNode;if(!xmlNode){return false;}if(typeof xmlNode!="object"){var str=xmlNode;
xmlNode=null;if(typeof xmlNode=="string"){xmlNode=apf.xmldb.getNodeById(str);}if(!xmlNode){xmlNode=this.findXmlNodeByValue(str);
if(!xmlNode){this.clearSelection(noEvent);return;}}}if(!(typeof(xmlNode.style||"")=="object")){htmlNode=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}else{var id=(htmlNode=xmlNode).getAttribute(apf.xmldb.htmlIdTag);while(!id&&htmlNode.parentNode){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}xmlNode=apf.xmldb.getNodeById(id);}if(!shiftKey&&!ctrlKey&&!force&&!this.reselectable&&this.$valueList.length<=1&&this.$valueList.indexOf(xmlNode)>-1){return;
}if(this.dispatchEvent("beforeselect",{selected:xmlNode,htmlNode:htmlNode,ctrlKey:ctrlKey,shiftKey:shiftKey,force:force,captureOnly:noEvent})===false){return false;
}var lastIndicator=this.caret;this.caret=xmlNode;if(shiftKey){var range=this.$calcSelectRange(this.$valueList[0]||lastIndicator,xmlNode);
if(this.$caret){this.$deindicate(this.$caret);}this.selectList(range);this.$selected=this.$caret=this.$indicate(htmlNode);
}else{if(ctrlKey){if(this.$valueList.contains(xmlNode)){if(this.selected==xmlNode){this.$deselect(this.$findHtmlNode(this.selected.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));
this.$deindicate(this.$caret);if(this.$valueList.length&&!fakeselect){this.selected=this.$valueList[0];
}}else{this.$deselect(htmlNode,xmlNode);}if(!fakeselect){this.$selectedList.remove(htmlNode);
this.$valueList.remove(xmlNode);}if(htmlNode!=this.$caret){this.$deindicate(this.$caret);
}this.$selected=this.$caret=this.$indicate(htmlNode);}else{if(this.$caret){this.$deindicate(this.$caret);
}this.$caret=this.$indicate(htmlNode,xmlNode);this.$selected=this.$select(htmlNode,xmlNode);
this.selected=xmlNode;if(!fakeselect){this.$selectedList.push(htmlNode);this.$valueList.push(xmlNode);
}}}else{if(fakeselect&&htmlNode&&this.$selectedList.contains(htmlNode)){return;
}else{if(this.$selected){this.$deselect(this.$selected);}if(this.$caret){this.$deindicate(this.$caret);
}if(this.selected){this.clearSelection(true);}this.$caret=this.$indicate(htmlNode,xmlNode);
this.$selected=this.$select(htmlNode,xmlNode);this.selected=xmlNode;this.$selectedList.push(htmlNode);
this.$valueList.push(xmlNode);}}}if(this.delayedselect&&(typeof ctrlKey=="boolean")){var _self=this;
$setTimeout(function(){if(_self.selected==xmlNode){_self.dispatchEvent("afterselect",{selection:_self.$valueList,selected:xmlNode,caret:_self.caret,captureOnly:noEvent});
}},10);}else{this.dispatchEvent("afterselect",{selection:this.$valueList,selected:xmlNode,caret:this.caret,captureOnly:noEvent});
}return true;};this.choose=function(xmlNode,userAction){if(!this.selectable||userAction&&this.disabled){return;
}if(this.dispatchEvent("beforechoose",{xmlNode:xmlNode})===false){return false;
}if(xmlNode&&!(typeof(xmlNode.style||"")=="object")){this.select(xmlNode);}if(this.hasFeature(apf.__DATABINDING__)&&this.dispatchEvent("afterchoose",{xmlNode:this.selected})!==false){this.setProperty("chosen",this.selected);
}};this.clearSelection=function(noEvent,userAction){if(!this.selectable||userAction&&this.disabled||!this.$valueList.length){return;
}if(!noEvent){if(this.dispatchEvent("beforeselect",{selection:[],selected:null,caret:this.caret})===false){return false;
}}var htmlNode;for(var i=this.$valueList.length-1;i>=0;i--){htmlNode=this.$findHtmlNode(this.$valueList[i].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
this.$deselect(htmlNode);}this.$selectedList.length=0;this.$valueList.length=0;
this.$selected=this.selected=null;if(this.caret){htmlNode=this.$findHtmlNode(this.caret.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
this.$caret=this.$indicate(htmlNode);}if(!noEvent){this.dispatchEvent("afterselect",{selection:this.$valueList,selected:null,caret:this.caret});
}};this.selectList=function(xmlNodeList,noEvent,selected,userAction){if(!this.selectable||userAction&&this.disabled){return;
}if(this.dispatchEvent("beforeselect",{selection:xmlNodeList,selected:selected||xmlNodeList[0],caret:this.caret,captureOnly:noEvent})===false){return false;
}this.clearSelection(true);for(var sel,i=0;i<xmlNodeList.length;i++){if(!xmlNodeList[i]||xmlNodeList[i].nodeType!=1){continue;
}var htmlNode,xmlNode=xmlNodeList[i];if(typeof xmlNode!="object"){xmlNode=apf.xmldb.getNodeById(xmlNode);
}if(!(typeof(xmlNode.style||"")=="object")){htmlNode=this.$pHtmlDoc.getElementById(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}else{htmlNode=xmlNode;xmlNode=apf.xmldb.getNodeById(htmlNode.getAttribute(apf.xmldb.htmlIdTag));
}if(!xmlNode){continue;}if(htmlNode){if(!sel&&selected==htmlNode){sel=htmlNode;
}this.$select(htmlNode,xmlNode);this.$selectedList.push(htmlNode);}this.$valueList.push(xmlNode);
}this.$selected=sel||this.$selectedList[0];this.selected=selected||this.$valueList[0];
this.dispatchEvent("afterselect",{selection:this.$valueList,selected:this.selected,caret:this.caret,captureOnly:noEvent});
};this.setCaret=function(xmlNode){if(!xmlNode){if(this.$caret){this.$deindicate(this.$caret);
}this.caret=this.$caret=null;return;}var htmlNode;if(typeof xmlNode!="object"){xmlNode=apf.xmldb.getNodeById(xmlNode);
}if(!(typeof(xmlNode.style||"")=="object")){htmlNode=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
}else{var id=(htmlNode=xmlNode).getAttribute(apf.xmldb.htmlIdTag);while(!id&&htmlNode.parentNode&&htmlNode.parentNode.nodeType==1){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}if(!id){alert(this.$int.outerHTML);}xmlNode=apf.xmldb.getNodeById(id);}if(this.$caret){this.$deindicate(this.$caret);
}this.$caret=this.$indicate(htmlNode);this.setProperty("caret",this.caret=xmlNode);
};this.$setTempSelected=function(xmlNode,ctrlKey,shiftKey,down){clearTimeout(this.timer);
if(this.$bindings.selectable){while(xmlNode&&!this.$getDataNode("selectable",xmlNode)){xmlNode=this.getNextTraverseSelected(xmlNode,!down);
}if(!xmlNode){return;}}if(!this.multiselect){ctrlKey=shiftKey=false;}if(ctrlKey||this.ctrlselect){if(this.$tempsel){this.select(this.$tempsel);
this.$tempsel=null;}this.setCaret(xmlNode);}else{if(shiftKey){if(this.$tempsel){this.$selectTemp();
this.$deselect(this.$tempsel);this.$tempsel=null;}this.select(xmlNode,null,shiftKey);
}else{if(!this.bufferselect||this.$valueList.length>1){this.select(xmlNode);}else{var id=apf.xmldb.getID(xmlNode,this);
this.$deselect(this.$tempsel||this.$selected);this.$deindicate(this.$tempsel||this.$caret);
this.$tempsel=this.$indicate(document.getElementById(id));this.$select(this.$tempsel);
var _self=this;this.timer=$setTimeout(function(){_self.$selectTemp();},400);}}}};
this.$selectTemp=function(){if(!this.$tempsel){return;}clearTimeout(this.timer);
this.select(this.$tempsel);this.$tempsel=null;this.timer=null;};this.selectAll=function(userAction){if(!this.multiselect||!this.selectable||userAction&&this.disabled||!this.xmlRoot){return;
}var nodes=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.xmlRoot.selectNodes(this.each);
this.selectList(nodes);};this.getSelection=function(xmldoc){var i,r;if(xmldoc){r=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();
for(i=0;i<this.$valueList.length;i++){apf.xmldb.cleanNode(r.appendChild(this.$valueList[i].cloneNode(true)));
}}else{for(r=[],i=0;i<this.$valueList.length;i++){r.push(this.$valueList[i]);}}return r;
};this.$getSelection=function(htmlNodes){return htmlNodes?this.$selectedList:this.$valueList;
};this.defaultSelectNext=function(xmlNode,isTree){var next=this.getNextTraverseSelected(xmlNode);
if(next||!isTree){this.select(next?next:this.getTraverseParent(xmlNode));}else{this.clearSelection(true);
}};this.selectNext=function(){var xmlNode=this.getNextTraverse();if(xmlNode){this.select(xmlNode);
}};this.selectPrevious=function(){var xmlNode=this.getNextTraverse(null,-1);if(xmlNode){this.select(xmlNode);
}};this.getDefaultNext=function(xmlNode,isTree){var next=this.getNextTraverseSelected(xmlNode);
return(next&&next!=xmlNode)?next:(isTree?this.getTraverseParent(xmlNode):null);
};this.isSelected=function(xmlNode){if(!xmlNode){return false;}for(var i=0;i<this.$valueList.length;
i++){if(this.$valueList[i]==xmlNode){return this.$valueList.length;}}return false;
};this.$checkSelection=function(nextNode){if(this.$valueList.length>1){for(var lst=[],i=0,l=this.$valueList.length;
i<l;i++){if(apf.isChildOf(this.xmlRoot,this.$valueList[i])){lst.push(this.$valueList[i]);
}}if(lst.length>1){this.selectList(lst);if(this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(nextNode||this.selected);
}return;}else{if(lst.length){nextNode=lst[0];}}}if(!nextNode){if(this.selected&&!apf.isChildOf(this.xmlRoot,this.selected)){nextNode=this.getFirstTraverseNode();
}else{if(this.selected&&this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(this.selected);
}else{if(!this.selected){nextNode=this.xmlRoot?this.getFirstTraverseNode():null;
}else{return;}}}}if(nextNode){if(this.autoselect){this.select(nextNode);}else{if(!this.multiselect){this.clearSelection();
}this.clearSelection();this.setCaret(nextNode);}}else{this.clearSelection();}};
this.selectable=true;if(typeof this.ctrlselect=="undefined"){this.ctrlselect=false;
}if(typeof this.multiselect=="undefined"){this.multiselect=true;}if(typeof this.autoselect=="undefined"){this.autoselect=true;
}if(typeof this.delayedselect=="undefined"){this.delayedselect=true;}if(typeof this.allowdeselect=="undefined"){this.allowdeselect=true;
}this.reselectable=false;this.$booleanProperties.selectable=true;this.$booleanProperties.multiselect=true;
this.$booleanProperties.autoselect=true;this.$booleanProperties.delayedselect=true;
this.$booleanProperties.allowdeselect=true;this.$booleanProperties.reselectable=true;
this.$supportedProperties.push("selectable","ctrlselect","multiselect","autoselect","delayedselect","allowdeselect","reselectable","selection","selected","default","value","caret");
this.$propHandlers.value=function(value){if(this.$lastValue==value){delete this.$lastValue;
return;}if(!this.$attrBindings.eachvalue&&!this.$amlLoaded&&this.getAttribute("eachvalue")){var _self=this;
return apf.queue.add("value"+this.$uniqueId,function(){_self.$propHandlers.value.call(_self,value);
});}if(value||value===0||this["default"]){this.select(String(value)||this["default"]);
}else{this.clearSelection();}};this.$propHandlers["default"]=function(value,prop){if(!this.value||!this.$amlLoaded&&!(this.getAttribute("value")||this.getAttribute("selected")||this.getAttribute("selection"))){this.$propHandlers.value.call(this,"");
}};this.$propHandlers.caret=function(value,prop){if(value){this.setCaret(value);
}};this.$propHandlers.selection=this.$propHandlers.selected=function(value,prop){if(!value){value=this[prop]=null;
}if(prop=="selected"&&typeof value!="string"){if(value&&value.nodeType!=1){value=value.nodeValue;
}else{return;}}if(this.$isSelecting){this.selection=this.$valueList;return false;
}var nodes,bindSet,getValue,i,j,c,d;if(prop=="selection"){if(typeof value=="object"&&value==this.$valueList){var pNode;
if((c=this.$attrBindings[prop])&&c.cvalue.models){this.$isSelecting=true;bindSet=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(!bindSet){throw new Error("Missing bind rule set: eachvalue, value or caption");
}var selNodes=this.$getDataNode(prop,this.xmlRoot);nodes=value;getValue=(d=this.$attrBindings["selection-unique"])&&d.cvalue;
if(selNodes.length){pNode=selNodes[0].parentNode;}else{var model,path;if(c.cvalue.xpaths[0]=="#"||c.cvalue.xpaths[1]=="#"){var m=(c.cvalue3||(c.cvalue3=apf.lm.compile(c.value,{xpathmode:5})))(this.xmlRoot);
model=m.model&&m.model.$isModel&&m.model;if(model){path=m.xpath;}else{if(m.model){model=apf.xmldb.findModel(m.model);
path=apf.xmlToXpath(m.model,model.data)+(m.xpath?"/"+m.xpath:"");}else{}}}else{model=apf.nameserver.get("model",c.cvalue.xpaths[0]);
path=c.cvalue.xpaths[1];}if(!model||!model.data){this.$isSelecting=false;return false;
}pNode=model.queryNode(path.replace(/\/[^\/]+$|^[^\/]*$/,"")||".");if(!pNode){throw new Error("Missing parent node");
}}remove_loop:for(i=0;i<selNodes.length;i++){value=getValue?getValue(selNodes[i]):this.$applyBindRule(bindSet,selNodes[i]);
for(j=0;j<nodes.length;j++){if(this.$applyBindRule(bindSet,nodes[j])==value){continue remove_loop;
}}apf.xmldb.removeNode(selNodes[i]);}add_loop:for(i=0;i<nodes.length;i++){value=this.$applyBindRule(bindSet,nodes[i]);
for(j=0;j<selNodes.length;j++){if(getValue?getValue(selNodes[j]):this.$applyBindRule(bindSet,selNodes[j])==value){continue add_loop;
}}var node=this.$attrBindings["selection-constructor"]&&this.$getDataNode("selection-constructor",nodes[i])||apf.getCleanCopy(nodes[i]);
apf.xmldb.appendChild(pNode,node);}this.$isSelecting=false;}return;}this.selection=this.$valueList;
}else{this.selected=null;}if(!this.xmlRoot){if(!this.$buffered){var f;this.addEventListener("afterload",f=function(){this.removeEventListener("afterload",f);
this.$propHandlers.selected.call(this,value,prop);delete this.$buffered;});this.$buffered=true;
}this[prop]=null;return false;}if(!value||typeof value!="object"){if(this.$attrBindings[prop]){nodes=this.$getDataNode(prop,this.xmlRoot);
if(nodes&&(nodes.length||nodes.nodeType==1)){this.setProperty("selection",nodes);
return;}if(!nodes||nodes.length===0){return;}}if(!value){this.clearSelection();
}else{this.select(value);}return false;}else{if(typeof value.length=="number"){nodes=value;
if(!nodes.length){this.selected=null;if(this.$valueList.length){this.clearSelection();
return false;}else{return;}}if(this.isTraverseNode(nodes[0])&&apf.isChildOf(this.xmlRoot,nodes[0])){if(!this.multiselect){this.select(nodes[0]);
}else{this.selectList(nodes);}return false;}if(this.$attrBindings[prop]){bindSet=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(!bindSet){throw new Error("Missing bind rule set: eachvalue, value or caption");
}var tNodes=!this.each?this.getTraverseNodes():this.xmlRoot.selectNodes("//"+this.each.split("|").join("|//"));
getValue=(c=this.$attrBindings["selection-unique"])&&c.cvalue;var selList=[];for(i=0;
i<nodes.length;i++){value=getValue?getValue(nodes[i]):this.$applyBindRule(bindSet,nodes[i]);
for(j=0;j<tNodes.length;j++){if(this.$applyBindRule(bindSet,tNodes[j])==value){selList.push(tNodes[j]);
}}}this.selectList(selList,true);return false;}throw new Error("Show me which case this is");
}else{if(this.$valueList.indexOf(value)==-1){this.select(value);}}}};this.$propHandlers.allowdeselect=function(value){if(value){var _self=this;
this.$container.onmousedown=function(e){if(!e){e=event;}if(e.ctrlKey||e.shiftKey){return;
}var srcElement=e.srcElement||e.target;if(_self.allowdeselect&&(srcElement==this||srcElement.getAttribute(apf.xmldb.htmlIdTag))){_self.clearSelection();
}};}else{this.$container.onmousedown=null;}};this.$propHandlers.ctrlselect=function(value){if(value!="enter"){this.ctrlselect=apf.isTrue(value);
}};function fAutoselect(){this.selectAll();}this.$propHandlers.autoselect=function(value){if(value=="all"&&this.multiselect){this.addEventListener("afterload",fAutoselect);
}else{this.removeEventListener("afterload",fAutoselect);}};this.$propHandlers.multiselect=function(value){if(!value&&this.$valueList.length>1){this.select(this.selected);
}};this.addEventListener("beforeselect",function(e){if(this.$bindings.selectable&&!this.$getDataNode("selectable",e.selected)){return false;
}},true);this.addEventListener("afterselect",function(e){var combinedvalue=null;
this.setProperty("caret",e.caret);if(this.sellength!=e.selection.length){this.setProperty("sellength",e.selection.length);
}delete this.selection;this.setProperty("selection",e.selection);if(!e.selection.length){this.setProperty("selected",e.selected);
if(this.value){this.setProperty("value","");}}else{this.$chained=true;if(!e.force&&(!this.dataParent||!this.dataParent.parent.$chained)){var _self=this;
$setTimeout(function(){if(_self.selected==e.selected){_self.setProperty("selected",combinedvalue||e.selected);
}delete _self.$chained;},10);}else{this.setProperty("selected",combinedvalue||e.selected);
delete this.$chained;}var valueRule=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(valueRule){this.$lastValue=this.$applyBindRule(valueRule,e.selected);if(this.$lastValue!=(valueRule!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){if(valueRule=="eachvalue"||this.xmlRoot!=this){this.change(this.$lastValue);
}else{this.setProperty("value",this.$lastValue);}}delete this.$lastValue;}}},true);
}).call(apf.MultiSelect.prototype=new apf.MultiselectBinding());apf.__CHILDVALUE__=1<<27;
apf.ChildValue=function(){if(!this.$childProperty){this.$childProperty="value";
}this.$regbase=this.$regbase|apf.__CHILDVALUE__;var f,re=/^[\s\S]*?>(<\?lm)?([\s\S]*?)(?:\?>)?<[^>]*?>$/;
this.addEventListener("DOMCharacterDataModified",f=function(e){if(e&&(e.currentTarget==this||e.currentTarget.nodeType==2&&e.relatedNode==this)||this.$amlDestroyed){return;
}if(this.getAttribute(this.$childProperty)){return;}var m=this.serialize().match(re),v=m&&m[2]||"";
if(m&&m[1]){v="{"+v+"}";}this.$norecur=true;if(v.indexOf("{")>-1||v.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,v);
}else{if(this[this.$childProperty]!=v){this.setProperty(this.$childProperty,v);
}}this.$norecur=false;});this.addEventListener("DOMAttrModified",f);this.addEventListener("DOMNodeInserted",f);
this.addEventListener("DOMNodeRemoved",f);this.addEventListener("$skinchange",function(e){this.$propHandlers[this.$childProperty].call(this,this.caption||"");
});this.$init(function(){this.addEventListener("prop."+this.$childProperty,function(e){if(!this.$norecur&&!e.value&&!this.getAttributeNode(this.$childProperty)){f.call(this);
}});});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var hasNoProp=typeof this[this.$childProperty]=="undefined";
if(hasNoProp&&!this.getElementsByTagNameNS(this.namespaceURI,"*",true).length&&(this.childNodes.length>1||this.firstChild&&(this.firstChild.nodeType==1||this.firstChild.nodeValue.trim().length))){var m=(this.$aml&&this.$aml.xml||this.serialize()).match(re),v=m&&m[2]||"";
if(m&&m[1]){v="{"+v+"}";}if(v.indexOf("{")>-1||v.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,v);
}else{this.setProperty(this.$childProperty,apf.html_entity_decode(v));}}else{if(hasNoProp){this.$propHandlers[this.$childProperty].call(this,"");
}}});};apf.__DATAACTION__=1<<25;apf.DataAction=function(){this.$regbase=this.$regbase|apf.__DATAACTION__;
this.getActionTracker=function(ignoreMe){if(!apf.AmlNode){return apf.window.$at;
}var pNode=this,tracker=ignoreMe?null:this.$at;if(!tracker&&this.dataParent){tracker=this.dataParent.parent.$at;
}while(!tracker){if(!pNode.parentNode&&!pNode.$parentNode){var model;return(model=this.getModel&&this.getModel(true))&&model.$at||apf.window.$at;
}tracker=(pNode=pNode.parentNode||pNode.$parentNode).$at;}return tracker;};this.$actionsLog={};
this.$actions=false;this.$startAction=function(name,xmlContext,fRollback){if(this.disabled||this.liveedit&&name!="edit"){return false;
}var actionRule=this.$actions&&this.$actions.getRule(name,xmlContext);if(!actionRule&&apf.config.autoDisableActions&&this.$actions){return false;
}var bHasOffline=typeof apf.offline!="undefined";if(this.dispatchEvent(name+"start",{xmlContext:xmlContext})===false){return false;
}this.$actionsLog[name]=xmlContext;return true;};this.$stopAction=function(name,isCancelled,curLock){delete this.$actionsLog[name];
};this.$executeAction=function(atAction,args,action,xmlNode,noevent,contextNode,multiple){var rule=this.$actions&&this.$actions.getRule(action,xmlNode);
if(!rule&&this.$actions&&apf.config.autoDisableActions&&"action|change".indexOf(action)==-1){apf.console.warn("Could not execute action '"+action+"'.               No valid action rule was found and auto-disable-actions is enabled");
return false;}var newMultiple;if(multiple){newMultiple=[];for(var k=multiple.length-1;
k>=0;k--){newMultiple.unshift({xmlActionNode:rule&&rule[4],amlNode:this,selNode:multiple[k],xmlNode:multiple[k]});
}}var ev=new apf.AmlEvent("before"+action.toLowerCase(),{action:atAction,args:args,xmlActionNode:rule,amlNode:this,selNode:contextNode,multiple:newMultiple||false});
if(!noevent){if(this.dispatchEvent(ev.name,null,ev)===false){return false;}delete ev.currentTarget;
}var at=this.getActionTracker();if(!at){return UndoObj;}var UndoObj=at.execute(ev);
ev.xmlNode=UndoObj.xmlNode;ev.undoObj=UndoObj;if(!noevent){ev.name="after"+action.toLowerCase();
ev.cancelBubble=false;delete ev.returnValue;delete ev.currentTarget;this.dispatchEvent(ev.name,null,ev);
}return UndoObj;};this.$executeSingleValue=function(atName,setName,xmlNode,value,getArgList){var xpath,args,rule=this.$getBindRule(setName,xmlNode);
if(!rule){return false;}var compiled;["valuematch","match","value"].each(function(type){if(!rule[type]||compiled){return;
}compiled=rule["c"+type];if(!compiled){compiled=rule.compile(type);}if(compiled.type!=3){compiled=null;
}});var atAction,model,node,sel=compiled.xpaths,shouldLoad=false;if(sel[0]=="#"||sel[1]=="#"){var m=(rule.cvalue3||(rule.cvalue3=apf.lm.compile(rule.value,{xpathmode:5})))(xmlNode);
model=m.model&&m.model.$isModel&&m.model;if(model){node=model.queryNode(m.xpath);
xmlNode=model.data;}else{model=apf.xmldb.findModel(m.model);node=m.model.selectSingleNode(m.xpath);
xmlNode=m.model;}sel[1]=m.xpath;}else{model=sel[0]&&apf.nameserver.get("model",sel[0])||this.$model,node=model?model.queryNode(sel[1]):(xmlNode||this.xmlRoot).selectSingleNode(sel[1]);
if(model&&!xmlNode){xmlNode=model.data;}}if(node){if(apf.queryValue(node)==value){return;
}atAction=(node.nodeType==1||node.nodeType==3||node.nodeType==4)?"setTextNode":"setAttribute";
args=(node.nodeType==1)?[node,value]:(node.nodeType==3||node.nodeType==4?[node.parentNode,value]:[node.ownerElement||node.selectSingleNode(".."),node.nodeName,value]);
}else{if(!this.$createModel){return false;}atAction="setValueByXpath";xpath=sel[1];
if(!xmlNode){if(!model){model=this.getModel();}if(model){if(!model.data){model.load("<data />");
}xpath=(model.getXpathByAmlNode(this)||".")+(xpath&&xpath!="."?"/"+xpath:"");xmlNode=model.data;
}else{if(!this.dataParent){return false;}xmlNode=this.dataParent.parent.selected||this.dataParent.parent.xmlRoot;
if(!xmlNode){return false;}xpath=(this.dataParent.xpath||".")+(xpath&&xpath!="."?"/"+xpath:"");
shouldLoad=true;}}args=[xmlNode,value,xpath];}if(getArgList){return{action:atAction,args:args};
}var result=this.$executeAction(atAction,args,atName,xmlNode);if(shouldLoad){this.load(xmlNode.selectSingleNode(xpath));
}return result;};this.change=function(value,force){if(this.errBox&&this.errBox.visible&&this.isValid&&this.isValid()){this.clearError();
}if(!this.xmlRoot&&!this.$createModel||!(this.$mainBind=="value"&&this.hasFeature(apf.__MULTISELECT__)?this.$attrBindings.value:this.$hasBindRule(this.$mainBind))){if(!force&&value===this.value||this.dispatchEvent("beforechange",{value:value})===false){return false;
}this.setProperty("value",value);return this.dispatchEvent("afterchange",{value:value});
}var valueRule=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";
if(value===(valueRule!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){return false;
}this.$executeSingleValue("change",this.$mainBind,this.xmlRoot,value);};this.$booleanProperties["render-root"]=true;
this.$supportedProperties.push("create-model","actions");this.$propHandlers["create-model"]=function(value){this.$createModel=value;
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(typeof this["create-model"]=="undefined"&&!this.$setInheritedAttribute("create-model")){this.$createModel=true;
}});};apf.config.$inheritProperties["create-model"]=1;apf.__CACHE__=1<<2;apf.Cache=function(){this.cache={};
this.$subTreeCacheContext=null;this.caching=true;this.$regbase=this.$regbase|apf.__CACHE__;
this.addEventListener("$load",function(e){if(!this.caching||e.forceNoCache){return;
}if(!this.cacheId){this.cacheId=this.$generateCacheId&&this.$generateCacheId(e.xmlNode)||e.xmlNode.getAttribute(apf.xmldb.xmlIdTag)||apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(e.xmlNode),e.xmlNode);
}var fromCache=getCache.call(this,this.cacheId,e.xmlNode);if(fromCache){if(fromCache==-1||!this.getTraverseNodes){return(e.returnValue=false);
}var nodes=this.getTraverseNodes();if(nodes.length&&this.autoselect){this.select(nodes[0],null,null,null,true);
}else{if(this.clearSelection){this.clearSelection();}}if(!nodes.length){this.$removeClearMessage();
this.$setClearMessage(this["empty-message"],"empty");}if(nodes.length!=this.length){this.setProperty("length",nodes.length);
}return false;}});this.addEventListener("$clear",function(){if(!this.caching){return;
}if(this.hasFeature(apf.__MULTISELECT__)&&this.$subTreeCacheContext&&this.$subTreeCacheContext.oHtml){if(this.renderRoot){this.$subTreeCacheContext.parentNode.insertBefore(this.$subTreeCacheContext.oHtml,this.$subTreeCacheContext.beforeNode);
}else{var container=this.$subTreeCacheContext.container||this.$container;while(container.childNodes.length){this.$subTreeCacheContext.oHtml.appendChild(container.childNodes[0]);
}}this.documentId=this.xmlRoot=this.cacheId=this.$subTreeCacheContext=null;}else{if(this.$loadedWhenOffline){this.$loadedWhenOffline=false;
}else{var fragment=this.$getCurrentFragment();if(!fragment){return;}fragment.documentId=this.documentId;
fragment.xmlRoot=this.xmlRoot;if(this.cacheId||this.xmlRoot){setCache.call(this,this.cacheId||this.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)||"doc"+this.xmlRoot.getAttribute(apf.xmldb.xmlDocTag),fragment);
}}}});function getCache(id,xmlNode){if(xmlNode&&this.hasFeature(apf.__MULTISELECT__)&&this.$isTreeArch){var cacheItem,htmlId=xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,node=this.$pHtmlDoc.getElementById(htmlId);
if(node){cacheItem=id?false:this.$container;}else{for(var prop in this.cache){if(this.cache[prop]&&this.cache[prop].nodeType){node=this.cache[prop].getElementById(htmlId);
if(node){cacheItem=id?prop:this.cache[prop];break;}}}}if(cacheItem&&!this.cache[id]){var oHtml=this.$findHtmlNode(xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
this.$subTreeCacheContext={oHtml:oHtml,parentNode:oHtml.parentNode,beforeNode:oHtml.nextSibling,cacheItem:cacheItem};
this.documentId=apf.xmldb.getXmlDocId(xmlNode);this.cacheId=id;this.xmlRoot=xmlNode;
if(this.renderRoot){this.$container.appendChild(oHtml);}else{while(oHtml.childNodes.length){this.$container.appendChild(oHtml.childNodes[0]);
}}return true;}}if(!this.cache[id]){return false;}var fragment=this.cache[id];this.documentId=fragment.documentId;
this.cacheId=id;this.xmlRoot=xmlNode;this.setProperty("root",this.xmlRoot);this.clearCacheItem(id);
this.$setCurrentFragment(fragment);return true;}function setCache(id,fragment){if(!this.caching){return;
}this.cache[id]=fragment;}this.$findHtmlNode=function(id){var node=this.$pHtmlDoc.getElementById(id);
if(node){return node;}for(var prop in this.cache){if(this.cache[prop]&&this.cache[prop].nodeType){node=this.cache[prop].getElementById(id);
if(node){return node;}}}return null;};this.clearCacheItem=function(id,remove){this.cache[id].documentId=this.cache[id].cacheId=this.cache[id].xmlRoot=null;
if(remove){apf.destroyHtmlNode(this.cache[id]);}this.cache[id]=null;};this.clearAllCache=function(){for(var prop in this.cache){if(this.cache[prop]){this.clearCacheItem(prop,true);
}}};this.getCacheItem=function(id){return this.cache[id];};this.$isCached=function(id){return this.cache[id]||this.cacheId==id?true:false;
};if(!this.$getCurrentFragment){this.$getCurrentFragment=function(){var fragment=this.$container.ownerDocument.createDocumentFragment();
while(this.$container.childNodes.length){fragment.appendChild(this.$container.childNodes[0]);
}return fragment;};this.$setCurrentFragment=function(fragment){this.$container.appendChild(fragment);
if(!apf.window.hasFocus(this)&&this.blur){this.blur();}};}this.$booleanProperties.caching=true;
this.$supportedProperties.push("caching");this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.clearAllCache();
});};apf.GuiElement.propHandlers.caching=function(value){if(!apf.isTrue(value)){return;
}if(!this.hasFeature(apf.__CACHE__)){this.implement(apf.Cache);}};apf.__RENAME__=1<<10;
apf.Rename=function(){this.$regbase=this.$regbase|apf.__RENAME__;this.canrename=false;
this.$renameSubject=this.renameTimer=this.lastCursor=null;this.$booleanProperties.canrename=true;
this.$booleanProperties.autorename=true;this.$supportedProperties.push("canrename","autorename");
this.$propHandlers.autorename=function(value){if(value){this.reselectable=true;
this.bufferselect=false;this.addEventListener("afterselect",$afterselect);this.addEventListener("keydown",$keydown);
}else{this.removeEventListener("afterselect",$afterselect);this.removeEventListener("keydown",$keydown);
}};function $afterselect(){var _self=this;$setTimeout(function(){if(_self.hasFocus()){_self.startRename();
}},20);}function $keydown(e){if(!this.renaming&&apf.isCharacter(e.keyCode)){this.startRename();
}}this.$isContentEditable=function(e){if(this.renaming&&this.autorename){return true;
}};this.rename=function(xmlNode,value){if(!xmlNode){xmlNode=this.caret||this.selected;
}if(!xmlNode){return;}return this.$executeSingleValue("rename","caption",xmlNode,value);
};this.startDelayedRename=function(e,time,userAction){clearTimeout(this.renameTimer);
if(e&&(e.button==2||e.ctrlKey||e.shiftKey)||userAction&&this.disabled){return;}this.renameTimer=$setTimeout("apf.lookup("+this.$uniqueId+").startRename()",time||400);
};this.startRename=function(force,startEmpty,userAction){if(!force&&(this.renaming||!this.canrename||!this.$startAction("rename",this.caret||this.selected,this.stopRename))||userAction&&this.disabled){return false;
}if(!this.hasFocus()){this.focus(null,null,true);}clearTimeout(this.renameTimer);
var elCaption=this.$getCaptionElement?this.$getCaptionElement():this.$caret||this.$selected;
if(!elCaption){return this.stopRename();}this.renaming=true;this.$renameSubject=this.caret||this.selected;
var wdt=elCaption.offsetWidth;this.lastCursor=elCaption.style.cursor;elCaption.style.cursor="text";
elCaption.parentNode.replaceChild(this.$txt,elCaption);elCaption.host=this;if(apf.isTrue(this.$getOption("main","scalerename"))){var diff=apf.getWidthDiff(this.$txt);
this.$txt.style.width=(wdt-diff-3)+"px";}this.$replacedNode=elCaption;var xmlNode=this.$getCaptionXml?this.$getCaptionXml(this.$renameSubject):this.$getDataNode("caption",this.$renameSubject);
var value=startEmpty||!xmlNode?"":(xmlNode.nodeType!=1?unescape(xmlNode.nodeValue):(apf.isOnlyChild(xmlNode.firstChild,[3,4])?apf.queryValue(xmlNode):this.$applyBindRule("caption",this.$renameSubject)))||"";
if(apf.hasContentEditable){if(this.$multiLineRename){this.$txt.innerHTML=apf.htmlCleaner.prepare(value.trim().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"));
}else{this.$txt.innerHTML=value.replace(/</g,"&lt;")||apf.hasContentEditableContainerBug&&"<br>"||"";
}}else{this.$txt.value=value;}this.$txt.unselectable="Off";this.$txt.host=this;
var txt=this.$txt;var f=function(){try{txt.focus();txt.select();}catch(e){}};if(apf.isIE){f();
}else{setTimeout(f);}};this.stopRename=function(contextXml,success){clearTimeout(this.renameTimer);
if(!this.renaming||contextXml&&contextXml!=this.$renameSubject||!this.$replacedNode){return false;
}this.renaming=false;if(this.$txt.parentNode&&this.$txt.parentNode.nodeType==1){if(apf.isIE8||apf.isIE7Emulate){this.$txt.blur();
}this.$txt.parentNode.replaceChild(this.$replacedNode,this.$txt);}if(this.$replacedNode){this.$replacedNode.style.cursor=this.lastCursor||"";
this.$replacedNode.host=null;}if(this.$multiLineRename){var value=apf.html_entity_decode(apf.htmlCleaner.parse(this.$txt.innerHTML,true).replace(/<br \/>/g,"").replace(/<\/?p>/g,""));
}else{var value=this.$txt[apf.hasContentEditable?"innerText":"value"].replace(/<.*?nobr>/gi,"").replace(/\n$/,"");
}if(!success||(this.$validateRename&&!this.$validateRename(value))){this.dispatchEvent("stoprename");
this.$stopAction("rename");}else{if(this.rename(this.$renameSubject,value)!==false){if(this.$replacedNode){this.$replacedNode.innerHTML=value.replace(/</g,"&lt;").replace(/\r?\n/g,"<br />");
}}}if(!this.renaming){this.$renameSubject=null;this.$replacedNode=null;this.$txt.style.width="";
}return true;};this.addEventListener("keydown",function(e){var key=e.keyCode;if(this.renaming){if(key==27||this.$multiLineRename&&e.ctrlKey&&key==13||!this.$multiLineRename&&key==13){this.stopRename(null,key==13&&!this.$autocomplete);
e.cancelBubble=true;return false;}else{if(apf.hasContentEditableContainerBug&&key==8&&this.$txt.innerHTML=="<br>"){e.preventDefault();
}}return;}if(key==113){if(this.$tempsel){this.$selectTemp();}if(this.caret!=this.selected){if(this.multiselect||this.isSelected(this.caret)){this.selected=this.caret;
this.$selected=this.$caret;}else{this.select(this.caret,true);}}this.startRename();
return false;}},true);this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$txt.refCount--;
if(!this.$txt.refCount){this.$txt.host=this.$txt.onmouseover=this.$txt.onmousedown=this.$txt.select=this.$txt.onfocus=this.$txt.onblur=null;
}this.$txt=null;});this.$init(apf.Rename.initEditableArea);};apf.Rename.initEditableArea=function(){if(!(this.$txt=document.getElementById("txt_rename"))){if(apf.hasContentEditable){this.$txt=document.createElement("DIV");
this.$txt.contentEditable=true;if(apf.isIE6){this.$txt.style.width="1px";}}else{this.$txt=document.createElement("input");
this.$txt.id="txt_rename";this.$txt.autocomplete=false;}this.$txt.refCount=0;this.$txt.id="txt_rename";
apf.importCssString("#txt_rename{white-space:nowrap}");this.$txt.onselectstart=function(e){(e||event).cancelBubble=true;
};this.$txt.onmouseover=this.$txt.onmouseout=this.$txt.oncontextmenu=this.$txt.onmouseup=this.$txt.ondblclick=this.$txt.onmousedown=function(e){apf.stopPropagation(e||event);
};this.$txt.onkeyup=function(e){if(!this.host.$autocomplete){return;}this.host.$lookup(this[apf.hasContentEditable?"innerHTML":"value"]);
};var sel;this.$txt.select=function(){if(!apf.hasMsRangeObject){if(window.getSelection&&document.createRange){var sel=window.getSelection();
sel.removeAllRanges();var r=document.createRange();r.setStart(this.firstChild,0);
var lastIndex=this.firstChild.nodeValue.lastIndexOf(".");r.setEnd(this.firstChild,lastIndex>-1?lastIndex:this.firstChild.nodeValue.length);
sel.addRange(r);}else{(sel||(sel=new apf.selection())).selectNode(this);}return;
}var r=document.selection.createRange();try{r.moveToElementText(this);if(apf.isFalse(this.host.$getOption("main","selectrename"))||typeof this.host.$renameStartCollapse!="undefined"){r.collapse(this.host.$renameStartCollapse);
}}catch(e){}r.select();};if(apf.hasFocusBug){this.$txt.onfocus=function(){if(apf.window){apf.window.$focusfix2();
}};}this.$txt.onblur=function(){if(apf.hasFocusBug){apf.window.$blurfix();}if(this.host.$autocomplete){return;
}this.host.stopRename(null,true);};}this.$txt.refCount++;};apf.__ALIGNMENT__=1<<29;
apf.BaseButton=function(){this.$init(true);};(function(){this.implement(apf.ChildValue);
this.$refKeyDown=this.$refMouseDown=0;this.$mouseOver=this.$mouseLeft=false;this.$propHandlers.background=function(value){var oNode=this.$getLayoutNode("main","background",this.$ext);
if(!oNode){return;}if(value){var b=value.split("|");this.$background=b.concat(["vertical",2,16].slice(b.length-1));
oNode.style.backgroundImage="url("+this.mediaPath+b[0]+")";oNode.style.backgroundRepeat="no-repeat";
}else{oNode.style.backgroundImage="";oNode.style.backgroundRepeat="";this.$background=null;
}};this.addEventListener("keydown",function(e){var key=e.keyCode;switch(key){case 13:if(this.localName!="checkbox"){this.$ext.onmouseup(e.htmlEvent,true);
}break;case 32:if(!e.htmlEvent.repeat){this.$refKeyDown++;this.$updateState(e.htmlEvent);
}return false;}},true);this.addEventListener("keyup",function(e){var key=e.keyCode;
switch(key){case 32:this.$refKeyDown--;if(this.$refKeyDown<0){this.$refKeyDown=0;
return false;}if(this.$refKeyDown+this.$refMouseDown==0&&!this.disabled){this.$ext.onmouseup(e,true);
}this.$updateState(e);return false;}},true);this.states={Out:1,Over:2,Down:3};this.$updateState=function(e,strEvent){if(e.reset){this.$refKeyDown=0;
this.$refMouseDown=0;this.$mouseOver=false;return false;}if(this.$refKeyDown>0||(this.$refMouseDown>0&&(this.$mouseOver||(!apf.isIE&&this.$ext===e.currentTarget)))||(this.isBoolean&&this.value)){this.$setState("Down",e,strEvent);
}else{if(this.$mouseOver){this.$setState("Over",e,strEvent);}else{this.$setState("Out",e,strEvent);
}}};this.$setupEvents=function(){if(this.editable){return;}var _self=this;this.$ext.onmousedown=function(e){e=e||window.event;
if(_self.$notfromext&&(e.srcElement||e.target)==this){return;}_self.$refMouseDown=1;
_self.$mouseLeft=false;if(_self.disabled){return;}if(!apf.isIE){if(_self.value){apf.stopEvent(e);
}else{apf.cancelBubble(e);}}_self.$updateState(e,"mousedown");};this.$ext.onmouseup=function(e,force){e=e||window.event;
if(_self.disabled||!force&&((!_self.$mouseOver&&(!apf.isIE&&this!==e.currentTarget))||!_self.$refMouseDown)){return;
}_self.$refMouseDown=0;_self.$updateState(e,"mouseup");if(_self.disabled||(e&&e.type=="click"&&_self.$mouseLeft==true)){return false;
}if(_self.$refMouseDown+_self.$refKeyDown){return false;}if(_self.$clickHandler&&_self.$clickHandler()){_self.$updateState(e||event,"click");
}else{_self.dispatchEvent("click",{htmlEvent:e});}return false;};this.$ext.onmousemove=function(e){if((!_self.$mouseOver||_self.$mouseOver==2)){e=e||window.event;
if(_self.$notfromext&&(e.srcElement||e.target)==this){return;}_self.$mouseOver=true;
if(!_self.disabled){_self.$updateState(e,"mouseover");}}};this.$ext.onmouseout=function(e){e=e||window.event;
var tEl=e.explicitOriginalTarget||e.toElement;if(apf.isChildOf(this,tEl)){return;
}_self.$mouseOver=false;_self.$refMouseDown=0;_self.$mouseLeft=true;if(!_self.disabled){_self.$updateState(e,"mouseout");
}};if(apf.hasClickFastBug){this.$ext.ondblclick=this.$ext.onmouseup;}};this.$doBgSwitch=function(nr){if(this.background&&(this.$background[2]>=nr||nr==4)){if(nr==4){nr=this.$background[2]+1;
}var strBG=this.$background[1]=="vertical"?"0 -"+(parseInt(this.$background[3])*(nr-1))+"px":"-"+(parseInt(this.$background[3])*(nr-1))+"px 0";
this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=strBG;
}};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");
};this.$blur=function(e){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);
if(e){this.$updateState({});}};this.addEventListener("prop.disabled",function(e){this.$refKeyDown=this.$refMouseDown=0;
});this.$destroy=function(skinChange){if(!skinChange&&this.$ext){this.$ext.onmousedown=this.$ext.onmouseup=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onclick=this.$ext.ondblclick=null;
}};}).call(apf.BaseButton.prototype=new apf.StandardBinding());apf.BaseList=function(){this.$init(true);
this.$dynCssClasses=[];this.listNodes=[];};(function(){this.implement(apf.Cache,apf.DataAction,apf.K);
this.$focussable=true;this.$isWindowContainer=-1;this.multiselect=true;this.$propHandlers.fill=function(value){if(value){this.loadFillData(this.getAttribute("fill"));
}else{this.clear();}};this.$mode=0;this.$propHandlers.mode=function(value){if("check|radio".indexOf(value)>-1){if(!this.hasFeature(apf.__MULTICHECK__)){this.implement(apf.MultiCheck);
}this.addEventListener("afterrename",$afterRenameMode);this.multicheck=value=="check";
this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",$afterRenameMode);
this.$mode=0;}};function $afterRenameMode(){}this.$keyHandler=function(e){var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey,selHtml=this.$caret||this.$selected;
if(e.returnValue==-1||!selHtml||this.renaming){return;}var selXml=this.caret||this.selected,oExt=this.$ext,node,margin,items,lines,hasScroll,hasScrollX,hasScrollY;
switch(key){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);
}this.choose(this.selected);break;case 32:if(ctrlKey||!this.isSelected(this.caret)){this.select(this.caret,ctrlKey);
}break;case 109:case 46:if(this.disableremove){return;}if(this.$tempsel){this.$selectTemp();
}this.remove();break;case 36:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(0,null,true,true);
}this.select(this.getFirstTraverseNode(),false,shiftKey);this.$container.scrollTop=0;
break;case 35:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(this.viewport.length,null,true,true);
}this.select(this.getLastTraverseNode(),false,shiftKey);this.$container.scrollTop=this.$container.scrollHeight;
break;case 107:if(this.more){this.startMore();}break;case 37:if(!selXml&&!this.$tempsel){return;
}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;margin=apf.getBox(apf.getStyle(selHtml,"margin"));
items=selHtml.offsetWidth?Math.floor((oExt.offsetWidth-(hasScroll?15:0))/(selHtml.offsetWidth+margin[1]+margin[3])):1;
node=this.getNextTraverseSelected(node,false);if(node){this.$setTempSelected(node,ctrlKey,shiftKey,true);
}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);if(selHtml.offsetTop<oExt.scrollTop){oExt.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),node)<items?0:selHtml.offsetTop-margin[0];
}break;case 38:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScroll=oExt.scrollHeight>oExt.offsetHeight;
items=selHtml.offsetWidth?Math.floor((oExt.offsetWidth-(hasScroll?15:0))/(selHtml.offsetWidth+margin[1]+margin[3])):1;
node=this.getNextTraverseSelected(node,false,items);if(node){this.$setTempSelected(node,ctrlKey,shiftKey,true);
}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);if(selHtml.offsetTop<oExt.scrollTop){oExt.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),node)<items?0:selHtml.offsetTop-margin[0];
}break;case 39:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));node=this.getNextTraverseSelected(node,true);
if(node){this.$setTempSelected(node,ctrlKey,shiftKey);}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);
if(selHtml.offsetTop+selHtml.offsetHeight>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=selHtml.offsetTop-oExt.offsetHeight+selHtml.offsetHeight+margin[0];
}break;case 40:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScroll=oExt.scrollHeight>oExt.offsetHeight;
items=selHtml.offsetWidth?Math.floor((oExt.offsetWidth-(hasScroll?15:0))/(selHtml.offsetWidth+margin[1]+margin[3])):1;
node=this.getNextTraverseSelected(node,true,items);if(node){this.$setTempSelected(node,ctrlKey,shiftKey);
}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);if(selHtml.offsetTop+selHtml.offsetHeight>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=selHtml.offsetTop-oExt.offsetHeight+selHtml.offsetHeight+margin[0];
}break;case 33:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScrollY=oExt.scrollHeight>oExt.offsetHeight;
hasScrollX=oExt.scrollWidth>oExt.offsetWidth;items=Math.floor((oExt.offsetWidth-(hasScrollY?15:0))/(selHtml.offsetWidth+margin[1]+margin[3]));
lines=Math.floor((oExt.offsetHeight-(hasScrollX?15:0))/(selHtml.offsetHeight+margin[0]+margin[2]));
node=this.getNextTraverseSelected(node,false,items*lines);if(!node){node=this.getFirstTraverseNode();
}if(node){this.$setTempSelected(node,ctrlKey,shiftKey,true);}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);
if(selHtml.offsetTop<oExt.scrollTop){oExt.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),node)<items?0:selHtml.offsetTop-margin[0];
}break;case 34:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
margin=apf.getBox(apf.getStyle(selHtml,"margin"));hasScrollY=oExt.scrollHeight>oExt.offsetHeight;
hasScrollX=oExt.scrollWidth>oExt.offsetWidth;items=Math.floor((oExt.offsetWidth-(hasScrollY?15:0))/(selHtml.offsetWidth+margin[1]+margin[3]));
lines=Math.floor((oExt.offsetHeight-(hasScrollX?15:0))/(selHtml.offsetHeight+margin[0]+margin[2]));
node=this.getNextTraverseSelected(selXml,true,items*lines);if(!node){node=this.getLastTraverseNode();
}if(node){this.$setTempSelected(node,ctrlKey,shiftKey);}else{return;}selHtml=apf.xmldb.findHtmlNode(node,this);
if(selHtml.offsetTop+selHtml.offsetHeight>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=selHtml.offsetTop-oExt.offsetHeight+selHtml.offsetHeight+margin[0];
}break;default:if(key==65&&ctrlKey){this.selectAll();}else{if(this.$hasBindRule("caption")){if(!this.xmlRoot||this.autorename){return;
}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};
}this.lookup.str+=String.fromCharCode(key);var nodes=this.getTraverseNodes();for(var v,i=0;
i<nodes.length;i++){v=this.$applyBindRule("caption",nodes[i]);if(v&&v.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(nodes[i])){this.select(nodes[i]);
}if(selHtml){this.$container.scrollTop=selHtml.offsetTop-(this.$container.offsetHeight-selHtml.offsetHeight)/2;
}return;}}return;}}break;}this.lookup=null;return false;};this.$deInitNode=function(xmlNode,htmlNode){if(!htmlNode){return;
}htmlNode.parentNode.removeChild(htmlNode);};this.$updateNode=function(xmlNode,htmlNode,noModifier){var elIcon=this.$getLayoutNode("item","icon",htmlNode);
if(elIcon){if(elIcon.nodeType==1){elIcon.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode))+")";
}else{elIcon.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode));
}}else{var elImage=this.$getLayoutNode("item","image",htmlNode);if(elImage){if(elImage.nodeType==1){elImage.style.backgroundImage="url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode))+")";
}else{elImage.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode));
}}}var elCaption=this.$getLayoutNode("item","caption",htmlNode);if(elCaption){if(elCaption.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){elCaption.innerHTML=this.$applyBindRule("caption",xmlNode);
}}else{elCaption.nodeValue=this.$applyBindRule("caption",xmlNode);}}htmlNode.title=this.$applyBindRule("title",xmlNode)||"";
var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass||this.$dynCssClasses.length){this.$setStyleClass(htmlNode,cssClass,this.$dynCssClasses);
if(cssClass&&!this.$dynCssClasses.contains(cssClass)){this.$dynCssClasses.push(cssClass);
}}if(!noModifier&&this.$updateModifier){this.$updateModifier(xmlNode,htmlNode);
}};this.$moveNode=function(xmlNode,htmlNode){if(!htmlNode){return;}var oPHtmlNode=htmlNode.parentNode;
var nNode=this.getNextTraverse(xmlNode);var beforeNode=nNode?apf.xmldb.findHtmlNode(nNode,this):null;
oPHtmlNode.insertBefore(htmlNode,beforeNode);};this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode){this.$getNewContext("item");
var oItem=this.$getLayoutNode("item"),elSelect=this.$getLayoutNode("item","select"),elIcon=this.$getLayoutNode("item","icon"),elImage=this.$getLayoutNode("item","image"),elCaption=this.$getLayoutNode("item","caption");
oItem.setAttribute("id",Lid);elSelect.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+"); o.$setStyleClass(this, 'hover', null, true);");
elSelect.setAttribute("onselectstart","return false;");elSelect.setAttribute("style",(elSelect.getAttribute("style")||"")+";user-select:none;-moz-user-select:none;-webkit-user-select:none;");
if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){elSelect.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.stopRename(); o.choose()");
elSelect.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            	  o.$setStyleClass(this, '', ['hover'], true);                this.hasPassedDown = false;");
elSelect.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (event.button == 2)                     o.stopRename();                 else if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1)");
elSelect.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (o.hasFeature(apf.__RENAME__) && this.dorename)                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1)");
}else{elSelect.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");
elSelect.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.choose(null, true)");
elSelect.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey, -1)");
}if(this.$mode){var elCheck=this.$getLayoutNode("item","check");if(elCheck){elCheck.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.checkToggle(this, true);o.$skipSelect = true;");
if(apf.isTrue(this.$applyBindRule("checked",xmlNode))){this.$checkedList.push(xmlNode);
this.$setStyleClass(oItem,"checked");}else{if(this.isChecked(xmlNode)){this.$setStyleClass(oItem,"checked");
}}}else{return false;}}if(elIcon){if(elIcon.nodeType==1){elIcon.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode))+")");
}else{elIcon.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",xmlNode));
}}else{if(elImage){if(elImage.nodeType==1){if((elImage.tagName||"").toLowerCase()=="img"){elImage.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode)));
}else{elImage.setAttribute("style","background-image:url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode))+")");
}}else{if(apf.isSafariOld){var p=elImage.ownerElement.parentNode,img=p.appendChild(p.ownerDocument.createElement("img"));
img.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode)));
}else{elImage.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",xmlNode));
}}}}if(elCaption){if(elCaption.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var q=(this.$amlBindQueue||(this.$amlBindQueue={}));
if(elCaption==oItem){apf.setNodeValue(elCaption,"");var span=elCaption.appendChild(elCaption.ownerDocument.createElement("span"));
if(apf.isIE){span.appendChild(elCaption.ownerDocument.createTextNode(" "));}span.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.caption||(q.caption=[])).push(xmlNode)-1));
}else{elCaption.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.caption||(q.caption=[])).push(xmlNode)-1));
apf.setNodeValue(elCaption,"");}}else{apf.setNodeValue(elCaption,this.$applyBindRule("caption",xmlNode));
}}oItem.setAttribute("title",this.$applyBindRule("tooltip",xmlNode)||"");var cssClass=this.$applyBindRule("css",xmlNode);
if(cssClass){this.$setStyleClass(oItem,cssClass);if(cssClass){this.$dynCssClasses.push(cssClass);
}}if(this.$addModifier&&this.$addModifier(xmlNode,oItem,htmlParentNode,beforeNode)===false){return;
}if(htmlParentNode){apf.insertHtmlNode(oItem,htmlParentNode,beforeNode);}else{this.listNodes.push(oItem);
}};this.addEventListener("$skinchange",function(e){if(this.more){delete this.moreItem;
}});this.$fill=function(){if(this.more&&!this.moreItem){this.$getNewContext("item");
var Item=this.$getLayoutNode("item"),elCaption=this.$getLayoutNode("item","caption"),elSelect=this.$getLayoutNode("item","select");
Item.setAttribute("class",this.$baseCSSname+"More");elSelect.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+');o.clearSelection();o.$setStyleClass(this, "more_down", null, true);');
elSelect.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["more_down"], true);');
elSelect.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+").startMore(this, true)");
if(elCaption){apf.setNodeValue(elCaption,this.more.match(/caption:(.*)(;|$)/i)[1]);
}this.listNodes.push(Item);}apf.insertHtmlNodes(this.listNodes,this.$container);
this.listNodes.length=0;if(this.more&&!this.moreItem){this.moreItem=this.$container.lastChild;
}};this.startMore=function(o,userAction){if(userAction&&this.disabled){return;}this.$setStyleClass(o,"",["more_down"]);
var xmlNode;if(!this.$actions.add){if(this.each&&!this.each.match(/[\/\[]/)){xmlNode="<"+this.each+(this.each.match(/^a:/)?" xmlns:a='"+apf.ns.aml+"'":"")+" custom='1' />";
}else{xmlNode="<item />";}}this.add(xmlNode,null,null,function(addedNode){this.select(addedNode,null,null,null,null,true);
if(this.morePos=="begin"){this.$container.insertBefore(this.moreItem,this.$container.firstChild);
}else{this.$container.appendChild(this.moreItem);}var undoLastAction=function(){this.getActionTracker().undo(this.autoselect?2:1);
this.removeEventListener("stoprename",undoLastAction);this.removeEventListener("beforerename",removeSetRenameEvent);
this.removeEventListener("afterrename",afterRename);};var afterRename=function(){this.removeEventListener("afterrename",afterRename);
};var removeSetRenameEvent=function(e){this.removeEventListener("stoprename",undoLastAction);
this.removeEventListener("beforerename",removeSetRenameEvent);var xmlNode=this.findXmlNodeByValue(e.args[1]);
if(xmlNode||!e.args[1]){if(e.args[1]&&this.dispatchEvent("notunique",{value:e.args[1]})===false){this.startRename();
this.addEventListener("stoprename",undoLastAction);this.addEventListener("beforerename",removeSetRenameEvent);
}else{this.removeEventListener("afterrename",afterRename);this.getActionTracker().undo();
if(!this.isSelected(xmlNode)){this.select(xmlNode);}}return false;}};this.addEventListener("stoprename",undoLastAction);
this.addEventListener("beforerename",removeSetRenameEvent);this.addEventListener("afterrename",afterRename);
this.startDelayedRename({},1);});};this.$calcSelectRange=function(xmlStartNode,xmlEndNode){var r=[],nodes=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.each):this.getTraverseNodes(),f,i;
for(f=false,i=0;i<nodes.length;i++){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);
}if(nodes[i]==xmlEndNode){f=false;}}if(!r.length||f){r=[];for(f=false,i=nodes.length-1;
i>=0;i--){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);}if(nodes[i]==xmlEndNode){f=false;
}}}return r;};this.$selectDefault=function(XMLRoot){this.select(this.getTraverseNodes()[0],null,null,null,true);
};this.loadFillData=function(str){var len,start,end,parts=str.splitSafe(","),data=[];
for(var p,part,i=0;i<parts.length;i++){if((part=parts[i]).match(/^\d+-\d+$/)){p=part.split("-");
start=parseInt(p[0]);end=parseInt(p[1]);if(p[0].length==p[1].length){len=Math.max(p[0].length,p[1].length);
for(var j=start;j<end+1;j++){data.push("<item>"+(j+"").pad(len,"0")+"</item>");
}}else{for(var j=start;j<end+1;j++){data.push("<item>"+j+"</item>");}}}else{data.push("<item>"+part+"</item>");
}}this.$initingModel=true;this.each="item";this.$setDynamicProperty("caption","[label/text()|@caption|text()]");
this.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");this.$canLoadDataAttr=false;
this.load("<data>"+data.join("")+"</data>");};}).call(apf.BaseList.prototype=new apf.MultiSelect());
apf.BaseSimple=function(){this.$init(true);};(function(){this.implement(apf.DataAction);
this.getValue=function(){return this.value;};}).call(apf.BaseSimple.prototype=new apf.StandardBinding());
apf.BaseStateButtons=function(){this.state="normal";this.edit=false;var actions={min:["minimized","minimize","restore"],max:["maximized","maximize","restore"],edit:["edit","edit","closeedit"],close:["closed","close","show"]};
this.$lastheight=null;this.$lastpos=null;this.$lastState={normal:true};this.$booleanProperties.animate=true;
this.$supportedProperties.push("buttons","animate","state");this.close=function(){this.setProperty("state",this.state.split("|").pushUnique("closed").join("|"),false,true);
return this;};this.minimize=function(){this.setProperty("state",this.state.split("|").remove("maximized").remove("normal").pushUnique("minimized").join("|"),false,true);
return this;};this.maximize=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("normal").pushUnique("maximized").join("|"),false,true);
return this;};this.restore=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("maximized").pushUnique("normal").join("|"),false,true);
return this;};this.edit=function(value){this.setProperty("state",this.state.split("|").pushUnique("edit").join("|"),false,true);
return this;};this.closeedit=function(value){this.setProperty("state",this.state.split("|").remove("edit").join("|"),false,true);
return this;};this.$toggle=function(type){var c=actions[type][0];this[actions[type][this.state.indexOf(c)>-1?2:1]]();
};this.$propHandlers.refparent=function(value){if(typeof value=="string"){this.$refParent=self[value]&&self[value].$ext||document.getElementById(value);
}else{this.$refParent=value;}};this.$propHandlers.maxconf=function(value){this.$maxconf=value.splitSafe(",");
};this.$propHandlers.state=function(value,prop,force,reenter,noanim){var _self=this;
if(!this.$amlLoaded){apf.queue.add("state"+this.$uniqueId,function(){_self.$propHandlers.state.call(_self,value,prop,force,reenter,noanim);
});return;}if(value==0){value="normal";}var i,pNode,position,l,t,o={},s=value.split("|"),lastState=this.$lastState,styleClass=[];
for(i=0;i<s.length;i++){o[s[i]]=true;}o.value=value;if(!o.maximized&&!o.minimized){o.normal=true;
}if(!reenter&&this.dispatchEvent("beforestatechange",{from:lastState,to:o})===false){this.state=lastState.value;
return false;}if(o.closed==this.visible){this.setProperty("visible",!o.closed,false,true);
}if(o.normal!=lastState.normal||!o.normal&&(o.minimized!=lastState.minimized||o.maximized!=lastState.maximized)){if(this.$lastheight){this.$ext.style.height=this.$lastheight;
}if(this.$lastpos){apf.plane.hide(this.$uniqueId);if(this.animate&&!noanim){var htmlNode=this.$ext;
position=apf.getStyle(htmlNode,"position");if(position!="absolute"){l=parseInt(apf.getStyle(htmlNode,"left"))||0;
t=parseInt(apf.getStyle(htmlNode,"top"))||0;}else{l=htmlNode.offsetLeft;t=htmlNode.offsetTop;
}this.animstate=1;apf.tween.multi(htmlNode,{steps:15,anim:apf.tween.easeInOutCubic,interval:10,tweens:[{type:"left",from:l,to:this.$lastpos.px[0]},{type:"top",from:t,to:this.$lastpos.px[1]},{type:"width",from:this.$ext.offsetWidth,to:this.$lastpos.px[2]},{type:"height",from:this.$ext.offsetHeight,to:this.$lastpos.px[3]}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);
}},onfinish:function(){_self.$lastpos.parentNode.insertBefore(_self.$ext,_self.$lastpos.beforeNode);
if(_self.$placeHolder){_self.$placeHolder.parentNode.removeChild(_self.$placeHolder);
}_self.$propHandlers.state.call(_self,value,null,null,true,true);}});return;}else{if(!this.animate){apf.plane.hide(this.$uniqueId,true);
_self.$lastpos.parentNode.insertBefore(_self.$ext,_self.$lastpos.beforeNode);if(_self.$placeHolder){_self.$placeHolder.parentNode.removeChild(_self.$placeHolder);
}}}this.$ext.style.position=this.$lastpos.pos;this.$ext.style.left=this.$lastpos.css[0];
this.$ext.style.top=this.$lastpos.css[1];this.$ext.style.width=this.$lastpos.css[2];
this.$ext.style.height=this.$lastpos.css[3];pNode=this.$lastpos.parentNode;pNode.style.width=this.$lastpos.parent[0];
pNode.style.height=this.$lastpos.parent[1];pNode.style.overflow=this.$lastpos.parent[2];
}if(this.aData&&this.aData.restore){this.aData.restore();}if(apf.layout){apf.layout.play(this.$pHtmlNode);
}this.$lastheight=this.$lastpos=null;if(o.normal){styleClass.push("",this.$baseCSSname+"Max",this.$baseCSSname+"Min");
}}if(o.minimized!=lastState.minimized){if(o.minimized){styleClass.unshift(this.$baseCSSname+"Min",this.$baseCSSname+"Max",this.$baseCSSname+"Edit");
if(this.aData&&this.aData.minimize){this.aData.minimize(this.collapsedHeight);}if(!this.aData||!this.aData.minimize){this.$lastheight=apf.getStyle(this.$ext,"height");
this.$ext.style.height=Math.max(0,this.collapsedHeight-apf.getHeightDiff(this.$ext))+"px";
}if(this.hasFocus()){apf.window.moveNext(null,this,true);}}else{styleClass.push(this.$baseCSSname+"Min");
$setTimeout(function(){apf.window.$focusLast(_self);});}}if(o.maximized!=lastState.maximized){if(o.maximized){styleClass.unshift(this.$baseCSSname+"Max",this.$baseCSSname+"Min",this.$baseCSSname+"Edit");
pNode=this.$refParent;if(!pNode){pNode=(this.$ext.offsetParent==document.body?document.documentElement:this.$ext.parentNode);
}this.animstate=0;var hasAnimated=false,htmlNode=this.$ext;var position=apf.getStyle(htmlNode,"position");
if(position=="absolute"){pNode.style.overflow="hidden";l=htmlNode.offsetLeft;t=htmlNode.offsetTop;
}else{var pos=apf.getAbsolutePosition(htmlNode);l=pos[0];t=pos[1];}this.$lastpos={css:[this.$ext.style.left,this.$ext.style.top,this.$ext.style.width,this.$ext.style.height,this.$ext.style.margin,this.$ext.style.zIndex],px:[l,t,this.$ext.offsetWidth,this.$ext.offsetHeight],parent:[pNode.style.width,pNode.style.height,pNode.style.overflow],pos:htmlNode.style.position,parentNode:pNode,beforeNode:this.$ext.nextSibling};
if(this.parentNode.$layout){if(!this.$placeHolder){this.$placeHolder=document.createElement("div");
}this.$placeHolder.style.position=this.$lastpos.pos;this.$placeHolder.style.left=this.$lastpos.css[0];
this.$placeHolder.style.top=this.$lastpos.css[1];this.$placeHolder.style.width=this.$lastpos.px[2]+"px";
this.$placeHolder.style.height=this.$lastpos.px[3]+"px";this.$placeHolder.style.margin=this.$lastpos.css[4];
this.$placeHolder.style.zIndex=this.$lastpos.css[5];this.$pHtmlNode.insertBefore(this.$placeHolder,this.$ext);
htmlNode.style.position="absolute";}document.body.appendChild(htmlNode);htmlNode.style.left=l+"px";
htmlNode.style.top=t+"px";function setMax(){if(_self.animstate){return;}var w,h,pos,box,pDiff;
if(_self.maxconf){w=_self.$maxconf[0];h=_self.$maxconf[1];pos=[_self.$maxconf[2]=="center"?(apf.getWindowWidth()-w)/2:_self.$maxconf[2],_self.$maxconf[3]=="center"?(apf.getWindowHeight()-h)/3:_self.$maxconf[3]];
}else{w=!apf.isIE&&pNode==document.documentElement?window.innerWidth:pNode.offsetWidth,h=!apf.isIE&&pNode==document.documentElement?window.innerHeight:pNode.offsetHeight;
}if(!pos){pos=pNode!=htmlNode.offsetParent?apf.getAbsolutePosition(pNode,htmlNode.offsetParent):[0,0];
}if(position!="absolute"){var diff=apf.getDiff(pNode);w-=diff[0]+(!_self.$refParent&&apf.isIE8?4:0);
h-=diff[0]+(!_self.$refParent&&apf.isIE8?4:0);}else{if(!_self.$refParent&&apf.isIE8){w-=4;
h-=4;}}box=_self.$refParent?[0,0,0,0]:marginBox;pDiff=apf.getDiff(pNode);pNode.style.width=(pNode.offsetWidth-pDiff[0])+"px";
pNode.style.height=(pNode.offsetHeight-pDiff[1])+"px";if(!hasAnimated&&_self.$maxconf&&_self.$maxconf[4]){apf.plane.show(htmlNode,false,null,null,{color:_self.$maxconf[4],opacity:_self.$maxconf[5],animate:_self.animate,protect:_self.$uniqueId});
}if(_self.animate&&!hasAnimated){_self.animstate=1;hasAnimated=true;apf.tween.multi(htmlNode,{steps:15,anim:apf.tween.easeInOutCubic,interval:10,tweens:[{type:"left",from:l,to:pos[0]-box[3]},{type:"top",from:t,to:pos[1]-box[0]},{type:"width",from:_self.$lastpos.px[2],to:(w+box[1]+box[3]-apf.getWidthDiff(_self.$ext))},{type:"height",from:_self.$lastpos.px[3],to:(h+box[0]+box[2]-apf.getHeightDiff(_self.$ext))}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);
}},onfinish:function(){_self.animstate=0;_self.dispatchEvent("afterstatechange",{from:lastState,to:o});
if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);}}});}else{if(!_self.animstate){htmlNode.style.left=(pos[0]-box[3])+"px";
htmlNode.style.top=(pos[1]-box[0])+"px";var diff=apf.getDiff(_self.$ext);htmlNode.style.width=(w-diff[0]+box[1]+box[3])+"px";
htmlNode.style.height=(h-diff[1]+box[0]+box[2])+"px";}}}if(apf.layout){apf.layout.pause(this.$pHtmlNode,setMax);
}}else{styleClass.push(this.$baseCSSname+"Max");}}if(o.edit!=lastState.edit){if(o.edit){styleClass.unshift(this.$baseCSSname+"Edit",this.$baseCSSname+"Max",this.$baseCSSname+"Min");
if(this.btnedit){oButtons.edit.innerHTML="close";}this.dispatchEvent("editstart");
}else{if(this.dispatchEvent("editstop")===false){return false;}styleClass.push(this.$baseCSSname+"Edit");
if(styleClass.length==1){styleClass.unshift("");}if(this.btnedit){oButtons.edit.innerHTML="edit";
}}}if(styleClass.length||o.closed!=lastState.closed){if(styleClass.length){this.$setStyleClass(this.$ext,styleClass.shift(),styleClass);
}if(o.edit){this.dispatchEvent("prop.visible",{value:true});if(_self.oSettings){apf.layout.forceResize(_self.oSettings);
}}if(!o.maximized||!this.animate||lastState.maximized&&_self.animate){_self.dispatchEvent("afterstatechange",{from:lastState,to:o});
}this.$lastState=o;if(this.aData&&!o.maximized){this.$purgeAlignment();}if(!this.animate&&apf.hasSingleRszEvent&&apf.layout){apf.layout.forceResize(_self.$int);
}}};var marginBox,hordiff,verdiff,oButtons={};this.$propHandlers.buttons=function(value){if(!this.$hasLayoutNode("button")){return;
}var buttons=value&&(value=value.replace(/(\|)\||\|$/,"$1")).split("|")||[],nodes=this.$buttons.childNodes,re=value&&new RegExp("("+value+")"),found={},idleNodes=[];
for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1||nodes[i].tagName!="DIV"){continue;
}if(nodes[i].getAttribute("button")&&(!value||!nodes[i].className||!nodes[i].className.match(re))){nodes[i].style.display="none";
this.$setStyleClass(nodes[i],"",["min","max","close","edit"]);idleNodes.push(nodes[i]);
}else{found[RegExp.$1]=nodes[i];}}for(i=0;i<buttons.length;i++){if(!buttons[i]){continue;
}if(found[buttons[i]]){this.$buttons.insertBefore(found[buttons[i]],this.$buttons.firstChild);
continue;}var btn=idleNodes.pop();if(!btn){this.$getNewContext("button");btn=this.$getLayoutNode("button");
btn.setAttribute("button","button");setButtonEvents.call(this,btn);btn=apf.insertHtmlNode(btn,this.$buttons);
}this.$setStyleClass(btn,buttons[i],["min","max","close","edit"]);btn.onclick=new Function("apf.lookup("+this.$uniqueId+").$toggle('"+buttons[i]+"')");
btn.style.display="block";oButtons[buttons[i]]=btn;this.$buttons.insertBefore(btn,this.$buttons.firstChild);
}marginBox=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};function setButtonEvents(btn){btn.setAttribute("onmousedown","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, 'down', null, true);             apf.cancelBubble(event, o);              var o = apf.findHost(this).$ext;             if (o.onmousedown) o.onmousedown(event);             apf.cancelBubble(event, o);             apf.window.$mousedown(event);");
btn.setAttribute("onmouseup","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, '', ['down'], true);");
btn.setAttribute("onmouseover","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, 'hover', null, true);");
btn.setAttribute("onmouseout","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, '', ['hover', 'down'], true);");
btn.setAttribute("ondblclick","apf.stopPropagation(event);");}this.$initButtons=function(oExt){this.animate=apf.enableAnim;
this.collapsedHeight=this.$getOption("Main","collapsed-height");var oButtons=this.$getLayoutNode("main","buttons",oExt);
if(!oButtons||apf.isIphone||!this.getAttribute("buttons")||!this.$hasLayoutNode("button")){return;
}var len=(this.getAttribute("buttons")||"").split("|").length;for(var btn,i=0;i<len;
i++){this.$getNewContext("button");btn=oButtons.appendChild(this.$getLayoutNode("button"));
btn.setAttribute("button","button");setButtonEvents.call(this,btn);}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){for(var name in oButtons){oButtons[name].onclick=null;
}});};apf.BaseTab=function(){this.$init(true);};(function(){this.isPaged=true;this.$focussable=apf.KEYBOARD;
this.length=0;this.isLoading={};this.inited=this.ready=false;this.$scroll=true;
this.set=function(page,callback,noEvent){if(noEvent||this.src&&!this.$findPage(page,{})){return this.$propHandlers.activepage.call(this,page,null,null,callback,noEvent);
}if(callback&&this.activepage==page){return callback(this.getPage(page));}this.$lastCallback=callback;
this.setProperty("activepage",page);};this.$supportedProperties.push("activepage","activepagenr","length","src","loading","trans-in","trans-out");
this.$propHandlers.activepagenr=this.$propHandlers.activepage=function(next,prop,force,callback,noEvent){if(!this.inited||apf.isNot(next)||next==-1){return;
}if(!callback){callback=this.$lastCallback;delete this.$lastCallback;}var page,info={};
page=this.$findPage(next,info);if(!page){if(this.src){if(this.isLoading[next]){return;
}if(this.$findPage("loading",{})){this.$propHandlers.activepage.call(this,"loading");
}this.setProperty("loading",true);this.isLoading[next]=true;page=this.ownerDocument.createElementNS(apf.ns.apf,"page");
page.setAttribute("id",next);this.appendChild(page);var _self=this;page.insertMarkup(this.src,{page:next,callback:function(options){delete _self.isLoading[next];
if(!options.xmlNode){var oError=new Error(apf.formatErrorString(0,null,"Loading new page","Could not load new page: "+_self.src));
_self.setProperty("loading",false);if(this.dispatchEvent("error",apf.extend({error:oError,bubbles:true},options))===false){return true;
}throw oError;}else{_self.setProperty("activepage",next);if(callback){callback(options.amlNode);
}_self.setProperty("loading",false);}}});return;}return false;}if(page.parentNode!=this){return false;
}if(!page.visible||page.disabled){return false;}if(next.tagName){next=info.position;
this.activepage=page.name||next;}if(!noEvent){var oEvent={previous:this.activepage,previousId:this.activepagenr,previousPage:this.$activepage,next:next,nextId:info.position,nextPage:page};
if(this.dispatchEvent("beforeswitch",oEvent)===false){if(this.hideLoader){this.hideLoader();
}return false;}}this.activepagenr=info.position;this.setProperty("activepagenr",info.position);
if(this.$activepage){this.$activepage.$deactivate();}page.$activate();if(page["trans-in"]||this.$activepage&&this.$activepage["trans-out"]){this.transition(page,page["trans-in"]||"normal",this.$activepage,this.$activepage&&this.$activepage["trans-out"]||"normal");
}this.$activepage=page;if(this.hideLoader){if(page.$rendered!==false){this.hideLoader();
}else{page.addEventListener("afterrender",function(){this.parentNode.hideLoader();
});}}if(!noEvent){if(page.$rendered!==false){this.dispatchEvent("afterswitch",oEvent);
}else{page.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterswitch",oEvent);
});}}if(typeof callback=="function"){callback(page);}return true;};this.$propHandlers.buttons=function(value){this.$scale=value.indexOf("scale")>-1;
this.$scroll=!this.$scale;if(this.$scale){this.$maxBtnWidth=parseInt(this.$getOption("button","maxwidth"))||150;
this.$minBtnWidth=parseInt(this.$getOption("button","minwidth"))||10;this.$setStyleClass(this.$buttons,"scale");
this.addEventListener("resize",scalersz);this.minwidth=this.$minBtnWidth*this.getPages().length+10;
this.$ext.style.minWidth=Math.max(0,this.minwidth-apf.getWidthDiff(this.$ext))+"px";
}else{this.$setStyleClass(this.$buttons,"",["scale"]);this.removeEventListener("resize",scalersz);
}};function visCheck(){scalersz.call(this);}var btnMoHandler;this.$scaleinit=function(node,type,callback){var pg=this.getPages();
var l=pg.length;this.minwidth=this.$minBtnWidth*l+10;this.$ext.style.minWidth=Math.max(0,this.minwidth-apf.getWidthDiff(this.$ext))+"px";
if(!apf.window.vManager.check(this,"tabscale",visCheck)){return;}if(!type){return scalersz.call(this);
}if(this.$control&&this.$control.type!="remove"&&this.$control.stop){this.$control.stop();
}var _self=this;var anim={steps:type=="remove"?8:8,control:this.$control={},anim:apf.tween.EASEOUT,interval:10,tweens:[],oHtml:node,onfinish:function(){if(!node){return;
}if(type=="add"){node.dispatchEvent("afteropen");}},onstop:function(){if(!node){return;
}if(type=="add"){node.dispatchEvent("afteropen");}else{if(type=="remove"){node.dispatchEvent("afterclose");
}}}};this.$control.type=type;if(type=="add"){var htmlNode=node.$button;htmlNode.style.width=this.$minBtnWidth+"px";
if(pg.length){scalersz.call(this,null,node);this.$buildScaleAnim(anim,pg,null,true);
}}else{if(type=="sync"){this.$buildScaleAnim(anim,pg);}else{if(type=="remove"){anim.onfinish=function(){if(node.dispatchEvent("afterclose")!==false){callback();
}html.style.marginLeft=0;apf.setOpacity(html,1);if(_self.$waitForMouseOut==2){apf.removeListener(_self.$buttons,"mouseout",btnMoHandler);
delete _self.$waitForMouseOut;_self.$scaleinit(null,"sync");}else{if(isLast){delete _self.$waitForMouseOut;
}}};anim.onstop=function(){apf.setOpacity(html,1);};var html=node.$button;anim.tweens.push({oHtml:html,type:"width",from:html.offsetWidth-apf.getWidthDiff(html),to:0});
var over=apf.getWidthDiff(html)+(this.$btnMargin||0);if(over){anim.tweens.push({oHtml:html,type:"marginLeft",from:0,to:-1*over});
}anim.tweens.push({oHtml:html,type:"fade",from:1,to:0});var isLast=pg[pg.length-1]==node;
if(isLast){this.$buildScaleAnim(anim,pg,node);}if(this.$activepage==node){var ln=node.nextSibling;
while(ln&&(!ln.$first||!ln.visible)){ln=ln.nextSibling;}var rn=node.previousSibling;
while(rn&&(!rn.$last||!rn.visible)){rn=rn.previousSibling;}if(ln||rn){this.set(ln||rn);
}}this.$waitForMouseOut=true;if(!isLast){if(!btnMoHandler){var _self=this;function btnMoHandler(e){var pos=apf.getAbsolutePosition(this);
if(e.clientX<=pos[0]||e.clientY<=pos[1]||e.clientX>=pos[0]+this.offsetWidth||e.clientY>=pos[1]+this.offsetHeight){apf.removeListener(_self.$buttons,"mouseout",btnMoHandler);
if(_self.$control.state==apf.tween.STOPPED){delete _self.$waitForMouseOut;_self.$scaleinit(null,"sync");
}else{if(_self.$waitForMouseOut){_self.$waitForMouseOut=2;}}}}}apf.addListener(_self.$buttons,"mouseout",btnMoHandler);
}}}}if(anim.tweens.length){apf.tween.multi(this,anim);}};this.$buildScaleAnim=function(anim,pg,excl,add){if(excl){pg=pg.slice();
pg.remove(excl);}if(!pg.length){return;}var cw=this.$buttons.offsetWidth-apf.getWidthDiff(this.$buttons);
var l=pg.length;var bw=Math.min(cw/l,this.$maxBtnWidth);var re=Math.round((bw%1)*10);
for(var wd,html,s,i=0;i<l-1;i++){s=Math.max(this.$minBtnWidth,round[i<re?1:0](bw));
cw-=s;html=pg[i].$button,wd=apf.getWidthDiff(html);anim.tweens.push({oHtml:html,type:"width",from:html.offsetWidth-wd,to:s-wd-(this.$btnMargin||0)});
}html=pg[l-1].$button,wd=apf.getWidthDiff(html);anim.tweens.push({oHtml:html,type:"width",from:html.offsetWidth-wd,to:Math.max(this.$minBtnWidth,Math.min(cw,this.$maxBtnWidth))-(this.$btnMargin||0)-wd});
};var round=[Math.floor,Math.ceil];function scalersz(e,excl){if(!this.length&&!this.getPages().length||this.$waitForMouseOut||this.$control&&this.$control.state==apf.tween.RUNNING){return;
}var page=this.getPage();if(!page){return;}if(this.$btnMargin==undefined){this.$btnMargin=apf.getMargin(page.$button)[0];
}var pg=this.getPages();if(excl){pg.remove(excl);}if(!pg.length){return;}var cw=this.$buttons.offsetWidth-apf.getWidthDiff(this.$buttons)-(excl?excl.$button.offsetWidth+this.$btnMargin:0);
var l=pg.length;var bw=Math.min(cw/l,this.$maxBtnWidth);var re=Math.round((bw%1)*10);
for(var s,i=0;i<l-1;i++){s=Math.max(this.$minBtnWidth,round[i<re?1:0](bw));cw-=s;
if(!pg[i].$button){continue;}pg[i].$button.style.width=(s-apf.getWidthDiff(pg[i].$button)-this.$btnMargin)+"px";
}if(!pg[l-1].$button){return;}pg[l-1].$button.style.width=(Math.max(this.$minBtnWidth,Math.min(cw,this.$maxBtnWidth))-this.$btnMargin-apf.getWidthDiff(pg[l-1].$button))+"px";
}this.transition=function(pageIn,animIn,pageOut,animOut){var _self=this;if(!this.$transInfo){this.$int.style.overflow=apf.getStyle(this.$int,"overflow")||"hidden";
this.$transInfo={start:function(){var h=_self.$ext;this.size=[h.style.width,h.style.height];
var d=apf.getDiff(h);h.style.width=(h.offsetWidth-d[0])+"px";h.style.height=(h.offsetHeight-d[1])+"px";
if(this["in"]){var h=this["in"].oHtml.$ext;var d=apf.getDiff(h);h.style.width=(_self.$int.offsetWidth-d[0])+"px";
h.style.height=(_self.$int.offsetHeight-d[1])+"px";h.style.display="block";apf.tween.multi(h,this["in"]);
}if(this["out"]){var h=this["out"].oHtml.$ext;var d=apf.getDiff(h);h.style.width=(_self.$int.offsetWidth-d[0])+"px";
h.style.height=(_self.$int.offsetHeight-d[1])+"px";h.style.display="block";apf.tween.multi(h,this["out"]);
}},stop:function(){if(this["in"]&&this["in"].control.stop){this["in"].control.stop();
}if(this["out"]&&this["out"].control.stop){this["out"].control.stop();}},finish:function(){var h=_self.$ext;
h.style.width=this.size[0];h.style.height=this.size[1];if(this["in"]){var h=this["in"].oHtml.$ext;
h.style.width=this["in"].size[0];h.style.height=this["in"].size[1];h.style.display="";
h.style.position="";h.style.zIndex="";h.style.left="";h.style.top="";apf.setOpacity(h,1);
delete this["in"];}if(this["out"]){var h=this["out"].oHtml.$ext;h.style.width=this["out"].size[0];
h.style.height=this["out"].size[1];h.style.display="";h.style.position="";h.style.zIndex="";
h.style.left="";h.style.top="";apf.setOpacity(h,1);delete this["out"];}_self.oPages.style.width="";
_self.oPages.style.height="";}};}this.$transInfo.stop();var d=apf.getDiff(this.oPages);
this.oPages.style.width=(this.oPages.offsetWidth-d[0])+"px";this.oPages.style.height=(this.oPages.offsetHeight-d[1])+"px";
var preventNext=this.$createAnim(pageIn,animIn,false,pageOut);if(preventNext!==false&&pageOut){this.$createAnim(pageOut,animOut,true,pageIn);
}setTimeout(function(){_self.$transInfo.start();});};this.$cube={left:[-1,"offsetWidth","left","getHtmlInnerWidth"],right:[1,"offsetWidth","left","getHtmlInnerWidth"],top:[-1,"offsetHeight","top","getHtmlInnerHeight"],bottom:[1,"offsetHeight","top","getHtmlInnerHeight"]};
this.$createAnim=function(page,animType,out,pageOut){var _self=this;var anim={steps:apf.isIE?15:25,control:{},anim:out?apf.tween.EASEOUT:apf.tween.EASEOUT,interval:10,tweens:[],oHtml:page,size:[page.$ext.style.width,page.$ext.style.height],onfinish:function(){_self.$transInfo.finish(out);
}};this.$transInfo[out?"out":"in"]=anim;var from,to,h=page.$ext;h.style.zIndex=out?10:20;
h.style.position="absolute";h.style.left=0;h.style.top=0;h.style.display="block";
animType=animType.split("-");switch(animType[0]){case"fade":anim.anim=apf.tween.NORMAL;
if(out){h.style.zIndex=30;}anim.tweens.push(out?{type:"fade",from:1,to:0}:{type:"fade",from:0,to:1});
break;case"slide":var info=this.$cube[animType[1]];from=0;to=info[0]*h[info[1]];
if(!out){h.style[info[2]]=from+"px";}anim.tweens.push({type:info[2],from:out?from:to,to:out?to:from});
break;case"push":var info=this.$cube[animType[1]];var h2=pageOut.$ext;if(out){if(this.$transInfo["in"]){this.$transInfo["in"].tweens=[];
}}else{this.$createAnim(pageOut,"normal",true);}var hInt=apf[info[3]](this.$int);
var from1=info[0]*hInt;var to1=0;var from2=0;var to2=-1*info[0]*hInt;if(out){h2.style[info[2]]=to2+"px";
}else{h.style[info[2]]=from1+"px";}anim.tweens.push({oHtml:h,type:[info[2]],from:out?to1:from1,to:out?from1:to1});
anim.tweens.push({oHtml:h2,type:[info[2]],from:out?to2:from2,to:out?from2:to2});
return false;case"normal":break;default:throw new Error("Unknown animation type:"+animType[0]);
}};this.getPages=function(){var r=[],nodes=this.childNodes;for(var i=0,l=nodes.length;
i<l;i++){if("page|case".indexOf(nodes[i].localName)>-1&&nodes[i].visible!==false){r.push(nodes[i]);
}}return r;};this.getPage=function(nameOrId){if(apf.isNot(nameOrId)){return this.$activepage;
}else{return this.$findPage(nameOrId);}};this.add=function(caption,name,type,before,callback){var page=this.ownerDocument.createElementNS(apf.ns.aml,"page");
if(name){page.setAttribute("id",name);}if(type){page.setAttribute("type",type);
}if(caption){page.setAttribute("caption",caption);}if(callback){callback(page);
}this.insertBefore(page,before);return page;};this.remove=function(nameOrId,force){var page=typeof nameOrId=="object"?nameOrId:this.$findPage(nameOrId);
if(!page){return false;}var e={page:page};if(typeof force=="object"){e.htmlEvent=force;
force=false;}if(!force&&this.dispatchEvent("close",e)===false){return;}if(this.$scale){this.$scaleinit(page,"remove",function(){page.destroy(true,true);
});}else{if(page.dispatchEvent("afterclose")!==false){page.destroy(true,true);}}return page;
};function getButtonsWidth(){var cId="cache_"+this.$buttons.childNodes.length;if(SCROLLANIM[cId]){return SCROLLANIM[cId];
}var iWidth=0;for(var i=0,l=this.$buttons.childNodes.length;i<l;i++){if(typeof this.$buttons.childNodes[i].offsetWidth!="undefined"){iWidth+=this.$buttons.childNodes[i].offsetWidth;
}}return SCROLLANIM[cId]=iWidth;}function setButtonState(dir,state){var bBoth=dir&SCROLL_BOTH;
if(bBoth){dir=SCROLL_LEFT;}var oBtn=this[dir&SCROLL_LEFT?"oLeftScroll":"oRightScroll"];
if(!(state&SCROLL_DIS)){if(dir&SCROLL_LEFT){SCROLL_L_STATE=state;}else{SCROLL_R_STATE=state;
}}if(state&SCROLL_OFF){apf.setStyleClass(oBtn,"",["disabled","hover","down"]);}else{if(state&SCROLL_HOVER){apf.setStyleClass(oBtn,"hover",["disabled","down"]);
}else{if(state&SCROLL_DOWN){apf.setStyleClass(oBtn,"down",["disabled","hover"]);
}else{if(state&SCROLL_DIS){apf.setStyleClass(oBtn,"disabled",["hover","down"]);
}}}}if(bBoth){setButtonState(SCROLL_RIGHT,state);}}this.setScrollerState=function(bOn,iBtns){if(!this.ready||!this.$hasButtons||!this.oScroller){return;
}if(typeof bOn=="undefined"){var scrollerWidth=this.oScroller.offsetWidth||parseInt(apf.getStyle(this.oScroller,"width").replace(/(px|em|%)/,""));
bOn=((getButtonsWidth.call(this)+scrollerWidth)>this.$ext.offsetWidth);iBtns=SCROLL_BOTH;
}if(iBtns&SCROLL_BOTH&&bOn!==SCROLLANIM.scrollOn){SCROLLANIM.scrollOn=bOn;if(!bOn){this.$buttons.style.left=SCROLLANIM.left+"px";
this.oScroller.style.display="none";}}else{this.oScroller.style.display="";}this.oScroller.style.display=(iBtns&SCROLL_BOTH&&!bOn)?"none":"";
if(typeof iBtns=="undefined"){iBtns=SCROLL_BOTH;}if(!bOn){if((iBtns&SCROLL_LEFT)||(iBtns&SCROLL_BOTH)){setButtonState.call(this,SCROLL_LEFT,SCROLL_DIS);
}if((iBtns&SCROLL_RIGHT)||(iBtns&SCROLL_BOTH)){setButtonState.call(this,SCROLL_RIGHT,SCROLL_DIS);
}}};this.correctScrollState=function(){if(!this.ready||!this.$hasButtons||!this.oScroller){return;
}this.setScrollerState();};function getAnimationBoundary(dir,useCache){if(SCROLLANIM.size<=0){SCROLLANIM.left=this.$buttons.offsetLeft;
SCROLLANIM.size=Math.round(this.firstChild.$button.offsetWidth);}if(dir&SCROLL_LEFT){return SCROLLANIM.left;
}else{if(dir&SCROLL_RIGHT){var oNode=this.$buttons.childNodes[this.$buttons.childNodes.length-1];
return this.$ext.offsetWidth-(oNode.offsetLeft+oNode.offsetWidth+(this.oScroller.offsetWidth+4));
}}}this.scroll=function(e,dir){if(!this.ready||!this.$hasButtons||!this.oScroller){return;
}if(!e){e=window.event;}if(typeof e.type=="unknown"){e={type:"click"};}if(bAnimating&&e.type!="dblclick"){return;
}bAnimating=true;if(typeof dir=="undefined"){dir=SCROLL_LEFT;}var iCurrentLeft=this.$buttons.offsetLeft,size=e.delta?Math.round(e.delta*36):SCROLLANIM.size,iBoundary=getAnimationBoundary.call(this,dir),_self=this;
if(dir&SCROLL_LEFT){setButtonState(SCROLL_LEFT,SCROLL_DOWN);setButtonState(SCROLL_RIGHT,SCROLL_OFF);
if(iCurrentLeft===iBoundary){this.setScrollerState(false,SCROLL_LEFT);return apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:20,from:iCurrentLeft,to:iCurrentLeft+12,type:"left",anim:apf.tween.EASEOUT,onstop:SCROLLANIM.stopHandle,onfinish:function(oNode){apf.tween.single(oNode,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,from:iCurrentLeft+12,to:iCurrentLeft,type:"left",anim:apf.tween.EASEIN,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_LEFT,SCROLL_OFF);}}});}});}var iTargetLeft=iCurrentLeft+(e.type=="dblclick"?size*3:size);
if(iTargetLeft>iBoundary){iTargetLeft=iBoundary;}if(iTargetLeft===iBoundary){this.setScrollerState(false,SCROLL_LEFT);
}this.setScrollerState(true,SCROLL_RIGHT);apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,control:SCROLLANIM.control,from:iCurrentLeft,to:iTargetLeft,type:"left",anim:apf.tween.NORMAL,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_LEFT,SCROLL_OFF);}if(keepScrolling){_self.scroll(e,globalDir);
}}});}else{if(dir&SCROLL_RIGHT){this.setScrollerState(true);setButtonState(SCROLL_RIGHT,SCROLL_DOWN);
setButtonState(SCROLL_LEFT,SCROLL_OFF);if(iCurrentLeft===iBoundary){this.setScrollerState(false,SCROLL_RIGHT);
return apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:20,from:iCurrentLeft,to:iCurrentLeft-24,type:"left",anim:apf.tween.EASEOUT,onstop:SCROLLANIM.stopHandle,onfinish:function(oNode,options){apf.tween.single(oNode,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,from:iCurrentLeft-24,to:iCurrentLeft,type:"left",anim:apf.tween.EASEIN,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_RIGHT,SCROLL_OFF);}}});}});}var iTargetLeft=iCurrentLeft-(e.type=="dblclick"?size*3:size);
if(iTargetLeft<iBoundary){iTargetLeft=iBoundary;}apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,control:SCROLLANIM.control,from:iCurrentLeft,to:iTargetLeft,type:"left",anim:apf.tween.NORMAL,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
if(e.name=="mousescroll"){setButtonState(SCROLL_RIGHT,SCROLL_OFF);}if(keepScrolling){_self.scroll(e,globalDir);
}}});}}};this.scrollIntoView=function(oPage){bAnimating=false;if(!this.ready||!this.$hasButtons||!this.oScroller||!oPage.$drawn){return;
}bAnimating=true;if(this.$buttons.offsetWidth<this.$ext.offsetWidth){return this.setScrollerState(false);
}var iTabLeft=oPage.$button.offsetLeft,iTabWidth=oPage.$button.offsetWidth,iCurrentLeft=this.$buttons.offsetLeft;
if(SCROLLANIM.size<=0){SCROLLANIM.left=this.$buttons.offsetLeft;var p=this.firstChild;
while(!p.$button){p=p.nextSibling;}SCROLLANIM.size=Math.round(p.$button.offsetWidth);
}this.$buttons.style.left=iCurrentLeft;var iRealWidth=this.$ext.offsetWidth,iScrollCorr=this.oScroller.offsetWidth+4,iTargetLeft=null,dir;
if((iTabLeft+iTabWidth)>((iRealWidth-iScrollCorr)-iCurrentLeft)){iTargetLeft=(-(iTabLeft-SCROLLANIM.left)+(iRealWidth-iTabWidth-iScrollCorr));
dir=SCROLL_RIGHT;}else{if((iCurrentLeft+iTabLeft)<SCROLLANIM.left){iTargetLeft=SCROLLANIM.left-iTabLeft;
dir=SCROLL_LEFT;}}if(iTargetLeft!==null){this.setScrollerState(true);setButtonState(SCROLL_RIGHT,dir&SCROLL_RIGHT?SCROLL_DOWN:SCROLL_OFF);
setButtonState(SCROLL_LEFT,dir&SCROLL_LEFT?SCROLL_DOWN:SCROLL_OFF);apf.tween.clearQueue(this.$buttons,true);
apf.tween.single(this.$buttons,{steps:SCROLLANIM.steps,interval:SCROLLANIM.interval,from:iCurrentLeft,to:iTargetLeft,type:"left",anim:apf.tween.NORMAL,onstop:SCROLLANIM.stopHandle,onfinish:function(){bAnimating=false;
setButtonState(SCROLL_RIGHT,SCROLL_OFF);setButtonState(SCROLL_LEFT,SCROLL_OFF);
}});}else{bAnimating=false;}};this.addEventListener("DOMNodeRemoved",function(e){var amlNode=e.currentTarget;
if(e.$doOnlyAdmin||e.relatedNode!=this||amlNode.localName!="page"){return;}if((this.activepage||this.activepage==0)&&this.activepage!=-1){var ln=amlNode.nextSibling;
while(ln&&(!ln.$first||!ln.visible)){ln=ln.nextSibling;}var rn=amlNode.previousSibling;
while(rn&&(!rn.$last||!rn.visible)){rn=rn.previousSibling;}if(this.firstChild==amlNode&&ln){ln&&ln.$first();
}if(this.lastChild==amlNode&&rn){rn&&rn.$last();}if(this.$activepage==amlNode){if(ln||rn){this.set(ln||rn);
}else{amlNode.$deactivate();this.$activepage=this.activepage=this.activepagenr=null;
this.setProperty("activepage",null);}}else{if(this.$scale){this.$scaleinit();}}}this.setProperty("length",this.childNodes.length);
});this.addEventListener("DOMNodeInserted",function(e){var amlNode=e.currentTarget;
if(amlNode.localName!="page"||e.relatedNode!=this||amlNode.nodeType!=1){return;
}if(!e.$beforeNode){var lastChild,pg=this.getPages();if(lastChild=pg[pg.length-1]){lastChild.$last(true);
}amlNode.$last();}var p=this.getPage(0);if(!p||e.$beforeNode==p){if(p){p.$first(true);
}amlNode.$first();}if(this.$activepage){var info={};this.$findPage(this.$activepage,info);
if(this.activepagenr!=info.position){if(parseInt(this.activepage)==this.activepage){this.activepage=info.position;
this.setProperty("activepage",info.position);}this.activepagenr=info.position;this.setProperty("activepagenr",info.position);
}}else{if(!this.activepage&&!this.$activepage){this.set(amlNode);}}if(this.$scale&&amlNode.visible){this.$scaleinit(amlNode,"add");
}else{amlNode.dispatchEvent("afteropen");}this.setProperty("length",this.childNodes.length);
});this.$findPage=function(nameOrId,info){var node,nodes=this.childNodes;if(nameOrId.localName){for(var t=0,i=0,l=nodes.length;
i<l;i++){node=nodes[i];if("page|case".indexOf(node.localName)>-1&&(++t)&&node==nameOrId){if(info){info.position=t-1;
}return node;}}}else{for(var t=0,i=0,l=nodes.length;i<l;i++){node=nodes[i];if("page|case".indexOf(node.localName)>-1&&(t++==nameOrId||node.name==nameOrId)){if(info){info.position=t-1;
}return node;}}}return null;};this.$enable=function(){var nodes=this.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(nodes[i].enable){nodes[i].enable();}}};this.$disable=function(){var nodes=this.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(nodes[i].disable){nodes[i].disable();}}};
this.addEventListener("keydown",function(e){if(!this.$hasButtons){return;}var page,key=e.keyCode;
switch(key){case 9:break;case 13:break;case 32:break;case 37:page=this.getPage().previousSibling;
while(page&&(page.nodeType!=1||"page|case".indexOf(page.localName)==-1||!page.visible)){page=page.previousSibling;
}if(page){this.setProperty("activepage",page);}break;case 39:page=this.getPage().nextSibling;
while(page&&(page.nodeType!=1||"page|case".indexOf(page.localName)==-1||!page.visible)){page=page.nextSibling;
}if(page){this.setProperty("activepage",page);}break;default:return;}},true);this.$loadChildren=function(callback){var page=false,_self=this,i,j,l,node,nodes;
this.inited=true;if(this.$hasButtons){this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);
this.$buttons.setAttribute("id",this.$uniqueId+"_buttons");}this.oPages=this.$getLayoutNode("main","pages",this.$ext);
if(this.$int){this.$int=this.oPages;page=true;nodes=this.childNodes;for(i=0;i<nodes.length;
i++){node=nodes[i];if(node.nodeType!=1){continue;}node.$draw(true);if(node.$skinchange){node.$skinchange();
}node.$loadAml();}}else{this.$int=this.oPages;nodes=this.getPages();if(nodes.length){nodes[0].$first();
(node=nodes[nodes.length-1]).$last();}}if(node){this.activepage=(typeof this.activepage!="undefined"?this.activepage:this.activepagenr)||0;
page=this.getPage(this.activepage);if(!page.render||page.$rendered){this.$propHandlers.activepage.call(this,this.activepage);
}}else{this.isPages=false;}this.setProperty("length",j);this.ready=true;if(!this.activepage&&this.getAttribute("src")){this.src=this.getAttribute("src");
this.$propHandlers.activepage.call(this);}};this.$destroy=function(bSkinChange){if(bSkinChange||!this.oScroller){return;
}};}).call(apf.BaseTab.prototype=new apf.Presentation());apf.BaseTree=function(){this.$init(true);
this.$dynCssClasses=[];this.$nodes=[];};(function(){this.implement(apf.Rename,apf.DataAction,apf.Cache,apf.K);
this.$isTreeArch=true;this.$focussable=true;this.multiselect=false;this.bufferselect=true;
this.startcollapsed=true;this.$animType=apf.tween.NORMAL;this.$animOpenStep=3;this.$animCloseStep=1;
this.$animSpeed=10;var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4;
var treeState=this.$treeState={};this.$treeState[0]="";this.$treeState[HAS_CHILD]="min";
this.$treeState[HAS_CHILD|IS_CLOSED]="plus";this.$treeState[IS_LAST]="last";this.$treeState[IS_LAST|HAS_CHILD]="minlast";
this.$treeState[IS_LAST|HAS_CHILD|IS_CLOSED]="pluslast";this.$treeState[IS_ROOT]="root";
this.$booleanProperties.openadd=true;this.$booleanProperties.startcollapsed=true;
this.$booleanProperties.nocollapse=true;this.$booleanProperties.singleopen=true;
this.$booleanProperties.animation=true;this.$booleanProperties.prerender=true;this.$booleanProperties.removecontainer=true;
this.$booleanProperties.dragroot=true;this.$supportedProperties.push("openadd","startcollapsed","nocollapse","singleopen","prerender","removecontainer","animation","dragroot");
this.openadd=true;this.startcollapsed=1;this.prerender=true;this.expandAll=function(){if(!this.xmlRoot){return;
}var xpath=this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"),_self=this;
(function(node){var nodes=node.selectNodes(xpath);for(var o,i=0;i<nodes.length;
i++){if(o=apf.xmldb.getHtmlNode(nodes[i],_self)){_self.slideToggle(o,1,true);}arguments.callee(nodes[i]);
}})(this.xmlRoot);};this.collapseAll=function(){if(!this.xmlRoot){return;}var pNodes=this.xmlRoot.selectNodes(".//"+this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"));
for(var o,i=pNodes.length-1;i>=0;i--){if(o=apf.xmldb.getHtmlNode(pNodes[i],this)){this.slideToggle(o,2,true);
}}};this.expandAndSelect=function(xmlNode){if(!this.xmlRoot){return;}var _self=this;
if((function _recur(loopNode){var pNode=_self.getTraverseParent(loopNode);if(pNode==_self.xmlRoot){return true;
}if(!pNode||_recur(pNode)===false){return false;}_self.slideToggle(apf.xmldb.getHtmlNode(pNode,_self),1,true);
})(xmlNode)!==false){this.select(xmlNode);}};this.expandList=function(pathList,user_callback){var pathLut={};
function check(path,callback){pathLut[path]=true;var found;for(var i=0,l=pathList.length;
i<l;i++){var ipath=pathList[i];if(ipath){if(ipath==path){delete pathList[i];}var t=ipath.split("/");
t.pop();var parent=t.join("/");if(parent==path){callback(ipath);found=true;}}}if(!found){user_callback();
}}pathList.sort();var cb,root=this.xmlRoot,_self=this;check("",cb=function(item){var paths=item.split("/");
var lastNode=root;apf.asyncForEach(paths,function(part,next2,index){apf.queue.empty();
setTimeout(function(){var xmlNode=(lastNode||root).selectSingleNode(part);if(xmlNode){lastNode=xmlNode;
_self.slideToggle(apf.xmldb.getHtmlNode(xmlNode,_self),1,true,null,function(){next2();
});}else{_self.slideToggle(apf.xmldb.getHtmlNode(lastNode,_self),1,true,null,function(){lastNode=lastNode.selectSingleNode(part);
if(!lastNode){next2(true);}else{next2();}});}},100);},function(err){check(item,cb);
});});};this.selectPath=function(path){};this.slideToggle=function(htmlNode,force,immediate,userAction,callback){if(this.nocollapse||userAction&&this.disabled){return;
}if(!htmlNode){htmlNode=this.$selected;}if(!htmlNode){return callback&&callback();
}var id=htmlNode.getAttribute(apf.xmldb.htmlIdTag);while(!id&&htmlNode.parentNode){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}var container=this.$getLayoutNode("item","container",htmlNode);if(!container){return;
}if(apf.getStyle(container,"display")=="block"){if(force==1){if(callback){callback();
}return;}htmlNode.className=htmlNode.className.replace(/min/,"plus");this.slideClose(container,apf.xmldb.getNode(htmlNode),immediate,callback);
}else{if(force==2){if(callback){callback();}return;}htmlNode.className=htmlNode.className.replace(/plus/,"min");
this.slideOpen(container,apf.xmldb.getNode(htmlNode),immediate,callback);}};this.isCollapsed=function(xmlNode){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(xmlNode,this)),"display")=="none");
};var lastOpened={};this.slideOpen=function(container,xmlNode,immediate,callback){if(!xmlNode){xmlNode=this.selected;
}var htmlNode=apf.xmldb.getHtmlNode(xmlNode,this);if(!container){container=this.$findContainer(htmlNode);
}if(!container.childNodes.length&&!this.getTraverseNodes(xmlNode).length){return callback&&callback();
}if(this.singleopen){var pNode=this.getTraverseParent(xmlNode),p=(pNode||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);
if(lastOpened[p]&&lastOpened[p][1]!=xmlNode&&this.getTraverseParent(lastOpened[p][1])==pNode){this.slideToggle(lastOpened[p][0],2);
}lastOpened[p]=[htmlNode,xmlNode];}if(!this.nocollapse){container.style.display="block";
}if(!this.prerender&&this.$hasLoadStatus(xmlNode,"potential")&&!container.childNodes.length){this.$extend(xmlNode,container,immediate,callback);
return;}if(immediate||container.scrollHeight>1000){if(!this.nocollapse&&container!=this.$container){container.style.height="auto";
container.style.overflow="visible";}if(this.$hasLoadStatus(xmlNode,"potential")){return this.$extend(xmlNode,container,immediate,callback);
}this.dispatchEvent("expand",{xmlNode:xmlNode});return callback&&callback();}var _self=this;
var prevHeight=container.style.height;container.style.overflow="visible";if(!apf.isIE7){container.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";
}var height=container.scrollHeight;container.style.overflow="hidden";container.style.height=prevHeight;
function finishSlide(){if(xmlNode&&_self.$hasLoadStatus(xmlNode,"potential")){$setTimeout(function(){if(container!=this.$container){container.style.height=container.scrollHeight+"px";
container.style.overflow="hidden";}_self.$extend(xmlNode,container,null,callback);
});if(container!=this.$container){if(!apf.isIE7){container.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";
}container.style.overflow="visible";}}else{if(container!=this.$container){container.style.overflow="visible";
if(!apf.isIE7){container.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";}_self.dispatchEvent("expand",{xmlNode:xmlNode});
}}}if(!this.getAttribute("animation")){var diff=apf.getHeightDiff(container),oInt=container;
container.style.height=Math.max((height),0)+"px";oInt.scrollTop=oInt.scrollHeight-oInt.offsetHeight-diff-(apf.isGecko?16:0);
finishSlide();}else{apf.tween.single(container,{type:"scrollheight",from:container.offsetHeight,to:height,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(container){finishSlide();
}});}};this.slideClose=function(container,xmlNode,immediate){if(this.nocollapse){return;
}if(!xmlNode){xmlNode=this.selected;}if(this.singleopen){var p=(this.getTraverseParent(xmlNode)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);
lastOpened[p]=null;}if(!container){var htmlNode=apf.xmldb.getHtmlNode(xmlNode,this);
container=this.$findContainer(htmlNode);}if(container!=this.$container){container.style.height=container.offsetHeight;
container.style.overflow="hidden";}if(immediate){if(container!=this.$container){container.style.height=0;
}container.style.display="none";this.dispatchEvent("collapse",{xmlNode:xmlNode});
return;}var _self=this;apf.tween.single(container,{type:"scrollheight",from:container.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(container,data){container.style.display="none";
_self.dispatchEvent("collapse",{xmlNode:xmlNode});}});};this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode,isLast,depth,nextNode,action){if(this.$isTreeArch&&this.$needsDepth&&typeof depth=="undefined"){var loopNode=xmlParentNode;
depth=0;while(loopNode!=this.xmlRoot){depth++;loopNode=loopNode.parentNode;}}var loadChildren=this.$getBindRule("insert",xmlNode)?true:false,traverseNodes=this.getTraverseNodes(xmlNode),hasTraverseNodes=traverseNodes.length?true:false,hasChildren=loadChildren||hasTraverseNodes,startcollapsed=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",xmlNode)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",xmlNode)?false:true):this.startcollapsed),state=(hasChildren?HAS_CHILD:0)|(startcollapsed&&hasChildren||loadChildren?IS_CLOSED:0)|(isLast?IS_LAST:0),htmlNode=this.$initNode(xmlNode,state,Lid,depth),container=this.$getLayoutNode("item","container",htmlNode),eachLength;
if(!startcollapsed&&!this.nocollapse){container.setAttribute("style","overflow:visible;height:auto;display:block;");
}var msg,removeContainer=(!this.removecontainer||hasChildren);if(!hasChildren||loadChildren){container.setAttribute("style","display:none;");
}if(!this.prerender){eachLength=traverseNodes.length;}if(hasChildren&&!this.prerender&&eachLength>2&&startcollapsed||loadChildren&&(!this.$hasLoadStatus(xmlNode)||this.$hasLoadStatus(xmlNode,"potential"))){this.$setLoading(xmlNode,container);
}else{if(!hasTraverseNodes&&(msg=this.$applyBindRule("empty",xmlNode))){this.$setEmptyMessage(container,msg);
}}if((!htmlParentNode||htmlParentNode==this.$container)&&xmlParentNode==this.xmlRoot&&!beforeNode||action=="insert"){this.$nodes.push(htmlNode);
if(!apf.isChildOf(htmlNode,container,true)&&removeContainer){this.$nodes.push(container);
}if(action!="insert"){this.$setStyleClass(htmlNode,"root");this.$setStyleClass(container,"root");
}}else{if(!htmlParentNode){htmlParentNode=apf.xmldb.getHtmlNode(xmlNode.parentNode,this);
htmlParentNode=htmlParentNode?this.$getLayoutNode("item","container",htmlParentNode):this.$container;
}if(htmlParentNode==this.$container){this.$setStyleClass(htmlNode,"root");this.$setStyleClass(container,"root");
}var next;if(action!="load"&&action!="extend"){if(!beforeNode&&(next=this.getNextTraverse(xmlNode))){beforeNode=apf.xmldb.getHtmlNode(next,this);
}}if(beforeNode&&beforeNode.parentNode!=htmlParentNode){beforeNode=null;}if(htmlParentNode.style&&this.getTraverseNodes(xmlNode.parentNode).length==1){this.$removeEmptyMessage(htmlParentNode);
}if(htmlParentNode.style){var isChildOfHtmlNode=!apf.isChildOf(htmlNode,container,true);
htmlNode=apf.insertHtmlNode(htmlNode,htmlParentNode,beforeNode);if(isChildOfHtmlNode&&removeContainer){var container=apf.insertHtmlNode(container,htmlParentNode,beforeNode);
}else{var container=this.$getLayoutNode("item","container",htmlNode);}}else{htmlParentNode.insertBefore(htmlNode,beforeNode);
if(!apf.isChildOf(htmlNode,container,true)&&removeContainer){htmlParentNode.insertBefore(container,beforeNode);
}}if(htmlParentNode.style){if(this.openadd&&htmlParentNode!=this.$container&&htmlParentNode.style.display!="block"){this.slideOpen(htmlParentNode,xmlParentNode,true);
}if(!this.$fillParent){this.$fillParent=xmlParentNode;}var next=nextNode==undefined?this.getNextTraverse(xmlNode,true):nextNode;
var html;if(next&&(html=apf.xmldb.getHtmlNode(next,this))){this.$fixItem(next,html);
}}}if((this.prerender||eachLength<3||!startcollapsed)&&(xmlNode.namespaceURI!=apf.ns.apf||xmlNode.localName!="item")){this.$addNodes(xmlNode,container,false,null,null,(depth||0)+1);
}return container;};this.$fill=function(){if(this.$useiframe){this.$pHtmlDoc=this.oDoc;
}if(this.$nodes.length){apf.insertHtmlNodes(this.$nodes,this.$fillParentHtml||this.$container);
this.$nodes.length=0;delete this.$fillParentHtml;}if(this.$fillParent){this.$fixItem(this.$fillParent,apf.xmldb.getHtmlNode(this.$fillParent,this));
delete this.$fillParent;}};this.$getParentNode=function(htmlNode){return htmlNode?this.$getLayoutNode("item","container",htmlNode):this.$container;
};this.$fixItem=function(xmlNode,htmlNode,isDeleting,oneLeft,noChildren){if(!htmlNode){return;
}if(isDeleting){var prevSib;if(prevSib=this.getNextTraverse(xmlNode,true)){this.$fixItem(prevSib,this.$findHtmlNode(prevSib.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);
}if(!this.emptyMessage&&xmlNode.parentNode.selectNodes(this.each).length==1){this.$fixItem(xmlNode.parentNode,this.$findHtmlNode(xmlNode.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);
}}else{var container=this.$getLayoutNode("item","container",htmlNode),hasChildren=false;
if(noChildren){hasChildren=false;}else{if(this.getTraverseNodes(xmlNode).length>0){hasChildren=true;
}else{if(this.$hasLoadStatus(xmlNode,"potential")){hasChildren=true;}else{hasChildren=false;
}}}var isClosed=hasChildren&&htmlNode.className.indexOf("plus")>-1;isLast=this.getNextTraverse(xmlNode,null,oneLeft?2:1)?false:true,state=(hasChildren?HAS_CHILD:0)|(isClosed?IS_CLOSED:0)|(isLast?IS_LAST:0);
this.$setStyleClass(this.$getLayoutNode("item","class",htmlNode),treeState[state],["min","plus","last","minlast","pluslast"]);
this.$setStyleClass(this.$getLayoutNode("item","container",htmlNode),treeState[state],["min","plus","last","minlast","pluslast"]);
if(this.$getLayoutNode("item","openclose",htmlNode)){this.$getLayoutNode("item","openclose",htmlNode).setAttribute("children",hasChildren);
}if(container){if(!hasChildren){container.style.display="none";}else{if(!isClosed){container.style.display="block";
}}}}};this.$deInitNode=function(xmlNode,htmlNode){var containerNode=this.$getLayoutNode("item","container",htmlNode),pContainer=htmlNode.parentNode;
containerNode.parentNode.removeChild(containerNode);pContainer.removeChild(htmlNode);
if(this.$withContainer){htmlNode.parentNode.removeChild(htmlNode.nextSibling);}if(xmlNode.parentNode!=this.xmlRoot){this.$fixItem(xmlNode,htmlNode,true);
}var msg;if(!pContainer.childNodes.length&&(msg=this.$applyBindRule("empty",xmlNode))){this.$setEmptyMessage(pContainer,msg);
}this.$fixItem(xmlNode,htmlNode,true);};this.$moveNode=function(xmlNode,htmlNode,oldXmlParent){if(!self.apf.debug&&!htmlNode){return;
}var container;if(this.$hasLoadStatus(xmlNode.parentNode,"potential")){container=this.$getLayoutNode("item","container",htmlNode);
htmlNode.parentNode.removeChild(htmlNode);container.parentNode.removeChild(container);
this.$extend(xmlNode.parentNode);return;}var oPHtmlNode=htmlNode.parentNode,tParent=this.getTraverseParent(xmlNode),pHtmlNode=apf.xmldb.getHtmlNode(tParent,this),nSibling=this.getNextTraverse(xmlNode),beforeNode=nSibling?apf.xmldb.getHtmlNode(nSibling,this):null,pContainer=pHtmlNode?this.$getLayoutNode("item","container",pHtmlNode):this.$container;
container=this.$getLayoutNode("item","container",htmlNode);if(pContainer!=oPHtmlNode&&this.getTraverseNodes(xmlNode.parentNode).length==1){this.$removeEmptyMessage(pContainer);
}pContainer.insertBefore(htmlNode,beforeNode);if(container){pContainer.insertBefore(container,beforeNode);
}var msg;if(!this.getTraverseNodes(oldXmlParent).length&&(msg=this.$applyBindRule("empty",oldXmlParent))){this.$setEmptyMessage(oPHtmlNode,msg);
}this.$fixItem(xmlNode,htmlNode);this.$fixItem(tParent,apf.xmldb.getHtmlNode(tParent,this));
this.$updateNode(oldXmlParent,apf.xmldb.getHtmlNode(oldXmlParent,this));var next;
if(next=this.getNextTraverse(xmlNode,true)){this.$fixItem(next,apf.xmldb.getHtmlNode(next,this));
}};this.$setLoading=function(xmlNode,container){this.$setLoadStatus(xmlNode,"potential");
var len=this.getTraverseNodes(xmlNode).length;if(!len||len>20){this.$getNewContext("loading");
apf.insertHtmlNode(this.$getLayoutNode("loading"),container);}};this.$removeLoading=function(xmlNode){if(!xmlNode){return;
}if(this.$timers){clearTimeout(this.$timers[xmlNode.getAttribute(apf.xmldb.xmlIdTag)]);
}var htmlNode=apf.xmldb.getHtmlNode(xmlNode,this);if(htmlNode){this.$getLayoutNode("item","container",htmlNode).innerHTML="";
this.$setStyleClass(htmlNode,"",["loading"]);}};this.$extend=function(xmlNode,container,immediate,callback){if(!this.$hasLoadStatus(xmlNode,"potential")){return;
}var rule=this.$getBindRule("insert",xmlNode),xmlContext=rule&&rule.match?(rule.cmatch||rule.compile("match"))(xmlNode):xmlNode;
if(rule&&xmlContext){this.$setLoadStatus(xmlNode,"loading");var _self=this;(this.$timers||(this.$timers={}))[xmlNode.getAttribute(apf.xmldb.xmlIdTag)]=setTimeout(function(){_self.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),"loading");
},100);if(rule.get){this.getModel().$insertFrom(rule.getAttribute("get"),{xmlNode:xmlContext,insertPoint:xmlContext,amlNode:this,callback:callback});
}else{if(this.$applyBindRule("insert",xmlNode)){this.insert(data,{insertPoint:xmlContext});
}}}else{if(!this.prerender){this.$setLoadStatus(xmlNode,"loaded");this.$removeLoading(xmlNode);
xmlUpdateHandler.call(this,{action:"insert",xmlNode:xmlNode,result:this.$addNodes(xmlNode,container,true,null,null,null,"extend"),anim:!immediate});
}}};function xmlUpdateHandler(e){if(e.action=="move-away"){this.$fixItem(e.xmlNode,apf.xmldb.findHtmlNode(e.xmlNode,this),true);
}if(e.action!="insert"){return;}var htmlNode=this.$findHtmlNode(e.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
if(!htmlNode){return;}if(e.action=="insert"&&e.result.length>0){if(this.$hasLoadStatus(e.xmlNode,"loaded",true)){var container=this.$getLayoutNode("item","container",htmlNode);
this.slideOpen(container,e.xmlNode);}else{if(this.$hasLoadStatus(e.xmlNode,"potential",true)){this.$setLoadStatus(e.xmlNode,"loaded");
}}}else{this.$fixItem(e.xmlNode,htmlNode);}}this.addEventListener("xmlupdate",xmlUpdateHandler);
this.addEventListener("beforerename",function(){if(this.$tempsel){clearTimeout(this.timer);
this.select(this.$tempsel);this.$tempsel=null;this.timer=null;}});this.addEventListener("keydown",function(e){var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey,selHtml=this.$caret||this.$selected,pos,top,el,node,nodes,sNode,pNode,container;
if(e.returnValue==-1||!selHtml||this.renaming){return;}var selXml=this.caret||this.selected,oExt=this.$container;
switch(key){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);
}this.choose(selHtml);break;case 32:if(this.$tempsel){this.$selectTemp();}if(this.$mode&&!ctrlKey){var sel=this.getSelection();
if(!sel.length||!this.multiselect){this.checkToggle(this.caret,true);}else{this.checkList(sel,this.isChecked(this.selected),true,false,true);
}}else{if(ctrlKey||!this.isSelected(this.caret)){this.select(this.caret,true);}}return false;
case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.caret);break;case 36:this.$setTempSelected(this.getFirstTraverseNode(),false,shiftKey);
oExt.scrollTop=0;return false;case 35:var lastNode=this.getLastTraverseNode();while(!this.isCollapsed(lastNode)){lastNode=this.getLastTraverseNode(lastNode);
}this.$setTempSelected(lastNode,false,shiftKey,true);oExt.scrollTop=oExt.scrollHeight;
return false;case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)&&!this.isCollapsed(this.caret)){this.slideToggle(this.$caret||this.$selected,2);
}else{if((pNode=this.getTraverseParent(this.caret))&&pNode!=this.xmlRoot){this.select(pNode);
}}return false;case 107:case 187:case 39:if(this.$tempsel){this.$selectTemp();}if(this.$hasLoadStatus(this.caret,"potential")||this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,1);
}break;case 109:case 189:if(this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,2);
}break;case 38:if(!selXml&&!this.$tempsel){return;}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;
sNode=this.getNextTraverse(node,true);if(sNode){nodes=this.getTraverseNodes(sNode);
do{container=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(sNode,this)));
if(container&&apf.getStyle(container,"display")=="block"&&nodes.length){sNode=nodes[nodes.length-1];
}else{break;}}while(sNode&&(nodes=this.getTraverseNodes(sNode)).length);}else{if(this.getTraverseParent(node)==this.xmlRoot){this.dispatchEvent("selecttop");
return;}else{sNode=this.getTraverseParent(node);}}if(sNode&&sNode.nodeType==1){this.$setTempSelected(sNode,ctrlKey,shiftKey,true);
}else{return false;}selHtml=apf.xmldb.getHtmlNode(sNode,this);top=apf.getAbsolutePosition(selHtml,this.$container)[1]-(selHtml.offsetHeight);
if(top<=oExt.scrollTop){oExt.scrollTop=top;}return false;case 40:if(!selXml&&!this.$tempsel){return;
}node=this.$tempsel?apf.xmldb.getNode(this.$tempsel):selXml;sNode=this.getFirstTraverseNode(node);
if(sNode){container=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(node,this)));
if(container&&apf.getStyle(container,"display")!="block"){sNode=null;}}while(!sNode){pNode=this.getTraverseParent(node);
if(!pNode){break;}var i=0;nodes=this.getTraverseNodes(pNode);while(nodes[i]&&nodes[i]!=node){i++;
}sNode=nodes[i+1];node=pNode;}if(sNode&&sNode.nodeType==1){this.$setTempSelected(sNode,ctrlKey,shiftKey);
}else{return false;}selHtml=apf.xmldb.getHtmlNode(sNode,this);top=apf.getAbsolutePosition(selHtml,this.$container)[1]+(selHtml.offsetHeight);
if(top>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=top-oExt.offsetHeight;}return false;
case 33:pos=apf.getAbsolutePosition(this.$container);el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+2);
sNode=apf.xmldb.findXmlNode(el);if(sNode==this.selected){oExt.scrollTop-=oExt.offsetHeight-apf.getHeightDiff(oExt);
el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+2);sNode=apf.xmldb.findXmlNode(el);
}this.select(sNode);selHtml=apf.xmldb.getHtmlNode(sNode,this);top=apf.getAbsolutePosition(selHtml,this.$container)[1]-(selHtml.offsetHeight);
if(top<=oExt.scrollTop){oExt.scrollTop=top;}break;case 34:pos=apf.getAbsolutePosition(this.$container);
el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+this.$ext.offsetHeight-4);
sNode=apf.xmldb.findXmlNode(el);if(sNode==this.selected){oExt.scrollTop+=oExt.offsetHeight-apf.getHeightDiff(oExt);
el=document.elementFromPoint(pos[0]+this.$container.offsetWidth-2,pos[1]+this.$ext.offsetHeight-4);
sNode=apf.xmldb.findXmlNode(el);}this.select(sNode);selHtml=apf.xmldb.getHtmlNode(sNode,this);
top=apf.getAbsolutePosition(selHtml,this.$container)[1]+(selHtml.offsetHeight);
if(top>oExt.scrollTop+oExt.offsetHeight){oExt.scrollTop=top-oExt.offsetHeight;}break;
default:if(this.celledit){if(!ctrlKey&&!e.altKey&&(key>46&&key<112||key>123)){this.startRename(null,true);
}return;}else{if(key==65&&ctrlKey){this.selectAll();return false;}else{if(this.caption||(this.bindingRules||{})["caption"]){if(!this.xmlRoot){return;
}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};
}this.lookup.str+=String.fromCharCode(key);var nodes=this.getTraverseNodes();for(var v,i=0;
i<nodes.length;i++){v=this.$applyBindRule("caption",nodes[i]);if(v&&v.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(nodes[i])){this.select(nodes[i]);
}if(selHtml){this.$container.scrollTop=selHtml.offsetTop-(this.$container.offsetHeight-selHtml.offsetHeight)/2;
}return;}}return;}}}break;}},true);this.$getCaptionElement=function(){if(!this.$selected){return false;
}var x=this.$getLayoutNode("item","caption",this.$selected);return x.nodeType==1?x:x.parentNode;
};this.$calcSelectRange=function(xmlStartNode,xmlEndNode){var r=[],f=false,i=0,pNodeStart=this.getTraverseParent(xmlStartNode),pNodeEnd=this.getTraverseParent(xmlEndNode),nodes=this.getTraverseNodes(pNodeStart);
for(;i<nodes.length;i++){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);
}if(nodes[i]==xmlEndNode){f=false;}}if(!r.length||f){r=[];for(f=false,i=nodes.length-1;
i>=0;i--){if(nodes[i]==xmlStartNode){f=true;}if(f){r.push(nodes[i]);}if(nodes[i]==xmlEndNode){f=false;
}}}return r;};this.$findContainer=function(htmlNode){return this.$getLayoutNode("item","container",htmlNode);
};this.$selectDefault=function(xmlNode){if(this.select(this.getFirstTraverseNode(xmlNode),null,null,null,true)){return true;
}else{var nodes=this.getTraverseNodes(xmlNode);for(var i=0;i<nodes.length;i++){if(this.$selectDefault(nodes[i])){return true;
}}}};this.$setEmptyMessage=function(htmlNode,msg){this.$getNewContext("empty");
var xmlEmpty=this.$getLayoutNode("empty");if(!xmlEmpty){return;}var empty=apf.insertHtmlNode(xmlEmpty,htmlNode);
empty.setAttribute("empty","true");var caption=this.$getLayoutNode("empty","caption",empty);
if(caption){apf.setNodeValue(caption,msg||"");}if(htmlNode.style){this.slideOpen(htmlNode,null,true);
}else{if(this.nocollapse){htmlNode.setAttribute("style","display:inline-block;");
}else{htmlNode.setAttribute("style","overflow:visible;height:auto;display:block;");
}}};this.$removeEmptyMessage=function(htmlNode){var cNode=htmlNode.firstElementChild||htmlNode.firstChild;
if(!cNode){return;}do{if(cNode.getAttribute&&cNode.getAttribute("empty")){htmlNode.removeChild(cNode);
return;}cNode=cNode.nextSibling;}while(cNode);};this.$drawBase=function(){this.$ext=this.$getExternal();
this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("main","openclose");
if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var _self=this;
this.$ext.onclick=function(e){_self.dispatchEvent("click",{htmlEvent:e||event});
};this.$ext.onmousedown=function(e){_self.dispatchEvent("mousedown",{htmlEvent:e||event});
};this.$ext.onmouseover=function(e){_self.dispatchEvent("mouseover",{htmlEvent:e||event});
};this.$ext.onmouseout=function(e){_self.dispatchEvent("mouseout",{htmlEvent:e||event});
};this.$ext.onmousemove=function(e){_self.dispatchEvent("mousemove",{htmlEvent:e||event});
};};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.nocollapse){this.startcollapsed=false;
}else{if(this.startcollapsed===1){this.startcollapsed=!apf.isFalse(this.$getOption("main","startcollapsed"));
}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$ext.onclick=null;
apf.destroyHtmlNode(this.oDrag);this.oDrag=null;});}).call(apf.BaseTree.prototype=new apf.MultiSelect());
apf.__DELAYEDRENDER__=1<<11;apf.DelayedRender=function(){this.$regbase=this.$regbase|apf.__DELAYEDRENDER__;
this.$rendered=false;this.$render=function(usedelay){if(this.$rendered){return;
}if(this.dispatchEvent("beforerender")===false){return;}if(this["render-delay"]||usedelay){$setTimeout("apf.lookup("+this.$uniqueId+").$renderparse()",10);
}else{this.$renderparse();}};this.$renderparse=function(){if(this.$rendered){return;
}this.$ext.style.visibility="hidden";var domParser=this.ownerDocument.$domParser;
domParser.parseFromXml(this.$aml,{amlNode:this,doc:this.ownerDocument,delayedRender:true});
domParser.$continueParsing(this);this.$rendered=true;this.dispatchEvent("afterrender");
this.$ext.style.visibility="";};var f;this.addEventListener("prop.visible",f=function(){if(arguments[0].value){this.$render();
this.removeEventListener("prop.visible",f);}});};apf.GuiElement.propHandlers.render=function(value){if(!this.hasFeature(apf.__DELAYEDRENDER__)&&value=="runtime"){this.implement(apf.DelayedRender);
if(this.localName!="page"){this.visible=false;this.$ext.style.display="none";}if(typeof this["render-delay"]=="undefined"){this.$setInheritedAttribute("render-delay");
}}};apf.config.$inheritProperties["render-delay"]=1;apf.__DRAGDROP__=1<<5;apf.DragDrop=function(){this.$regbase=this.$regbase|apf.__DRAGDROP__;
this.$dragInited=false;this.copy=function(nodeList,pNode,beforeNode,isMove){if(nodeList.nodeType){nodeList=[nodeList];
}var exec,changes=[],i=0,l=nodeList.length;for(;i<l;i++){changes.push({action:isMove?"moveNode":"appendChild",args:[pNode,isMove?nodeList[i]:nodeList[i]=nodeList[i].cloneNode(true),beforeNode]});
}if(this.$actions[(isMove?"movegroup":"copygroup")]){exec=this.$executeAction("multicall",changes,(isMove?"movegroup":"copygroup"),nodeList[0]);
}else{exec=this.$executeAction("multicall",changes,(isMove?"move":"copy"),nodeList[0],null,null,nodeList.length>1?nodeList:null);
}if(exec!==false){return nodeList;}return false;};this.move=function(nodeList,pNode,beforeNode){return this.copy(nodeList,pNode,beforeNode,true);
};this.isDragAllowed=function(x,data){if(!this.dragroot&&this.xmlRoot.firstChild==x[0]){return false;
}if(this.disabled||!x||!x.length||!x[0]){return false;}if(this.drag||this.dragcopy){if(data){data.merge(x);
}return true;}var d,ruleList=[],j=0,l=x.length;for(;j<l;j++){d=this.$getDataNode("drag",x[j],null,ruleList);
if(!d){return false;}if(data){data.push(d);}}return ruleList.length?ruleList:false;
};this.isDropAllowed=function(x,target){if(this.disabled||!x||!x.length||!target){return false;
}if(!this.dragroot==false&&this.xmlRoot.firstChild==x[0]){return false;}var data,tgt,hasDropRule=this.$attrBindings&&this.$attrBindings.drop;
if(this.drop&&(!hasDropRule||hasDropRule.value=="true")){this.$setDynamicProperty("drop",this.hasFeature(apf.__MULTISELECT__)?"["+this.each+"]":"[node()]");
hasDropRule=true;}if(hasDropRule){for(var j=0,l=x.length;j<l;j++){data=this.$getDataNode("drop",x[j]);
if(!data){break;}}if(j==l&&target&&!apf.isChildOf(data,target,true)){return[target,null];
}}var rules=this.$bindings.drop;if(!rules||!rules.length){return false;}var rule,strTgt,i=0,rl=rules.length;
for(;i<rl;i++){rule=this.$bindings.getRuleIndex("drop",i);for(var j=0,l=x.length;
j<l;j++){data=rule.cvalue?rule.cvalue(x[j]):rule.cmatch(x[j]);if(!data){break;}}if(j!=l){continue;
}strTgt=rule.target;if(!strTgt||strTgt=="."){tgt=target;}else{tgt=(rule.ctarget||rule.compile("target"))(target);
}if(tgt&&!apf.isChildOf(data,tgt,true)){return[tgt,rule];}}return false;};this.$dragDrop=function(xmlReceiver,xmlNodeList,rule,defaction,isParent,srcRule,event){if(action=="tree-append"&&isParent){return false;
}var action=rule&&rule.action;if(action){action=(rule.caction||rule.compile("action"))(xmlNodeList[0]);
}else{action=defaction;}var context={internal:apf.DragServer.dragdata.host==this,ctrlKey:event.ctrlKey,keyCode:event.keyCode},ifcopy=rule&&rule.copy;
if(ifcopy){ifcopy=!apf.isFalse((rule.ccopy||rule.compile("copy"))(xmlNodeList[0],context));
}else{if(typeof this.dragcopy=="boolean"||typeof this.dropcopy=="boolean"){if(this.dropcopy){ifcopy=this.dropcopy;
}else{if(this.dragcopy){ifcopy=event.ctrlKey;}else{var copyRule=this.$attrBindings&&this.$attrBindings.dragcopy;
if(copyRule){ifcopy=!apf.isFalse((copyRule.cvalue2||copyRule.compile("value",{withopt:true}))(xmlNodeList[0],context));
}}}}}if(!ifcopy){for(var i=0,l=srcRule.length;i<l;i++){ifcopy=typeof srcRule[i]=="object"&&srcRule[i].copy?!apf.isFalse((srcRule[i].ccopy||srcRule[i].compile("copy"))(xmlNodeList[0],context)):event.ctrlKey;
if(ifcopy){break;}}}var sNode,actRule=ifcopy?"copy":"move",parentXpath=rule?rule.getAttribute("parent"):null;
switch(action){case"list-append":xmlReceiver=(isParent?xmlReceiver:this.getTraverseParent(xmlReceiver));
if(parentXpath){if(xmlReceiver.selectSingleNode(parentXpath)){xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);
}else{xmlReceiver.appendChild(xmlReceiver.ownerDocument.createElement(parentXpath));
xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);}}sNode=this[actRule](xmlNodeList,xmlReceiver);
break;case"insert-before":sNode=isParent?this[actRule](xmlNodeList,xmlReceiver):this[actRule](xmlNodeList,xmlReceiver.parentNode,xmlReceiver);
break;case"tree-append":if(parentXpath){if(xmlReceiver.selectSingleNode(parentXpath)){xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);
}else{xmlReceiver.appendChild(xmlReceiver.ownerDocument.createElement(parentXpath));
xmlReceiver=xmlReceiver.selectSingleNode(parentXpath);}}sNode=this[actRule](xmlNodeList,xmlReceiver);
break;}if(this.selectable&&sNode){this.selectList(sNode);this.setCaret(sNode[0]);
this.focus();}return sNode;};this.enableDragDrop=function(){this.icoAllowed="";
this.icoDenied="";this.$ext.dragdrop=false;var _self=this;this.$ext[apf.isIphone?"ontouchstart":"onmousedown"]=function(e){if(_self.disabled){return;
}e=e||window.event;var fEl,srcEl=e.originalTarget||e.srcElement||e.target,multiselect=_self.hasFeature(apf.__MULTISELECT__);
if(multiselect&&srcEl==_self.$container){return;}_self.dragging=0;try{if(!apf.isIphone&&_self.allowdeselect&&(srcEl==this||srcEl.getAttribute(apf.xmldb.htmlIdTag)&&_self.$getLayoutNode("item","select",this)!=this)){return;
}}catch(e){return;}if(_self.$findValueNode){fEl=_self.$findValueNode(srcEl);}var el=(fEl?apf.xmldb.getNode(fEl):apf.xmldb.findXmlNode(srcEl));
if(multiselect&&(!_self.selected||!el||el==_self.xmlRoot)){return;}if(_self.isDragAllowed(multiselect?_self.$getSelection():el)){apf.DragServer.start(_self,srcEl,e);
}};this.$ext[apf.isIphone?"ontouchmove":"onmousemove"]=function(e){if(this.host.dragging!=1||_self.disabled){return;
}};this.$ext.onmouseup=function(){if(_self.disabled){return;}this.host.dragging=0;
};this.$ext.ondragcopy=this.$ext.ondragstart=function(){return false;};if(document.elementFromPointAdd){document.elementFromPointAdd(this.$ext);
}if(this.$initDragDrop&&!this.$dragInited){this.$initDragDrop();this.$dragInited=2;
}else{this.$dragInited=true;}};function disableDragDrop(){this.$dragInited=false;
this.$ext.onmousedown=this.$ext.onmousemove=this.$ext.onmouseup=null;if(document.elementFromPointRemove){document.elementFromPointRemove(this.$ext);
}}this.implement(this.hasFeature(apf.__MULTISELECT__)?apf.MultiselectDragDrop:apf.StandardDragDrop);
this.$supportedProperties.push("drop","drag","dragcopy");this.$propHandlers.dragcopy=this.$propHandlers.dropcopy=this.$propHandlers.drag=this.$propHandlers.drop=function(value,prop){this[prop]=apf.isTrue(value);
if(this.$dragInited&&prop=="drag"&&value&&this.$dragInited!=2){this.$initDragDrop();
this.$dragInited=2;return;}if(prop=="dragcopy"||prop=="dropcopy"){return;}if(!value&&!this.drag&&!this.drop&&!this.$bindings&&(this.$attrBindings&&(!this.$attrBindings.drag||!this.$attrBindings.drop))){disableDragDrop.call(this);
}else{if(value&&!this.$dragInited){this.enableDragDrop();}}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){disableDragDrop.call(this);
if(this.oDrag){apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}});};apf.GuiElement.propHandlers.dragcopy=apf.GuiElement.propHandlers.dropcopy=apf.GuiElement.propHandlers.drop=apf.GuiElement.propHandlers.drag=function(value,prop){if(!apf.isFalse(value)){if(!this.hasFeature(apf.__DRAGDROP__)){this.implement(apf.DragDrop);
this.enableDragDrop();}this[prop]=apf.isTrue(value);}};apf.DragServer={Init:function(){apf.addEventListener("hotkey",function(e){if(apf.window.dragging&&e.keyCode==27){if(document.body.lastHost&&document.body.lastHost.dragOut){document.body.lastHost.dragOut(apf.dragHost);
}return apf.DragServer.stopdrag();}});},start:function(amlNode,srcEl,e,customNode){if(document.elementFromPointReset){document.elementFromPointReset();
}amlNode.dragging=1;var d=window.document;d=(!d.compatMode||d.compatMode=="CSS1Compat")?d.html||d.documentElement:d.body;
var scrollX=(apf.isIE?d.scrollLeft:window.pageXOffset),scrollY=(apf.isIE?d.scrollTop:window.pageYOffset),oParent=amlNode.$ext.offsetParent,pos;
while(oParent&&oParent!=d&&oParent.tagName!="BODY"){scrollX-=oParent.scrollLeft;
scrollY-=oParent.scrollTop;oParent=oParent.offsetParent;}if(!srcEl&&customNode){pos=[0,0];
}else{var loopEl=srcEl,lastId;while(loopEl&&loopEl.nodeType==1&&!(lastId=loopEl.getAttribute(apf.xmldb.htmlIdTag))){loopEl=loopEl.parentNode;
}if(!lastId){return;}pos=apf.getAbsolutePosition(loopEl);}apf.DragServer.coordinates={srcElement:srcEl,doc:d,scrollX:scrollX,scrollY:scrollY,offsetX:e.clientX-pos[0],offsetY:e.clientY-pos[1],clientX:e.pageX?e.pageX-window.pageXOffset:e.clientX,clientY:e.pageY?e.pageY-window.pageYOffset:e.clientY};
var selection=customNode||amlNode.hasFeature(apf.__MULTISELECT__)?amlNode.getSelection():[amlNode.xmlRoot],data=[],srcRules=amlNode.isDragAllowed(selection,data);
if(!srcRules){return;}if(amlNode.hasEventListener("dragdata")){data=amlNode.dispatchEvent("dragdata",{data:data});
}this.dragdata={rules:srcRules,selection:selection,data:data,indicator:amlNode.$showDragIndicator(selection,this.coordinates),host:amlNode};
if(amlNode.dispatchEvent("dragstart",this.dragdata)===false){return false;}amlNode.dragging=2;
apf.dragMode=true;document.onmousemove=this.onmousemove;document.onmouseup=this.onmouseup;
},stop:function(runEvent,success){if(this.last){this.dragout();}this.dragdata.host.dispatchEvent("dragstop");
this.dragdata.host.dragging=0;this.dragdata.host.$hideDragIndicator(success);apf.dragMode=false;
document.onmousemove=document.onmouseup=null;this.dragdata=null;},dragover:function(o,el,e){var _self=this,originalEl=el;
function checkPermission(targetEl){return o.isDropAllowed&&o.xmlRoot?o.isDropAllowed(_self.dragdata.data,targetEl):apf.isTrue(apf.getInheritedAttribute(o,"",function(p){if(p.drop){o=p;
if(o==apf.DragServer.last){return false;}return true;}}));}e=e||window.event;var fEl;
if(o.$findValueNode){fEl=o.$findValueNode(el);}if(this.lastFel&&this.lastFel==fEl||!this.lastFel&&this.last==o){return;
}var elSel=(fEl?apf.xmldb.getNode(fEl):apf.xmldb.findXmlNode(el)),candrop=checkPermission(elSel||o.xmlRoot);
if(this.last&&this.last!=o){this.dragout(this.last,e);}this.last=o;this.lastFel=fEl;
if(!candrop){if(o&&o.$dragover){var parentNode=(elSel||o.xmlRoot).parentNode;if(parentNode&&(el=apf.xmldb.findHtmlNode(parentNode,o))){if(o.$findValueNode){fEl=o.$findValueNode(el);
}elSel=(fEl?apf.xmldb.getNode(fEl):apf.xmldb.findXmlNode(el));candrop=checkPermission(parentNode);
this.lastFel=el;if(!candrop){return;}}else{return;}}else{return;}}if(o.dispatchEvent("dragover",this.dragdata,{target:(elSel||o.xmlRoot),lastEl:o.lastel,originalEl:originalEl})===false){candrop=false;
}var srcEl=e.originalTarget||e.srcElement||e.target;if(o&&o.$dragover){o.$dragover(el,this.dragdata,candrop);
}},dragout:function(o,e){this.lastFel=null;if(o){this.dragdata.htmlEvent=e;o.dispatchEvent("dragout",this.dragdata);
}if(this.last&&this.last.$dragout){this.last.$dragout(null,this.dragdata);}this.last=null;
},dragdrop:function(o,el,srcO,e){var _self=this;function checkPermission(targetEl){return o.isDropAllowed&&o.xmlRoot?o.isDropAllowed(_self.dragdata.data,targetEl):apf.isTrue(apf.getInheritedAttribute(o,"",function(p){if(p.drop){o=p;
return true;}}));}var isParent,lastTop,elSel=(o.$findValueNode?apf.xmldb.getNode(o.$findValueNode(el)):apf.xmldb.findXmlNode(el)),candrop=checkPermission(elSel||o.xmlRoot);
if(this.dragdata.indicator){lastTop=this.dragdata.indicator.style.top;this.dragdata.indicator.style.top="10000px";
}if(!candrop){if(o&&o.$dragover){var parentNode=(elSel||o.xmlRoot).parentNode,htmlParentNode;
if(parentNode&&(htmlParentNode=apf.xmldb.findHtmlNode(parentNode,o))){candrop=checkPermission(parentNode);
el=htmlParentNode;}}}if(candrop){if(o.dispatchEvent("dragdrop",apf.extend({candrop:candrop,htmlEvent:e,top:lastTop},this.dragdata))===false){candrop=false;
}else{if(!o.xmlRoot){var m=o.getModel?o.getModel(true):apf.nameserver.get("model",o.model);
if(m){m.load(this.dragdata.data[0]);}return true;}else{var action=candrop[1]&&candrop[1].action||(o.$isTreeArch?"tree-append":"list-append");
if(action=="list-append"&&(!o.$isTreeArch&&o==this.dragdata.host)){candrop=false;
}}}}if(this.dragdata.indicator){this.dragdata.indicator.style.top=lastTop;}if(!candrop){this.dragout(o,e);
return false;}if(o.$dragDrop){var rNode=o.$dragDrop(candrop[0],this.dragdata.data,candrop[1],action,isParent||candrop[0]==o.xmlRoot,this.dragdata.rules,e);
this.dragdata.resultNode=rNode;}if(o.$dragdrop){o.$dragdrop(el,apf.extend({htmlEvent:e,xmlNode:rNode},this.dragdata),candrop);
}this.last=null;this.lastFel=null;return true;},onmousemove:function(e){if(!apf.DragServer.dragdata){return;
}e=e||window.event;var dragdata=apf.DragServer.dragdata,c={clientX:e.pageX?e.pageX-window.pageXOffset:e.clientX,clientY:e.pageY?e.pageY-window.pageYOffset:e.clientY};
if(!dragdata.started&&Math.abs(apf.DragServer.coordinates.clientX-c.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-c.clientY)<6){return;
}if(!dragdata.started){if(dragdata.host.$dragstart){dragdata.host.$dragstart(null,dragdata);
}dragdata.started=true;}if(dragdata.indicator){var storeIndicatorTopPos=dragdata.indicator.style.top;
dragdata.indicator.style.display="block";dragdata.indicator.style.top="10000px";
}apf.DragServer.dragdata.x=e.pageX?e.pageX-(!apf.isIE?window.pageXOffset:0):c.clientX;
apf.DragServer.dragdata.y=e.pageY?e.pageY-(!apf.isIE?window.pageYOffset:0):c.clientY;
var el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
if(!el){el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
}if(dragdata.indicator){dragdata.indicator.style.top=storeIndicatorTopPos;}dragdata.host.$moveDragIndicator(c);
var receiver=apf.findHost(el);if(receiver){apf.DragServer.dragover(receiver,el,e);
}else{if(apf.DragServer.last){apf.DragServer.dragout(apf.DragServer.last,e);}}apf.DragServer.lastTime=new Date().getTime();
},onmouseup:function(e){e=e||window.event;var c={clientX:e.pageX?e.pageX-window.pageXOffset:e.clientX,clientY:e.pageY?e.pageY-window.pageYOffset:e.clientY};
if(!apf.DragServer.dragdata.started&&Math.abs(apf.DragServer.coordinates.clientX-c.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-c.clientY)<6){apf.DragServer.stop(true);
return;}var indicator=apf.DragServer.dragdata.indicator,storeIndicatorTopPos=indicator.style.top;
if(indicator){indicator.style.top="10000px";}apf.DragServer.dragdata.x=e.pageX?e.pageX-(!apf.isIE?window.pageXOffset:0):c.clientX;
apf.DragServer.dragdata.y=e.pageY?e.pageY-(!apf.isIE?window.pageYOffset:0):c.clientY;
var el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
if(!el){el=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);
}indicator.style.top=storeIndicatorTopPos;var host=apf.findHost(el);if(apf.DragServer.host&&host!=apf.DragServer.host){apf.DragServer.dragout(apf.DragServer.host,e);
}var success=apf.DragServer.dragdrop(host,el,apf.DragServer.dragdata.host,e);apf.DragServer.stop(true,success);
}};apf.MultiselectDragDrop=function(){this.diffX=this.diffY=0;this.multiple=false;
this.lastDragNode=null;this.lastel=null;this.$showDragIndicator=function(sel,e){var srcEl=e.originalTarget||e.srcElement||e.target;
this.multiple=sel.length>1;if(this.multiple){this.diffX=e.scrollX;this.diffY=e.scrollY;
}else{var itemNode=apf.xmldb.findHtmlNode(sel[0],this);this.diffX=-1*(e.offsetX-parseInt(apf.getStyleRecur(itemNode,"padding-left").replace(/px$/,"")-10));
this.diffY=-1*e.offsetY;}var prefix=this.oDrag.className.split(" ")[0];this.$setStyleClass(this.oDrag,(this.multiple?prefix+"_multiple":"")+(this["class"]?" "+this["class"]:""),[prefix+"_multiple"]);
if(this.multiple){document.body.appendChild(this.oDrag);return this.oDrag;}else{if(this.localName=="datagrid"){if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);
}sel=this.$selected||this.$caret;var oDrag=sel.cloneNode(true);oDrag.removeAttribute("onmousedown");
oDrag.onmousedown=null;oDrag.removeAttribute("onmouseup");oDrag.onmouseup=null;
oDrag.removeAttribute("onmouseout");oDrag.onmouseout=null;oDrag.removeAttribute("ondblclick");
oDrag.ondblclick=null;document.body.appendChild(oDrag);oDrag.style.position="absolute";
oDrag.style.width=sel.offsetWidth+"px";oDrag.style.display="none";oDrag.removeAttribute("id");
this.$setStyleClass(oDrag,"draggrid");var nodes=sel.childNodes;var dragnodes=oDrag.childNodes;
for(var i=nodes.length-1;i>=0;i--){if(dragnodes[i].nodeType==1){dragnodes[i].style.width=apf.getStyle(nodes[i],"width");
}}return(this.lastDragNode=oDrag);}else{var sel=this.$selected||this.$caret,width=apf.getStyle(this.oDrag,"width");
if(!sel){return;}if(!width||width=="auto"){this.oDrag.style.width=(sel.offsetWidth-apf.getWidthDiff(this.oDrag))+"px";
}this.$updateNode(this.selected,this.oDrag);}}apf.window.zManager.set("drag",this.oDrag);
return this.oDrag;};this.$hideDragIndicator=function(success){var oDrag=this.lastDragNode||this.oDrag,_self=this;
if(!this.multiple&&!success&&oDrag.style.display=="block"){if(!this.$selected&&!this.$caret){return;
}var pos=apf.getAbsolutePosition(this.$selected||this.$caret);apf.tween.multi(oDrag,{anim:apf.tween.easeInOutCubic,steps:apf.isIE?15:20,interval:15,tweens:[{type:"left",from:oDrag.offsetLeft,to:(pos[0]+parseInt(apf.getStyleRecur(this.$selected,"padding-left").replace(/px$/,"")))},{type:"top",from:oDrag.offsetTop,to:pos[1]}],onfinish:function(){if(_self.lastDragNode){apf.destroyHtmlNode(_self.lastDragNode);
_self.lastDragNode=null;}else{_self.oDrag.style.display="none";}}});}else{if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);
this.lastDragNode=null;}else{this.oDrag.style.display="none";}}};this.$moveDragIndicator=function(e){var oDrag=this.lastDragNode||this.oDrag;
oDrag.style.left=(e.clientX+this.diffX)+"px";oDrag.style.top=(e.clientY+this.diffY+(this.multiple?15:0))+"px";
};this.addEventListener("$skinchange",function(){this.$initDragDrop();});this.$initDragDrop=function(){if(!this.$hasLayoutNode("dragindicator")){return;
}this.oDrag=apf.insertHtmlNode(this.$getLayoutNode("dragindicator"),document.body);
apf.window.zManager.set("drag",this.oDrag);this.oDrag.style.position="absolute";
this.oDrag.style.cursor="default";this.oDrag.style.display="none";};this.$findValueNode=function(el){if(!el){return null;
}while(el&&el.nodeType==1&&!el.getAttribute(apf.xmldb.htmlIdTag)){if(this.$isTreeArch&&el.previousSibling&&el.previousSibling.nodeType==1){el=el.previousSibling;
}else{el=el.parentNode;}}return(el&&el.nodeType==1&&el.getAttribute(apf.xmldb.htmlIdTag))?el:null;
};this.$dragout=function(el,dragdata,extra){if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);
}var sel=this.$getSelection(true);for(var i=0,l=sel.length;i<l;i++){this.$setStyleClass(sel[i],"selected",["dragDenied","dragInsert","dragAppend","indicate"]);
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Drop"]);this.lastel=null;
};if(!this.$dragdrop){this.$dragdrop=this.$dragout;}this.$dragover=function(el,dragdata,extra){this.$setStyleClass(this.$ext,this.$baseCSSname+"Drop");
var sel=this.$getSelection(true);for(var i=0,l=sel.length;i<l;i++){this.$setStyleClass(sel[i],"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);
}if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);
}var action=extra[1]&&extra[1].action;this.lastel=this.$findValueNode(el);if(this.$isTreeArch&&action=="list-append"){var htmlNode=apf.xmldb.findHtmlNode(this.getTraverseParent(apf.xmldb.getNode(this.lastel)),this);
this.lastel=htmlNode?this.$getLayoutNode("item","container",htmlNode):this.$container;
this.$setStyleClass(this.lastel,"dragInsert");}else{this.$setStyleClass(this.lastel,extra?(action=="insert-before"?"dragInsert":"dragAppend"):"dragDenied");
}};};apf.StandardDragDrop=function(){this.$showDragIndicator=function(sel,e){var x=e.offsetX+22,y=e.offsetY;
this.oDrag.startX=x;this.oDrag.startY=y;document.body.appendChild(this.oDrag);var oInt=this.$getLayoutNode("main","caption",this.oDrag);
if(oInt.nodeType!=1){oInt=oInt.parentNode;}oInt.innerHTML=this.$applyBindRule("caption",this.xmlRoot)||"";
return this.oDrag;};this.$hideDragIndicator=function(){this.oDrag.style.display="none";
};this.$moveDragIndicator=function(e){this.oDrag.style.left=(e.clientX-this.oDrag.startX+document.documentElement.scrollLeft)+"px";
this.oDrag.style.top=(e.clientY-this.oDrag.startY+document.documentElement.scrollTop)+"px";
};this.$initDragDrop=function(){if(!this.getAttribute("drag")){return;}this.oDrag=document.body.appendChild(this.$ext.cloneNode(true));
apf.window.zManager.set("drag",this.oDrag);this.oDrag.style.position="absolute";
this.oDrag.style.cursor="default";this.oDrag.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";
this.oDrag.style.MozOpacity=0.5;this.oDrag.style.opacity=0.5;this.oDrag.style.display="none";
};};apf.DragServer.Init();apf.__FOCUSSABLE__=1<<26;apf.Focussable=function(){this.$regbase=this.$regbase|apf.__FOCUSSABLE__;
if(this.disabled==undefined){this.disabled=false;}this.setTabIndex=function(tabindex){apf.window.$removeFocus(this);
apf.window.$addFocus(this,tabindex);return this;};this.focus=function(noset,e,nofix){if(!noset){if(this.$isWindowContainer>-1){apf.window.$focusLast(this,e,true);
}else{apf.window.$focus(this,e);if(!nofix&&apf.hasFocusBug){apf.window.$focusfix();
}}return this;}if(this.$focus&&!this.editable&&(!e||!e.mouse||this.$focussable==apf.KEYBOARD_MOUSE)){this.$focus(e);
}this.dispatchEvent("focus",apf.extend({bubbles:true},e));return this;};this.blur=function(noset,e){if((e&&!apf.isChildOf(e.fromElement,e.toElement))&&apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();
}if(this.$blur){this.$blur(e);}if(!noset){apf.window.$blur(this);}this.dispatchEvent("blur",apf.extend({bubbles:!e||!e.cancelBubble},e));
return this;};this.hasFocus=function(){return apf.document.activeElement==this||this.$isWindowContainer&&(apf.document.activeElement||{}).$focusParent==this;
};};apf.__INTERACTIVE__=1<<21;apf.Interactive=function(){var nX,nY,rX,rY,startPos,lastCursor=null,l,t,r,b,lMax,tMax,lMin,tMin,w,h,we,no,ea,so,rszborder,rszcorner,marginBox,verdiff,hordiff,_self=this,posAbs,oX,oY,overThreshold,dragOutline,resizeOutline,myPos,startGeo;
this.$regbase=this.$regbase|apf.__INTERACTIVE__;this.$dragStart=function(e,reparent){var nativeEvent=e||event;
if(!reparent&&nativeEvent.button==2){return;}dragStart.apply(nativeEvent.srcElement||this,arguments);
};this.$propHandlers.draggable=function(value){if(apf.isFalse(value)){this.draggable=value=false;
}else{if(apf.isTrue(value)){this.draggable=value=true;}}var o=this.editable?this.$ext:this.oDrag||this.$ext;
if(value){apf.addListener(o,"mousedown",this.$dragStart);}else{apf.removeListener(o,"mousedown",this.$dragStart);
}if(o.interactive&1){return;}o.interactive=(o.interactive||0)+1;};this.$propHandlers.resizable=function(value){if(apf.isFalse(value)){this.resizable=value=false;
}else{if(apf.isTrue(value)){this.resizable=value=true;}}this.$ext.style.cursor="";
var o=this.oResize||this.$ext;if(o.interactive&2){return;}if(!_self.editable){apf.addListener(o,"mousedown",function(){resizeStart.apply(o,arguments);
});apf.addListener(o,"mousemove",function(){resizeIndicate.apply(o,arguments);});
}o.interactive=(o.interactive||0)+2;rszborder=this.$getOption&&parseInt(this.$getOption("Main","resize-border"))||3;
rszcorner=this.$getOption&&parseInt(this.$getOption("Main","resize-corner"))||12;
marginBox=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};this.$cancelInteractive=function(){document.onmouseup(null,true);
};function dragStart(e,reparent){if(!e){e=event;}if(!reparent&&(!_self.draggable||apf.dragMode)){return;
}dragOutline=_self.dragOutline==true||apf.config.dragOutline;if(_self.dispatchEvent("beforedragstart",{htmlEvent:e})===false){return;
}apf.dragMode=true;if(reparent){_self.dispatchEvent("beforedrag");overThreshold=true;
}else{overThreshold=false;}apf.popup.forceHide();posAbs="absolute|fixed".indexOf(apf.getStyle(_self.$ext,"position"))>-1;
if(!posAbs){_self.$ext.style.position=posAbs?"absolute":"relative";}if(_self.editable){posAbs=true;
}if(posAbs&&!_self.aData){apf.plane.show(dragOutline?oOutline:_self.$ext,e.reappend);
}var ext=(reparent||(oOutline&&oOutline.self))&&dragOutline?oOutline:_self.$ext;
var pos=posAbs?apf.getAbsolutePosition(ext,ext.offsetParent,true):[parseInt(apf.getStyle(ext,"left"))||0,parseInt(apf.getStyle(ext,"top"))||0];
startGeo=[ext.style.left,ext.style.top,ext.style.right,ext.style.bottom,ext.style.width,ext.style.height];
nX=pos[0]-(oX=e.clientX);nY=pos[1]-(oY=e.clientY);if(!(reparent||(oOutline&&oOutline.self))){if(posAbs&&dragOutline){oOutline.className="drag";
var diffOutline=apf.getDiff(oOutline);_self.$ext.offsetParent.appendChild(oOutline);
oOutline.style.left=pos[0]+"px";oOutline.style.top=pos[1]+"px";oOutline.style.width=(_self.$ext.offsetWidth-diffOutline[0])+"px";
oOutline.style.height=(_self.$ext.offsetHeight-diffOutline[1])+"px";if(_self.editable){oOutline.style.display="block";
}}else{if(_self.$ext.style.right){_self.$ext.style.left=pos[0]+"px";_self.$ext.style.right="";
}if(_self.$ext.style.bottom){_self.$ext.style.top=pos[1]+"px";_self.$ext.style.bottom="";
}}}document.onmousemove=dragMove;document.onmouseup=function(e,cancel){document.onmousemove=document.onmouseup=null;
if(posAbs&&!_self.aData){apf.plane.hide();}var htmlNode=dragOutline?oOutline:_self.$ext;
if(overThreshold&&!_self.$multidrag){if(cancel){var ext=_self.$ext;ext.style.left=startGeo[0];
ext.style.top=startGeo[1];ext.style.right=startGeo[2];ext.style.bottom=startGeo[3];
ext.style.width=startGeo[4];ext.style.height=startGeo[5];if(_self.dispatchEvent){_self.dispatchEvent("dragcancel",{htmlNode:htmlNode,htmlEvent:e});
}}else{if(_self.setProperty){updateProperties();}else{if(dragOutline){_self.$ext.style.left=l+"px";
_self.$ext.style.top=t+"px";}}}}l=t=w=h=null;if(!posAbs){_self.$ext.style.position="relative";
}if(_self.showdragging){apf.setStyleClass(_self.$ext,"",["dragging"]);}if(posAbs&&dragOutline&&!oOutline.self){oOutline.style.display="none";
}apf.dragMode=false;if(!cancel&&_self.dispatchEvent&&overThreshold){_self.dispatchEvent("afterdrag",{htmlNode:htmlNode,htmlEvent:e});
}};if(reparent){document.onmousemove(e);}return false;}function dragMove(e){if(!e){e=event;
}if(!overThreshold&&_self.showdragging){apf.setStyleClass(_self.$ext,"dragging");
}var dx=e.clientX-oX,dy=e.clientY-oY,distance;if(!overThreshold&&(distance=dx*dx>dy*dy?dx:dy)*distance<2){return;
}else{if(!overThreshold){if(dragOutline&&oOutline.style.display!="block"){oOutline.style.display="block";
}if(_self.dispatchEvent&&_self.dispatchEvent("beforedrag",{htmlEvent:e})===false){document.onmouseup();
return;}}}var oHtml=dragOutline?oOutline:_self.$ext;oHtml.style.left=(l=e.clientX+nX)+"px";
oHtml.style.top=(t=e.clientY+nY)+"px";if(_self.realtime){var change=_self.$stick={};
_self.$showDrag(l,t,oHtml,e,change);if(typeof change.l!="undefined"){l=change.l,oHtml.style.left=l+"px";
}if(typeof change.t!="undefined"){t=change.t,oHtml.style.top=t+"px";}}overThreshold=true;
}this.$resizeStart=resizeStart;function resizeStart(e,options){if(!e){e=event;}if(!_self.resizable||String(_self.height).indexOf("%")>-1&&_self.parentNode.localName=="vbox"||String(_self.width).indexOf("%")>-1&&_self.parentNode.localName=="hbox"){return;
}resizeOutline=!(_self.resizeOutline==false||!apf.config.resizeOutline);var ext=_self.$ext;
if(!resizeOutline){var diff=apf.getDiff(ext);hordiff=diff[0];verdiff=diff[1];}startPos=apf.getAbsolutePosition(ext);
startPos.push(ext.offsetWidth);startPos.push(ext.offsetHeight);myPos=apf.getAbsolutePosition(ext,ext.offsetParent,true);
startGeo=[ext.style.left,ext.style.top,ext.style.right,ext.style.bottom,ext.style.width,ext.style.height];
var sLeft=0,sTop=0,x=(oX=e.clientX)-startPos[0]+sLeft+document.documentElement.scrollLeft,y=(oY=e.clientY)-startPos[1]+sTop+document.documentElement.scrollTop,resizeType;
if(options&&options.resizeType){posAbs="absolute|fixed".indexOf(apf.getStyle(ext,"position"))>-1;
resizeType=options.resizeType;}else{resizeType=getResizeType.call(ext,x,y);}rX=x;
rY=y;if(!resizeType){return;}if(_self.dispatchEvent&&_self.dispatchEvent("beforeresize",{type:resizeType,setType:function(type){resizeType=type;
}})===false){return;}apf.popup.forceHide();apf.dragMode=true;overThreshold=false;
we=resizeType.indexOf("w")>-1;no=resizeType.indexOf("n")>-1;ea=resizeType.indexOf("e")>-1;
so=resizeType.indexOf("s")>-1;if(!_self.minwidth){_self.minwidth=0;}if(!_self.minheight){_self.minheight=0;
}if(!_self.maxwidth){_self.maxwidth=10000;}if(!_self.maxheight){_self.maxheight=10000;
}if(posAbs){lMax=myPos[0]+startPos[2];tMax=myPos[1]+startPos[3];lMin=myPos[0]+startPos[2];
tMin=myPos[1]+startPos[3];}if(posAbs){apf.plane.show(resizeOutline?oOutline:ext);
}if(resizeOutline){oOutline.className="resize";var diffOutline=apf.getDiff(oOutline);
hordiff=diffOutline[0];verdiff=diffOutline[1];oOutline.style.left=startPos[0]+"px";
oOutline.style.top=startPos[1]+"px";oOutline.style.width=(ext.offsetWidth-hordiff)+"px";
oOutline.style.height=(ext.offsetHeight-verdiff)+"px";oOutline.style.display="block";
}else{if(ext.style.right){iStyleRight=ext.style.right.slice(0,-2);if(iStyleRight){myPos[0]=myPos[0]+parseInt(iStyleRight);
ext.style.left=myPos[0]+"px";}else{ext.style.left=myPos[0]+"px";}}if(ext.style.bottom){ext.style.top=myPos[1]+"px";
}}if(!options||!options.nocursor){if(lastCursor===null){lastCursor=document.body.style.cursor;
}document.body.style.cursor=resizeType+"-resize";}document.onmousemove=resizeMove;
document.onmouseup=function(e,cancel){document.onmousemove=document.onmouseup=null;
if(posAbs){apf.plane.hide();}clearTimeout(timer);if(resizeOutline){var diff=apf.getDiff(_self.$ext);
hordiff=diff[0];verdiff=diff[1];}if(cancel){var ext=_self.$ext;ext.style.left=startGeo[0];
ext.style.top=startGeo[1];ext.style.right=startGeo[2];ext.style.bottom=startGeo[3];
ext.style.width=startGeo[4];ext.style.height=startGeo[5];if(_self.dispatchEvent){_self.dispatchEvent("resizecancel");
}}else{doResize(e||event,true);}if(_self.setProperty){updateProperties();}document.body.style.cursor=lastCursor||"";
lastCursor=null;if(resizeOutline){oOutline.style.display="none";}apf.dragMode=false;
if(!cancel&&_self.dispatchEvent){_self.dispatchEvent("afterresize",{l:l,t:t,w:w+hordiff,h:h+verdiff});
}l=t=w=h=null;};return false;}function updateProperties(left,top,width,height,hdiff,vdiff,right,bottom){if(typeof left=="undefined"){left=l,top=t,width=w,height=h,vdiff=verdiff,hdiff=hordiff;
}else{posAbs=true;}var hasLeft=_self.left||_self.left===0;var hasRight=_self.right||_self.right===0;
var hasBottom=_self.bottom||_self.bottom===0;var hasTop=_self.top||_self.top===0;
if(posAbs){var htmlNode=(oOutline&&oOutline.style.display=="block")?oOutline:_self.$ext;
if(hasRight&&!(right||right===0)){right=apf.getHtmlRight(htmlNode);}if(hasBottom&&!(bottom||bottom===0)){bottom=apf.getHtmlBottom(htmlNode);
}if(hasRight){_self.setProperty("right",right,0,_self.editable);if(!_self.left){htmlNode.style.left="";
}}if(hasBottom){_self.setProperty("bottom",bottom,0,_self.editable);if(!_self.top){htmlNode.style.top="";
}}if((left||left===0)&&(!hasRight||hasLeft)){_self.setProperty("left",left,0,_self.editable);
}if((top||top===0)&&(!hasBottom||hasTop)){_self.setProperty("top",top,0,_self.editable);
}}if(hdiff!=undefined&&width&&(!hasLeft||!hasRight)){_self.setProperty("width",width+hdiff,0,_self.editable);
}if(vdiff!=undefined&&height&&(!hasTop||!hasBottom)){_self.setProperty("height",height+vdiff,0,_self.editable);
}}this.$updateProperties=updateProperties;var min=Math.min,max=Math.max,lastTime,timer;
function resizeMove(e){if(!e){e=event;}clearTimeout(timer);if(lastTime&&new Date().getTime()-lastTime<(resizeOutline?6:apf.mouseEventBuffer)){var z={clientX:e.clientX,clientY:e.clientY};
timer=setTimeout(function(){doResize(z);},10);return;}lastTime=new Date().getTime();
doResize(e);}function doResize(e,force){var oHtml=resizeOutline&&!force?oOutline:_self.$ext;
var sLeft=document.documentElement.scrollLeft,sTop=document.documentElement.scrollTop;
if(we){if(posAbs){oHtml.style.left=(l=max((lMin-_self.maxwidth),min((lMax-_self.minwidth),myPos[0]+e.clientX-oX+sLeft)))+"px";
}oHtml.style.width=(w=min(_self.maxwidth-hordiff,max(hordiff,_self.minwidth,startPos[2]-(e.clientX-oX)+sLeft)-hordiff))+"px";
}if(no){if(posAbs){oHtml.style.top=(t=max((tMin-_self.maxheight),min((tMax-_self.minheight),myPos[1]+e.clientY-oY+sTop)))+"px";
}oHtml.style.height=(h=min(_self.maxheight-verdiff,max(verdiff,_self.minheight,startPos[3]-(e.clientY-oY)+sTop)-verdiff))+"px";
}if(ea){oHtml.style.width=(w=min(_self.maxwidth-hordiff,max(hordiff,_self.minwidth,e.clientX-startPos[0]+(startPos[2]-rX)+sLeft)-hordiff))+"px";
}if(so){oHtml.style.height=(h=min(_self.maxheight-verdiff,max(verdiff,_self.minheight,e.clientY-startPos[1]+(startPos[3]-rY)+sTop)-verdiff))+"px";
}if(_self.parentNode&&_self.parentNode.localName=="table"){updateProperties();apf.layout.processQueue();
}if(_self.realtime){var change=_self.$stick={};_self.$showResize(l||apf.getHtmlLeft(oHtml),t||apf.getHtmlTop(oHtml),w&&w+hordiff||oHtml.offsetWidth,h&&h+verdiff||oHtml.offsetHeight,e,change,we,no,ea,so);
if(posAbs&&we&&typeof change.l!="undefined"){oHtml.style.left=(l=max((lMin-_self.maxwidth),min((lMax-_self.minwidth),change.l)))+"px";
}if(posAbs&&no&&typeof change.t!="undefined"){oHtml.style.top=(t=max((tMin-_self.maxheight),min((tMax-_self.minheight),change.t)))+"px";
}if(typeof change.w!="undefined"){oHtml.style.width=(w=min(_self.maxwidth-hordiff,max(hordiff,_self.minwidth,change.w)-hordiff))+"px";
}if(typeof change.h!="undefined"){oHtml.style.height=(h=min(_self.maxheight-verdiff,max(verdiff,_self.minheight,change.h)-verdiff))+"px";
}}if(apf.hasSingleRszEvent){apf.layout.forceResize(_self.$int);}}function getResizeType(x,y){var cursor="",tcursor="";
posAbs="absolute|fixed".indexOf(apf.getStyle(_self.$ext,"position"))>-1;if(_self.resizable==true||_self.resizable=="vertical"){if(y<rszborder+marginBox[0]){cursor=posAbs?"n":"";
}else{if(y>this.offsetHeight-rszborder){cursor="s";}else{if(y>this.offsetHeight-rszcorner){tcursor="s";
}}}}if(_self.resizable==true||_self.resizable=="horizontal"){if(x<(cursor?rszcorner:rszborder)+marginBox[0]){cursor+=tcursor+(posAbs?"w":"");
}else{if(x>this.offsetWidth-(cursor||tcursor?rszcorner:rszborder)){cursor+=tcursor+"e";
}}}return cursor;}var originalCursor;function resizeIndicate(e){if(!e){e=event;
}if(!_self.resizable||_self.editable||document.onmousemove){return;}var pos=apf.getAbsolutePosition(_self.$ext),sLeft=0,sTop=0,x=e.clientX-pos[0]+sLeft+document.documentElement.scrollLeft,y=e.clientY-pos[1]+sTop+document.documentElement.scrollTop;
if(!originalCursor){originalCursor=apf.getStyle(this,"cursor");}var cursor=getResizeType.call(_self.$ext,x,y);
this.style.cursor=cursor?cursor+"-resize":originalCursor||"default";}var oOutline;
function initOutline(e){var doc=this.$pHtmlDoc||document;oOutline=doc.getElementById("apf_outline");
if(!oOutline){oOutline=doc.body.appendChild(doc.createElement("div"));oOutline.refCount=0;
oOutline.setAttribute("id","apf_outline");oOutline.style.position="absolute";oOutline.style.display="none";
apf.window.zManager.set("drag",oOutline);oOutline.host=false;}oOutline.refCount++;
}if(this.addEventListener&&this.hasFeature(apf.__AMLNODE__)&&!this.$amlLoaded){if(document.body){initOutline.call(this);
}else{this.addEventListener("DOMNodeInsertedIntoDocument",initOutline);}}else{this.$pHtmlDoc=document;
initOutline.call(this);}this.$setOutline=function(o){oOutline=o;};};apf.GuiElement.propHandlers.resizable=function(value){this.implement(apf.Interactive);
this.$propHandlers.resizable.apply(this,arguments);};apf.GuiElement.propHandlers.draggable=function(value){this.implement(apf.Interactive);
this.$propHandlers.draggable.apply(this,arguments);};apf.Init.run("interactive");
apf.__MEDIA__=1<<20;apf.__MULTICHECK__=1<<22;apf.MultiCheck=function(){this.$regbase=this.$regbase|apf.__MULTICHECK__;
this.multicheck=true;this.checklength=0;this.$checkedList=[];this.check=function(xmlNode,userAction){if(userAction&&this.disabled||this.$checkedList.indexOf(xmlNode)>-1){return;
}if(userAction&&this.$executeSingleValue("check","checked",xmlNode,"true")!==false){return;
}if(this.dispatchEvent("beforecheck",{xmlNode:xmlNode})===false){return false;}if(!this.multicheck&&this.$checkedList.length){this.clearChecked(true);
}this.$checkedList.push(xmlNode);if(this.$isTreeArch){var nodes=xmlNode.selectNodes(".//"+this.each.split("|").join("|.//"));
this.checkList(nodes,null,true,true);var all,pNode=this.getTraverseParent(xmlNode);
while(pNode&&pNode!=this.xmlRoot){nodes=this.getTraverseNodes(pNode);all=true;for(var i=0;
i<nodes.length;i++){if(this.$checkedList.indexOf(nodes[i])==-1){all=false;break;
}}apf.setStyleClass(apf.xmldb.getHtmlNode(pNode,this),all?"checked":"partial",["partial","checked"]);
if(all){this.$checkedList.push(pNode);}pNode=this.getTraverseParent(pNode);}}this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,this),"checked",["partial"]);
this.dispatchEvent("aftercheck",{list:this.$checkedList,xmlNode:xmlNode});};this.uncheck=function(xmlNode,userAction){if(userAction&&this.disabled||this.$checkedList.indexOf(xmlNode)==-1){return;
}if(userAction&&this.$executeSingleValue("check","checked",xmlNode,"false")!==false){return;
}if(this.$isTreeArch){return this.checkList([xmlNode],true,true);}if(this.dispatchEvent("beforeuncheck",{xmlNode:xmlNode})===false){return false;
}this.$checkedList.remove(xmlNode);this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,this),"",["checked","partial"]);
this.dispatchEvent("afteruncheck",{list:this.$checkedList,xmlNode:xmlNode});};this.checkToggle=function(xmlNode,userAction){if(userAction&&this.disabled){return;
}if(xmlNode.style){var htmlNode=xmlNode,id=htmlNode.getAttribute(apf.xmldb.htmlIdTag);
while(!id&&htmlNode.parentNode){id=(htmlNode=htmlNode.parentNode).getAttribute(apf.xmldb.htmlIdTag);
}xmlNode=apf.xmldb.getNode(htmlNode);}if(this.$checkedList.indexOf(xmlNode)>-1){this.uncheck(xmlNode,userAction);
}else{this.check(xmlNode,userAction);}};this.checkList=function(xmlNodeList,uncheck,noClear,noEvent,userAction){if(!xmlNodeList.indexOf){xmlNodeList=apf.getArrayFromNodelist(xmlNodeList);
}if(userAction){if(this.disabled){return;}var changes=[];for(var c,i=0;i<xmlNodeList.length;
i++){c=this.$executeSingleValue("check","checked",xmlNodeList[i],uncheck?"false":"true",true);
if(c===false){break;}changes.push(c);}if(changes.length){return this.$executeAction("multicall",changes,"checked",xmlNodeList[0],null,null,xmlNodeList.length>1?xmlNodeList:null);
}}if(userAction&&this.disabled){return;}if(!noEvent&&this.dispatchEvent("beforecheck",{list:xmlNodeList})===false){return false;
}if(!uncheck&&!noClear){this.clearChecked(true);}if(!this.multicheck){xmlNodeList=[xmlNodeList[0]];
}var i;if(uncheck){for(i=xmlNodeList.length-1;i>=0;i--){this.$checkedList.remove(xmlNodeList[i]);
this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNodeList[i],this),"",["checked"]);
}}else{for(i=xmlNodeList.length-1;i>=0;i--){this.$checkedList.push(xmlNodeList[i]);
this.$setStyleClass(apf.xmldb.getHtmlNode(xmlNodeList[i],this),"checked");}}if(!noEvent&&this.$isTreeArch){var _self=this;
function recur(xmlNode,forceChange){var nodes=_self.getTraverseNodes(xmlNode);if(!nodes.length){if(forceChange){if(uncheck){_self.$checkedList.remove(xmlNode);
_self.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),"",["checked"]);return 0;
}else{if(_self.$checkedList.indexOf(xmlNode)==-1){_self.$checkedList.push(xmlNode);
_self.$setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),"checked");}return 1;
}}return _self.$checkedList.indexOf(xmlNode)>-1?1:0;}var isInList=_self.$checkedList.indexOf(xmlNode)!=-1,shouldBeChanged=forceChange||xmlNodeList.indexOf(xmlNode)>-1&&(uncheck?!isInList:isInList),all=true,none=true,partial=false,isChecked;
for(var i=nodes.length-1;i>=0;i--){isChecked=recur(nodes[i],shouldBeChanged);if(isChecked){none=false;
if(!partial&&isChecked==2){partial=true;}}else{all=false;}if(!all&&!none){partial=true;
}}if(xmlNode==_self.xmlRoot){return;}if(all){if(!isInList){_self.$checkedList.push(xmlNode);
apf.setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),"checked",["partial"]);}}else{if(isInList){_self.$checkedList.remove(xmlNode);
}apf.setStyleClass(apf.xmldb.getHtmlNode(xmlNode,_self),partial?"partial":"",["partial","checked"]);
}return all?1:(none?0:2);}recur(this.xmlRoot);}if(!noEvent){this.dispatchEvent("aftercheck",{list:xmlNodeList});
}};this.clearChecked=function(noEvent){if(!noEvent&&this.dispatchEvent("beforeuncheck",{xmlNode:this.$checkedList})===false){return false;
}for(var i=this.$checkedList.length-1;i>=0;i--){this.$setStyleClass(apf.xmldb.getHtmlNode(this.$checkedList[i],this),"",["checked"]);
}this.$checkedList.length=0;if(!noEvent){this.dispatchEvent("afteruncheck",{list:this.$checkedList});
}};this.isChecked=function(xmlNode){return this.$checkedList.indexOf(xmlNode)>-1;
};this.getChecked=function(xmldoc){var i,r;if(xmldoc){r=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();
for(i=0;i<this.$checkedList.length;i++){apf.xmldb.cleanNode(r.appendChild(this.$checkedList[i].cloneNode(true)));
}}else{for(r=[],i=0;i<this.$checkedList.length;i++){r.push(this.$checkedList[i]);
}}return r;};this.checkAll=function(userAction){if(!this.multicheck||userAction&&this.disabled||!this.xmlRoot){return;
}var nodes=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.getTraverseNodes();
this.checkList(nodes);};this.addEventListener("beforeload",function(){if(!this.$hasBindRule("checked")){this.clearChecked(true);
}});this.addEventListener("afterload",function(){if(!this.$hasBindRule("checked")&&this.$checkedList.length){this.checkList(this.$checkedList,false,true,false);
}});this.addEventListener("xmlupdate",function(e){if(e.action=="attribute"||e.action=="text"||e.action=="synchronize"||e.action=="update"){var c1=apf.isTrue(this.$applyBindRule("checked",e.xmlNode));
var c2=this.isChecked(e.xmlNode);if(c1!=c2){if(c1){this.check(e.xmlNode);}else{this.uncheck(e.xmlNode);
}}}});this.addEventListener("aftercheck",function(){if(this.checklength!=this.$checkedList.length){this.setProperty("checklength",this.$checkedList.length);
}});this.addEventListener("afteruncheck",function(){if(this.checklength!=this.$checkedList.length){this.setProperty("checklength",this.$checkedList.length);
}});};apf.Teleport=function(){this.$init(true);};apf.__TELEPORT__=1<<28;(function(){this.$parsePrio="002";
this.$regbase=this.$regbase|apf.__TELEPORT__;this.$booleanProperties.autoroute=true;
this.$supportedProperties.push("url","timeout","protocol","route-server","autoroute");
this.$propHandlers.url=function(value){var url=new apf.url(value);if(!url.protocol){return apf.console.error(apf.formatErrorString(0,this,"Communication (Teleport) initialization error","Invalid server url provided: '"+value+"'"));
}this.$host=url.host;this.$rootPath=url.path;this.$server=value.replace(new RegExp(this.$rootPath+"$"),"");
};this.$propHandlers.timeout=function(value){this.timeout=parseInt(value)||10000;
};this.$propHandlers.protocol=function(value){var proto=value.toLowerCase();if(!apf[proto]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+proto+"'",this));
}this.implement(apf[proto]);};this.toString=function(){return"[Ajax.org Teleport Component : "+(this.name||"")+" ("+this.type+")]";
};this.addEventListener("DOMNodeInsertedIntoDocument",function(){var error;if(this.type&&this.type=="socket"){if(!apf.socket){error="Socket";
}else{this.implement(apf.socket);}}else{if(!apf.http){error="HTTP";}else{this.implement(apf.http);
}}if(error){throw new Error(apf.formatErrorString(1024,null,"Teleport baseclass","Could not find Ajax.org Teleport "+error+" Component",this.$aml));
}if(this.id){apf.$asyncObjects[this.id]=1;}});}).call(apf.Teleport.prototype=new apf.AmlElement());
apf.Init.run("teleport");apf.__TRANSACTION__=1<<3;apf.Transaction=function(){this.$regbase=this.$regbase|apf.__TRANSACTION__;
this.$addParent=this.$transactionNode=this.$transactionSubject=this.$originalNode=this.$inTransaction=this.$lastAction=null;
this.$supportedProperties.push("autoshow");this.$booleanProperties.autoshow=true;
this.commit=function(repeat){if(!this.$inTransaction){return false;}if(!this.$validgroup&&this.validgroup){this.$validgroup=self[this.validgroup];
}if(this.$validgroup&&!this.$validgroup.isValid()){return false;}var returnValue=true;
if(!this.$at.undolength){if(repeat){return false;}this.$at.purge();this.$inTransaction=false;
this.load(this.$originalNode);this.$helperModel.reset();returnValue=false;}else{this.$at.reset();
this.$inTransaction=false;this.$transactionNode.removeAttribute(apf.xmldb.xmlListenTag);
if(this.$lastAction=="add"){if(this.$transactionSubject.$executeAction("appendChild",[this.$addParent,this.$transactionNode],"add",this.$transactionNode)&&this.$transactionSubject.hasFeature(apf.__MULTISELECT__)){this.$transactionSubject.select(this.$transactionNode);
}this.$transactionSubject=null;}else{var at=this.$at;this.$at=this.dataParent?this.dataParent.parent.getActionTracker():null;
this.$transactionSubject.$executeAction("replaceNode",[this.$originalNode,this.$transactionNode],"update",this.$transactionNode);
this.$at=at;}}this.$transactionNode=null;this.$addParent=null;this.$originalNode=null;
if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;}else{this.hide();}}return returnValue;
};this.rollback=function(noLoad){if(!this.$inTransaction){return;}if(this.$at){if(this.rpcMode=="realtime"){this.$at.undo(-1);
}this.$at.reset();}this.$transactionNode=null;this.$addParent=null;if(!noLoad){this.load(this.$originalNode);
}this.$helperModel.reset();this.$stopAction(this.$lastAction,true);this.$originalNode=null;
this.$inTransaction=false;if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;
}else{this.hide();}}};this.begin=function(strAction,xmlNode,parentXmlNode,dataParent){if(this.$inTransaction){if(this.autoshow){this.autoshow=-1;
}this.rollback();}var _self=this;this.$lastAction=strAction;if(!this.$lastAction){this.$lastAction=this.xmlRoot&&"update"||"add";
}if(dataParent){this.$setDynamicProperty("model","["+dataParent.id+".selected]");
}if(xmlNode&&this.$lastAction=="update"){this.xmlRoot=xmlNode;}if(!this.$at){this.$at=new apf.actiontracker();
var propListen=function(e){_self.setProperty(e.prop,e.value);};this.$at.addEventListener("prop.undolength",propListen);
this.setProperty("undolength",0);this.$at.addEventListener("prop.redolength",propListen);
this.setProperty("redolength",0);}if(!this.$helperModel){this.$helperModel=new apf.model();
this.$helperModel["save-original"]=true;this.$helperModel.load("<data />");}this.$transactionNode=null;
this.$addParent=null;this.$originalNode=this.xmlRoot;this.$inTransaction=true;function begin(){this.$inTransaction=-1;
this.$helperModel.data.appendChild(this.$transactionNode);this.load(this.$helperModel.data.firstChild);
this.$inTransaction=true;if(this.disabled){this.enable();}if(this.autoshow){if(this.autoshow==-1){this.autoshow=true;
}else{this.show();}}}dataParent=this.dataParent&&this.dataParent.parent;if(!dataParent||!dataParent.$actions||!dataParent.$actions[this.$lastAction]){dataParent=this;
}if(this.$lastAction=="add"){var rule,actionRules=dataParent.$actions;if(actionRules){if(xmlNode&&xmlNode.nodeType){rule=actionRules.getRule("add",xmlNode);
}else{if(typeof xmlNode=="string"){if(xmlNode.trim().charAt(0)=="<"){xmlNode=apf.getXml(xmlNode);
rule=actionRules.getRule("add",xmlNode);}else{var rules=actionRules.$rules.add;
for(var i=0,l=rules.length;i<l;i++){if(rules[i].getAttribute("type")==xmlNode){xmlNode=null;
rule=rules[i];break;}}}}}if(!rule){rule=(dataParent.$actions.add||{})[0];}}else{rule=null;
}var refNode=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot;var callback=function(addXmlNode,state,extra){if(state!=apf.SUCCESS){var oError;
oError=new Error(apf.formatErrorString(1032,dataParent,"Loading xml data","Could not add data for control "+dataParent.name+"["+dataParent.tagName+"] \nUrl: "+extra.url+"\nInfo: "+extra.message+"\n\n"+xmlNode));
if(extra.tpModule.retryTimeout(extra,state,dataParent,oError)===true){return true;
}throw oError;}if(typeof addXmlNode!="object"){addXmlNode=apf.getXmlDom(addXmlNode).documentElement;
}if(addXmlNode.getAttribute(apf.xmldb.xmlIdTag)){addXmlNode.setAttribute(apf.xmldb.xmlIdTag,"");
}if(!dataParent.$startAction("add",addXmlNode,_self.rollback)){return false;}var actionNode=(dataParent.$actions&&dataParent.$actions.getRule("add",dataParent.$isTreeArch?dataParent.selected:dataParent.xmlRoot)||{})[2];
if(parentXmlNode){_self.$addParent=parentXmlNode;}else{if(actionNode&&actionNode.getAttribute("parent")){_self.$addParent=dataParent.xmlRoot.selectSingleNode(actionNode.getAttribute("parent"));
}else{_self.$addParent=dataParent.$isTreeArch?dataParent.selected||dataParent.xmlRoot:dataParent.xmlRoot;
}}if(!_self.$addParent){_self.$addParent=dataParent.xmlRoot||dataParent.getModel(true).data;
}if(apf.isWebkit&&_self.$addParent.ownerDocument!=addXmlNode.ownerDocument){addXmlNode=_self.$addParent.ownerDocument.importNode(addXmlNode,true);
}_self.$transactionNode=addXmlNode;_self.$transactionSubject=dataParent;begin.call(_self);
};if(xmlNode){return callback(xmlNode,apf.SUCCESS);}else{if(rule&&rule.get){return apf.getData(rule.get,{xmlNode:refNode,callback:callback});
}else{}}}else{if(!dataParent.$startAction(this.$lastAction,this.xmlRoot,this.rollback)){return false;
}this.$transactionSubject=dataParent;this.$transactionNode=this.$originalNode.cloneNode(true);
begin.call(this);}};this.$canLoadData=function(){return true;};this.addEventListener("prop.model",function(e){return false;
});this.clear=function(){this.documentId=this.xmlRoot=this.cacheId=null;};this.addEventListener("beforeload",function(e){var xmlNode=e.xmlNode;
if(this.$inTransaction==-1){return;}if(this.$inTransaction){if(this.$transactionNode&&xmlNode!=this.$transactionNode){if(this.autoshow){this.autoshow=-1;
}this.rollback(true);}else{return;}}if(this.autoshow){this.autoshow=-1;}if(this.begin("update",xmlNode)!==false){return false;
}});};apf.GuiElement.propHandlers.transaction=function(value){if(!(this.transaction=apf.isTrue(value))){return;
}if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);
}if(!this.hasFeature(apf.__DATAACTION__)){this.implement(apf.DataAction);if(this.actions){this.$propHandlers.actions.call(this,this.actions,"actions");
}}if(!this.hasFeature(apf.__TRANSACTION__)){this.implement(apf.Transaction);if(!this.validgroup){this.$validgroup=new apf.ValidationGroup();
this.$validgroup.register(this);}if(!this.id){this.setProperty("id",this.localName+"_"+this.$uniqueId);
}var attr=this.attributes.getNamedItem("model");if(!attr){this.attributes.push(attr=new apf.AmlAttr(this,"model",null));
}attr.inheritedValue="{"+this.id+".root}";if(typeof this.autoshow=="undefined"&&(this.localName=="modalwindow"||this.localName=="window")){this.autoshow=true;
}}};apf.__VIRTUALVIEWPORT__=1<<19;apf.VirtualViewport=function(){this.$init(true);
this.$regbase=this.$regbase|apf.__VIRTUALVIEWPORT__;this.virtualVTimer=null;this._xmlUpdate=this.$xmlUpdate;
apf.setStyleClass(this.$ext,"virtual");this.$deInitNode=function(xmlNode,htmlNode){this.viewport.redraw();
};this.$moveNode=function(xmlNode,htmlNode){this.viewport.redraw();};this.emptyNode=apf.xmldb.getXml("<empty />");
this.$addEmpty=this.$add;this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode){var htmlNode=this.$pHtmlDoc.getElementById(Lid);
if(!htmlNode){return;}this.$updateNode(xmlNode,htmlNode);};this.$fill=function(){};
this.addEventListener("$load",function(){if(!this.viewport.limit){this.viewport.limit=1;
}});this.clear=function(nomsg,do_event){if(this.clearSelection){this.clearSelection(!do_event);
}this.documentId=this.xmlRoot=this.cacheId=null;if(!nomsg){this.viewport.offset=0;
this.viewport.length=0;this.viewport.resize(0);this.viewport.sb.update();this.$setClearMessage(this["empty-message"]);
}else{if(this.$removeClearMessage){this.$removeClearMessage();}}this.viewport.cache=null;
};var _self=this;this.viewport={offset:0,limit:2,length:0,sb:new apf.scrollbar(),host:this,cache:null,inited:false,draw:function(){this.inited=true;
var limit=this.limit;this.limit=0;this.resize(limit,true);},redraw:function(){this.change(this.offset);
},prepare:function(){if(!this.inited){this.draw();}var nodes=_self.getTraverseNodes();
if(!nodes){return;}var docId=apf.xmldb.getXmlDocId(_self.xmlRoot),hNodes=_self.$container.childNodes;
for(var j=0,i=0,l=hNodes.length;i<l;i++){if(hNodes[i].nodeType!=1){continue;}hNodes[i].style.display=(j>=nodes.length)?"none":"block";
apf.xmldb.nodeConnect(docId,nodes[j],hNodes[i],_self);j++;}},resize:function(limit,updateScrollbar){this.cache=null;
var i;if(limit<this.limit){var nodes=_self.$container.childNodes;for(i=nodes.length-1;
i>=0;i--){if(nodes[i].nodeType!=1){continue;}_self.$container.removeChild(nodes[i]);
if(--this.limit==limit){break;}}}else{if(limit>this.limit){for(i=this.limit;i<limit;
i++){_self.$addEmpty(_self.emptyNode,"",_self.xmlRoot,_self.$container);}}else{return;
}}this.limit=limit;if(updateScrollbar){this.sb.update(this.$container);}},findNewLimit:function(scrollTop){var oHtml=_self.$container;
if(!scrollTop){scrollTop=oHtml.scrollTop;}if(!_self.xmlRoot||oHtml.lastChild&&oHtml.lastChild.style.display=="none"){return;
}if(!oHtml.lastChild||oHtml.lastChild.offsetTop+oHtml.lastChild.offsetHeight<=oHtml.offsetHeight+scrollTop){var Lid,xmlNode,nodes,sel=_self.$getSelection();
while(this.limit<this.length-1&&(!oHtml.lastChild||oHtml.lastChild.offsetTop+oHtml.lastChild.offsetHeight<=oHtml.offsetHeight+scrollTop)){this.limit++;
nodes=_self.getTraverseNodes();if(nodes.length<this.limit){this.limit=nodes.length;
break;}xmlNode=nodes[nodes.length-1];Lid=apf.xmldb.nodeConnect(_self.documentId,xmlNode,null,_self);
_self.$addEmpty(xmlNode,Lid,_self.xmlRoot,oHtml);if(sel.indexOf(xmlNode)>-1){_self.$select(oHtml.lastChild);
}else{_self.$deselect(oHtml.lastChild);}}}else{if(oHtml.lastChild&&oHtml.lastChild.offsetTop>oHtml.offsetHeight+scrollTop){var lastChild;
while(this.limit>2&&(lastChild=oHtml.lastChild).offsetTop>oHtml.offsetHeight+scrollTop){_self.$container.removeChild(lastChild);
this.limit--;}}}if(!this.initialLimit){this.initialLimit=this.limit;}},change:function(offset,limit,updateScrollbar,noScroll){var offsetN;
if(offset<0){offset=0;}if(offset>this.length-this.limit-1){offsetN=Math.floor(this.length-this.limit-1);
}else{offsetN=Math.floor(offset);}if(!limit){limit=this.limit;}this.cache=null;
var diff=offsetN-this.offset,oldLimit=this.limit;if(diff*diff>=this.limit*this.limit){diff=false;
}this.offset=offsetN;if(diff>0){var lastNode=_self.$container.lastChild;if(lastNode.nodeType!=1){lastNode=lastNode.previousSibling;
}}if(updateScrollbar){this.sb.$curValue=this.offset/(this.length-this.limit-1);
this.sb.updatePos();}var nodes=_self.getTraverseNodes();if(!nodes){return;}if(nodes.length<this.limit){if(offset>0){alert("shouldnt get here");
}else{this.resize(nodes.length);}}var docId=apf.xmldb.getXmlDocId(_self.xmlRoot),hNodes=_self.$container.childNodes,xmlNode,htmlNode,xmlPos,sel,len,j,i;
if(diff>0){xmlPos=oldLimit-diff;len=hNodes.length,sel=_self.$getSelection();for(j=0,i=0;
j<diff&&i<len;i++){htmlNode=_self.$container.firstChild;if(htmlNode.nodeType==1){j++;
xmlNode=nodes[xmlPos++];if(xmlNode){apf.xmldb.nodeConnect(docId,xmlNode,htmlNode,_self);
_self.$updateNode(xmlNode,htmlNode);if(sel.indexOf(xmlNode)>-1){_self.$select(htmlNode);
}else{_self.$deselect(htmlNode);}htmlNode.style.display="block";}else{htmlNode.style.display="none";
}}_self.$container.appendChild(htmlNode);}}else{if(diff<0){diff=diff*-1;xmlPos=0;
sel=_self.$getSelection();for(j=0,i=hNodes.length-1;j<diff&&i>=0;i++){htmlNode=_self.$container.lastChild;
if(htmlNode.nodeType==1){j++;xmlNode=nodes[xmlPos++];apf.xmldb.nodeConnect(docId,xmlNode,htmlNode,_self);
_self.$updateNode(xmlNode,htmlNode);if(sel.indexOf(xmlNode)>-1){_self.$select(htmlNode);
}else{_self.$deselect(htmlNode);}htmlNode.style.display="block";}_self.$container.insertBefore(htmlNode,_self.$container.firstChild);
}}else{if(diff===false){len=hNodes.length;sel=_self.$getSelection();for(j=0,i=0;
i<len;i++){htmlNode=hNodes[i];if(htmlNode.nodeType==1){xmlNode=nodes[j++];apf.xmldb.nodeConnect(docId,xmlNode,htmlNode,_self);
_self.$updateNode(xmlNode,htmlNode);if(sel.indexOf(xmlNode)>-1){_self.$select(htmlNode);
}else{_self.$deselect(htmlNode);}}}}}}if(!noScroll){if(offset>=this.length-this.initialLimit){diff=offset-(this.length-this.initialLimit)+2;
_self.$container.scrollTop=(_self.$container.scrollHeight-_self.$container.offsetHeight)*(diff/2);
}else{var scrollTop=(offset%1)*_self.$container.firstChild.offsetHeight;this.findNewLimit(scrollTop);
_self.$container.scrollTop=scrollTop;}if(updateScrollbar){this.sb.update();}return;
}}};this.viewport.sb.parentNode=new apf.Class().$init();this.viewport.sb.parentNode.$container=this.$pHtmlNode;
this.viewport.sb.dispatchEvent("DOMNodeInsertedIntoDocument");this.viewport.sb.attach(this.$container,this.viewport,function(timed,pos){var vp=_self.viewport;
if(vp.sb.realtime||!timed){var l=vp.length-vp.initialLimit;if(l==0){_self.$container.scrollTop=pos*(_self.$container.scrollHeight-_self.$container.offsetHeight);
}else{vp.change(l*pos,vp.limit,false);}}else{clearTimeout(this.virtualVTimer);this.virtualVTimer=$setTimeout(function(){vp.change(Math.round((vp.length-vp.initialLimit)*pos),vp.limit,false);
},300);}});apf.layout.setRules(this.$container,"scrollbar","        var s = apf.all["+this.viewport.sb.$uniqueId+"];        s.update();    ",true);
apf.layout.queue(this.$container);this.$isInViewport=function(xmlNode,struct){var nodes=this.getTraverseNodes();
for(var i=0,l=nodes.length;i<l;i++){if(nodes[i]==xmlNode){return true;}}return false;
};this.scrollTo=function(xmlNode,last){var sPos={};this.$isInViewport(xmlNode,sPos);
this.viewport.change(sPos.position+(last?this.viewport.limit-1:0));};this.getFirstTraverseNode=function(xmlNode){return this.getTraverseNodes(xmlNode)[0];
};this.$clearVirtualDataset=function(parentNode){var nodes=parentNode.childNodes;
for(var i=nodes.length-1;i>=0;i--){parentNode.removeChild(nodes[i]);}};this.$createVirtualDataset=function(xmlNode,length,docId){var marker=xmlNode.selectSingleNode("a_marker")||xmlNode.appendChild(xmlNode.ownerDocument.createElement("a_marker"));
marker.setAttribute("start","0");if(length){marker.setAttribute("end",length);marker.setAttribute("reserved",++this.nodeCount[docId]);
this.nodeCount[docId]+=length;}};this.$xmlUpdate=function(){this.viewport.cache=null;
this.viewport.length=this.xmlRoot.selectNodes(this.each).length;this.viewport.sb.update(this.$container);
this._xmlUpdate.apply(this,arguments);};this.$load=function(XMLRoot){apf.xmldb.addNodeListener(XMLRoot,this);
if(!this.renderRoot&&!this.getTraverseNodes(XMLRoot).length){return this.clear("loading");
}if(this.$hasBindRule("load")){this.$createVirtualDataset(XMLRoot);}this.viewport.cache=null;
this.viewport.length=this.xmlRoot.selectNodes(this.each).length+1;this.viewport.prepare();
var nodes=this.$addNodes(XMLRoot,null,null,this.renderRoot);this.viewport.sb.update(this.$container);
if(this.selectable){if(this.autoselect){if(nodes.length){this.$selectDefault(XMLRoot);
}else{this.setProperty("selected",null);}}else{this.clearSelection(true);var xmlNode=this.getFirstTraverseNode();
if(xmlNode){this.setCaret(xmlNode);}this.setProperty("selected",null);this.setProperty("chosen",null);
}}if(this.$focussable){apf.window.hasFocus(this)?this.$focus():this.$blur();}};
this.$loadSubData=function(){};this.$loadPartialData=function(marker,start,length){var loadNode,rule=this.$getBindRule("load",xmlRootNode);
if(rule&&(!rule[1]||rule[1](xmlRootNode))){this.$setLoadStatus(xmlRootNode,"loading");
var mdl=this.getModel(true);mdl.$insertFrom(rule.getAttribute("get"),{ascending:this.$sort?this.$sort.get().ascending:true,xmlNode:loadNode,documentId:this.documentId,marker:marker,start:start,length:length,insertPoint:this.xmlRoot,amlNode:this,callback:function(xmlNode){_self.setProperty("root",_self.xmlRoot);
var length=parseInt(apf.queryValue(xmlNode,rule.getAttribute("total")));if(_self.viewport.length!=length){_self.viewport.length=length;
this.$createVirtualDataset(_self.xmlRoot,_self.viewport.length,_self.documentId);
}}});}};function fillList(len,list,from){for(var i=0;i<len;i++){list.push(_self.documentId+"|"+(from+i));
}}function buildList(markers,markerId,distance,xml){var marker,nodes,start,vlen=this.viewport.limit,list=[];
if(markerId==-1){nodes=xml.selectNodes(_self.each);start=0;marker=markers[0];}else{if(distance<0){fillList(Math.abs(distance),list,parseInt(marker.getAttribute("reserved"))+parseInt(marker.getAttribute("end"))-parseInt(marker.getAttribute("start"))+distance);
distance=0;_self.$loadPartialData(marker);if(list.length==vlen){return list;}}nodes=markers[markerId].selectNodes("following-sibling::"+this.each.split("|").join("following-sibling::"));
start=markers[markerId].getAttribute("end");marker=markers[++markerId];}do{var loop=Math.min(marker.getAttribute("start")-start,vlen);
for(var i=distance;i<loop;i++){list.push(nodes[i]);}if(list.length==vlen){break;
}var mlen=parseInt(marker.getAttribute("end"))-parseInt(marker.getAttribute("start"));
fillList(Math.min(mlen,vlen-list.length),list,parseInt(marker.getAttribute("reserved")));
_self.$loadPartialData(marker);start=parseInt(marker.getAttribute("end"));marker=markers[++markerId];
distance=0;}while(list.length<vlen&&marker);_self.viewport.cache=list;return list;
}this.getTraverseNodes=function(xmlNode){if(!this.xmlRoot){return;}if(this.viewport.cache){return this.viewport.cache;
}var start=this.viewport.offset+1,end=start+this.viewport.limit;var markers=(xmlNode||this.xmlRoot).selectNodes("a_marker");
if(!markers.length){var list=(xmlNode||this.xmlRoot).selectNodes("("+this.each+")[position() >= "+start+" and position() < "+(end)+"]");
return this.$sort?this.$sort.apply(list):list;}for(var i=0;i<markers.length;i++){if(markers[i].getAttribute("end")<start){if(i==markers.length-1){return buildList(markers,i,start-markers[i].getAttribute("end"),(xmlNode||this.xmlRoot));
}continue;}if(markers[i].getAttribute("start")-end<=0&&start>=markers[i].getAttribute("start")){return buildList(markers,i,start-markers[i].getAttribute("end"),(xmlNode||this.xmlRoot));
}else{if(markers[i-1]){return buildList(markers,i-1,start-markers[i-1].getAttribute("end"),(xmlNode||this.xmlRoot));
}else{return buildList(markers,-1,start,(xmlNode||this.xmlRoot));}}}};var baseNTS=this.getNextTraverseSelected;
this.getNextTraverseSelected=function(xmlNode,up,count){if(!xmlNode){xmlNode=this.selected;
}if(!count){count=1;}var node=baseNTS.call(this,xmlNode,up,count);if(node&&node!=xmlNode){return node;
}var nodes=this.getTraverseNodes(),i=0;while(nodes[i]&&nodes[i]!=xmlNode){i++;}if(up){i=-1*(nodes.length-i-1);
}this.viewport.change(Math.max(0,this.viewport.offset+i+(up?count:-1*count)),null,true,true);
nodes=this.getTraverseNodes();return nodes[up?nodes.length-1:0];};this.caching=false;
};apf.__XFORMS__=1<<17;apf.clipboard=new apf.Class().$init();apf.clipboard.store=null;
apf.clipboard.empty=true;apf.clipboard.copied=null;apf.clipboard.put=function(item){this.store=item;
this.setProperty("empty",item?false:true);};apf.clipboard.clear=function(){this.setProperty("empty",true);
};apf.clipboard.get=function(){return this.store;};apf.clipboard.$highlightSelection=function(amlNode,nodes,unset){for(var i=0,l=nodes.length;
i<l;i++){apf.setStyleClass(apf.xmldb.getHtmlNode(nodes[i],amlNode),(unset?"":"cut"),["cut"]);
}};apf.clipboard.copySelection=function(amlNode){var nodes=this.get()||[];this.$highlightSelection(amlNode,nodes,true);
this.put(amlNode.getSelection().map(function(node){return apf.xmldb.getCleanCopy(node);
}));this.copied=true;};apf.clipboard.cutSelection=function(amlNode){var nodes=this.get()||[];
this.$highlightSelection(amlNode,nodes,true);this.put(nodes=amlNode.getSelection());
this.$highlightSelection(amlNode,nodes);this.copied=false;};apf.clipboard.pasteSelection=function(amlNode,selected){var nodes=this.get();
if(!nodes){return;}if(!selected){selected=amlNode.selected||amlNode.getFirstTraverseNode();
}if(amlNode.hasFeature(apf.__DRAGDROP__)){amlNode.copy(nodes,selected,undefined,!this.copied);
}else{if(nodes[0].parentNode){for(var i=0,l=nodes.length;i<l;i++){apf.xmldb.moveNode(selected,nodes[i]);
}}else{for(var i=0,l=nodes.length;i<l;i++){apf.xmldb.appendChild(selected,nodes[i]);
}}}this.$highlightSelection(amlNode,nodes,true);amlNode.selectList(nodes);};apf.window=function(){this.$uniqueId=apf.all.push(this);
this.apf=apf;this.toString=function(){return"[apf.window]";};this.getActionTracker=function(){return this.$at;
};this.loadCodeFile=function(url){if(self[url]){apf.importClass(self[url],true,this.win);
}else{apf.include(url);}};this.show=function(){if(apf.isDeskrun){jdwin.Show();}};
this.hide=function(){if(apf.isDeskrun){jdwin.Hide();}else{this.loaded=false;if(this.win){this.win.close();
}}};this.focus=function(){if(apf.isDeskrun){jdwin.SetFocus();}else{window.focus();
}};this.setIcon=function(url){if(apf.isDeskrun){jdwin.icon=parseInt(url)==url?parseInt(url):url;
}};this.setTitle=function(value){this.title=value||"";if(apf.isDeskrun){jdwin.caption=value;
}else{document.title=(value||"");}};this.loadAml=function(x){if(x[apf.TAGNAME]=="deskrun"){this.loadDeskRun(x);
}};this.vManager=new apf.visibilitymanager();this.zManager=new apf.zmanager();this.$tabList=[];
this.$addFocus=function(amlNode,tabindex,isAdmin){if(!isAdmin){amlNode.addEventListener("DOMNodeInserted",moveFocus);
amlNode.addEventListener("DOMNodeRemoved",removeFocus);if(amlNode.$isWindowContainer>-2){amlNode.addEventListener("focus",trackChildFocus);
amlNode.addEventListener("blur",trackChildFocus);amlNode.$focusParent=amlNode;if(amlNode.$isWindowContainer>-1){if(!amlNode.$tabList){amlNode.$tabList=[amlNode];
}this.$tabList.push(amlNode);return;}else{amlNode.$tabList=[amlNode];}}}var fParent=findFocusParent(amlNode),list=fParent.$tabList;
if(!amlNode.$isWindowContainer){amlNode.$focusParent=fParent;}else{amlNode.$focusParent2=fParent;
}if(list[tabindex]){list.insertIndex(amlNode,tabindex);}else{list.push(amlNode);
}};this.$removeFocus=function(amlNode){if(!amlNode.$focusParent){return;}amlNode.$focusParent.$tabList.remove(amlNode);
if(!amlNode.$isWindowContainer){amlNode.removeEventListener("DOMNodeInserted",moveFocus);
amlNode.removeEventListener("DOMNodeRemoved",removeFocus);}if(amlNode.$isWindowContainer>-2){amlNode.removeEventListener("focus",trackChildFocus);
amlNode.removeEventListener("blur",trackChildFocus);}};var focusLoopDetect;this.$focus=function(amlNode,e,force){var aEl=this.document.activeElement;
if(aEl==amlNode&&!force){return;}this.$settingFocus=amlNode;if(!e){e={};}e.toElement=amlNode;
e.fromElement=aEl;if(aEl&&aEl!=amlNode&&focusLoopDetect!=aEl){focusLoopDetect=aEl;
aEl.blur(true,e);if(focusLoopDetect!=aEl){return false;}}(apf.activeElement=this.document.activeElement=amlNode).focus(true,e);
this.$settingFocus=null;apf.dispatchEvent("movefocus",{toElement:amlNode});};this.$blur=function(amlNode){var aEl=this.document.activeElement;
if(aEl!=amlNode){return false;}aEl.$focusParent.$lastFocussed=null;apf.activeElement=this.document.activeElement=null;
apf.dispatchEvent("movefocus",{fromElement:amlNode});};var lastFocusParent;this.$focusDefault=function(amlNode,e){var fParent=findFocusParent(amlNode);
this.$focusLast(fParent,e);};this.$focusRoot=function(e){var docEl=apf.document.documentElement;
if(this.$focusLast(docEl,e)===false){}};this.$focusLast=function(amlNode,e,ignoreVisible){var lf=amlNode.$lastFocussed;
if(lf&&lf.parentNode&&lf.$focussable===true&&(ignoreVisible||lf.$ext.offsetHeight)){this.$focus(lf,e,true);
}else{var next,node=amlNode,skip;while(node){if(!skip&&node.focussable!==false&&node.$focussable===true&&!node.$tabList&&(ignoreVisible||node.$ext&&node.$ext.offsetHeight)&&node.disabled<1){this.$focus(node,e,true);
break;}if((next=!skip&&node.firstChild||!(skip=false)&&node.nextSibling)){node=next;
if(node.$isWindowContainer>0){skip=true;}}else{if(node==amlNode){if(node.$isWindowContainer){this.$focus(node,e,true);
}return;}else{do{node=node.parentNode;}while(node&&!node.nextSibling&&node!=amlNode&&!node.$isWindowContainer);
if(node==amlNode){if(node.$isWindowContainer){this.$focus(node,e,true);}return;
}if(node){if(node.$isWindowContainer){this.$focus(node,e,true);break;}node=node.nextSibling;
}}}}if(!node){this.$focus(apf.document.documentElement);}}};function trackChildFocus(e){if(e.name=="blur"){if(e.srcElement!=this&&this.$blur){this.$blur();
}return;}if(e.srcElement!=this&&this.$focus&&(!e||!e.mouse||this.$focussable==apf.KEYBOARD_MOUSE)){this.$focus();
}if(e.srcElement==this||e.trackedChild){e.trackedChild=true;return;}this.$lastFocussed=e.srcElement;
if(this.localName&&this.localName.indexOf("window")>-1){e.trackedChild=true;}}function findFocusParent(amlNode){var node=amlNode;
do{node=node.parentNode;}while(node&&!node.$isWindowContainer);return node||apf.document.documentElement;
}function moveFocus(e){if(e&&e.currentTarget!=this){return;}if(this.$isWindowContainer){apf.window.$tabList.pushUnique(this);
}else{apf.window.$addFocus(this,this.tabindex,true);}}function removeFocus(e){if(e&&(e.currentTarget!=this||e.$doOnlyAdmin)){return;
}var list=this.$focusParent.$tabList;var nodes=this.childNodes;for(var i=0,l=nodes.length;
i<l;i++){list.remove(nodes[i]);}if(apf.document.activeElement==this){apf.window.moveNext();
}if(this.$isWindowContainer){apf.window.$tabList.remove(this);return;}if(!this.$focusParent){return;
}list.remove(this);}this.hasFocus=function(amlNode){return this.document.activeElement==amlNode;
};this.moveNext=function(shiftKey,relObject,switchWindows,e){if(switchWindows&&apf.document.activeElement){var p=apf.document.activeElement.$focusParent;
if(p.visible&&p.modal){return false;}}var dir,start,next,amlNode=relObject||apf.document.activeElement,fParent=amlNode?(switchWindows&&amlNode.$isWindowContainer&&amlNode.$isWindowContainer!=-1?apf.window:e&&e.innerList?amlNode.$focusParent:amlNode.$focusParent2||amlNode.$focusParent):apf.document.documentElement,list=fParent.$tabList;
if(amlNode&&(switchWindows||amlNode!=apf.document.documentElement)){start=(list||[]).indexOf(amlNode);
if(start==-1){return;}}else{start=-1;}if(this.document.activeElement&&this.document.activeElement==amlNode&&list.length==1||list.length==0){return false;
}dir=(shiftKey?-1:1);next=start;if(start<0){start=0;}do{next+=dir;if(next>=list.length){next=0;
}else{if(next<0){next=list.length-1;}}if(start==next&&amlNode){if(list[0].$isWindowContainer){this.$focus(list[0],e);
}return false;}amlNode=list[next];}while(!amlNode||amlNode.disabled>0||amlNode==apf.document.activeElement||(switchWindows?!amlNode.visible:amlNode.$ext&&!amlNode.$ext.offsetHeight)||amlNode.focussable===false||switchWindows&&!amlNode.$tabList.length);
if(fParent==apf.window&&amlNode.$isWindowContainer!=-2){this.$focusLast(amlNode,{mouse:true},switchWindows);
}else{(e||(e={})).shiftKey=shiftKey;this.$focus(amlNode,e);}};this.focusDefault=function(){if(this.moveNext()===false){this.moveNext(null,apf.document.documentElement,true);
}};apf.addListener(window,"beforeunload",function(){return apf.dispatchEvent("exit");
});apf.addListener(window,"unload",function(){if(!apf){return;}apf.window.isExiting=true;
apf.window.destroy();});var timer,state="",last="";this.$focusfix=function(){state+="a";
clearTimeout(timer);$setTimeout("window.focus();");timer=$setTimeout(determineAction);
};this.$focusfix2=function(){state+="b";clearTimeout(timer);timer=$setTimeout(determineAction);
};this.$blurfix=function(){state+="c";clearTimeout(timer);timer=$setTimeout(determineAction);
};function determineAction(){clearTimeout(timer);if(state=="e"||state=="c"||state.charAt(0)=="x"&&!state.match(/eb$/)||state=="ce"||state=="de"){if(last!="blur"){last="blur";
apf.window.dispatchEvent("blur");}}else{if(last!="focus"){last="focus";apf.window.dispatchEvent("focus");
}}state="";timer=null;}apf.addListener(window,"focus",this.$focusevent=function(){if(apf.hasFocusBug){state+="d";
clearTimeout(timer);timer=$setTimeout(determineAction);}else{clearTimeout(iframeFixTimer);
iframeFix.newState="focus";iframeFixTimer=$setTimeout(iframeFix,10);}});apf.addListener(window,"blur",this.$blurevent=function(){if(!apf){return;
}if(apf.hasFocusBug){state+="e";clearTimeout(timer);timer=$setTimeout(determineAction);
}else{clearTimeout(iframeFixTimer);iframeFix.newState="blur";iframeFixTimer=$setTimeout(iframeFix,10);
}});var iframeFixTimer;function iframeFix(){clearTimeout(iframeFixTimer);var newState=iframeFix.newState;
if(last==newState){return;}last=newState;apf.dispatchEvent(last);}this.hasFocus=function(){return(last=="focus");
};apf.addListener(document,"contextmenu",function(e){if(!e){e=event;}var pos,ev,amlNode=apf.findHost(e.srcElement||e.target)||apf.document.activeElement||apf.document&&apf.document.documentElement;
if(amlNode&&amlNode.localName=="menu"){return false;}if(apf.contextMenuKeyboard){if(amlNode){pos=amlNode.selected?apf.getAbsolutePosition(amlNode.$selected):apf.getAbsolutePosition(amlNode.$ext||amlNode.$pHtmlNode);
}else{pos=[0,0];}ev={x:pos[0]+10+document.documentElement.scrollLeft,y:pos[1]+10+document.documentElement.scrollTop,amlNode:amlNode,htmlEvent:e};
}else{if(e.htmlEvent){ev=e;}else{ev={x:e.clientX+document.documentElement.scrollLeft,y:e.clientY+document.documentElement.scrollTop,htmlEvent:e};
}}ev.bubbles=true;apf.contextMenuKeyboard=null;if((amlNode||apf).dispatchEvent("contextmenu",ev)===false||ev.returnValue===false){if(e.preventDefault){e.preventDefault();
}return false;}if(apf.config.disableRightClick){if(e.preventDefault){e.preventDefault();
}return false;}});apf.addListener(document,"mouseup",function(e){if(!e){e=event;
}apf.dispatchEvent("mouseup",{htmlEvent:e});});var ta={INPUT:1,TEXTAREA:1,SELECT:1};
apf.addListener(document,"mousedown",this.$mousedown=function(e){if(!e){e=event;
}var p,amlNode=apf.findHost(e.srcElement||e.target);if(apf.popup.last&&(!amlNode||apf.popup.last!=amlNode.$uniqueId)&&apf.popup.cache[apf.popup.last]&&!apf.isChildOf(apf.popup.cache[apf.popup.last].content,e.srcElement||e.target,true)){apf.popup.forceHide();
}if(amlNode===false){amlNode=apf.document.activeElement;}if((!amlNode||((!amlNode.$focussable||amlNode.focussable===false)&&amlNode.canHaveChildren!=2&&!amlNode.$focusParent))&&apf.config.allowBlur){lastFocusParent=null;
if(apf.document.activeElement){apf.document.activeElement.blur();}}else{if(amlNode){if((p=apf.document.activeElement&&apf.document.activeElement.$focusParent||lastFocusParent)&&p.visible&&p.modal&&amlNode.$focusParent!=p&&amlNode.$isWindowContainer!=-1){apf.window.$focusLast(p,{mouse:true,ctrlKey:e.ctrlKey});
}else{if(!amlNode&&apf.document.activeElement){apf.window.$focusRoot();}else{if(amlNode.$isWindowContainer==-1){if(amlNode.$tabList.length){apf.window.moveNext(null,amlNode.$tabList[0],null,{mouse:true,innerList:true});
}else{apf.window.$focus(amlNode);}}else{if((amlNode.disabled==undefined||amlNode.disabled<1)&&amlNode.focussable!==false){if(amlNode.$focussable){apf.window.$focus(amlNode,{mouse:true,ctrlKey:e.ctrlKey});
}else{if(amlNode.canHaveChildren==2){if(!apf.config.allowBlur||!apf.document.activeElement||apf.document.activeElement.$focusParent!=amlNode){apf.window.$focusLast(amlNode,{mouse:true,ctrlKey:e.ctrlKey});
}}else{if(!apf.config.allowBlur||amlNode!=apf.document.documentElement){apf.window.$focusDefault(amlNode,{mouse:true,ctrlKey:e.ctrlKey});
}}}}else{apf.window.$focusDefault(amlNode,{mouse:true,ctrlKey:e.ctrlKey});}}}}if(apf.hasFocusBug){var isTextInput=(ta[e.srcElement.tagName]||e.srcElement.isContentEditable)&&!e.srcElement.disabled||amlNode.$isTextInput&&amlNode.$isTextInput(e)&&amlNode.disabled<1;
if(!amlNode||!isTextInput){apf.window.$focusfix();}}else{if(!last){apf.window.$focusevent();
}}}}apf.dispatchEvent("mousedown",{htmlEvent:e,amlNode:amlNode||apf.document.documentElement});
if(apf.isIE||apf.isIphone){return;}var canSelect=!((!apf.document&&(!apf.isParsingPartial||amlNode)||apf.dragMode)&&!ta[e.target&&e.target.tagName]);
if(canSelect&&amlNode){if(!e.target&&e.srcElement){e.target={};}var isTextInput=(ta[e.target.tagName]||e.target.contentEditable=="true")&&!e.target.disabled||amlNode.$isTextInput&&amlNode.$isTextInput(e)&&amlNode.disabled<1;
if(!apf.config.allowSelect&&!isTextInput&&amlNode.nodeType!=amlNode.NODE_PROCESSING_INSTRUCTION&&!amlNode.textselect){canSelect=false;
}}if(!canSelect&&e.button!=2){if(e.preventDefault){e.preventDefault();}try{if(document.activeElement&&document.activeElement.contentEditable=="true"){document.activeElement.blur();
}}catch(e){}}});apf.addListener(document,"selectstart",function(e){if(!e){e=event;
}var amlNode=apf.findHost(e.srcElement);var canSelect=!(!apf.document&&(!apf.isParsingPartial||amlNode)||apf.dragMode);
if(canSelect){if(!apf.config.allowSelect&&(amlNode&&amlNode.nodeType!=amlNode.NODE_PROCESSING_INSTRUCTION&&!amlNode.textselect)){canSelect=false;
}}if(!canSelect){e.returnValue=false;return false;}});apf.addListener(document,"keyup",this.$keyup=function(e){if(!e){e=event;
}var ev={keyCode:e.keyCode,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altkey,htmlEvent:e,bubbles:true};
var aEl=apf.document&&apf.document.activeElement;if((aEl&&!aEl.disableKeyboard?aEl.dispatchEvent("keyup",ev):apf.dispatchEvent("keyup",ev))===false){apf.preventDefault(e);
return false;}});var wheel=this.$mousewheel=function wheel(e){if(!e){e=event;}var delta=null;
if(e.wheelDelta){delta=e.wheelDelta/120;if(apf.isOpera){delta*=-1;}}else{if(e.detail){delta=-e.detail/3;
}}if(delta!==null){if(apf.isIE){var el=e.srcElement||e.target;while(el&&el.scrollHeight<=el.offsetHeight){el=el.parentNode||el.$parentNode;
}if(el&&el.nodeType==9){el=el.documentElement;}if(!el||el.nodeType!=1){return;}if(el&&el.tagName=="BODY"&&"auto|scroll".indexOf(apf.getStyle(el,"overflowY"))==-1){el=document.documentElement;
}if(el&&"auto|scroll".indexOf(apf.getStyle(el,"overflowY"))>-1){var max,dist=0.35*el.offsetHeight*delta;
if(delta<0){if(el&&el.scrollTop>=(max=el.scrollHeight-el.offsetHeight+apf.getVerBorders(el))+dist){el.scrollTop=max;
e.returnValue=false;}}else{if(el&&el.scrollTop<=dist){el.scrollTop=0;e.returnValue=false;
}}}}var ev={delta:delta,target:e.target||e.srcElement,button:e.button,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,bubbles:true,htmlEvent:e};
var amlNode=apf.findHost(e.srcElement||e.target);var res=(amlNode||apf).dispatchEvent("mousescroll",ev);
if(res===false||ev.returnValue===false){if(e.preventDefault){e.preventDefault();
}e.returnValue=false;}}};if(document.addEventListener){document.addEventListener("DOMMouseScroll",wheel,false);
}window.onmousewheel=document.onmousewheel=wheel;apf.addListener(document,"keyup",function(e){e=e||event;
if(e.ctrlKey&&e.keyCode==9&&apf.document.activeElement){var w=apf.document.activeElement.$focusParent;
if(w.modal){if(e.preventDefault){e.preventDefault();}return false;}apf.window.moveNext(e.shiftKey,apf.document.activeElement.$focusParent,true);
w=apf.document.activeElement.$focusParent;if(w&&w.bringToFront){w.bringToFront();
}if(e.preventDefault){e.preventDefault();}return false;}});apf.addListener(document,"keydown",this.$keydown=function(e){e=e||event;
if(e.keyCode==93){apf.contextMenuKeyboard=true;}var amlNode=apf.document.activeElement,htmlNode=(e.explicitOriginalTarget||e.srcElement||e.target),isTextInput=(ta[htmlNode.tagName]||htmlNode.contentEditable||htmlNode.contentEditable=="true")&&!htmlNode.disabled||amlNode&&amlNode.$isTextInput&&amlNode.$isTextInput(e)&&amlNode.disabled<1;
var o,ctrlKey=apf.isMac?e.metaKey:e.ctrlKey;if(!isTextInput&&apf.config.undokeys&&ctrlKey){if(e.keyCode==90){o=apf.document.activeElement;
while(o&&!o.getActionTracker&&!o.$at){o=o.parentNode;}if(!o){o=apf.window;}(o.$at||o.getActionTracker()).undo();
}else{if(e.keyCode==89){o=apf.document.activeElement;while(o&&!o.getActionTracker&&!o.$at){o=o.parentNode;
}if(!o){o=apf.window;}(o.$at||o.getActionTracker()).redo();}}}var eInfo={ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,keyCode:e.keyCode,htmlEvent:e,isTextInput:isTextInput,bubbles:true};
delete eInfo.currentTarget;var aEl=amlNode;if((aEl&&!aEl.disableKeyboard&&!aEl.editable?aEl.dispatchEvent("keydown",eInfo):apf.dispatchEvent("keydown",eInfo))===false){apf.stopEvent(e);
if(apf.canDisableKeyCodes){try{e.keyCode=0;}catch(e){}}return false;}else{if((!apf.config.disableTabbing||apf.document.activeElement)&&e.keyCode==9){if(e.ctrlKey&&apf.document.activeElement){var w=apf.document.activeElement.$focusParent;
if(w.modal){if(e.preventDefault){e.preventDefault();}return false;}apf.window.moveNext(e.shiftKey,apf.document.activeElement.$focusParent,true);
w=apf.document.activeElement.$focusParent;if(w&&w.bringToFront){w.bringToFront();
}}else{if(!apf.document.activeElement||apf.document.activeElement.tagName!="menu"){apf.window.moveNext(e.shiftKey);
}}if(e.preventDefault){e.preventDefault();}return false;}}var altKey=apf.isMac?e.metaKey:e.altKey;
if(apf.config.disableBackspace&&e.keyCode==8&&!isTextInput){if(apf.canDisableKeyCodes){try{e.keyCode=0;
}catch(e){}}e.returnValue=false;}if(apf.config.disableF5&&(e.keyCode==116||e.keyCode==117)){if(apf.canDisableKeyCodes){try{e.keyCode=0;
}catch(e){}}else{e.preventDefault();e.stopPropagation();}}if(e.keyCode==27){e.returnValue=false;
}if(!apf.config.allowSelect&&e.shiftKey&&(e.keyCode>32&&e.keyCode<41)&&!isTextInput){e.returnValue=false;
}if(e.returnValue===false&&e.preventDefault){e.preventDefault();}return e.returnValue;
});apf.document={};this.init=function(strAml){if(apf.actiontracker){this.$at=new apf.actiontracker();
this.$at.name="default";apf.nameserver.register("actiontracker","default",this.$at);
}this.$domParser=new apf.DOMParser();this.document=apf.document=this.$domParser.parseFromString(strAml,"text/xml",{timeout:apf.config.initdelay,callback:function(doc){if(apf.parsed!=2){var inital=apf.parsed;
apf.parsed=2;apf.dispatchEvent("parse",{initial:inital});apf.parsed=true;}if(!apf.loaded){if(!apf.document.activeElement&&(!apf.config.allowBlur||apf.document.documentElement&&apf.document.documentElement.editable)){apf.window.focusDefault();
}apf.loaded=true;$setTimeout(function(){apf.dispatchEvent("load");apf.addEventListener("$event.load",function(cb){cb();
});});}}});};var lastFocusElement;this.addEventListener("focus",function(e){if(!apf.document.activeElement&&lastFocusParent&&!apf.isIphone){lastFocusElement.focus();
}});this.addEventListener("blur",function(e){if(!apf.document.activeElement||apf.isIphone){return;
}apf.document.activeElement.blur(true,{srcElement:this});lastFocusParent=apf.document.activeElement.$focusParent;
lastFocusElement=apf.document.activeElement;apf.activeElement=apf.document.activeElement=null;
});this.getLastActiveElement=function(){return apf.activeElement||lastFocusElement;
};this.destroy=function(){this.$at=null;apf.unload(this);apf=this.win=this.window=this.document=null;
window.onfocus=window.onerror=window.onunload=window.onbeforeunload=window.onbeforeprint=window.onafterprint=window.onmousewheel=window.onblur=null;
document.oncontextmenu=document.onmousedown=document.onmousemove=document.onmouseup=document.onmousewheel=document.onkeyup=document.onkeydown=null;
if(document.body){document.body.onmousedown=document.body.onmousemove=document.body.onmouseup=null;
document.body.innerHTML="";}};};apf.window.prototype=new apf.Class().$init();apf.window=new apf.window();
apf.sanitizeTextbox=function(oTxt){if(!apf.hasFocusBug){return;}oTxt.onfocus=function(){if(apf.window){apf.window.$focusfix2();
}};oTxt.onblur=function(){if(apf.window){apf.window.$blurfix();}};};apf.runGecko=function(){if(apf.runNonIe){apf.runNonIe();
}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(sExpr,contextNode){try{var oResult=this.evaluate(sExpr,(contextNode||this),this.createNSResolver(this.documentElement),7,null);
}catch(ex){var msg=ex.message;if(ex.code==ex.INVALID_EXPRESSION_ERR){msg=msg.replace(/the expression/i,"'"+sExpr+"'");
}throw new Error(ex.lineNumber,"XPath error: "+msg);}var nodeList=new Array(oResult.snapshotLength);
nodeList.expr=sExpr;for(var i=nodeList.length-1;i>=0;i--){nodeList[i]=oResult.snapshotItem(i);
}return nodeList;};Text.prototype.selectNodes=Attr.prototype.selectNodes=Element.prototype.selectNodes=function(sExpr){return this.ownerDocument.selectNodes(sExpr,this);
};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){try{var oResult=this.evaluate(sExpr,(contextNode||this),this.createNSResolver(this.documentElement),9,null);
}catch(ex){var msg=ex.message;if(ex.code==ex.INVALID_EXPRESSION_ERR){msg=msg.replace(/the expression/i,"'"+sExpr+"'");
}throw new Error(ex.lineNumber,"XPath error: "+msg);}return oResult.singleNodeValue;
};Text.prototype.selectSingleNode=Attr.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(sExpr){return this.ownerDocument.selectSingleNode(sExpr,this);
};var serializer=new XMLSerializer();var o=document.createElement("div");apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var frag,l,node,i;
if(nodeList){frag=document.createDocumentFragment();for(i=nodeList.length-1;i>=0;
i--){node=nodeList[i];frag.insertBefore(node,frag.firstChild);}}o.innerHTML=typeof s=="string"?s:apf.html_entity_decode(serializer.serializeToString(frag)).replace(/<([^>]+)\/>/g,"<$1></$1>");
frag=document.createDocumentFragment();for(i=0,l=o.childNodes.length;i<l;i++){node=o.childNodes[0];
frag.appendChild(node);}if(beforeNode){htmlNode.insertBefore(frag,beforeNode);}htmlNode.appendChild(frag);
};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,s){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}if(!s){s=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):((xmlNode.nodeType==3||xmlNode.nodeType==4||xmlNode.nodeType==2)?xmlNode.nodeValue:serializer.serializeToString(xmlNode)));
}o.innerHTML=s.replace(/<([^>]+)\/>/g,"<$1></$1>");if(beforeNode){htmlNode.insertBefore(o.firstChild,beforeNode);
}else{htmlNode.appendChild(o.firstChild);}return beforeNode?beforeNode.previousSibling:htmlNode.lastChild;
};function Error(nr,msg){this.message=msg;this.nr=nr;}apf.getHtmlLeft=function(oHtml){return(oHtml.offsetLeft+(parseInt(apf.getStyle(oHtml.parentNode,"borderLeftWidth"))||0));
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(2*(parseInt(apf.getStyle(p,"borderLeftWidth"))||0))-(parseInt(apf.getStyle(p,"borderRightWidth"))||0));
};apf.getHtmlTop=function(oHtml){return(oHtml.offsetTop+(parseInt(apf.getStyle(oHtml.parentNode,"borderTopWidth"))||0));
};apf.getHtmlBottom=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(2*(parseInt(apf.getStyle(p,"borderTopWidth"))||0))-(parseInt(apf.getStyle(p,"borderBottomWidth"))||0));
};apf.getBorderOffset=function(oHtml){return[-1*(parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0),-1*(parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0)];
};};apf.runIE=function(){var hasIE7Security=false,hasIESecurity=false;apf.getHttpReq=hasIESecurity?function(){if(apf.availHTTP.length){return apf.availHTTP.pop();
}return new XMLHttpRequest();}:function(){if(apf.availHTTP.length){return apf.availHTTP.pop();
}return new ActiveXObject("microsoft.XMLHTTP");};apf.getXmlDom=hasIESecurity?function(message,noError){var xmlParser=getDOMParser(message,noError);
return xmlParser;}:function(message,noError,preserveWhiteSpaces){var xmlParser=new ActiveXObject("microsoft.XMLDOM");
xmlParser.setProperty("SelectionLanguage","XPath");if(preserveWhiteSpaces){xmlParser.preserveWhiteSpace=true;
}if(message){if(apf.cantParseXmlDefinition){message=message.replace(/\] \]/g,"] ]").replace(/^<\?[^>]*\?>/,"");
}xmlParser.loadXML(message);if(xmlParser.parseError!=0&&apf.xmldb&&apf.isJson(message)){try{xmlParser=apf.json2Xml(message,noError);
}catch(e){throw new Error(apf.formatErrorString(1051,null,"JSON to XML conversion error occurred."+e.message,"\nSource Text : "+message.replace(/\t/gi," ")));
}}else{if(!noError){this.xmlParseError(xmlParser);}}}return xmlParser;};apf.xmlParseError=function(xml){var xmlParseError=xml.parseError;
if(xmlParseError!=0){throw new Error(apf.formatErrorString(1050,null,"XML Parse error on line "+xmlParseError.line,xmlParseError.reason+"Source Text:\n"+xmlParseError.srcText.replace(/\t/gi," ")));
}return xml;};apf.getStyle=function(el,prop){return el.currentStyle[prop];};apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var str;
if(nodeList){for(str=[],i=0,l=nodeList.length;i<l;i++){str[i]=nodeList[i].xml;}}str=s||apf.html_entity_decode(str.join(""));
if(apf.isIE<7){str=str.replace(/style="background-image:([^"]*)"/g,"find='$1' style='background-image:$1'");
}try{(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",str);
}catch(e){document.body.insertAdjacentHTML("beforeend","<table><tr>"+str+"</tr></table>");
var x=document.body.lastChild.firstChild.firstChild;for(i=x.childNodes.length-1;
i>=0;i--){htmlNode.appendChild(x.childNodes[apf.hasDynamicItemList?0:i]);}}if(apf.isIE<7){$setTimeout(function(){var nodes=htmlNode.getElementsByTagName("*");
for(var s,i=0,l=nodes.length;i<l;i++){if(s=nodes[i].getAttribute("find")){nodes[i].style.backgroundImage=s.trim();
}}});}};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,str){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}var pNode=beforeNode||htmlNode;if(!str){str=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):xmlNode.xml||xmlNode.outerHTML||xmlNode.nodeValue);
}try{pNode.insertAdjacentHTML(beforeNode?"beforeBegin":"beforeEnd",str);}catch(e){pNode.insertAdjacentHTML("afterEnd",str);
return pNode.nextSibling;}if(beforeNode){return beforeNode.previousSibling;}else{return htmlNode.lastChild.nodeType==1?htmlNode.lastChild:htmlNode.lastChild.previousSibling;
}};apf.getHtmlLeft=function(oHtml){return(oHtml.offsetLeft-(apf.isIE>7&&parseInt(oHtml.parentNode.currentStyle.borderLeftWidth)||0));
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(apf.isIE<8&&parseInt(p.currentStyle.borderLeftWidth)||0)-(parseInt(p.currentStyle.borderRightWidth)||0));
};apf.getHtmlTop=function(oHtml){return(oHtml.offsetTop-(apf.isIE>7&&parseInt(oHtml.offsetParent.currentStyle.borderTopWidth)||0));
};apf.getHtmlBottom=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(apf.isIE<8&&parseInt(p.currentStyle.borderTopWidth)||0)-(parseInt(p.currentStyle.borderBottomidth)||0));
};apf.getBorderOffset=function(oHtml){return apf.isIE<8&&[0,0]||[parseInt(oHtml.currentStyle.borderLeftWidth)||0,parseInt(oHtml.currentStyle.borderTopWidth)||0];
};apf.getOpacity=function(oHtml){return parseInt(((oHtml.currentStyle.filter||"").match(/alpha\(opacity=(\d*)\)/)||[0,0])[1])/100;
};apf.setOpacity=function(oHtml,value){oHtml.style.filter=value==1?"":"alpha(opacity="+Math.round(value*100)+")";
};apf.popup2={cache:{},setContent:function(cacheId,content,style,width,height){if(!this.popup){this.init();
}this.cache[cacheId]={content:content,style:style,width:width,height:height};if(content.parentNode){content.parentNode.removeChild(content);
}if(style){apf.importCssString(style,this.popup.document);}return this.popup.document;
},removeContent:function(cacheId){this.cache[cacheId]=null;delete this.cache[cacheId];
},init:function(){this.popup=window.createPopup();this.popup.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml" xmlns:a='+apf.ns.aml+' xmlns:xsl="http://www.w3.org/1999/XSL/Transform">                <head>                    <script>                    var apf = {                        all: [],                        lookup:function(uniqueId){                            return this.all[uniqueId] || {                                $setStyleClass:function(){}                            };                        }                    };                    function destroy(){                        apf.all=null;                    }                    <\/script>                    <style>                    HTML{border:0;overflow:hidden;margin:0}                    BODY{margin:0}                    </style>                </head>                <body onmouseover="if(!self.apf) return;if(this.c){apf.all = this.c.all;this.c.Popup.parentDoc=self;}"></body>                </html>');
var c=apf;this.popup.document.body.onmousemove=function(){this.c=c;};},show:function(cacheId,x,y,animate,ref,width,height,callback){if(!this.popup){this.init();
}var o=this.cache[cacheId];this.popup.document.body.innerHTML=o.content.outerHTML;
if(animate){var iVal,steps=7,i=0,popup=this.popup;iVal=setInterval(function(){var value=++i*((height||o.height)/steps);
popup.show(x,y,width||o.width,value,ref);popup.document.body.firstChild.style.marginTop=(i-steps-1)*((height||o.height)/steps);
if(i>steps){clearInterval(iVal);callback(popup.document.body.firstChild);}},10);
}else{this.popup.show(x,y,width||o.width,height||o.height,ref);}this.last=cacheId;
},hide:function(){if(this.popup){this.popup.hide();}},forceHide:function(){if(this.last){apf.lookup(this.last).dispatchEvent("popuphide");
}},destroy:function(){if(!this.popup){return;}this.popup.document.body.c=null;this.popup.document.body.onmouseover=null;
}};apf.importClass(apf.runXpath,true,self);};apf.runNonIe=function(){DocumentFragment.prototype.getElementById=function(id){return this.childNodes.length?this.childNodes[0].ownerDocument.getElementById(id):null;
};if(XMLDocument.prototype.__defineGetter__){XMLDocument.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);
});XMLDocument.prototype.__defineSetter__("xml",function(){throw new Error(apf.formatErrorString(1042,null,"XML serializer","Invalid assignment on read-only property 'xml'."));
});Node.prototype.__defineGetter__("xml",function(){if(this.nodeType==3||this.nodeType==4||this.nodeType==2){return this.nodeValue;
}return(new XMLSerializer()).serializeToString(this);});Element.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);
});}if(typeof HTMLElement!="undefined"){if(!HTMLElement.prototype.insertAdjacentElement){Text.prototype.insertAdjacentElement=HTMLElement.prototype.insertAdjacentElement=function(where,parsedNode){switch(where.toLowerCase()){case"beforebegin":this.parentNode.insertBefore(parsedNode,this);
break;case"afterbegin":this.insertBefore(parsedNode,this.firstChild);break;case"beforeend":this.appendChild(parsedNode);
break;case"afterend":if(this.nextSibling){this.parentNode.insertBefore(parsedNode,this.nextSibling);
}else{this.parentNode.appendChild(parsedNode);}break;}};}if(!HTMLElement.prototype.insertAdjacentHTML){Text.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML=function(where,htmlStr){var r=this.ownerDocument.createRange();
r.setStartBefore(apf.isWebkit?document.body:(self.document?document.body:this));
var parsedHTML=r.createContextualFragment(htmlStr);this.insertAdjacentElement(where,parsedHTML);
};}if(!HTMLBodyElement.prototype.insertAdjacentHTML){HTMLBodyElement.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML;
}if(!HTMLElement.prototype.insertAdjacentText){Text.prototype.insertAdjacentText=HTMLElement.prototype.insertAdjacentText=function(where,txtStr){var parsedText=document.createTextNode(txtStr);
this.insertAdjacentElement(where,parsedText);};}HTMLElement.prototype.removeNode=function(){if(!this.parentNode){return;
}this.parentNode.removeChild(this);};if(HTMLElement.prototype.__defineSetter__){HTMLElement.prototype.__defineSetter__("innerText",function(sText){var s=""+sText;
this.innerHTML=s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
});HTMLElement.prototype.__defineGetter__("innerText",function(){return this.innerHTML.replace(/<[^>]+>/g,"").replace(/\s\s+/g," ").replace(/^\s+|\s+$/g," ");
});HTMLElement.prototype.__defineGetter__("outerHTML",function(){return(new XMLSerializer()).serializeToString(this);
});}}var ASYNCNOTSUPPORTED=false;try{XMLDocument.prototype.async=true;ASYNCNOTSUPPORTED=true;
}catch(e){}Document.prototype.onreadystatechange=null;Document.prototype.parseError=0;
Array.prototype.item=function(i){return this[i];};Array.prototype.expr="";XMLDocument.prototype.$clearDOM=function(){while(this.hasChildNodes()){this.removeChild(this.firstChild);
}};XMLDocument.prototype.$copyDOM=function(oDoc){this.$clearDOM();if(oDoc.nodeType==9||oDoc.nodeType==11){var oNodes=oDoc.childNodes;
for(var i=0;i<oNodes.length;i++){this.appendChild(this.importNode(oNodes[i],true));
}}else{if(oDoc.nodeType==1){this.appendChild(this.importNode(oDoc,true));}}};XMLDocument.prototype.loadXML=function(strXML){apf.xmldb.setReadyState(this,1);
var sOldXML=this.xml||this.serialize();var oDoc=(new DOMParser()).parseFromString(strXML,"text/xml");
apf.xmldb.setReadyState(this,2);this.$copyDOM(oDoc);apf.xmldb.setReadyState(this,3);
apf.xmldb.loadHandler(this);return sOldXML;};Node.prototype.getElementById=function(id){};
HTMLElement.prototype.replaceNode=Element.prototype.replaceNode=function(xmlNode){if(!this.parentNode){return;
}this.parentNode.insertBefore(xmlNode,this);this.parentNode.removeChild(this);};
XMLDocument.prototype.$load=XMLDocument.prototype.load;XMLDocument.prototype.load=function(sURI){var oDoc=document.implementation.createDocument("","",null);
oDoc.$copyDOM(this);this.parseError=0;apf.xmldb.setReadyState(this,1);try{if(this.async==false&&ASYNCNOTSUPPORTED){var tmp=new XMLHttpRequest();
tmp.open("GET",sURI,false);tmp.overrideMimeType("text/xml");tmp.send(null);apf.xmldb.setReadyState(this,2);
this.$copyDOM(tmp.responseXML);apf.xmldb.setReadyState(this,3);}else{this.$load(sURI);
}}catch(objException){this.parseError=-1;}finally{apf.xmldb.loadHandler(this);}return oDoc;
};var getStyle=apf.getStyle=function(el,prop){try{return(window.getComputedStyle(el,"")||{})[prop]||"";
}catch(e){}};HTMLDocument.prototype.setProperty=XMLDocument.prototype.setProperty=function(x,y){};
apf.getHttpReq=function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();
};apf.getXmlDom=function(message,noError,preserveWhiteSpaces){var xmlParser;if(message){if(preserveWhiteSpaces===false){message=message.replace(/>[\s\n\r]*</g,"><");
}xmlParser=new DOMParser();xmlParser=xmlParser.parseFromString(message,"text/xml");
if(xmlParser.getElementsByTagName("parsererror").length&&apf.xmldb&&apf.isJson(message)){try{xmlParser=apf.json2Xml(message,noError);
}catch(e){throw new Error(apf.formatErrorString(1051,null,"JSON to XML conversion error occurred.","\nSource Text : "+message.replace(/\t/gi," ")));
}}else{if(!noError){this.xmlParseError(xmlParser);}}}else{xmlParser=document.implementation.createDocument("","",null);
}return xmlParser;};apf.xmlParseError=function(xml){if(xml.getElementsByTagName("parsererror").length){var nodeValue=xml.documentElement.firstChild.nodeValue;
if(nodeValue!=null){var str=nodeValue.split("\n"),linenr=str[2].match(/\w+ (\d+)/)[1],message=str[0].replace(/\w+ \w+ \w+: (.*)/,"$1");
}else{if(nodeValue=xml.documentElement.firstChild.getElementsByTagName("div")[0].firstChild.nodeValue){var linenr=nodeValue.match(/line\s(\d*)/)[1]||"N/A",message=nodeValue.match(/column\s\d*:(.*)/)[1]||"N/A";
}else{var linenr="N/A",message="N/A";}}var srcText=xml.documentElement.lastChild.firstChild,srcMsg="";
if(srcText&&srcText.nodeValue){srcMsg="\nSource Text : "+srcText.nodeValue.replace(/\t/gi," ");
}throw new Error(apf.formatErrorString(1050,null,"XML Parse Error on line "+linenr,message+srcMsg));
}return xml;};apf.xmldb.setReadyState=function(oDoc,iReadyState){oDoc.readyState=iReadyState;
if(oDoc.onreadystatechange!=null&&typeof oDoc.onreadystatechange=="function"){oDoc.onreadystatechange();
}};apf.xmldb.loadHandler=function(oDoc){if(!oDoc.documentElement||oDoc.documentElement.tagName=="parsererror"){oDoc.parseError=-1;
}apf.xmldb.setReadyState(oDoc,4);};apf.Init.add(function(){var i,nodes=document.getElementsByTagName("form");
for(i=0;i<nodes.length;i++){nodes[i].removeNode();}nodes=document.getElementsByTagName("xml");
for(i=0;i<nodes.length;i++){nodes[i].removeNode();}nodes=null;});if(document.body){document.body.focus=function(){};
}if(!document.elementFromPoint){Document.prototype.elementFromPointRemove=function(el){if(!this.RegElements){return;
}this.RegElements.remove(el);};Document.prototype.elementFromPointAdd=function(el){if(!this.RegElements){this.RegElements=[];
}this.RegElements.push(el);};Document.prototype.elementFromPointReset=function(RegElements){FoundValue=[];
FoundNode=null;LastFoundAbs=document.documentElement;};Document.prototype.elementFromPoint=function(x,y){document.elementFromPointReset();
if(this.RegElements){var calc_z=-1,i,calc,n,sx,sy,ex,ey,z;for(calc_z=-1,calc,i=0;
i<this.RegElements.length;i++){n=this.RegElements[i];if(getStyle(n,"display")=="none"){continue;
}sx=getElementPosX(n);sy=getElementPosY(n);ex=sx+n.offsetWidth;ey=sy+n.offsetHeight;
if(x>sx&&x<ex&&y>sy&&y<ey){z=getElementZindex(n);if(z>calc_z){calc=[n,x,y,sx,sy];
calc_z=z;}}}if(calc){efpi(calc[0],calc[1],calc[2],0,FoundValue,calc[3],calc[4]);
if(!FoundNode){FoundNode=calc[0];LastFoundAbs=calc[0];FoundValue=[calc_z];}}}if(!this.RegElements||!this.RegElements.length){efpi(document.body,x,y,0,[],getElementPosX(document.body),getElementPosY(document.body));
}return FoundNode;};function efpi(from,x,y,CurIndex,CurValue,px,py){var StartValue=CurValue,StartIndex=CurIndex,nodes=from.childNodes,n,i,z,sx,sy,ex,ey,isAbs,isHidden,inSpace;
for(n,i=0;i<from.childNodes.length;i++){n=from.childNodes[i];if(n.nodeType==1&&getStyle(n,"display")!="none"&&n.offsetParent){sx=px+n.offsetLeft-n.offsetParent.scrollLeft;
sy=py+n.offsetTop-n.offsetParent.scrollTop;ex=sx+n.offsetWidth;ey=sy+n.offsetHeight;
isAbs=getStyle(n,"position");isAbs=(isAbs=="absolute")||(isAbs=="relative");isHidden=getStyle(n,"overflow")=="hidden";
inSpace=(x>sx&&x<ex&&y>sy&&y<ey);if(isAbs&&isHidden&&!inSpace){continue;}CurIndex=StartIndex;
CurValue=StartValue.copy();z=parseInt(getStyle(n,"zIndex"))||0;if(isAbs&&(z||z==0)||isHidden){if(!isAbs){z=0;
}if(z>=(FoundValue[CurIndex]||0)){if(z>(CurValue[CurIndex]||0)){CurValue[CurIndex]=z;
}CurIndex++;if(inSpace&&CurIndex>=FoundValue.length){FoundNode=n;FoundValue=CurValue;
LastFoundAbs=n;}}else{continue;}}else{if(inSpace&&CurIndex>=FoundValue.length){FoundNode=n;
FoundValue=CurValue;}}efpi(n,x,y,CurIndex,CurValue,isAbs?sx:px,isAbs?sy:py);}}}function getElementPosY(myObj){return myObj.offsetTop+parseInt(apf.getStyle(myObj,"borderTopWidth"))+(myObj.offsetParent?getElementPosY(myObj.offsetParent):0);
}function getElementPosX(myObj){return myObj.offsetLeft+parseInt(apf.getStyle(myObj,"borderLeftWidth"))+(myObj.offsetParent?getElementPosX(myObj.offsetParent):0);
}function getElementZindex(myObj){var z=0,n,p=myObj;while(p&&p.nodeType==1){z=Math.max(z,parseInt(getStyle(p,"zIndex"))||-1);
p=p.parentNode;}return z;}}apf.getOpacity=function(oHtml){return apf.getStyle(oHtml,"opacity");
};apf.setOpacity=function(oHtml,value){oHtml.style.opacity=value;};};apf.runOpera=function(){if(apf.runNonIe){apf.runNonIe();
}Document.prototype.selectNodes=XMLDocument.prototype.selectNodes=HTMLDocument.prototype.selectNodes=function(sExpr,contextNode){var oResult=this.evaluate(sExpr,(contextNode?contextNode:this),this.createNSResolver(this.documentElement),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);
var nodeList=new Array(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=0;
i<nodeList.length;i++){nodeList[i]=oResult.snapshotItem(i);}return nodeList;};Text.prototype.selectNodes=Attr.prototype.selectNodes=Element.prototype.selectNodes=function(sExpr){var doc=this.ownerDocument;
if(!doc.selectSingleNode){doc.selectSingleNode=HTMLDocument.prototype.selectSingleNode;
doc.selectNodes=HTMLDocument.prototype.selectNodes;}if(doc.selectNodes){return doc.selectNodes(sExpr,this);
}else{throw new Error(apf.formatErrorString(1047,null,"XPath Selection","Method selectNodes is only supported by XML Nodes"));
}};Document.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=HTMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var nodeList=this.selectNodes("("+sExpr+")[1]",contextNode?contextNode:null);
return nodeList.length>0?nodeList[0]:null;};Text.prototype.selectSingleNode=Attr.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(sExpr){var doc=this.ownerDocument;
if(!doc.selectSingleNode){doc.selectSingleNode=HTMLDocument.prototype.selectSingleNode;
doc.selectNodes=HTMLDocument.prototype.selectNodes;}if(doc.selectSingleNode){return doc.selectSingleNode(sExpr,this);
}else{throw new Error(apf.formatErrorString(1048,null,"XPath Selection","Method selectSingleNode is only supported by XML Nodes. \nInfo : "+e));
}};var serializer=new XMLSerializer();apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var node,frag,i,l;
if(nodeList){frag=document.createDocumentFragment();i=0;l=nodeList.length;for(;
i<l;i++){if(!(node=nodeList[i])){continue;}frag.appendChild(node);}}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s||apf.html_entity_decode(serializer.serializeToString(frag)).replace(/<([^>]+)\/>/g,"<$1></$1>"));
};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,s){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}if(!s){s=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):((xmlNode.nodeType==3||xmlNode.nodeType==4||xmlNode.nodeType==2)?xmlNode.nodeValue:serializer.serializeToString(xmlNode)));
}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s.replace(/<([^>]+)\/>/g,"<$1></$1>"));
return beforeNode?beforeNode.previousSibling:htmlNode.lastChild;};apf.getHtmlLeft=function(oHtml){return(oHtml.offsetLeft-(parseInt(apf.getStyle(oHtml.parentNode,"borderLeftWidth"))||0));
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(parseInt(apf.getStyle(p,"borderRightWidth"))||0));
};apf.getHtmlTop=function(oHtml){return(oHtml.offsetTop-(parseInt(apf.getStyle(oHtml.offsetParent,"borderTopWidth"))||0));
};apf.getHtmlBottom=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(parseInt(apf.getStyle(p,"borderBottomWidth"))||0));
};apf.getBorderOffset=function(oHtml){return[parseInt(apf.getStyle(oHtml,"borderLeftWidth"))||0,parseInt(apf.getStyle(oHtml,"borderTopWidth"))||0];
};};apf.runWebkit=function(){HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(sExpr,contextNode){if(sExpr.substr(0,2)=="//"){sExpr="."+sExpr;
}try{var oResult=this.evaluate(sExpr,(contextNode||this),this.createNSResolver(this.documentElement),7,null);
}catch(ex){try{var oResult=this.evaluate("child::"+sExpr,(contextNode||this),this.createNSResolver(this.documentElement),7,null);
}catch(ex){throw new Error("XPath error: "+ex.message+"\nLine: "+ex.lineNumber+"\nExpression: '"+sExpr+"'");
}}var nodeList=new Array(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=nodeList.length-1;
i>=0;i--){nodeList[i]=oResult.snapshotItem(i);}return nodeList;};Text.prototype.selectNodes=Attr.prototype.selectNodes=Element.prototype.selectNodes=function(sExpr){return this.ownerDocument.selectNodes(sExpr,this);
};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var nodeList=this.selectNodes("("+sExpr+")[1]",contextNode?contextNode:null);
return nodeList.length>0?nodeList[0]:null;};Text.prototype.selectSingleNode=Attr.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(sExpr){return this.ownerDocument.selectSingleNode(sExpr,this);
};var serializer=new XMLSerializer();apf.insertHtmlNodes=function(nodeList,htmlNode,beforeNode,s){var node,frag,a,i,l;
if(nodeList){frag=document.createDocumentFragment();a=[],i=0,l=nodeList.length;
for(;i<l;i++){if(!(node=nodeList[i])){continue;}frag.appendChild(node);}}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s||apf.html_entity_decode(serializer.serializeToString(frag)).replace(/<([^>]+)\/>/g,"<$1></$1>"));
};apf.insertHtmlNode=function(xmlNode,htmlNode,beforeNode,s){if(htmlNode.nodeType!=11&&!htmlNode.style){return htmlNode.appendChild(xmlNode);
}if(!s){s=apf.html_entity_decode(xmlNode.serialize?xmlNode.serialize(true):((xmlNode.nodeType==3||xmlNode.nodeType==4||xmlNode.nodeType==2)?xmlNode.nodeValue:serializer.serializeToString(xmlNode)));
}(beforeNode||htmlNode).insertAdjacentHTML(beforeNode?"beforebegin":"beforeend",s.match(/<(IMG|LINK|META|BR|HR|BASEFONT)[^\/>]*/i)?s.replace(/<([^>]+)\/>/g,"<$1 />"):s.replace(/<([^>]+)\/>/g,"<$1></$1>"));
return beforeNode?beforeNode.previousSibling:htmlNode.lastChild;};apf.getHtmlLeft=function(oHtml){return oHtml.offsetLeft;
};apf.getHtmlRight=function(oHtml){var p;return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowWidth():p.offsetWidth)-oHtml.offsetLeft-oHtml.offsetWidth-(parseInt(apf.getStyle(p,"borderLeftWidth"))||0)-(parseInt(apf.getStyle(p,"borderRightWidth"))||0));
};apf.getHtmlTop=function(oHtml){return oHtml.offsetTop;};apf.getHtmlBottom=function(oHtml){var p;
return(((p=oHtml.offsetParent).tagName=="BODY"?apf.getWindowHeight():p.offsetHeight)-oHtml.offsetTop-oHtml.offsetHeight-(parseInt(apf.getStyle(p,"borderTopWidth"))||0)-(parseInt(apf.getStyle(p,"borderBottomWidth"))||0));
};apf.getBorderOffset=function(oHtml){return[0,0];};if(apf.runNonIe){apf.runNonIe();
}};apf.crypto.Base64=(function(){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
function encode(data){var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];
if(!data){return data;}data=apf.crypto.UTF8.encode(data+"");do{o1=data.charCodeAt(i++);
o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;
h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);
}while(i<data.length);enc=tmp_arr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";
break;case 2:enc=enc.slice(0,-1)+"=";break;}return enc;}function decode(data){var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,tmp_arr=[];
if(!data){return data;}data+="";do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));
h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;
o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);
}else{if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);
}}}while(i<data.length);return apf.crypto.UTF8.decode(tmp_arr.join(""));}return{decode:decode,encode:encode};
})();apf.crypto.UTF8={encode:function(string){string=(string+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");
var tmp_arr=[],start=0,end=0,c1,enc;for(var n=0,l=string.length;n<l;n++){c1=string.charCodeAt(n);
enc=null;if(c1<128){end++;}else{if((c1>127)&&(c1<2048)){enc=String.fromCharCode((c1>>6)|192)+String.fromCharCode((c1&63)|128);
}else{enc=String.fromCharCode((c1>>12)|224)+String.fromCharCode(((c1>>6)&63)|128)+String.fromCharCode((c1&63)|128);
}}if(enc!==null){if(end>start){tmp_arr.push(string.substring(start,end));}tmp_arr.push(enc);
start=end=n+1;}}if(end>start){tmp_arr.push(string.substring(start,string.length));
}return tmp_arr.join("");},decode:function(str_data){var tmp_arr=[],i=0,ac=0,c1=0,c2=0,c3=0;
str_data+="";while(i<str_data.length){c1=str_data.charCodeAt(i);if(c1<128){tmp_arr[ac++]=String.fromCharCode(c1);
i++;}else{if((c1>191)&&(c1<224)){c2=str_data.charCodeAt(i+1);tmp_arr[ac++]=String.fromCharCode(((c1&31)<<6)|(c2&63));
i+=2;}else{c2=str_data.charCodeAt(i+1);c3=str_data.charCodeAt(i+2);tmp_arr[ac++]=String.fromCharCode(((c1&15)<<12)|((c2&63)<<6)|(c3&63));
i+=3;}}}return tmp_arr.join("");}};apf.crypto.MD5={hexcase:0,b64pad:"",chrsz:8,hex_md5:function(s){return this.binl2hex(this.core_md5(this.str2binl(s),s.length*this.chrsz));
},b64_md5:function(s){return this.binl2b64(this.core_md5(this.str2binl(s),s.length*this.chrsz));
},str_md5:function(s){return this.binl2str(this.core_md5(this.str2binl(s),s.length*this.chrsz));
},hex_hmac_md5:function(key,data){return this.binl2hex(this.core_hmac_md5(key,data));
},b64_hmac_md5:function(key,data){return this.binl2b64(this.core_hmac_md5(key,data));
},str_hmac_md5:function(key,data){return this.binl2str(this.core_hmac_md5(key,data));
},core_md5:function(x,len){x[len>>5]|=128<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;
var a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(var i=0;i<x.length;
i+=16){var olda=a,oldb=b,oldc=c,oldd=d;a=this.md5_ff(a,b,c,d,x[i+0],7,-680876936);
d=this.md5_ff(d,a,b,c,x[i+1],12,-389564586);c=this.md5_ff(c,d,a,b,x[i+2],17,606105819);
b=this.md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=this.md5_ff(a,b,c,d,x[i+4],7,-176418897);
d=this.md5_ff(d,a,b,c,x[i+5],12,1200080426);c=this.md5_ff(c,d,a,b,x[i+6],17,-1473231341);
b=this.md5_ff(b,c,d,a,x[i+7],22,-45705983);a=this.md5_ff(a,b,c,d,x[i+8],7,1770035416);
d=this.md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=this.md5_ff(c,d,a,b,x[i+10],17,-42063);
b=this.md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=this.md5_ff(a,b,c,d,x[i+12],7,1804603682);
d=this.md5_ff(d,a,b,c,x[i+13],12,-40341101);c=this.md5_ff(c,d,a,b,x[i+14],17,-1502002290);
b=this.md5_ff(b,c,d,a,x[i+15],22,1236535329);a=this.md5_gg(a,b,c,d,x[i+1],5,-165796510);
d=this.md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=this.md5_gg(c,d,a,b,x[i+11],14,643717713);
b=this.md5_gg(b,c,d,a,x[i+0],20,-373897302);a=this.md5_gg(a,b,c,d,x[i+5],5,-701558691);
d=this.md5_gg(d,a,b,c,x[i+10],9,38016083);c=this.md5_gg(c,d,a,b,x[i+15],14,-660478335);
b=this.md5_gg(b,c,d,a,x[i+4],20,-405537848);a=this.md5_gg(a,b,c,d,x[i+9],5,568446438);
d=this.md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=this.md5_gg(c,d,a,b,x[i+3],14,-187363961);
b=this.md5_gg(b,c,d,a,x[i+8],20,1163531501);a=this.md5_gg(a,b,c,d,x[i+13],5,-1444681467);
d=this.md5_gg(d,a,b,c,x[i+2],9,-51403784);c=this.md5_gg(c,d,a,b,x[i+7],14,1735328473);
b=this.md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=this.md5_hh(a,b,c,d,x[i+5],4,-378558);
d=this.md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=this.md5_hh(c,d,a,b,x[i+11],16,1839030562);
b=this.md5_hh(b,c,d,a,x[i+14],23,-35309556);a=this.md5_hh(a,b,c,d,x[i+1],4,-1530992060);
d=this.md5_hh(d,a,b,c,x[i+4],11,1272893353);c=this.md5_hh(c,d,a,b,x[i+7],16,-155497632);
b=this.md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=this.md5_hh(a,b,c,d,x[i+13],4,681279174);
d=this.md5_hh(d,a,b,c,x[i+0],11,-358537222);c=this.md5_hh(c,d,a,b,x[i+3],16,-722521979);
b=this.md5_hh(b,c,d,a,x[i+6],23,76029189);a=this.md5_hh(a,b,c,d,x[i+9],4,-640364487);
d=this.md5_hh(d,a,b,c,x[i+12],11,-421815835);c=this.md5_hh(c,d,a,b,x[i+15],16,530742520);
b=this.md5_hh(b,c,d,a,x[i+2],23,-995338651);a=this.md5_ii(a,b,c,d,x[i+0],6,-198630844);
d=this.md5_ii(d,a,b,c,x[i+7],10,1126891415);c=this.md5_ii(c,d,a,b,x[i+14],15,-1416354905);
b=this.md5_ii(b,c,d,a,x[i+5],21,-57434055);a=this.md5_ii(a,b,c,d,x[i+12],6,1700485571);
d=this.md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=this.md5_ii(c,d,a,b,x[i+10],15,-1051523);
b=this.md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=this.md5_ii(a,b,c,d,x[i+8],6,1873313359);
d=this.md5_ii(d,a,b,c,x[i+15],10,-30611744);c=this.md5_ii(c,d,a,b,x[i+6],15,-1560198380);
b=this.md5_ii(b,c,d,a,x[i+13],21,1309151649);a=this.md5_ii(a,b,c,d,x[i+4],6,-145523070);
d=this.md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=this.md5_ii(c,d,a,b,x[i+2],15,718787259);
b=this.md5_ii(b,c,d,a,x[i+9],21,-343485551);a=this.safe_add(a,olda);b=this.safe_add(b,oldb);
c=this.safe_add(c,oldc);d=this.safe_add(d,oldd);}return[a,b,c,d];},md5_cmn:function(q,a,b,x,s,t){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(a,q),this.safe_add(x,t)),s),b);
},md5_ff:function(a,b,c,d,x,s,t){return this.md5_cmn((b&c)|((~b)&d),a,b,x,s,t);
},md5_gg:function(a,b,c,d,x,s,t){return this.md5_cmn((b&d)|(c&(~d)),a,b,x,s,t);
},md5_hh:function(a,b,c,d,x,s,t){return this.md5_cmn(b^c^d,a,b,x,s,t);},md5_ii:function(a,b,c,d,x,s,t){return this.md5_cmn(c^(b|(~d)),a,b,x,s,t);
},core_hmac_md5:function(key,data){var bkey=this.str2binl(key),ipad=Array(16),opad=Array(16);
if(bkey.length>16){bkey=this.core_md5(bkey,key.length*this.chrsz);}for(var i=0;
i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828;}return this.core_md5(opad.concat(this.core_md5(ipad.concat(this.str2binl(data)),512+data.length*this.chrsz)),512+128);
},safe_add:function(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);
return(msw<<16)|(lsw&65535);},bit_rol:function(num,cnt){return(num<<cnt)|(num>>>(32-cnt));
},str2binl:function(str){var bin=[],i,mask=(1<<this.chrsz)-1;for(i=0;i<str.length*this.chrsz;
i+=this.chrsz){bin[i>>5]|=(str.charCodeAt(i/this.chrsz)&mask)<<(i%32);}return bin;
},binl2str:function(bin){var str=[],i,mask=(1<<this.chrsz)-1;for(i=0;i<bin.length*32;
i+=this.chrsz){str.push(String.fromCharCode((bin[i>>5]>>>(i%32))&mask));}return str.join("");
},binl2hex:function(binarray){var hex_tab=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",str=[],i;
for(i=0;i<binarray.length*4;i++){str.push(hex_tab.charAt((binarray[i>>2]>>((i%4)*8+4))&15)+hex_tab.charAt((binarray[i>>2]>>((i%4)*8))&15));
}return str.join("");},binl2b64:function(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",str=[],i;
for(i=0;i<binarray.length*4;i+=3){var triplet=(((binarray[i>>2]>>8*(i%4))&255)<<16)|(((binarray[i+1>>2]>>8*((i+1)%4))&255)<<8)|((binarray[i+2>>2]>>8*((i+2)%4))&255);
for(var j=0;j<4;j++){if(i*8+j*6>binarray.length*32){str.push(this.b64pad);}else{str.push(tab.charAt((triplet>>6*(3-j))&63));
}}}return str.join("");}};(function(global){function rotate_left(n,s){var t4=(n<<s)|(n>>>(32-s));
return t4;}function cvt_hex(val){var str="";var i;var v;for(i=7;i>=0;i--){v=(val>>>(i*4))&15;
str+=v.toString(16);}return str;}global.SHA1=function(str){var blockstart,i,j,W=new Array(80),H0=1732584193,H1=4023233417,H2=2562383102,H3=271733878,H4=3285377520,A,B,C,D,E,temp;
str=apf.crypto.UTF8.encode(str);var str_len=str.length,word_array=[];for(i=0;i<str_len-3;
i+=4){j=str.charCodeAt(i)<<24|str.charCodeAt(i+1)<<16|str.charCodeAt(i+2)<<8|str.charCodeAt(i+3);
word_array.push(j);}switch(str_len%4){case 0:i=2147483648;break;case 1:i=str.charCodeAt(str_len-1)<<24|8388608;
break;case 2:i=str.charCodeAt(str_len-2)<<24|str.charCodeAt(str_len-1)<<16|32768;
break;case 3:i=str.charCodeAt(str_len-3)<<24|str.charCodeAt(str_len-2)<<16|str.charCodeAt(str_len-1)<<8|128;
break;}word_array.push(i);while((word_array.length%16)!=14){word_array.push(0);
}word_array.push(str_len>>>29);word_array.push((str_len<<3)&4294967295);for(blockstart=0;
blockstart<word_array.length;blockstart+=16){for(i=0;i<16;i++){W[i]=word_array[blockstart+i];
}for(i=16;i<=79;i++){W[i]=rotate_left(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);}A=H0;B=H1;
C=H2;D=H3;E=H4;for(i=0;i<=19;i++){temp=(rotate_left(A,5)+((B&C)|(~B&D))+E+W[i]+1518500249)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=20;i<=39;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+1859775393)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=40;i<=59;i++){temp=(rotate_left(A,5)+((B&C)|(B&D)|(C&D))+E+W[i]+2400959708)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}for(i=60;i<=79;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+3395469782)&4294967295;
E=D;D=C;C=rotate_left(B,30);B=A;A=temp;}H0=(H0+A)&4294967295;H1=(H1+B)&4294967295;
H2=(H2+C)&4294967295;H3=(H3+D)&4294967295;H4=(H4+E)&4294967295;}temp=cvt_hex(H0)+cvt_hex(H1)+cvt_hex(H2)+cvt_hex(H3)+cvt_hex(H4);
return temp.toLowerCase();};})(apf.crypto);apf.JsParser=new (function(){var tok_lut={'"':4,"'":4,"[":2,"]":3,"{":2,"}":3,"(":2,")":3,"\n":6,"\r\n":6,"//":7,"/*":7,"*/":7,"/":8},tok_close={"}":"{","]":"[",")":"("},tokenizerx=/(\r?[\n]|\/[\/*]|\*\/|["'{(\[\])}\]\/])|([ \t]+)|([\w\$._])+|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>])/g;
function errToString(){return this.t+"["+this.pos+"]";}function posToString(){return"Ln : "+this.line+", Col : "+this.col;
}function argToString(){return this.type+" "+this.name+(this.def!==undefined?"="+this.def:"");
}function markerToString(){return"Marker:"+this.type+"  ["+this.pos+"] "+(this.args?"("+this.args.join(",")+")":"");
}function funcToString(){return this.type+" "+this.ret+" "+this.name+(this.args?"("+this.args.join(",")+")":"")+"  ["+this.pos+"]"+(this.doc?(" Doc: "+this.doc):"");
}function concat(t,b,e,m){for(var s=[],sl=0,i=b;i<e;i+=3){s[sl++]=(t[i]==2)?concat(t[i+2],0,t[i+2].length):t[i+2];
if(m&&i<e-3){s[sl++]=m;}}return s.join("");}function formatPos(l,pos){return JsParser.line(l,pos).toString();
}var pre_regex={"throw":1,"return":1,"(":1,"[":1,",":1,"=":1,":":1};this.parse=function(str){var t=[],b=0,stack=[],type=0,mode_tok=0,n,lines=[],err=[];
var last_tok=null;str.replace(tokenizerx,function(tok,rx_lut,rx_ws,rx_word,rx_misc,pos){type=rx_lut?tok_lut[rx_lut]:(rx_ws?9:(rx_word?5:0));
if(!mode_tok){switch(type){case 8:if(pre_regex[last_tok]||pre_regex[t[t.length-1]]){if(t[t.length-3]=="["){mode_tok="objRgx";
var openTags=1;}else{mode_tok=tok;}t[n=t.length]=type,t[++n]=pos;b=[tok];}else{t[n=t.length]=0;
t[++n]=pos;t[++n]=tok;}break;case 4:case 7:t[n=t.length]=type,t[++n]=pos;mode_tok=tok;
b=[tok];break;case 2:t[n=t.length]=type;t[++n]=pos;stack.push(t);t=t[++n]=[0,pos,tok];
break;case 3:if(t[2]!=tok_close[tok]){err.push({t:"Error closing "+tok+" (opened with: "+t[2]+")",pos:pos,toString:errToString});
}else{t[n=t.length]=type;t[++n]=pos;t[++n]=tok;t=stack.pop();}break;case 6:lines[lines.length]=pos;
break;case 9:break;default:t[n=t.length]=type;t[++n]=pos;t[++n]=tok;break;}}else{b[b.length]=tok;
if(mode_tok=="objRgx"){if(tok=="["){openTags++;}else{if(tok=="]"){openTags--;}}if(openTags==0){mode_tok=0;
t[++n]=b.join("");}}switch(type){case 4:if(mode_tok==tok){mode_tok=0;t[++n]=b.join("");
}break;case 7:if(tok=="*/"&&mode_tok=="/*"){mode_tok=0;t[++n]=b.join("");}else{if(tok=="*/"&&mode_tok=="/"){mode_tok=0;
t[++n]=b.join("");}}break;case 8:if(mode_tok=="/"){mode_tok=0;t[++n]=b.join("");
}break;case 6:lines[lines.length]=pos;if(mode_tok=="//"){mode_tok=0;b.pop();t[++n]=b.join("");
}break;}}if(type<9){last_tok=tok;}});while(stack.length){err.push({t:"Not closed: "+(n=t[2],t=stack.pop(),n),pos:formatPos(lines,t[t.length-2]),toString:errToString});
}if(mode_tok){err.push({t:"Blockmode not closed of "+b[0],pos:formatPos(lines,t[t.length-1]),toString:errToString});
}return{tree:t,lines:lines,err:err};};this.dump=function(s,t,level){for(var i=0;
i<t.length;i+=3){var type=t[i];if(type==2){this.dump(s,t[i+2],level+1);}else{s.push(Array(level).join("----"),type," ",t[i+2],"\n");
}}};this.line=function(lines,pos){for(var i=0,j=lines.length;i<j&&lines[i]<pos;
i++){}return{line:i+1,col:pos-lines[i-1],toString:posToString};};this.scan=function(t,tag_prefix,classes,err,in_struct,scope,outer,base_class){};
})();apf.lm=new (function(){var statement_lut={"var":1,"for":1,"while":1,"do":1,"if":1,"else":1,"switch":1,"case":1,"break":1,"continue":1,"default":1,"function":2,"return":1,"try":1,"catch":1,"throw":1,"debugger":1,alert:1,confirm:1,setTimeout:1,setInterval:1,"delete":1,"export":1,"import":1,label:1,foreach:1,each:1,eachrev:1,foreachrev:1,node:1,local:1,yield:1,let:1,"finally":1,"delete":1},type_lut={"\n":1,"\r\n":1,"==":2,"++":2,"--":2,'"':5,"'":5,"<!--":6,"-->":6,"/*":6,"//":6,"*/":6,"{":7,"}":8,"[":9,"]":10,"(":11,")":12,"<":13,">":14,"+=":2,"-=":2,"/=":2,"*=":2,"!=":2},type_close={"{":"}","[":"]","(":")","{{":"}"},xpath_axes={ancestor:1,"ancestor-or-self":1,attribute:1,child:1,descendant:1,"descendant-or-self":1,following:1,"following-sibling":1,namespace:1,parent:1,preceding:1,self:1},misc_tok={";":1,",":2,"^":3,"=":4,"+=":4,"-=":4,"/=":4,"*=":4,"/":5,":":6},xpath_lut_code={"~":"_val(_n,","%":"_nod(_n,","*":"_nods(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_text={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_attr={"~":"_val(_n,","%":"_val(_n,","*":"_val(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_node,xpath_lut_node_normal={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},xpath_lut_node_langedit={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lnged("},pre_regexp={"[":1,"(":1,",":1,"=":1,"return":1,"throw":1},pre_xpath={"else":1,"return":1,"delete":1},pre_plain={"do":1,"else":1,"try":1},op_lut={"=":"_asn(","+=":"_add(","-=":"_sub(","/=":"_div(","*=":"_mul("},new_block={"+":1,"%":1,"-":1,"/":1,"=":1,"(":1,"?":1,"|":1,"^":1,"[":1,"&":1,"*":1,"!":1,":":1,"<":1,",":1},out_context_word={"{":1,"} ":1,")":1,")   ":1,";":1,"\n":1,"else":1},out_context_paren={"{":1,";":1,"\n":1,"else":1},markup_in_code_lut={"} ":1,")   ":1,"(":1,";":1,"&":1,"^":1,"|":1,",":1,'"':1,"'":1,"=":1,"!=":2,"+=":2,"-=":2,"/=":2,"*=":2,"?":1,"{":1,"}":1,">":1,"[":1,"+":1,":":1,"else":1,"return":1},block_autoappend={'"':1,"'":1,">":1,"]":1,"}":1},unesc_lut={'\\"':'"',"\\'":"'","\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\"},call_exclusion={alert:1,confirm:1,setTimeout:1,setInterval:1,"switch":1,call:1,"return":1,"throw":1,"case":1,"catch":1,abs:1,acos:1,asin:1,atan:1,atan2:1,ceil:1,cos:1,exp:1,floor:1,log:1,max:1,min:1,pow:1,random:1,round:1,sin:1,sqrt:1,tan:1,lin:1,linear:1,idx:1,sort:1,"typeof":1},is_out_space={" ":1,"\n":1},newline_notallowed={"{":1,";":1,"(":1,"\n":1},unesc_str={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")"},unesc_txt={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\\\\\\\","\\":"\\\\","\\<":"<","\\>":">"},xml_code_operators={lte:"<=",gte:">=",lt:"<",gt:">",and:"&&",or:"||",andbin:"&",orbin:"|",LTE:"<=",GTE:">=",LT:"<",GT:">",AND:"&&",OR:"||",ANDBIN:"&",ORBIN:"|"},xpath_macro={0:"_val(_n,",1:"_valcr(_n,_cr,",2:"_nod(_n,",3:"_nodcr(_n,_cr,",4:"_nods(_n,",5:"_xpt(_n,",6:"_valst(_n,",7:"_valed(_n,",8:"_valattr(_n,",foreach:"_nods(_n,",each:"_nods(_n,",foreachrev:"_nods(_n,",eachrev:"_nods(_n,",xabs:"_valst(_n,",local:"_nod(_n,",tagName:"_nod(_n,",localName:"_nod(_n,",xml:"_xmlq(",_call:"_val(_n,"},xpath_model={"_val(_n,":"_valm(","_valcr(_n,_cr,":"_valcr(0,_cr,","_nod(_n,":"_nodm(","_nodcr(_n,_cr,":"_nodcr(0,_cr,","_nods(_n,":"_nodsm(","_argwrap(_n,":"_argwrapm(","_xml(_n,":"_xml(0,","_xmls(_n,":"_xmls(0,","_cnt(_n,":"_cntm(","_xpt(_n,":"_xptm(","_valst(_n,":"_valm(","_valed(_n,":"_valed(0,","_lng(":"_lng(","_lnged(":"_lnged("},parserx=/(\r?[\n]|\/\*|\*\/|\/\/|\<\!\-\-|\-\-\>|[=\!+\/\*-]=|\+\+|\-\-|["'{(\[\])}\]\<\>]|$)|([ \t]+)|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF.$_][\w.$_]*)|(\d[x\d.]*)|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>]?)/g,selfrx=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g,macro_o={},macro_c={},macro_m={},c_async_lut=apf.$asyncObjects||{comm:1,rpc:1,http:1,"apf.ajax":1},c_process_async,c_xpathmode,c_elemxpath,c_statexpath,c_injectself,c_propassign,c_export,o,ol,o_asyncs,o_xpathpairs,o_props,o_segs,o_xpaths,o_models,s=[],sl,bt=[],bts=[],parse_mode,scope,segment,start_tok,str,str_len,line_no,nesting,last_tok,last_type,last_dot,last_model,last_prop,last_cmt_mode,last_cmt_tok,last_cmt_type,last_line,last_ns,last_word;
macro_o["if"]="if(",macro_c["if"]=")",macro_o["while"]="while(",macro_c["while"]=")",macro_o["for"]="for(",macro_c["for"]=")",macro_o["switch"]="switch(",macro_c["switch"]=")",macro_o["catch"]="catch(",macro_c["catch"]=")",macro_c["function"]=")  ";
macro_o.foreach=macro_o.each="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(",macro_c.foreach=macro_c.each=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-2]++])||(_t.length-=2,_n=_t.pop(),0);)",macro_o.foreachrev=macro_o.eachrev="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(",macro_c.foreachrev=macro_c.eachrev=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-1].length-(_t[_t.length-2]++)-1])||(_t.length-=2,_n=_t.pop(),0);)",macro_o.local="\nfor(var _t=_t||[],_t=(_t.push(_n,((_n=_local(",macro_c.local=")),1)),_t);(_t[_t.length-1]--&&_n)||(_t.length--,_n=_t.pop(),0);)",macro_o._editlm="_valedx(true, ",macro_o._editnormal="_valedx(false, ",macro_c.edit=")",macro_o.xabs="  (  ",macro_c.xabs="  )  ",macro_o.localName="_localName(_n",macro_c.localName=")",macro_o.output="_o.join(''",macro_c.output=")",macro_o.reset="(_o=[],l=0",macro_c.reset=")",macro_o.index="apf.getChildNumber.call(apf",macro_c.index=")",macro_o.item="(_t[_t.length-1][_t[_t.length-2]-1]",macro_c.item=")",macro_o.first="(_t[_t.length-2]==1",macro_c.first=")",macro_o.last="(_t[_t.length-2]==_t[_t.length-1].length",macro_c.last=")",macro_o.total="(_t[_t.length-1].length",macro_c.total=")",macro_o.pos="(_t[_t.length-2]-1",macro_c.pos=")",macro_o.tagName="_tagName(_n",macro_c.tagName=")",macro_o._nodeValue="_nodeValue(_n",macro_c._nodeValue=")",macro_c.async="])",macro_c.precall="])",macro_c._call=")";
var call_args_lut={_call:".call(_n",localName:macro_o.localName,tagName:macro_o.tagName,nodeValue:macro_o.nodeValue,index:macro_o.index},cf_block_o="(function(){var _o=[],_l=0;\n",cf_block_c=";return _l==1?_o[0]:_o.join('');})()",cf_async_o="_async(_n,_c,_a,_w,_f,this,",cf_async_m="',_a[++_a.i]||[",cf_obj_output="_r=",cf_mode_output,cf_str_output="_o[_l++]=",cf_def_output="",cf_func_o="{var _o=[],_l=0,_n=this;\n",cf_func_c=";\nreturn _l==1?_o[0]:_o.join('');}",cc_async_o="(_a=_a||{}).i=0;try{\n",cc_async_c="}catch(_e){if(_e.x)return;throw(_e);}\n",cc_pc_o="(_a=_a||{}).i=0;try{_precall(_w);",cc_pc_c="}catch(_e){if(_e.x)return;throw(_e);}",cc_opt_o="with(_w){",cc_opt_c="}",cc_v_blk_o="var _o=[],_l=0;_o[_l++]=",cc_v_blk_ob="var _o=[],_l=0;\n",cc_v_blk_c=";\nreturn _ret(_l==1?_o[0]:_o.join(''));",cc_v_blk_cb=";\n_c(_ret(_l==1?_o[0]:_o.join('')),apf.SUCCESS,apf.$lmx);apf.$lmx=null;",cc_v_ret_o="return _ret(",cc_v_ret_c=");",cc_v_cb_o="_c(_ret(",cc_v_cb_c="),apf.SUCCESS,apf.$lmx);apf.$lmx=null;\n",cc_o_blk_o="var _r=",cc_o_blk_ob="var _r;",cc_o_blk_c=";\nreturn _r;",cc_o_blk_cb=";\n_c(_r,apf.SUCCESS,apf.$lmx);apf.$lmx=null;",cc_o_blk_ce=";\n_c(0,apf.SUCCESS,apf.$lmx);apf.$lmx=null;;",cc_o_ret_o="return ",cc_o_ret_c="",cc_o_cb_o="_c(",cc_o_cb_c=",apf.SUCCESS);",cc_f_async_o="var _f=function(_n,_c,_w,_a){",cc_f_opt_o="var _f=function(_n,_w){",cc_f_o="var _f=function(_n){",cc_fc_async_o="var _f=function(_n,_c,_w,_cr,_a){",cc_fc_opt_o="var _f=function(_n,_w,_cr,){",cc_fc_o="var _f=function(_n,_cr){",cc_fe_async_o="var _f=function(event,_c,_w,_a,_n){",cc_fe_opt_o="var _f=function(event,_w,_n){",cc_fe_o="var _f=function(event,_n){",cc_f_c="}",cc_f_match_o="var _f=function(_m){",cc_m_m_blk=";\nif(_n=_r){if(!_n.nodeType)_n=_m;",cc_m_m_value_o=";\nif(_n=",cc_m_m_value_c="){if(!_n.nodeType)_n=_m;",cc_m_v_string="\nreturn ",cc_m_v_o="\nreturn _ret(",cc_m_v_c=");",cc_m_n_string="\nreturn _n;",cc_m_n_o="\nreturn (_r = (",cc_m_n_c="))?(_r.nodeType?_r:_n):(_r===null?null:_n);",cc_m_o="var _r, _n = _m;",cc_m_brk=";\n_n = _m;",cc_m_v_ret="\nreturn _ret(_nodeValue(_n));",cc_m_n_ret="\nreturn _n;",cc_m_c="\n}";
function switchToBlock(no_output){var u,v;if(o[scope-1]=="{{"){u=scope-1;}else{for(v=sl-2,u=0;
v>=0&&o[u=(s[v]&268435455)-1]!="{{";v-=2){}}if(!no_output&&ol>u+1){o[u]=cf_block_o+cf_str_output;
}else{o[u]=cf_block_o;}parse_mode=1;}function parser(tok,rx_lut,rx_white,rx_word,rx_num,rx_misc,pos){var u,v,w,type=rx_lut?type_lut[rx_lut]:(rx_white?0:(rx_word?3:(rx_num?4:(tok?2:15))));
switch(parse_mode){case 0:case 1:switch(type){case 0:if((last_type==3&&last_tok!="$")||last_type==4){o[ol++]=" ";
}else{if(xpath_lut_code[last_tok]){last_type=0;}}break;case 1:line_no++,last_line=pos;
if(o[ol-1]!="\n"&&!newline_notallowed[last_tok]){o[ol++]="\n";}if(xpath_lut_code[last_tok]){last_type=0;
}break;case 2:if(v=misc_tok[tok]){switch(v){case 1:if(!s[sl-1]){o[ol++]=")",sl-=2;
}if(!parse_mode){if(o[ol-1]!="\n"&&last_tok!="{"&&last_tok!=";"){o[ol++]="\n";}}else{if(!sl||s[sl-1]){o[ol++]=";";
}}break;case 2:if(!s[sl-1]){o[ol++]=")",sl-=2;}o[ol++]=",";break;case 3:if(o[ol-1]=="\n"||o[ol-1]==";"||last_tok=="{"||last_tok=="} "||ol==scope){if(!parse_mode){switchToBlock();
}o[ol++]="  ";}else{o[ol++]="^";}break;case 4:if(last_tok!="<"&&last_tok!=">"){if(!parse_mode&&o[scope-1]!="("){switchToBlock(true);
}o[ol++]=tok;for(v=ol;v>=scope&&!statement_lut[o[v]]&&!((o[v]=="  "||o[v]==(nesting?cf_str_output:cf_mode_output))&&(o[v]="",1));
v--){}if(last_type==3&&last_dot>0&&last_tok.charAt(0)!="."){if(c_propassign){ol-=2;
while(is_out_space[o[ol]]){ol--;}w=last_tok;o[ol++]=op_lut[tok],o[ol++]=w.slice(0,last_dot),o[ol++]=",'",o[ol++]=w.slice(last_dot+1),o[ol++]="',",s[sl++]=scope|(parse_mode<<28),s[sl++]="";
}}}else{o[ol++]=tok;}break;case 5:if(pre_regexp[last_tok]){s[sl++]=scope|(parse_mode<<28);
s[sl++]=o[ol++]=tok;scope=segment=ol-1;nesting++,parse_mode=5,start_tok=tok;}else{o[ol++]="/";
}break;case 6:if(sl>2&&s[sl-1]=="{{"&&(ol<scope+4&&last_type==5)||(ol<scope+3&&(last_type==3||last_type==4))){o[scope-1]=s[sl-1]="{";
parse_mode=(v=s[sl-2])>>28;s[sl-2]=v&268435455,nesting--;}else{if(o[ol-3]=="case"||(last_type==5&&last_word=="case")){tok=";";
}}o[ol++]=":";break;default:o[ol++]=tok;break;}}else{o[ol++]=unesc_lut[tok]||tok;
}break;case 3:case 4:if(v=xml_code_operators[tok]){o[ol++]=tok=v,type=2;}else{v=u=w=0;
last_dot=(last_word=tok).lastIndexOf(".");if(tok.charAt(0)!="."&&((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)||(w=statement_lut[tok]))&&!parse_mode){if(w==2&&s[sl-1].indexOf("{")){w=0;
}switchToBlock(w);}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v&&parse_mode&&!statement_lut[tok]&&!call_exclusion[tok]){o[ol++]=(nesting?cf_str_output:cf_mode_output);
}if(last_dot>0&&tok.charAt(0)!="."){o_props[o[ol++]=last_prop=tok]=1;}else{o[ol++]=tok;
}}break;case 5:if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]="+";}}s[sl++]=scope|(parse_mode<<28),s[sl++]=o[ol++]=tok;
scope=segment=ol-1,nesting++,parse_mode=5,start_tok=tok;break;case 6:if(tok=="*/"||tok=="-->"){throw {t:"Unmatched comment "+tok,p:pos};
}last_cmt_mode=parse_mode,last_cmt_tok=last_tok,last_cmt_type=last_type,parse_mode=6,start_tok=tok;
break;case 7:if(o[ol-1]==")  "||(o[ol-2]==")  "&&ol--)){if(s[sl-1]!="("&&s[sl-1]!="["){s[sl++]=scope|(parse_mode<<28),s[sl++]="{{",o[ol++]=cf_func_o,scope=ol,parse_mode=1,nesting++,o[ol++]="";
}else{s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=ol;parse_mode=1;}}else{if((macro_o[s[sl+1]]&&last_tok==")   ")||pre_plain[last_tok]){s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=ol;
o[ol++]="";}else{if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+''+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]=(last_tok=="}")?"+''+":"+";}}s[sl++]=scope|(parse_mode<<28),s[sl++]=o[ol++]="{{";
if(!nesting&&scope!=ol){o_segs++;}nesting++,segment=scope=ol,parse_mode=0;}}break;
case 8:if(!s[sl-1]){o[ol++]=")",o[ol++]="\n",sl-=2;}if(type_close[v=s[--sl]]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}if(v=="{{"){if(scope==ol-1){if((s[sl-1]>>28)<=1){o[scope-1]="{",o[ol-1]="}";}else{o[scope-1]=o[ol-1]="'";
}}else{if(!parse_mode){o[scope-1]="(",o[ol-1]=")";}else{if(o[scope-1]==cf_func_o){if(scope==ol-2){o[scope-1]="{",o[ol-1]="}";
}else{o[ol-1]=cf_func_c;}}else{o[ol-1]=cf_block_c;}}}parse_mode=(v=s[--sl])>>28,scope=v&268435455;
segment=ol,nesting--;if(!nesting){o_segs++;}if(parse_mode==7){o[ol++]='+"\\"',parse_mode=4;
}}else{scope=s[--sl];}break;case 9:if(((last_type==3&&!pre_xpath[last_tok]&&last_tok!="$")||last_tok==")"||last_tok=="]")&&o[ol-1]!="\n"){o[ol++]="[",s[sl++]=scope|(parse_mode<<28),s[sl++]=tok,segment=scope=ol;
}else{last_model=null;if((w=xpath_lut_code[last_tok])){ol--,last_tok=o[ol-1];}else{w=xpath_macro[s[sl-1]]||xpath_macro[nesting?0:c_xpathmode];
}if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&(ol>scope||s[sl-1].length==1))&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]="+";}}if(!nesting&&ol!=scope){o_segs++;
}nesting++,s[sl++]=scope|(parse_mode<<28),s[sl++]=o[ol++]=w,segment=scope=ol,bt[scope]=pos,parse_mode=3;
}break;case 10:if(!s[sl-1]){o[ol++]=")",sl-=2;}if(type_close[v=s[--sl]]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}scope=s[--sl]&268435455;break;case 11:if(((v=(u=((out_context_paren[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope))&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v&&parse_mode){o[ol++]=(nesting?cf_str_output:cf_mode_output),last_type=0;}if(w=macro_o[last_tok]){if(o[ol-1]==" "){ol--;
}o[ol-1]=w,s[sl++]=scope,s[sl++]=last_tok,scope=segment=ol;}else{if(last_type==3){if(last_dot<0){v=0;
if(last_tok=="function"||o[ol-3]=="function"||o[ol-4]=="function"){s[sl++]=scope,s[sl++]="function",o[ol++]="(",scope=segment=ol;
if(last_tok!="function"&&c_export&&sl==4){o[v=(o[ol-4]=="function")?(ol-4):(ol-5)]="var "+last_tok+" = "+c_export+"."+last_tok+" = function";
o[v+2]="";}}else{if(!call_exclusion[last_tok]&&o[ol-3]!="new"){o[ol++]=".call(_n",s[sl++]=scope,s[sl++]="_call",scope=segment=ol;
}else{s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=segment=ol;}}}else{if(last_dot>1&&c_process_async&&(c_async_lut[v=last_tok.substring(0,last_dot)]||c_async_lut[v=last_tok])){if(o[--ol]==" "){ol--;
}o[ol++]=cf_async_o,o[ol++]=v,o[ol++]=",'";o[ol++]=last_tok.slice(last_dot+1);o[ol++]=cf_async_m,s[sl++]=scope,s[sl++]="async",scope=segment=ol,o_asyncs++;
}else{if(last_tok.indexOf(".")!=last_dot){o_props[last_tok.slice(0,last_dot)]=1;
}s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=segment=ol;}}}else{s[sl++]=scope,s[sl++]=o[ol++]=tok,scope=segment=ol;
}if(last_tok==last_prop){delete o_props[last_tok];}}break;case 12:if(!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(w=macro_c[v=s[--sl]]){if(v!="_call"){tok=")   ";}if((u=call_args_lut[v])&&u!=o[ol-1]){o[scope-1]=u+",";
}o[ol++]=w;}else{if(type_close[v]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}}scope=s[--sl]&268435455;break;case 13:if(ol==scope||markup_in_code_lut[last_tok]||o[ol-1]=="\n"){if((v=(u=((out_context_word[last_tok]||o[ol-1]=="\n")&&!new_block[last_tok]))&&!s[sl-1].indexOf("{")&&ol>scope)&&!parse_mode){switchToBlock();
}if(u&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}if(v){o[ol++]=(o[ol-2]!="\n"&&block_autoappend[last_tok])?"+''+":(nesting?cf_str_output:cf_mode_output);
}else{if(block_autoappend[last_tok]){o[ol++]="+";}}last_ns=null,o[ol++]='"',o[ol++]="<",nesting++,s[sl++]=scope|(parse_mode<<28),sl+=3,s[sl-2]=s[sl-1]=0;
segment=scope=ol-1,parse_mode=4;}else{o[ol++]="<";}break;case 14:o[ol++]=">";break;
case 15:if(sl&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}break;}break;case 2:switch(type){case 1:line_no++,last_line=pos;if(ol!=scope&&ol!=segment){o[ol++]="\\n";
}break;case 2:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=unesc_txt[tok]||tok;
break;case 3:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}o[ol++]=(tok=='"')?'\\"':"'";break;case 7:if(ol==segment){if(ol!=scope){o[ol++]="+";
}}else{o[ol++]='"+',nesting||o_segs++;}s[sl++]=scope|536870912,s[sl++]=o[ol++]="{{",nesting++,segment=scope=ol,parse_mode=0;
break;case 9:last_model=null;if((w=xpath_lut_text[last_tok])&&o[ol-1]==last_tok){if(--ol-1==scope){ol--;
}}else{w=xpath_macro[(nesting||scope!=ol)?0:c_xpathmode];}if(ol!=scope){o[ol]=(ol++==segment)?"+":(nesting||o_segs++,'"+');
if(!nesting){o_segs++;}}s[sl++]=scope|536870912,s[sl++]=o[ol++]=w,segment=scope=ol,nesting++,parse_mode=3;
break;case 15:if(sl){throw {t:"Unclosed "+s[sl-1]+" found at end in textmode",p:pos};
}if(ol!=scope&&ol!=segment){o[ol++]='"',nesting||o_segs++;}break;default:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}o[ol++]=tok;}break;case 3:switch(type){case 0:if(ol!=scope){if(ol==segment){o[ol++]='+"';
}o[ol++]=tok;}break;case 1:line_no++,last_line=pos;break;case 2:if(tok==":"&&last_tok==":"&&!xpath_axes[w=o[ol-2]]&&((v=s[sl-2])>>28)!=6){if(o[ol-2]=='+"'){o[ol-2]=o[ol-1]="",last_model="#";
}else{o[ol-1]='"';if(segment==scope){last_model=o.slice(segment+1,ol-1).join("");
}else{last_model="#";}}if(!(w=xpath_model[o[scope-1]])){throw {t:"Invalid model found for: "+o[scope-1],p:pos};
}o[scope-1]=w,o[ol++]=",",segment=scope=ol;}else{if(tok==","&&(v=(s[sl-2]>>28))<=1){ol=scope-1,u=str.slice(bt[scope]+1,pos+1);
last_type=9,parse_mode=v,o[ol++]=last_tok="[";s[sl-2]=(s[sl-2]&268435455)|(parse_mode<<28),s[sl-1]=last_tok,segment=scope=ol,nesting--;
if(!nesting){o_xpaths--;}if(u.length>1){bts.push(str);(str=u).replace(parserx,parser);
str=bts.pop();}}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=unesc_lut[tok]||tok;
}}break;case 3:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}if(s[sl-1]=="["){s[sl-1]=tok;}else{if(s[sl-1]==tok){s[sl-1]="[";}}if(tok=='"'){o[ol++]="\\";
}o[ol++]=tok;break;case 7:if(ol==segment){if(ol!=scope){o[ol++]="+''+";}}else{o[ol++]='"+';
}s[sl++]=scope|805306368,s[sl++]=o[ol++]="{{",nesting++,segment=scope=ol,parse_mode=0;
if(last_model&&s[sl-3]!=xpath_lut_text["$"]){o_xpathpairs.push(last_model,"#");
last_model=null,o_models++;}break;case 9:if(s[sl-1]=="'"||s[sl-1]=='"'||((last_type!=3||last_tok=="$")&&last_tok!=")"&&last_tok!="]")){if(last_model){o_xpathpairs.push(last_model,"#"),o_models++;
}last_model=null;if((w=xpath_lut_text[last_tok])&&o[ol-1]==last_tok){ol--;}else{w=xpath_macro[0];
}if(ol==segment){if(ol!=scope){o[ol++]="+";}}else{o[ol++]='"+';}s[sl++]=scope|805306368,s[sl++]=o[ol++]=w,nesting++,segment=scope=ol,parse_mode=3;
}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}s[sl++]=scope|1610612736,s[sl++]=o[ol++]="[";
}break;case 10:sl--,parse_mode=(w=s[--sl])>>28,w=w&268435455;if(parse_mode==6){if(s[sl+1]!="["){throw {t:"In xpath, cannot close "+s[sl+1]+" with "+tok,p:pos};
}if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]="]";parse_mode=3;}else{if(ol==scope){if((s[sl]>>28)<=1){o[scope-1]="[",o[ol++]="]";
}else{o[scope-1]=o[ol++]='"';}segment=ol;}else{if(ol!=segment){o[ol++]='"';}if(segment==scope){v=o.slice(segment+1,ol-1).join("");
if(c_injectself&&o[scope-1]!=","&&v!=(u=v.replace(selfrx,"$1self::"))&&s[sl+1]!=xpath_lut_text["$"]){o[scope+1]=v=u;
for(u=scope+2;u<ol-1;u++){o[u]="";}}}else{if((u=o[scope-1])!=","){v="#";if(c_injectself){o[scope-1]=u+"_injself(",o[ol++]=")";
}}else{v="";}}if(s[sl+1]!=xpath_lut_text["$"]&&v){o_xpathpairs.push(last_model,v);
if(last_model){o_models++;}}o[ol++]=") ",segment=ol;if(parse_mode==7){o[ol++]='+"\\"',parse_mode=4;
}}nesting--,last_model=null;if(!nesting){o_segs++,o_xpaths++;}}scope=w;break;case 11:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}s[sl++]=scope|805306368,s[sl++]=o[ol++]="(";break;case 12:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}if(type_close[v=s[--sl]]!=(o[ol++]=tok)){throw {t:"Cannot close "+v+" with "+tok,p:pos};
}scope=s[--sl]&268435455;break;case 15:throw {t:"Unexpected end whilst parsing xpath",p:pos};
break;default:if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=tok;break;}break;
case 4:switch(type){case 0:if(ol==segment){o[ol++]='+"';}o[ol++]=" ",last_type=0;
break;case 1:if(ol==segment){o[ol++]='+"';}line_no++,last_line=pos,o[ol++]="\\n",last_type=1;
break;case 2:if(ol==segment){o[ol++]='+"';}if(tok=="/"&&last_tok=="<"){sl-=4;if(s[sl]||s[sl+2]){throw {t:"Unexpected closing tag whilst parsing xml",p:pos};
}}else{if(tok==":"&&last_type==3&&o[ol-2]=="<"){last_ns=last_tok;}}o[ol++]=unesc_txt[tok]||tok;
break;case 3:if(ol==segment){o[ol++]='+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(ol==segment){o[ol++]='+"';}if(tok=='"'){o[ol++]="\\";
}o[ol++]=tok;break;case 6:if(tok=="//"&&!s[sl-1]){if(ol==segment){o[ol++]='+"';
}o[ol++]=tok;}else{if(tok=="*/"){throw {t:"Unmatched comment "+tok,p:pos};}last_cmt_mode=parse_mode,last_cmt_tok=last_tok,last_cmt_type=last_type,parse_mode=6,start_tok=tok;
}break;case 13:last_ns=null;if(ol==segment){o[ol++]='+"';}o[ol++]=tok,s[sl]=s[sl+2]=0,sl+=4,s[sl-1]=0;
break;case 14:if(ol==segment){o[ol++]='+"';}o[ol++]=tok;if(last_tok!="<"){if(last_tok=="/"){sl-=4;
if(s[sl+2]){throw {t:"Unexpected / whilst parsing xml",p:pos};}if(o[ol-3]=="<"){ol-=2,o[ol-1]="";
}}else{sl-=2;}if(s[sl]){nesting--,o[ol++]='"',scope=s[sl],segment=ol,parse_mode=scope>>28,scope=scope&268435455;
}else{s[sl-1]=1;}}else{ol--,o[ol-1]="";}break;case 9:last_model=null;if(last_tok=="!"&&o[ol-2]=="<"&&!s[sl-1]){o[ol++]=tok,s[sl++]=scope|(parse_mode<<28);
s[sl++]="]]>",scope=segment=ol-1;nesting++,parse_mode=5;}else{if(s[sl-1]){if((v=xpath_lut_node[last_tok])){ol--;
}else{v=xpath_macro[c_elemxpath];}s[sl++]=scope|1073741824;}else{s[sl++]=scope|1073741824;
if((v=xpath_lut_attr[last_tok])){ol--;if(o[ol-1]=="="){last_tok="=";}}else{v=xpath_macro[last_ns?c_statexpath:8];
}if(last_tok=="="){o[ol++]='\\"',s[sl-1]=scope|1879048192;}}o[ol]=(ol++==segment)?"+''+":'"+';
nesting++,s[sl++]=o[ol++]=v,segment=scope=ol,parse_mode=3;}break;case 7:if(!s[sl-1]&&last_tok=="="){o[ol++]='\\"',s[sl++]=scope|1879048192;
}else{s[sl++]=scope|1073741824;}o[ol]=(ol++==segment)?"+''+":'"+';s[sl++]=o[ol++]="{{",nesting++;
segment=scope=ol,parse_mode=0;break;default:if(ol==segment){o[ol++]='+"';}o[ol++]=tok;
break;case 15:throw {t:"Unexpected end whilst parsing xml",p:pos};break;}break;
case 5:switch(type){case 1:line_no++,last_line=pos;if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';
}o[ol++]="\\n";break;case 2:if(tok=="/"&&s[sl-1]=="/"){o[ol++]="/",scope=s[sl-=2],segment=ol,parse_mode=scope>>28,scope=scope&268435455,nesting--;
}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=(s[sl-1]!="/"&&unesc_str[tok])||tok;
}break;case 3:if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}if(tok.charAt(tok.length-1)=="$"){o[ol++]=tok.slice(0,-1);
o[ol++]=tok="$";}else{o[ol++]=tok;}break;case 5:if(s[sl-1]==tok){if(scope!=segment){o[ol]=(ol++!=segment)?(tok+")"):")";
}else{o[ol++]=tok;}scope=s[sl-=2],segment=ol,parse_mode=scope>>28;scope=scope&268435455,nesting--;
}else{if(ol==segment){o[ol]=(ol++==scope)?'"':'+"';}o[ol++]=tok=='"'?'\\"':tok;
}break;case 6:if(s[sl-1]=="/"&&tok=="*/"){o[ol++]="*/",scope=s[sl-=2],segment=ol,parse_mode=scope>>28,scope=scope&268435455,nesting--;
}else{if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}o[ol++]=tok;}break;case 7:if(s[sl-1]!="'"&&s[sl-1]!="/"){if(s[sl-1]=='"'){o[scope]='("';
}if(ol==segment){if(ol!=scope){o[ol++]="+";}}else{o[ol++]='"+';}s[sl++]=scope|1342177280,o[ol++]=s[sl++]="{{",nesting++,segment=scope=ol,parse_mode=0;
}else{o[ol++]=tok;}break;case 9:if(s[sl-1]!="'"&&s[sl-1]!="/"&&(s[sl-1]=='"'&&(o[scope]='("')||ol!=scope+2||last_tok!="CDATA")){last_model=null;
if((w=xpath_lut_text[last_tok])&&o[ol-1]==last_tok){ol--;}else{w=xpath_macro[0];
}if(ol!=scope){o[ol]=(ol++==segment)?"+":'"+';}s[sl++]=scope|1342177280,s[sl++]=o[ol++]=w,segment=scope=ol,nesting++,parse_mode=3;
}else{o[ol++]=tok;}break;case 14:if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}o[ol++]=tok;
if(s[sl-1]=="]]>"&&last_tok=="]"&&o[ol-3]=="]"){scope=s[sl-=2],parse_mode=scope>>28;
scope=scope&268435455,nesting--;sl-=4;if(s[sl]){nesting--,o[ol++]='"',scope=s[sl],segment=ol,parse_mode=scope>>28,scope=scope&268435455;
}else{s[sl-1]=1;}}break;case 15:throw {t:"Unexpected end whilst parsing string",p:pos};
break;default:if(ol==segment){o[ol]=(ol++==scope)?"":'+"';}o[ol++]=tok;break;}break;
case 6:switch(type){case 1:line_no++,last_line=pos;if(start_tok=="//"){parse_mode=last_cmt_mode,tok=last_tok=last_cmt_tok,type=last_type=last_cmt_type;
}break;case 6:if((start_tok=="/*"&&tok=="*/")||(start_tok=="<!--"&&tok=="-->")){parse_mode=last_cmt_mode,tok=last_tok=last_cmt_tok,type=last_type=last_cmt_type;
}break;case 15:if(start_tok!="//"){throw {t:"Unexpected end whilst parsing comment",p:pos};
}else{parse_mode=last_cmt_mode,tok=last_tok=last_cmt_tok,type=last_type=last_cmt_type;
if(sl&&!s[sl-1]){o[ol-1]=="\n"&&(o[ol-1]=""),o[ol++]=")",o[ol++]="\n",v=1,sl-=2;
}}break;}break;}if(type>1){last_tok=tok,last_type=type;}}this.lastCode=function(){if(typeof(o)=="object"){return o.join("");
}return o;};function handleError(e,last_line,part,linenr){if(e.t){throw new Error(apf.formatErrorString(0,null,"Parsing live markup source","Error whilst parsing: "+e.t+" on line:"+line_no+" col:"+(e.p-last_line-2)+(part?(" part: "+part):"")+"\n"+str));
}else{throw new Error(apf.formatErrorString(0,null,"Compiling live markup function on line "+linenr,"Error whilst compiling: "+e.message+"\nInput:\n"+str+"\nGenerated:\n"+apf.lm.lastCode()));
}}var cache={},emptyCfg={};this.resetCache=function(){cache={};};var lmcache_rx=/^\s*~~(c\d+)~~/;
this.compile=function(istr,cfg){if(!cfg){cfg=emptyCfg;}if(istr==null||!istr.length){return(cfg.nostring||cfg.event)?function(){return istr;
}:{type:2,str:istr};}var c,f,is_single_prop;if(istr.charAt(0)=="~"&&(c=istr.match(lmcache_rx))){if(c=apf.lm_exec[c[1]]){return c;
}alert("ERROR, undefined live markup cache marker found:"+istr);return{type:2,str:istr};
}var key=(cfg.xpathmode|(cfg.withopt&&16)|(cfg.precall&&32)|(cfg.alwayscb&&64)|(cfg.nostring&&128)|(cfg.parsecode&&256)|(cfg.nostate&&512)|(cfg.liveedit&&1024)|(cfg.langedit&&2048)|(cfg.injectself&&4096)|(cfg.event&&8192)|(cfg.funcglobal&&16384))+istr;
if(c=cache[key]){return c;}c_injectself=cfg.injectself,c_xpathmode=cfg.xpathmode||0,c_statexpath=cfg.nostate?0:6,c_elemxpath=0;
c_export=cfg.funcglobal?"self":(cfg.withopt?"_w":null);c_process_async=!cfg.event;
xpath_macro.edit=cfg.liveedit?"_argwrap(_n,":"_argwrap(_n,";macro_o.edit=cfg.liveedit?macro_o._editlm:macro_o._editnormal;
xpath_lut_node=cfg.langedit?xpath_lut_node_langedit:xpath_lut_node_normal;o_props={},o_xpathpairs=[],s=[],o=["","","",""],str=istr,str_len=str.length;
ol=scope=segment=o.length,o_segs=o_xpaths=o_asyncs=o_models=nesting=line_no=last_type=last_line=0;
if(cfg.parsecode){parse_mode=0,sl=2,s[0]=ol,s[1]="{{",last_tok="{",cf_mode_output=cfg.event?"":(c_xpathmode<=1?cf_str_output:cf_obj_output);
}else{parse_mode=2,sl=last_tok=0,cf_mode_output=cf_str_output;}if(cfg.nothrow){str.replace(parserx,parser);
}else{try{str.replace(parserx,parser);}catch(e){handleError(e,last_line);return null;
}}if(cfg.parsecode){if(nesting||s[sl-1].length==1){handleError({t:"Unclosed "+s[sl-1]+" found at end in codemode",p:str_len},last_line);
}if(segment!=ol){o_segs++;}}else{if((ol==7||ol==8)&&o_segs==1){is_single_prop=0;
for(c in o_props){is_single_prop++;}if(is_single_prop!=1){is_single_prop=0;}}}if((!cfg.nostring&&!cfg.event)&&(parse_mode==2&&segment==4||ol==4)){return{type:2,str:o.slice(5,-1).join("").replace(/\\n/g,"\n").replace(/\\"/g,'"')};
}if(o_asyncs||cfg.alwayscb){if(cfg.event){if(parse_mode==1){o[3]="";}o[ol++]=cc_o_blk_ce;
}else{if(c_xpathmode){if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_o_blk_o:cc_o_blk_ob,o[ol++]=cc_o_blk_cb;
}else{o[3]=cc_o_cb_o,o[ol++]=cc_o_cb_c;}}else{if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_v_blk_o:cc_v_blk_ob,o[ol++]=cc_v_blk_cb;
}else{o[3]=cc_v_cb_o,o[ol++]=cc_v_cb_c;}}}if(o_asyncs){if(parse_mode==1){if(cfg.precall){o[2]=cc_pc_o,o[ol-1]=cc_pc_c+o[ol-1];
}else{o[2]=cc_async_o,o[ol-1]=cc_async_c+o[ol-1];}}else{o[ol++]=o[3]+"_r"+o[ol-2];
if(cfg.precall){o[2]=cc_pc_o,o[3]=cc_o_blk_o,o[ol-2]=cc_pc_c;}else{o[2]=cc_async_o,o[3]=cc_o_blk_o,o[ol-2]=cc_async_c;
}}}if(cfg.withopt){o[1]=cc_opt_o,o[ol++]=cc_opt_c;}o[0]=cfg.event?cc_fe_async_o:((c_xpathmode==1||c_xpathmode==3)?cc_fc_async_o:cc_f_async_o);
o[ol++]=cc_f_c;}else{if(cfg.event){if(parse_mode==1){o[3]="";}}else{if(c_xpathmode){if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_o_blk_o:cc_o_blk_ob,o[ol++]=cc_o_blk_c;
}else{o[3]=cc_o_ret_o,o[ol++]=cc_o_ret_c;}}else{if(parse_mode==1){o[3]=(o[3]!=cf_block_o)?cc_v_blk_o:cc_v_blk_ob,o[ol++]=cc_v_blk_c;
}else{o[3]=cc_v_ret_o,o[ol++]=cc_v_ret_c;}}}if(cfg.withopt){o[2]=cc_opt_o,o[ol++]=cc_opt_c;
}o[0]=cfg.event?(cfg.withopt?cc_fe_opt_o:cc_fe_o):(cfg.withopt?((c_xpathmode==1||c_xpathmode==3)?cc_fc_opt_o:cc_f_opt_o):((c_xpathmode==1||c_xpathmode==3)?cc_fc_o:cc_f_o));
o[ol++]=cc_f_c;}if(cfg.nothrow){f=apf.lm_exec.compile(o.join(""));}else{try{f=apf.lm_exec.compile(o.join(""));
}catch(e){if(!apf.isIE){var oErr=window.onerror;window.onerror=function(x,y,line){window.onerror=oErr;
handleError(e,last_line,null,line);return true;};apf.include("","",null,o.join(""));
window.onerror=oErr;}else{handleError(e,last_line);}return null;}}f.type=(o_segs==1&&o_xpaths==1)?3:(is_single_prop?4:1);
f.xpaths=o_xpathpairs,f.models=o_models,f.props=o_props,f.asyncs=o_asyncs;cache[key]=f;
return f;};this.compileMatch=function(strarray,cfg){if(!cfg){cfg=emptyCfg;}o_props={},o_xpathpairs=[],o=[cc_f_match_o,cc_m_o],s=[],nesting=0,ol=o.length,xpath_lut_node=xpath_lut_node_normal;
for(var st,ob,i=0,j=strarray.length;i<j;i+=2){if(str=strarray[i]){str_len=s.length,c_xpathmode=2;
if(i){o[ol++]=cc_m_brk;}o[ol++]="";s[0]=ob=ol=scope=segment=o.length,cf_mode_output=cf_obj_output;
line_no=last_type=o_segs=o_xpaths=o_asyncs=parse_mode=last_line=0;sl=2,s[1]="{{",last_tok="{";
c_injectself=1;if(cfg.nothrow){str.replace(parserx,parser);}else{try{str.replace(parserx,parser);
}catch(e){handleError(e,last_line);return null;}}if(nesting||s[sl-1].length==1){handleError({t:"Unclosed "+s[sl-1]+" found at end in codemode",p:str_len});
}if(o_asyncs){handleError({t:"Asynchronous calls not supported in match/value"});
}if(parse_mode==1){o[ob-1]=(o[ob-1]!=cf_block_o)?cf_mode_output:"",o[ol++]=cc_m_m_blk;
}else{o[ob-1]=cc_m_m_value_o,o[ol++]=cc_m_m_value_c;}}if(str=strarray[i+1]){str_len=s.length;
if(!strarray[i]&&i){o[ol++]=cc_m_brk;}o[ol++]="";ob=ol=scope=segment=o.length,cf_mode_output=cf_str_output;
c_xpathmode=c_injectself=last_tok=sl=line_no=o_segs=o_xpaths=last_type=o_asyncs=last_line=0;
if(cfg.node){c_xpathmode=2;}parse_mode=2,c_injectself=0;if(cfg.nothrow){str.replace(parserx,parser);
}else{try{str.replace(parserx,parser);}catch(e){handleError(e,last_line);return null;
}}if(o_asyncs){handleError({t:"Asynchronous calls not supported in match/value"});
}if(cfg.node){if(parse_mode==2&&segment==ob||ol==ob){o[ob-1]=cc_m_n_string;}else{o[ob-1]=cc_m_n_o,o[ol++]=cc_m_n_c;
}}else{if(parse_mode==2&&segment==ob||ol==ob){o[ob-1]=cc_m_v_string;}else{o[ob-1]=cc_m_v_o,o[ol++]=cc_m_v_c;
}}if(strarray[i]){o[ol++]=cc_m_c;}else{break;}}else{if(!strarray[i]){handleError({t:"Both match and value are empty"});
}if(cfg.node){o[ol++]=cc_m_n_ret;}else{o[ol++]=cc_m_v_ret;}c_xpathmode=2;o[ol++]=cc_m_c;
}}o[ol++]=cc_f_c;var f;if(cfg.nothrow){f=apf.lm_exec.compile(o.join(""));}else{try{f=apf.lm_exec.compile(o.join(""));
}catch(e){handleError(e,last_line);return null;}}f.type=1,f.xpaths=o_xpathpairs,f.props=o_props,f.asyncs=o_asyncs;
return f;};this.setWarnLevel=function(lvl){apf.lm_exec.setWarnLevel(lvl);};this.parseExpression=function(istr,cfg){if(!cfg){cfg=emptyCfg;
}o_props={},o_xpathpairs=[],o=[],s=[],nesting=0,xpath_lut_node=xpath_lut_node_normal;
str=istr,str_len=str.length;ob=ol=scope=segment=o.length,cf_mode_output=cf_str_output;
c_xpathmode=c_injectself=last_tok=sl=line_no=o_segs=o_xpaths=last_type=o_asyncs=last_line=0;
parse_mode=2;if(cfg.nothrow){str.replace(parserx,parser);}else{try{str.replace(parserx,parser);
}catch(e){handleError(e,last_line);return null;}}return o.join("");};})();apf.lm_exec=new (function(){var wlvl=1;
this.setWarnLevel=function(lvl){wlvl=lvl;};function wxpath(x,t){apf.console.warn("Live Markup warning in "+t+", no results for xpath: '"+x+"'");
}function wnode(x,t){apf.console.warn("Live Markup warning in "+t+", xpath on null node: '"+x+"'");
}function wmodel(m,x,t){apf.console.log("Live Markup warning in "+t+", xpath on empty model: '"+m+"' xpath: '"+x+"'");
}function wlang(x,t){apf.console.log("Live Markup warning in "+t+", language symbol not found: '"+x+"'");
}function xmlParse(str){var n=apf.getXmlDom("<_apflmlist_>"+str+"</_apflmlist_>");
if(!n||!(n=n.documentElement)){return null;}return(n.firstChild==n.lastChild)?n.firstChild:n;
}function __val(n,x){if(!n){return("");}return(n=(!n.nodeType&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||("");
}var __valattrrx=/(["'])/g;function __valattrrp(m,a){return m=='"'?"&quot;":"&apos;";
}function __valattr(n,x){if(!n){return("");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue.replace(__valattrrx,__valattrrp)||("");
}function __valm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");
}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||("");
}function __nod(n,x){return n?n.selectSingleNode(x):(null);}function _nods(n,x){return n?n.selectNodes(x):([]);
}function __nodm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(null);
}return n.selectSingleNode(x);}function _nodsm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return([]);
}return n.selectNodes(x);}function __cnt(n,x){return n?n.selectNodes(x).length:(0);
}function __cntm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(0);
}return n.selectNodes(x).length;}function _xpt(n,x){return{xpath:x,toString:function(){return"LM Xpath object: "+this.x;
}};}function _xptm(m,x){if(m&&!m.$isModel){var node=m;m=apf.xmldb.findModel(m);
x=apf.xmlToXpath(node,m.data)+"/"+x;}return{model:m,xpath:x,toString:function(){return"LM Xpath object with model: "+this.x;
}};}function _xml(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");
}}return(n&&(n=n.selectSingleNode(x)))&&n.xml||("");}function _xmls(n,m,x){if(n){x=m;
}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");
}}for(var i=0,j=((n=n.selectNodes(x))).length,o=[];i<j;i++){o[i]=n[i].xml;}return o.join("");
}function _valcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return("");
}}if(cr){apf.createNodeFromXpath(ni,x);}else{if(n=ni.selectSingleNode(x)){return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";
}}return("");}function _nodcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(null);
}}return n.selectSingleNode(x)||(cr&&apf.createNodeFromXpath(n,x));}function _valst(n,x){var m=apf.xmldb.findModel(n);
if(!m){return("");}return"["+m.id+"::"+apf.xmlToXpath(n,m.data,true)+(!x||x=="."?"":"/"+x)+"]";
}function _asn(o,p,v){if(!o||typeof(o)!="object"){throw new Error(apf.formatErrorString(0,0,"LM Property Assign","Cannot assign property on non object, property:"+p));
}if(o.setAttribute){o.setAttribute(p,v);}else{o[p]=v;}return v;}function _add(o,p,v){return _asn(o,p,o&&o[p]+v);
}function _sub(o,p,v){return _asn(o,p,o&&o[p]-v);}function _div(o,p,v){return _asn(o,p,o&&o[p]/v);
}function _mul(o,p,v){return _asn(o,p,o&&o[p]*v);}function _local(n){if(n&&n.charAt&&n.charAt(0)=="<"){return apf.getXmlDom(n).documentElement;
}return n;}function _tagName(n1,n2){return(n2&&n2.tagName)||(n1&&n1.tagName);}function _localName(n1,n2){return(n2&&n2[apf.TAGNAME])||(n1&&n1[apf.TAGNAME]);
}function _nodeValue(n,n2){if(n2){n=n2;}return(n=(n.nodeType!=1&&n||(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";
}function __ret(r){return r;}function __lng(x,x2){return"$["+x+"]";}function _lnged(x,x2){return"$["+x+"]";
}function _(n,m,x){return'<span class="liveEdit" xpath="'+(n?(m.substr(0,1)!="/"?apf.xmlToXpath(n,null,false):"")+"/"+m:"")+'">'+((n?__val(n,m):__valm(m,x))||"&#32;")+"</span>";
}function _argwrap(n,x){return[n,x];}function _argwrapm(m,x){return[0,m,x];}function _valedx(editMode,args,opt){args[3]=opt;
args[4]=editMode;return _valed.apply(this,args);}function _valed(n,m,x,options,editMode){var res=(n?__val(n,m):__valm(m,x));
if(options&&options.multiline&&options.editor!="richtext"){res=res.replace(/\n/g,"<br />");
}if(editMode!==false){var value=res||options&&options.initial||"&#32;";if(!options||!options.richtext){value=apf.htmlentities(value);
}if(options&&options.multiline){value=value.replace(/&lt;br ?\/?&gt;/g,"<br />").replace(/&lt;(\/?div)&gt;/g,"<$1>");
}return'<div onmousedown="apf.LiveEdit.mousedown(this, event)" class="liveEdit'+(options&&options.multiline?" liveeditMultiline":"")+(!res&&options&&options.initial?" liveEditInitial":"")+'" xpath="'+(n?((m.substr(0,1)!="/"?apf.xmlToXpath(n,null,false):"")+"/"+m).replace(/([\[\{\}\]])/g,"\\$1"):(self[m]?(m+".queryNode('"+x.replace(/'/g,"\\'")+"')").replace(/([\[\{\}\]])/g,"\\$1"):""))+'"'+(options?' options="'+apf.serialize(options).escapeHTML().replace(/"/g,"&quot;").replace(/([\[\{\}\]])/g,"\\$1")+'"'+(options.editor?' editor="'+options.editor+'"':""):"")+">"+value+"</div>";
}else{return res;}}var selfrx=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g;function _injself(s){return s.charAt?s.replace(selfrx,"$1self::"):s;
}apf.$lmx=null;function _async(_n,_c,_a,_w,_f,_this,obj,func,args){var i=_a.i,v;
if(!_a.ret){_a.ret=[];}if(_a[i]){return _a.ret[i];}_a[i]=true;if(!obj.exec){return _a.ret[i]=(func)?obj[func].apply(obj,args):obj.apply(obj,args);
}var cb=function(data,state,extra){if(_w){delete _w._pc;}if(state!=apf.SUCCESS){_c(null,state,extra);
}else{apf.$lmx=extra;_a.ret[i]=data;if(_w){_f.call(_this,_n,_c,_w,_a);}else{_f.call(_this,_n,_c,_a);
}}};if(_w&&_w._pc){_w._pc={obj:obj,func:func,args:args,message:obj.createMessage&&obj.createMessage(func,args),_c:_c,cb:cb};
}else{obj.exec(func,args,cb);}throw ({x:1});}function _precall(_w){var o;if(typeof(o=_w._pc)!="object"||!o){return;
}o.obj.exec(o.func,o.args,o.cb,{message:o.message});throw ({x:1});}var _clut=apf.color?apf.color.colorshex:{},_cparse=/^(rgb|hsv|hsb)\(\s+(\d+)\s+,\s+(\d+)\s+,\s+(\d+)\)/;
function sort(set,xpath,options){var s=new apf.Sort();options=options||{};if(!xpath.charAt){xpath="";
}if(xpath.charAt(0)=="@"){xpath=xpath.slice(1);options.getValue=function(n){return n.getAttribute(xpath);
};}else{options.getValue=function(n){return apf.queryValue(n,xpath);};}s.set(options);
return s.apply(apf.getArrayFromNodelist(set));}function _cthex(c){var t;if((t=typeof(c))=="string"){if(c.indexOf("#")==0){if(c.length==7){return parseInt(c.slice(-1),16);
}return parseInt(c.slice(-1),16);}if(t=_clut[a]){return t;}if(c=c.match(_cparse)){if((t=c[1])=="rgb"){return(((t=c[2])<0?0:(t>255?255:parseInt(t)))<<16)+(((t=c[3])<0?0:(t>255?255:parseInt(t)))<<8)+(((t=c[4])<0?0:(t>255?255:parseInt(t))));
}else{var h=parseFloat(c[2]),s=parseFloat(c[3]),v=parseFloat(c[4]),i,m=v*(1-s),n=v*(1-s*((i=floor(((h<0?-h:h)%1)*6))?h-i:1-(h-i)));
switch(i){case 6:case 0:return((v&255)<<16)+((n&255)<<8)+(m&255);case 1:return((n&255)<<16)+((v&255)<<8)+(m&255);
case 2:return((m&255)<<16)+((v&255)<<8)+(n&255);case 3:return((m&255)<<16)+((n&255)<<8)+(v&255);
case 4:return((n&255)<<16)+((m&255)<<8)+(v&255);default:case 5:return((v&255)<<16)+((m&255)<<8)+(n&255);
}}}}else{if(t=="number"){return t;}}return null;}function lin(f,a,b){var fa=parseFloat(a),fb=parseFloat(b),fm=1-(f=f<0?0:(f>1?1:f));
if(fa!=a||fb!=b){return(((fa=_cthex(a))&16711680)*f+((fb=_cthex(b))&16711680)*fm)&16711680|((fa&65280)*f+(fb&65280)*fm)&65280|((fa&255)*f+(fb&255)*fm)&255;
}return f*fa+fm*fb;}var abs=Math.abs,acos=Math.acos,asin=Math.asin,atan=Math.atan,atan2=Math.atan2,ceil=Math.ceil,cos=Math.cos,exp=Math.exp,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,random=Math.random,round=Math.round,sin=Math.sin,sqrt=Math.sqrt,tan=Math.tan,linear=lin;
function tsin(x){return 0.5*sin(x)+0.5;}function tcos(x){return 0.5*cos(x)+0.5;
}function usin(x){return 0.5-0.5*sin(x);}function ucos(x){return 0.5-0.5*cos(x);
}function snap(a,b){return round(a/b)*b;}function clamp(a,b,c){return a<b?b:(a>c?c:a);
}this.compile=function(code){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng,_valattr=__valattr;
eval(code);return _f;};this.compileWith=function(code,withs){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng,_valattr=__valattr;
eval(code);return _f;};var LMBEGINCACHE;var LMENDCACHE;})();apf.url=function(str){var base;
var location=(window.location&&window.location.toString())||"";if(str.indexOf(":")==-1&&(base=location).indexOf(":")!=-1){base=new apf.url(base);
str=apf.getAbsolutePath(base.protocol+"://"+base.host+(base.directory.charAt(0)=="/"?"":"/")+(base.directory.charAt(base.directory.length-1)=="/"?base.directory:base.directory+"/"),str).replace(/\/\/\/\//,"///");
}var o=apf.url.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),i=14;
this.uri=str.toString();while(i--){this[o.key[i]]=m[i]||"";}this[o.q.name]={};var _self=this;
this[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1){_self[o.q.name][$1]=$2;
}});this.isSameLocation=function(){if(this.uri.length&&this.uri.charAt(0)=="#"){return false;
}if(!this.protocol&&!this.port&&!this.host){return true;}if(!this.protocol&&this.host&&this.port&&window.location.hostname==this.host&&window.location.port==this.port){return true;
}if(!this.protocol&&this.host&&!this.port&&window.location.hostname==this.host&&window.location.port==80){return true;
}return window.location.protocol==(this.protocol+":")&&window.location.hostname==this.host&&(window.location.port==this.port||!window.location.port&&!this.port);
};};apf.url.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};
apf.runXpath=function(){apf.XPath={cache:{},getSelf:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];
if(data){data[0](htmlNode,data[1],info,count+1,numfound++,sResult);}else{sResult.push(htmlNode);
}},getChildNode:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];
var nodes=htmlNode.childNodes;if(!nodes){return;}for(var i=0;i<nodes.length;i++){if(tagName&&(tagName!=nodes[i].tagName)&&(nodes[i].style?nodes[i].tagName.toLowerCase():nodes[i].tagName)!=tagName){continue;
}htmlNode=nodes[i];if(data){data[0](nodes[i],data[1],info,count+1,numfound++,sResult);
}else{sResult.push(nodes[i]);}}},doQuery:function(htmlNode,qData,info,count,num,sResult){var result=null,data=info[count];
var query=qData[0];var returnResult=qData[1];try{var qResult=eval(query);}catch(e){apf.console.error(e.name+" "+e.type+":"+apf.XPath.lastExpr+"\n\n"+query);
return;}if(returnResult){return sResult.push(qResult);}if(!qResult||qResult.dataType==apf.ARRAY&&!qResult.length){return;
}if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);
}},getTextNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.childNodes;
for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=3&&nodes[i].nodeType!=4){continue;
}if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);
}}},getAnyNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.getElementsByTagName("*");
for(var i=0;i<nodes.length;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);
}else{sResult.push(nodes[i]);}}},getAttributeNode:function(htmlNode,attrName,info,count,num,sResult){if(!htmlNode||htmlNode.nodeType!=1){return;
}if(attrName=="*"){var nodes=htmlNode.attributes;for(var i=0;i<nodes.length;i++){arguments.callee.call(this,htmlNode,nodes[i].nodeName,info,count,i,sResult);
}return;}var data=info[count],value=htmlNode.getAttributeNode(attrName);if(data){data[0](value,data[1],info,count+1,0,sResult);
}else{if(value){sResult.push(value);}}},getAllNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],prefix=x[2],nodes,i,l;
if(inclSelf&&(htmlNode.tagName==tagName||tagName=="*"||tagName=="node()")){if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);
}else{sResult.push(htmlNode);}}if(tagName=="node()"){tagName="*";prefix="";if(apf.isIE){nodes=htmlNode.getElementsByTagName("*");
}else{nodes=[];(function recur(x){for(var n,i=0;i<x.childNodes.length;i++){n=x.childNodes[i];
if(n.nodeType!=1){continue;}nodes.push(n);recur(n);}})(htmlNode);}}else{nodes=htmlNode.getElementsByTagName((prefix&&(apf.isGecko||apf.isOpera||htmlNode.nodeFunc)?prefix+":":"")+tagName);
}for(i=0,l=nodes.length;i<l;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);
}else{sResult.push(nodes[i]);}}},getAllAncestorNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],i=0,s=inclSelf?htmlNode:htmlNode.parentNode;
while(s&&s.nodeType==1){if(s.tagName==tagName||tagName=="*"||tagName=="node()"){if(data){data[0](s,data[1],info,count+1,++i,sResult);
}else{sResult.push(s);}}s=s.parentNode;}},getParentNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],node=htmlNode.parentNode;
if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);
}}},getPrecedingSibling:function(htmlNode,tagName,info,count,num,sResult){var data=info[count],node=htmlNode.previousSibling;
while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.previousSibling;
continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);
break;}}}},getFollowingSibling:function(htmlNode,tagName,info,count,num,sResult){var result=null,data=info[count];
var node=htmlNode.nextSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.nextSibling;
continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);
break;}}}},multiXpaths:function(contextNode,list,info,count,num,sResult){for(var i=0;
i<list.length;i++){info=list[i][0];var rootNode=(info[3]?contextNode.ownerDocument.documentElement:contextNode);
info[0](rootNode,info[1],list[i],1,0,sResult);}sResult.makeUnique();},compile:function(sExpr){var isAbsolute=sExpr.match(/^\//);
sExpr=sExpr.replace(/\[(\d+)\]/g,"/##$1").replace(/\|\|(\d+)\|\|\d+/g,"##$1").replace(/\.\|\|\d+/g,".").replace(/\[([^\]]*)\]/g,function(match,m1){return"/##"+m1.replace(/\|/g,"_@_");
});if(sExpr=="/"||sExpr=="."){return sExpr;}return this.processXpath(sExpr.replace(/\/\//g,"descendant::"),isAbsolute);
},processXpath:function(sExpr,isAbsolute){var results=[],i,l,m,query;sExpr=sExpr.replace(/'[^']*'/g,function(m){return m.replace("|","_@_");
});sExpr=sExpr.split("|");for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=sExpr[i].replace(/_\@\_/g,"|");
}if(sExpr.length==1){sExpr=sExpr[0];}else{for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=this.processXpath(sExpr[i]);
}results.push([this.multiXpaths,sExpr]);return results;}var sections=sExpr.split("/");
for(i=0,l=sections.length;i<l;i++){if(sections[i]=="."||sections[i]==""){continue;
}else{if(sections[i]==".."){results.push([this.getParentNode,null]);}else{if(sections[i].match(/^[\w\-_\.]+(?:\:[\w\-_\.]+){0,1}$/)){results.push([this.getChildNode,sections[i]]);
}else{if(sections[i].match(/^\#\#(\d+)$/)){results.push([this.doQuery,["num+1 == "+parseInt(RegExp.$1)]]);
}else{if(sections[i].match(/^\#\#(.*)$/)){query=RegExp.$1;m=[query.match(/\(/g),query.match(/\)/g)];
if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;
}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query)]]);
}else{if(sections[i]=="*"){results.push([this.getChildNode,null]);}else{if(sections[i].substr(0,2)=="[]"){results.push([this.getAllNodes,["*",false]]);
}else{if(sections[i].match(/descendant-or-self::node\(\)$/)){results.push([this.getAllNodes,["*",true]]);
}else{if(sections[i].match(/descendant-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);
}else{if(sections[i].match(/descendant::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);
}else{if(sections[i].match(/ancestor-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);
}else{if(sections[i].match(/ancestor::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);
}else{if(sections[i].match(/^\@(.*)$/)){results.push([this.getAttributeNode,RegExp.$1]);
}else{if(sections[i]=="text()"){results.push([this.getTextNode,null]);}else{if(sections[i]=="node()"){results.push([this.getChildNode,null]);
}else{if(sections[i].match(/following-sibling::(.*)$/)){results.push([this.getFollowingSibling,RegExp.$1.toLowerCase()]);
}else{if(sections[i].match(/preceding-sibling::(.*)$/)){results.push([this.getPrecedingSibling,RegExp.$1.toLowerCase()]);
}else{if(sections[i]=="self::node()"){results.push([this.getSelf,null]);}else{if(sections[i].match(/self::(.*)$/)){results.push([this.doQuery,["apf.XPath.doXpathFunc(htmlNode, 'local-name') == '"+RegExp.$1+"'"]]);
}else{query=sections[i];m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;
}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query),true]]);
}}}}}}}}}}}}}}}}}}}}results[0][3]=isAbsolute;return results;},compileQuery:function(code){return new apf.CodeCompilation(code).compile();
},doXpathFunc:function(contextNode,type,nodelist,arg2,arg3,xmlNode,force){if(!nodelist||nodelist.length==0){nodelist="";
}if(type=="not"){return !nodelist;}if(!force){var arg1,i,l;if(typeof nodelist=="object"||nodelist.dataType==apf.ARRAY){if(nodelist&&!nodelist.length){nodelist=[nodelist];
}var res=false,value;for(i=0,l=nodelist.length;i<l;i++){xmlNode=nodelist[i];if(!xmlNode||typeof xmlNode=="string"||"position|last|count|local-name|name".indexOf(type)>-1){value=xmlNode;
}else{if(xmlNode.nodeType==1&&xmlNode.firstChild&&xmlNode.firstChild.nodeType!=1){xmlNode=xmlNode.firstChild;
}value=xmlNode.nodeValue;}if(res=arguments.callee.call(this,contextNode,type,value,arg2,arg3,xmlNode,true)){return res;
}}return res;}else{arg1=nodelist;}}else{arg1=nodelist;}switch(type){case"position":return apf.getChildNumber(contextNode)+1;
case"format-number":return apf.formatNumber(arg1);case"floor":return Math.floor(arg1);
case"ceiling":return Math.ceil(arg1);case"starts-with":return arg1?arg1.substr(0,arg2.length)==arg2:false;
case"string-length":return arg1?arg1.length:0;case"count":return arg1?arg1.length:0;
case"last":return arg1?arg1[arg1.length-1]:null;case"name":var c=xmlNode||contextNode;
return c.nodeName||c.tagName;case"local-name":var c=xmlNode||contextNode;if(c.nodeType!=1){return false;
}return c.localName||(c.tagName||"").split(":").pop();case"substring":return arg1&&arg2?arg1.substring(arg2,arg3||0):"";
case"contains":return arg1&&arg2?arg1.indexOf(arg2)>-1:false;case"concat":var str="";
for(i=1,l=arguments.length;i<l;i++){if(typeof arguments[i]=="object"){str+=getNodeValue(arguments[i][0]);
continue;}str+=arguments[i];}return str;case"translate":for(i=0,l=arg2.length;i<l;
i++){arg1=arg1.replace(arg2.substr(i,1),arg3.substr(i,1));}return arg1;}},selectNodeExtended:function(sExpr,contextNode,match){var sResult=this.selectNodes(sExpr,contextNode);
if(sResult.length==0){return null;}if(!match){return sResult;}for(var i=0,l=sResult.length;
i<l;i++){if(String(getNodeValue(sResult[i]))==match){return[sResult[i]];}}return null;
},getRoot:function(xmlNode){while(xmlNode.parentNode&&xmlNode.parentNode.nodeType==1){xmlNode=xmlNode.parentNode;
}return xmlNode.parentNode;},selectNodes:function(sExpr,contextNode){if(!this.cache[sExpr]){this.cache[sExpr]=this.compile(sExpr);
}if(typeof this.cache[sExpr]=="string"){if(this.cache[sExpr]=="."){return[contextNode];
}if(this.cache[sExpr]=="/"){return[(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode))];
}}if(typeof this.cache[sExpr]=="string"&&this.cache[sExpr]=="."){return[contextNode];
}var info=this.cache[sExpr][0],rootNode=(info[3]?(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode)):contextNode),sResult=[];
if(rootNode){info[0](rootNode,info[1],this.cache[sExpr],1,0,sResult);}return sResult;
}};function getNodeValue(sResult){if(sResult.nodeType==1){return sResult.firstChild?sResult.firstChild.nodeValue:"";
}if(sResult.nodeType>1||sResult.nodeType<5){return sResult.nodeValue;}return sResult;
}apf.CodeCompilation=function(code){this.data={F:[],S:[],I:[],X:[]};this.compile=function(){code=code.replace(/ or /g," || ").replace(/ and /g," && ").replace(/!=/g,"{}").replace(/=/g,"==").replace(/\{\}/g,"!=");
this.tokenize();this.insert();code=code.replace(/, \)/g,", htmlNode)");return code;
};this.tokenize=function(){var data=this.data.F;code=code.replace(/(translate|format-number|contains|substring|local-name|last|position|round|starts-with|string|string-length|sum|floor|ceiling|concat|count|not)\s*\(/g,function(d,match){return(data.push(match)-1)+"F_";
});data=this.data.S;code=code.replace(/'([^']*)'/g,function(d,match){return(data.push(match)-1)+"S_";
}).replace(/"([^"]*)"/g,function(d,match){return(data.push(match)-1)+"S_";});data=this.data.X;
code=code.replace(/(^|\W|\_)([\@\.\/A-Za-z\*][\*\.\@\/\w\:\-]*(?:\(\)){0,1})/g,function(d,m1,m2){return m1+(data.push(m2)-1)+"X_";
}).replace(/(\.[\.\@\/\w]*)/g,function(d,m1,m2){return(data.push(m1)-1)+"X_";});
data=this.data.I;code=code.replace(/(\d+)(\W)/g,function(d,m1,m2){return(data.push(m1)-1)+"I_"+m2;
});};this.insert=function(){var data=this.data;code=code.replace(/(\d+)X_\s*==\s*(\d+S_)/g,function(d,nr,str){return"apf.XPath.selectNodeExtended('"+data.X[nr].replace(/'/g,"\\'")+"', htmlNode, "+str+")";
}).replace(/(\d+)([FISX])_/g,function(d,nr,type){var value=data[type][nr];if(type=="F"){return"apf.XPath.doXpathFunc(htmlNode, '"+value+"', ";
}else{if(type=="S"){return"'"+value+"'";}else{if(type=="I"){return value;}else{if(type=="X"){return"apf.XPath.selectNodeExtended('"+value.replace(/'/g,"\\'")+"', htmlNode)";
}}}}}).replace(/, \)/g,")");};};};apf.BindingRule=function(struct,tagName){this.$init(tagName||true,apf.NODE_HIDDEN,struct);
};(function(){this.$bindingRule=true;this.compile=function(prop){return(this["c"+prop]=apf.lm.compile(this[prop],{xpathmode:3,injectself:true}));
};this.$compile=function(prop,options){return(this["c"+prop+"2"]=apf.lm.compile(this[prop],options));
};this.$attrExcludePropBind=apf.extend({value:1,match:1},this.$attrExcludePropBind);
this.$booleanProperties.hasaml=true;this.$propHandlers.value=this.$propHandlers.match=function(value,prop){delete this["c"+prop];
if(this.$amlLoaded){var node=this;while(node&&node.$bindingRule){node=node.parentNode;
}if(!node){return;}apf.queue.add("reload"+node.$uniqueId,function(){node.reload();
});if(node.$bindings.$isCompiled){node.$bindings.$compiled=node.$bindings.compile(this.localName!="each"&&this.localName);
}}};this.addEventListener("DOMNodeInserted",function(e){var node=this;while(node.$bindingRule){node=node.parentNode;
}apf.queue.add("reload"+node.$uniqueId,function(){node.reload();});if(e.currentTarget==this){(node.$bindings[this.localName]||(node.$bindings[this.localName]=[])).push(this);
}else{if(!this.attributes.getNamedItem("value")){this.value=apf.serializeChildren(this);
}else{return;}}if(node.$bindings.$isCompiled){node.$bindings.$compiled=node.$bindings.compile(this.localName!="each"&&this.localName);
}});this.addEventListener("DOMNodeRemoved",function(e){if(this.$amlDestroyed){return;
}var first,node=this;while(node&&node.$bindingRule){node=node.parentNode;}if(!node){return;
}if(e.currentTarget==this){if(node.$bindings&&node.$bindings[this.localName]){node.$bindings[this.localName].remove(this);
}else{return;}}else{if(!this.attributes.getNamedItem("value")&&(first=this.firstChild)){if(first.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(first.target=="lm"){this.value="{"+first.nodeValue+"}";
}else{this.value=first.nodeValue;}}else{this.value=apf.serializeChildren(this).trim();
}}else{return;}}apf.queue.add("reload"+node.$uniqueId,function(){if(!node.$amlDestroyed){node.reload();
}});if(node.$bindings.$isCompiled){node.$bindings.$compiled=node.$bindings.compile(this.localName!="each"&&this.localName);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var first;if(!this.value&&this.localName!="each"&&(first=this.$aml&&this.$aml.firstChild||this.firstChild)){if(first.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(first.target=="lm"){this.value="{"+first.nodeValue+"}";
}else{this.value=first.nodeValue;}}else{this.value=apf.serializeChildren(this.$aml).trim();
}}var pNode=this.parentNode;while(pNode.$bindingRule){pNode=pNode.parentNode;}var bindings=pNode.$bindings||(pNode.$bindings=new apf.ruleList());
(bindings[this.localName]||(bindings[this.localName]=[])).push(this);if(pNode.localName!="bindings"&&(this.localName!="each"||!this.childNodes.length)){var ns=this;
while((ns=ns.nextSibling)&&ns.nodeType!=1){}if(!ns||!ns.$bindingRule){pNode.$cbindings=pNode.$bindings.compile(pNode.$bindings.$isCompiled?this.localName:null);
pNode.dispatchEvent("bindingsload",{bindings:pNode.$bindings,compiled:pNode.$cbindings});
pNode.$checkLoadQueue();}}});}).call(apf.BindingRule.prototype=new apf.AmlElement());
apf.aml.setElement("icon",apf.BindingRule);apf.aml.setElement("image",apf.BindingRule);
apf.aml.setElement("caption",apf.BindingRule);apf.aml.setElement("tooltip",apf.BindingRule);
apf.aml.setElement("css",apf.BindingRule);apf.aml.setElement("selectable",apf.BindingRule);
apf.aml.setElement("value",apf.BindingRule);apf.aml.setElement("src",apf.BindingRule);
apf.aml.setElement("collapsed",apf.BindingRule);apf.aml.setElement("expanded",apf.BindingRule);
apf.aml.setElement("empty",apf.BindingRule);apf.ActionRule=function(struct,tagName){this.$init(tagName||true,apf.NODE_HIDDEN,struct);
};(function(){this.$actionRule=true;this.compile=function(prop,options){return(this["c"+prop]=apf.lm.compile(this[prop],options||{xpathmode:2}));
};this.$attrExcludePropBind=apf.extend({set:1,get:1,undo:1,lock:1,match:1,parent:1},this.$attrExcludePropBind);
this.$propHandlers.set=this.$propHandlers.get=this.$propHandlers.parent=this.$propHandlers.match=function(value,prop){delete this["c"+prop];
};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this){var pNode=this.parentNode;
if(!pNode.$actions){pNode.$actions=new apf.ruleList();}(pNode.$actions[this.localName]||(pNode.$actions[this.localName]=[])).push(this);
}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);
}});this.addEventListener("DOMNodeRemoved",function(e){if(this.$amlDestroyed){return;
}if(e.currentTarget==this){this.parentNode.$actions[this.localName].remove(this);
}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.get){this.get=apf.serializeChildren(this.$aml).trim();
}var actions=this.parentNode.$actions||(this.parentNode.$actions=new apf.ruleList());
(actions[this.localName]||(actions[this.localName]=[])).push(this);});}).call(apf.ActionRule.prototype=new apf.AmlElement());
apf.aml.setElement("rename",apf.ActionRule);apf.aml.setElement("remove",apf.ActionRule);
apf.aml.setElement("add",apf.ActionRule);apf.aml.setElement("update",apf.ActionRule);
apf.aml.setElement("copy",apf.ActionRule);apf.aml.setElement("move",apf.ActionRule);
apf.aml.setElement("check",apf.ActionRule);apf.aml.setElement("change",apf.ActionRule);
apf.actions=function(struct,tagName){this.$init(tagName||"actions",apf.NODE_HIDDEN,struct);
this.$actions=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;
this.register=function(amlNode){if(amlNode.localName=="smartbinding"){this.$smartbinding=amlNode;
this.$smartbinding.add(this);return;}this.$amlNodes[amlNode.$uniqueId]=amlNode;
amlNode.$actions=this.$actions;amlNode.$actionsElement=this;amlNode.dispatchEvent("actionsload",{bindings:this});
};this.unregister=function(amlNode){this.$amlNodes[amlNode.$uniqueId]=null;delete this.$amlNodes[amlNode.$uniqueId];
delete amlNode.$actionsElement;delete amlNode.$actions;amlNode.dispatchEvent("actionsunload",{bindings:this});
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var nodes=this.childNodes;
for(var node,i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeType!=1){continue;
}node.dispatchEvent("DOMNodeInsertedIntoDocument");}this.register(this.parentNode);
});}).call(apf.actions.prototype=new apf.AmlElement());apf.aml.setElement("actions",apf.actions);
apf.actiontracker=function(struct,tagName){this.$init(tagName||"actiontracker",apf.NODE_HIDDEN,struct);
this.$undostack=[];this.$redostack=[];this.$execstack=[];};(function(){this.$lastExecStackItem=null;
this.realtime=true;this.undolength=0;this.redolength=0;this.$booleanProperties={};
this.$booleanProperties.realtime=true;this.$supportedProperties=["realtime","undolength","redolength","alias","length","position"];
this.$handlePropSet=function(prop,value,force){if(this.$booleanProperties[prop]){value=apf.isTrue(value);
}switch(prop){case"undolength":this.undolength=this.$undostack.length;break;case"redolength":this.redolength=this.$redostack.length;
break;default:this[prop]=value;}};this.item=function(index){if(index<this.$undostack.length){return this.$undostack[index];
}return this.$redostack[index-this.$undostack.length];};this.add=function(data,title){throw new Error("Not implemented yet");
};this.remove=function(index){throw new Error("Not implemented yet");};this.clearUndo=function(){this.setProperty("undolength",this.$undostack.length=0);
this.dispatchEvent("afterchange",{action:"clear-undo"});};this.clearRedo=function(){this.setProperty("redolength",this.$redostack.length=0);
this.dispatchEvent("afterchange",{action:"clear-redo"});};this.define=function(action,func){apf.actiontracker.actions[action]=func;
};this.getParent=function(){return this.parentNode&&this.parentNode.getActionTracker?this.parentNode.getActionTracker(true):(apf.window.$at!=this?apf.window.$at:null);
};this.getDone=function(time){if(typeof time!="number"){return[];}for(var o,i=this.$undostack.length;
i>=0;--i){if(!(o=this.$undostack[i])||!o.timestamp){continue;}if(o.timestamp>=time){return this.$undostack.slice(i);
}}return[];};this.getUndone=function(time){if(typeof time!="number"){return[];}for(var o,i=0,l=this.$redostack.length;
i<l;++i){if(!(o=this.$redostack[i])||!o.timestamp){continue;}if(o.timestamp<=time){return this.$redostack.slice(0,i+1);
}}return[];};this.execute=function(options){if(this.dispatchEvent("beforechange",options)===false){return false;
}var UndoObj=new apf.UndoData(options,this);if(options.action&&!options.transaction){apf.actiontracker.actions[options.action](UndoObj,false,this);
}UndoObj.id=this.$undostack.push(UndoObj)-1;this.setProperty("undolength",this.$undostack.length);
if(UndoObj.multiple){this.$addToQueue(UndoObj.multiple,false,true);}else{this.$addToQueue(UndoObj,false);
}if(!options.rdb){this.$redostack.length=0;this.setProperty("redolength",this.$redostack.length);
}this.dispatchEvent("afterchange",{action:"do"});return UndoObj;};this.purge=function(nogrouping,forcegrouping){if(true){if(this.$execstack.length){this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this);
this.$lastExecStackItem=this.$execstack[this.$execstack.length-1];}}else{if(parent){this.reset();
}}};this.reset=function(){this.$undostack.length=this.$redostack.length=0;this.setProperty("undolength",0);
this.setProperty("redolength",0);this.dispatchEvent("afterchange",{action:"reset"});
};this.undo=function(id,single,rollback){change.call(this,id,single,true,rollback);
};this.redo=function(id,single,rollback){change.call(this,id,single,false,rollback);
};function change(id,single,undo,rollback){var undoStack=undo?this.$undostack:this.$redostack,redoStack=undo?this.$redostack:this.$undostack;
if(!undoStack.length){return;}if(single){var UndoObj=undoStack[id];if(!UndoObj){return;
}undoStack.length--;redoStack.push(UndoObj);if(UndoObj.action){apf.actiontracker.actions[UndoObj.action](UndoObj,undo,this);
}if(!rollback){if(UndoObj.multiple){this.$addToQueue(UndoObj.multiple,undo,true);
}else{this.$addToQueue(UndoObj,undo);}}this.setProperty("undolength",this.$undostack.length);
this.setProperty("redolength",this.$redostack.length);return UndoObj;}if(this.dispatchEvent("beforechange")===false){return;
}if(id==-1){id=undoStack.length;}if(!id){id=1;}var i=0;while(i<id&&undoStack.length>0){if(!undoStack[undoStack.length-1]){undoStack.length--;
this.$undostack=[];this.$redostack=[];return false;}else{change.call(this,undoStack.length-1,true,undo,rollback);
i++;}}this.dispatchEvent("afterchange",{action:undo?"undo":"redo",rollback:rollback});
}this.$receive=function(data,state,extra,UndoObj,callback){if(state==apf.TIMEOUT&&extra.tpModule.retryTimeout(extra,state,this)===true){return true;
}if(state!=apf.SUCCESS){if(this.dispatchEvent("actionfail",apf.extend(extra,{state:state,message:"Could not sent Action RPC request for control "+this.name+"["+this.localName+"] \n\n"+extra.message,bubbles:true}))===false){return true;
}if(typeof apf.offline!="undefined"&&!apf.offline.reloading){this.undo(UndoObj.id,extra.userdata,true);
}if(callback){callback(!extra.userdata);}if(!extra.userdata){this.$execstack=[];
var oError=new Error(apf.formatErrorString(0,this,"Executing action","Error sending action to the server:\n"+(extra.url?"Url:"+extra.url+"\n\n":"")+extra.message));
if(this.dispatchEvent("error",apf.extend({error:oError,state:state,bubbles:true},extra))===false){return;
}throw oError;}}else{this.dispatchEvent("actionsuccess",apf.extend(extra,{state:state,bubbles:true},extra));
if(callback){callback();}}this.$queueNext(UndoObj,callback);};this.$addToQueue=function(UndoObj,undo,isGroup){if(!isGroup&&this.$execstack.length&&!UndoObj.state&&this.$execstack[this.$execstack.length-1].undoObj==UndoObj){this.$execstack.length--;
return;}var idx,undoObj,qItem;if(isGroup){var undoObj,qItem=this.$execstack.shift();
for(var i=0;i<UndoObj.length;i++){undoObj=UndoObj[i];this.$execstack.unshift({undoObj:(undoObj.tagName?undoObj:new apf.UndoData(undoObj,this)).preparse(undo,this),undo:undo});
}if(qItem){this.$execstack.unshift(qItem);}return;}qItem={undoObj:UndoObj.preparse(undo,this),undo:undo};
this.$execstack.push(qItem)-1;if(this.$execstack.length==1&&this.realtime){UndoObj.saveChange(undo,this);
}};this.$queueNext=function(UndoObj,callback){if(!this.$execstack[0]||this.$execstack[0].undoObj!=UndoObj){throw new Error(apf.formatErrorString(0,this,"Executing Next                 action in queue","The execution stack was corrupted. This is                 a fatal error. The application should be restarted. You will                 lose all your changes. Please contact the administrator."));
}UndoObj.state=null;var lastItem=this.$execstack.shift();if(!this.$execstack[0]||lastItem==this.$lastExecStackItem){return;
}this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this,callback);};
}).call(apf.actiontracker.prototype=new apf.AmlElement());apf.aml.setElement("actiontracker",apf.actiontracker);
apf.application=function(){this.$init("application",apf.NODE_HIDDEN);if(!apf.isO3){this.$int=document.body;
this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;
this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");
};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);
}};apf.application.prototype=new apf.AmlElement();apf.aml.setElement("application",apf.application);
apf.appsettings=function(struct,tagName){this.$init(tagName||"appsettings",apf.NODE_HIDDEN,struct);
};(function(){this.$parsePrio="001";this.$attrExcludePropBind={language:1,login:1,logout:1};
this.$supportedProperties=["debug","name","baseurl","resource-path","disable-right-click","allow-select","allow-blur","auto-disable-actions","auto-disable","disable-f5","auto-hide-loading","disable-space","disable-backspace","undokeys","initdelay","default-page","query-append","outline","drag-outline","resize-outline","resize-outline","iepngfix","iepngfix-elements","iphone-fullscreen","iphone-statusbar","iphone-icon","iphone-icon-is-glossy","iphone-fixed-viewport","skinset","language","storage","offline","login"];
this.$booleanProperties={debug:1,"disable-right-click":1,"allow-select":1,"allow-blur":1,"auto-disable-actions":1,"auto-disable":1,"disable-f5":1,"auto-hide-loading":1,"disable-space":1,"disable-backspace":1,undokeys:1,initdelay:1,outline:1,iepngfix:1,"iphone-fullscreen":1,"iphone-icon-is-glossy":1,"iphone-fixed-viewport":1};
var $setProperty=this.setProperty;this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){if(inherited!=2){$setProperty.apply(this,arguments);
}};this.$handlePropSet=function(prop,value,force){if(this.$booleanProperties[prop]){value=apf.isTrue(value);
}this[prop]=value;apf.config.setProperty(prop,value);};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){});
}).call(apf.appsettings.prototype=new apf.AmlElement());apf.aml.setElement("appsettings",apf.appsettings);
apf.auth=function(struct,tagName){this.$init(tagName||"auth",apf.NODE_HIDDEN,struct);
this.$services={};this.$cache={};this.$queue=[];this.$credentials=null;};apf.aml.setElement("auth",apf.auth);
(function(){this.autostart=true;this.authenticated=false;this.enablequeue=false;
this.$retry=true;this.loggedIn=false;this.$needsLogin=false;this.$hasHost=false;
this.inProcess=0;this.$attrExcludePropBind=apf.extend({login:1,logout:1},this.$attrExcludePropBind);
this.$booleanProperties.autostart=true;this.$booleanProperties.remember=true;this.$supportedProperties.push("login","logout","fail-state","error-state","login-state","logout-state","waiting-state","window","autostart","remember","authenticated","enablequeue");
this.$propHandlers.login=this.$propHandlers["login-state"]=function(value){this.$services["default"]=value?this:null;
this.$needsLogin=value?true:false;};this.register=function(node){this.$services[node.name]=node;
this.$needsLogin=true;};this.unregister=function(node){var prop;delete this.$services[node.name];
if(!(prop in this.$services)){this.$needsLogin=false;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.inited=true;
if(this.parentNode&&this.parentNode.$setAuth){this.parentNode.$setAuth(this);this.$hasHost=true;
}if(this.autostart&&!this.$hasHost){var _self=this;apf.addEventListener("load",function(){_self.authRequired();
apf.removeEventListener("load",arguments.callee);});}});this.addEventListener("authrequired",function(){if(self[this.window]){this.win=self[this.window];
if(this.win){this.win.show();return false;}}if(self[this["authreq-state"]]){this.state=self[this["authreq-state"]];
if(this.state){this.state.activate();return false;}}});this.addEventListener("beforelogin",function(){if(self[this["waiting-state"]]){this.state=self[this["waiting-state"]];
if(this.state){this.state.activate();}}});var knownHttpAuthErrors={401:1,403:1};
function failFunction(e){var st=(e.state==apf.TIMEOUT||!knownHttpAuthErrors[e.status]?self[this["error-state"]]:self[this["fail-state"]])||self[this["fail-state"]];
if(st){this.state=st;if(this.state){this.state.activate();return false;}}}this.addEventListener("loginfail",failFunction);
this.addEventListener("logoutfail",failFunction);this.addEventListener("logoutsuccess",function(){if(self[this["logout-state"]]){this.state=self[this["logout-state"]];
if(this.state){this.state.activate();}}});this.addEventListener("loginsuccess",function(e){if(self[this.window]){this.win=self[this.window];
if(this.win){this.win.hide();}}if(self[this["login-state"]]){this.state=self[this["login-state"]];
if(this.state){this.state.activate();}}if(e.data&&this.model){this.model=apf.nameserver.get("model",this.model);
if(this.model){this.model.load(e.data);}}});this.logIn=function(username,password,callback,options){if(!options){options={};
}options.username=username;options.password=password;if(this.dispatchEvent("beforelogin",options)===false){return false;
}this.inProcess=1;var pos=0,len=0,_self=this,doneCallback=function(){if(len!=++pos){return;
}_self.inProcess=0;_self.loggedIn=true;_self.clearQueue();if(callback){callback();
}};if(this.$hasHost){this.$credentials=options;callback=this.$hostCallback;this.$hostCallback=null;
len=1;doneCallback();this.dispatchEvent("loginsuccess",{state:1,data:null,bubbles:true,username:username,password:password});
if(!this.remember){this.$credentials=null;}}else{if(!options.service){var s=options.$services||this.$services;
for(var name in s){len++;this.$do(name,options,"in",null,doneCallback);}}else{if(options.service){len=1;
this.$do(options.service,options,"in",null,doneCallback);}}}};this.relogin=function(){if(this.dispatchEvent("beforerelogin")===false){return false;
}var name,pos=0,len=0,_self=this,doneCallback=function(){if(len!=++pos){return;
}_self.inProcess=0;_self.loggedIn=true;_self.clearQueue();};for(name in this.$services){if(!this.$cache[name]){return false;
}len++;this.$do(name,this.$cache[name],"in",true,doneCallback);}return true;};this.$do=function(service,options,type,isRelogin,callback){var xmlNode=this.$services[service],_self=options.userdata=this;
options.callback=function(data,state,extra){if(state==apf.TIMEOUT&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}var result=_self.dispatchEvent("log"+type+"check",apf.extend({state:state,data:data,service:service,bubbles:true},extra)),loginFailed=typeof result=="boolean"?!result:!(state==apf.SUCCESS||type=="out"&&extra.status==401);
if(loginFailed){_self.inProcess=0;if(isRelogin){return _self.authRequired();}var commError=new Error(apf.formatErrorString(0,null,"Logging "+type,"Error logging in: "+extra.message));
if(_self.dispatchEvent("log"+type+"fail",apf.extend({error:commError,service:service,state:state,data:data,bubbles:true,username:options.username,password:options.password},extra))!==false){throw commError;
}_self.setProperty("authenticated",false);return;}if(type=="in"){if(!isRelogin&&_self.$retry){var cacheItem={};
for(var prop in options){if("object|array".indexOf(typeof options[prop])==-1){cacheItem[prop]=options[prop];
}}_self.$cache[service||"default"]=cacheItem;}}else{if(_self.$cache[service||"default"]){_self.$cache[service||"default"]=null;
}}if(callback){callback();}_self.dispatchEvent("log"+type+"success",apf.extend({},extra,{state:state,service:service,data:data,bubbles:true,username:options.username,password:options.password}));
_self.setProperty("authenticated",true);};apf.saveData(xmlNode.getAttribute("log"+type),options);
};this.clearQueue=function(){if(!this.loggedIn){return;}var queue=this.$queue.slice();
this.$queue.length=0;for(var i=0;i<queue.length;i++){var qItem=queue[i];if(!this.loggedIn){this.$queue.push(qItem);
continue;}if(qItem.retry){qItem.$retry.call(qItem.object);}else{if(qItem.id){qItem.tpModule.retry(qItem.id);
}}}if(this.$queue.length){this.clearQueue();}};this.logOut=function(callback,options){if(!options){options={};
}if(this.dispatchEvent("beforelogout",options)===false){return;}this.loggedIn=false;
if(!options.service){for(var name in this.$services){this.$do(name,options,"out",null,callback);
}}else{if(options.service){this.$do(options.service,options,"out",null,callback);
}}};this.getCredentials=function(service){var cache=this.$cache[service||"default"];
return !cache?["",""]:[cache.username,cache.password];};this.authRequired=function(options,forceNoRetry){if(options&&options.userdata==this){return;
}if(this.loggedIn&&!forceNoRetry&&this.$retry&&this.relogin()){var result=false;
}else{if(this.inProcess!=1){if(this.$hasHost&&typeof options=="function"){if(this.$credentials){return options();
}this.$hostCallback=options;}var result=this.dispatchEvent("authrequired",apf.extend({bubbles:true,data:options&&options.data},options));
}}this.loggedIn=false;if(result===false){if(this.enablequeue&&options){this.$queue.push(options);
}return true;}};}).call(apf.auth.prototype=new apf.AmlElement());apf.section=function(struct,tagName){this.$init(tagName||"section",apf.NODE_VISIBLE,struct);
};apf.menubar=function(struct,tagName){this.$init(tagName||"menubar",apf.NODE_VISIBLE,struct);
};apf.bar=function(struct,tagName){this.$init(tagName||"bar",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$canLeechSkin=true;this.$isLeechingSkin=false;
this.$propHandlers.caption=function(value){this.$int.innerHTML=value;};this.addEventListener("AMLReparent",function(beforeNode,pNode,withinParent){if(!this.$amlLoaded){return;
}if(this.$isLeechingSkin&&!withinParent&&this.skinName!=pNode.skinName||!this.$isLeechingSkin&&this.parentNode.$hasLayoutNode&&this.parentNode.$hasLayoutNode(this.localName)){this.$isLeechingSkin=true;
this.$forceSkinChange(this.parentNode.skinName.split(":")[0]+":"+skinName);}});
this.$draw=function(){this.$ext=this.$getExternal(this.$isLeechingSkin?this.localName:"main");
if(this.oDrag){this.oDrag.parentNode.removeChild(this.oDrag);}this.oDrag=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","dragger",this.$ext);
this.$int=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","container",this.$ext);
};this.$loadAml=function(x){};this.$skinchange=function(){};}).call(apf.bar.prototype=new apf.Presentation());
apf.menubar.prototype=apf.section.prototype=apf.bar.prototype;apf.aml.setElement("bar",apf.bar);
apf.aml.setElement("menubar",apf.menubar);apf.aml.setElement("section",apf.section);
apf.BindingColorRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.$bindings&&this.$bindings.color){var clr=this.$bindings.color[0];
apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"color",clr.getAttribute("text"),null,this.oWin);
apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"backgroundColor",clr.getAttribute("row"),null,this.oWin);
apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight":" .records .highlight"),"backgroundColor",clr.getAttribute("row"),null,this.oWin);
}apf.importStylesheet([["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align],["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align]]);
this.$draw();});}).call(apf.BindingColorRule.prototype=new apf.BindingRule());apf.aml.setElement("color",apf.BindingColorRule);
apf.BindingColumnRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
this.$className="col"+this.$uniqueId;};(function(){this.$defaultwidth="100";this.$width=100;
this.$sortable=true;this.$resizable=true;this.$movable=true;this.$cssInit=false;
this.$attrExcludePropBind=apf.extend({css:1,icon:1,caption:1,eachcaption:1,eachvalue:1,each:1,icon:1},this.$attrExcludePropBind);
this.$supportedProperties.push("tree","icon","caption","width","options","check","editor","colspan","align","css","sorted","each","eachvalue","eachcaption","model");
this.$booleanProperties.tree=true;this.$booleanProperties.check=true;this.$booleanProperties.sorted=true;
this.$propHandlers.width=function(value,prop){if(!value){value=this.$defaultwidth;
}this.$isPercentage=value&&String(value).indexOf("%")>-1;this.$width=parseFloat(value);
};this.$propHandlers.options=function(value,prop){this.$sortable=value.indexOf("sort")>-1;
this.$resizable=value.indexOf("size")>-1;this.$movable=value.indexOf("move")>-1;
};this.resize=function(newsize,pNode){var hN;if(this.$isPercentage){var oldsize=(this.$ext.offsetWidth-(pNode.$widthdiff-3)),ratio=newsize/oldsize,next=[],fixed=[],total=0,node=this.$ext.nextSibling;
while(node&&node.getAttribute("hid")){hN=apf.all[node.getAttribute("hid")];if(hN.$isPercentage){next.push(hN);
total+=hN.$width;}else{fixed.push(hN);}node=node.nextSibling;}if(fixed.length&&!next.length){return fixed[0].resize(fixed[0].$width+(oldsize-newsize),pNode);
}var newPerc=ratio*this.$width,diffPerc=newPerc-this.$width,diffRatio=(total-diffPerc)/total;
if(diffRatio<0.01){if(newsize<20){return;}return this.resize(newsize-10,pNode);
}for(var n,i=0;i<next.length;i++){n=next[i];n.$width*=diffRatio;apf.setStyleRule("."+n.$className,"width",n.$width+"%");
}this.$width=newPerc;apf.setStyleRule("."+this.$className,"width",this.$width+"%");
}else{var diff=newsize-this.$width;this.$width=newsize;if(apf.isIE&&pNode.oIframe){this.$ext.style.width=newsize+"px";
}else{}apf.setStyleRule("."+this.$className,"width",newsize+"px",null,pNode.oWin);
pNode.$fixed+=diff;var vLeft=(pNode.$fixed)+"px";if(!this.$isFixedGrid){apf.setStyleRule("."+pNode.$baseCSSname+" .row"+pNode.$uniqueId,"paddingRight",vLeft,null,this.oWin);
apf.setStyleRule("."+pNode.$baseCSSname+" .row"+pNode.$uniqueId,"marginRight","-"+vLeft,null,pNode.oWin);
pNode.$container.style.paddingRight=pNode.$head.style.paddingRight=vLeft;}}};this.hide=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","hidden",null,this.oWin);
};this.show=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","visible",null,this.oWin);
};this.sort=function(pNode,initial){if(pNode.$lastSorted==this){apf.setStyleClass(this.$int,pNode.toggleSortOrder()?"ascending":"descending",["descending","ascending"]);
return;}var h;if(h=pNode.$lastSorted){apf.setStyleRule("."+h.$className,"background","white");
apf.setStyleClass(h.$int,"",["descending","ascending"]);}apf.setStyleRule("."+this.$className,"background","#f3f3f3");
apf.setStyleClass(this.$int,"ascending",["descending","ascending"]);pNode.resort({order:"ascending",xpath:(this.cvalue||this.compile("value")).xpaths[1]},false,initial||!pNode.length);
pNode.$lastSorted=this;};this.move=function(hTo,pNode){if(hTo&&this==hTo){return;
}var hFrom=this,childNrFrom=apf.getChildNumber(hFrom.$int),childNrTo=hTo&&apf.getChildNumber(hTo.$int);
pNode.$head.insertBefore(hFrom.$int,hTo&&hTo.$int||null);if(!pNode.length){return;
}(function _recur(nodes){for(var node,i=0;i<nodes.length;i++){if(nodes[i].nodeType!=1){continue;
}node=nodes[i];if(pNode.$isTreeArch&&node.tagName=="BLOCKQUOTE"){_recur(node.childNodes);
}else{node.insertBefore(node.childNodes[childNrFrom],childNrTo!=undefined&&node.childNodes[childNrTo]||null);
}}})(pNode.$container.childNodes);};this.$draw=function(pNode,caption,width,className){var pNode=pNode||this.parentNode;
while(pNode.$bindingRule){pNode=pNode.parentNode;}if(!pNode.hasFeature(apf.__PRESENTATION__)){return;
}if(width){this.$propHandlers.width.call(this,width);}apf.importStylesheet([["."+this.$className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+this.align]]);
pNode.$getNewContext("headitem");var $head=pNode.$getLayoutNode("headitem");$head.setAttribute("class",this.$className+(className?" "+className:""));
$head.setAttribute("hid",this.$uniqueId);var hCaption=pNode.$getLayoutNode("headitem","caption");
hCaption.nodeValue=this.caption||caption||"&nbsp";this.$ext=this.$int=apf.insertHtmlNode($head,pNode.$head||pNode.$container);
var dragging=false;var _self=this;if(this.sorted){this.sort(pNode,true);}this.$int.onmouseup=function(e){if(!e){e=event;
}if(pNode.disabled||!apf.isChildOf(dragging,this,true)){return;}apf.setStyleClass(this,"hover",["down"]);
if(_self.$sortable){_self.sort(pNode);}pNode.dispatchEvent("sortcolumn",_self);
};this.$int.onmousedown=function(e){if(!e){e=event;}dragging=target=this;if(pNode.disabled){return;
}var pos=apf.getAbsolutePosition(target),sLeft=pNode.$head.scrollLeft;var d=e.clientX-pos[0]+sLeft;
if(d<4||target.offsetWidth-d-8<3&&apf.getChildNumber(_self.$int)<pNode.$headings.length-1){var t=d<4&&target.previousSibling||target;
if(_self.$resizable){pos=apf.getAbsolutePosition(t);apf.setStyleClass(pNode.$pointer,"size_pointer",["move_pointer"]);
pNode.$pointer.style.display="block";pNode.$pointer.style.left=(t.offsetLeft-sLeft-1)+"px";
pNode.$pointer.style.width=(t.offsetWidth-pNode.$widthdiff+1)+"px";apf.plane.show(pNode.$pointer,null,true);
dragging=true;document.onmouseup=function(){if(!e){e=event;}document.onmouseup=document.onmousemove=null;
apf.all[t.getAttribute("hid")].resize(pNode.$pointer.offsetWidth,pNode);dragging=false;
pNode.$pointer.style.display="none";apf.plane.hide();};document.onmousemove=function(e){if(!e){e=event;
}pNode.$pointer.style.width=Math.max(10,Math.min(pNode.$container.offsetWidth-pNode.$pointer.offsetLeft-20,e.clientX-pos[0]-1+sLeft))+"px";
};return;}}apf.setStyleClass(target,"down",["hover"]);if(!_self.$movable){document.onmouseup=function(e){document.onmouseup=null;
dragging=false;};return;}apf.setStyleClass(pNode.$pointer,"move_pointer",["size_pointer"]);
var x=e.clientX-target.offsetLeft,sX=e.clientX,y=e.clientY-target.offsetTop,sY=e.clientY,copy;
document.onmouseup=function(e){if(!e){e=event;}document.onmouseup=document.onmousemove=null;
dragging=false;pNode.$pointer.style.display="none";if(!copy){return;}copy.style.top="-100px";
var el=document.elementFromPoint(e.clientX,e.clientY);if(el.parentNode==copy.parentNode){var pos=apf.getAbsolutePosition(el);
var beforeNode=(e.clientX-pos[0]>el.offsetWidth/2?el.nextSibling:el);_self.move(beforeNode?apf.all[beforeNode.getAttribute("hid")]:null,pNode);
}apf.destroyHtmlNode(copy);};document.onmousemove=function(e){if(!e){e=event;}if(!copy){if(Math.abs(e.clientX-sX)<3&&Math.abs(e.clientY-sY)<3){return;
}copy=target.cloneNode(true);copy.style.position="absolute";var diff=apf.getWidthDiff(target);
copy.style.width=(target.offsetWidth-diff-pNode.$widthdiff+2)+"px";copy.style.left=target.offsetLeft;
copy.style.top=target.offsetTop;copy.style.margin=0;copy.removeAttribute("hid");
apf.setStyleClass(copy,"drag",["ascending","descending"]);target.parentNode.appendChild(copy);
}copy.style.top="-100px";pNode.$pointer.style.display="none";var el=document.elementFromPoint(e.clientX,e.clientY);
if(el.parentNode==copy.parentNode){var pos=apf.getAbsolutePosition(el);pNode.$pointer.style.left=(el.offsetLeft+((e.clientX-pos[0]>el.offsetWidth/2)?el.offsetWidth-8:0))+"px";
pNode.$pointer.style.display="block";}copy.style.left=(e.clientX-x)+"px";copy.style.top=(e.clientY-y)+"px";
};};this.$int.onmouseout=function(e){if(!e){e=event;}if(pNode.disabled){return;
}var _self=this;this.$timer=setTimeout(function(){pNode.$ext.style.cursor="";apf.setStyleClass(_self,"",["hover","down"]);
},10);};this.$int.onmousemove=function(e){if(dragging||pNode.disabled){return;}if(!e){e=event;
}var pos=apf.getAbsolutePosition(this),sLeft=pNode.$head.scrollLeft;var d=e.clientX-pos[0]+sLeft;
if(d<4||this.offsetWidth-d-pNode.$widthdiff<3&&apf.getChildNumber(_self.$int)<pNode.$headings.length-1){var t=d<4?this.previousSibling:this;
pNode.$ext.style.cursor=t&&_self.$resizable?"w-resize":"default";apf.setStyleClass(this,"",["hover","down"]);
}else{pNode.$ext.style.cursor="default";apf.setStyleClass(this,"hover",["down"]);
}};if(!this.options&&pNode.options){this.$propHandlers.options.call(this,this.options=pNode.options);
}return this;};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.$draw();
});this.addEventListener("DOMNodeRemovedFromDocument",function(e){if(!this.$int){return;
}this.$int.onmouseover=this.$int.onmouseup=this.$int.onmousedown=this.$int.onmousemove=this.$int.onmouseout=null;
});}).call(apf.BindingColumnRule.prototype=new apf.BindingRule());apf.aml.setElement("column",apf.BindingColumnRule);
apf.BindingDndRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){this.compile=function(prop){if(!this[prop]){return;}var compileData;
if(prop=="value"){compileData=apf.lm.compile(this[prop],{xpathmode:3});}else{if(prop=="match"){compileData=apf.lm.compile(this[prop],{xpathmode:3,injectself:true});
}else{if(prop=="target"){compileData=apf.lm.compile(this[prop],{xpathmode:2,injectself:true});
}else{if(prop=="action"){compileData=apf.lm.compile(this[prop],{nostring:true});
}else{if(prop=="copy"){compileData=apf.lm.compile(this[prop],{withopt:true,nostring:true});
}else{throw new Error("Missing property handler for compile");}}}}}return(this["c"+prop]=compileData);
};this.$attrExcludePropBind=apf.extend({target:1,parent:1,action:1,dragcopy:1},this.$attrExcludePropBind);
this.$propHandlers.target=this.$propHandlers.parent=this.$propHandlers.action=this.$propHandlers.dragcopy=function(value,prop){delete this["c"+prop];
};this.$noderegister=function(e){apf.GuiElement.propHandlers.drop.call(e.amlNode,true);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pNode=this;
while(pNode&&pNode.$bindingRule){pNode=pNode.parentNode;}if(!pNode){return;}if(pNode.localName=="bindings"){pNode.addEventListener("noderegister",this.$noderegister);
var nodes=pNode.$amlNodes;for(var i=0;i<nodes.length;i++){apf.GuiElement.propHandlers.drop.call(nodes[i],true);
}}else{apf.GuiElement.propHandlers.drop.call(pNode,true);}});}).call(apf.BindingDndRule.prototype=new apf.BindingRule());
apf.aml.setElement("drag",apf.BindingDndRule);apf.aml.setElement("drop",apf.BindingDndRule);
apf.BindingEachRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
var _self=this;this.$noderegister=function(e){e.amlNode.$handleBindingRule(_self.match,"each");
e.amlNode.$sort=_self.sort?new apf.Sort(_self):null;};};(function(){this.$attrExcludePropBind=apf.extend({sort:1,"data-type":1,"date-format":1,"sort-method":1,order:1,"case-order":1},this.$attrExcludePropBind);
this.$booleanProperties.animate=true;this.$propHandlers.sort=this.$propHandlers["data-type"]=this.$propHandlers["date-format"]=this.$propHandlers.order=this.$propHandlers["case-order"]=function(value,prop){delete this["c"+prop];
};this.$updateEach=function(value){var pNode=this.parentNode;if(pNode.localName=="bindings"){var nodes=pNode.$amlNodes,i=0,l=nodes.length;
for(;i<l;++i){if(nodes[i].each!=value){nodes[i].$handleBindingRule(value,"each");
}}}else{if(pNode.each!=value){pNode.$handleBindingRule(value,"each");}}};this.$getFilteredMatch=function(value){if(!value){return this.match;
}var keywords=value.trim().toLowerCase().split(" ");var each=this.match.charAt(0)=="["&&this.match.charAt(this.match.length-1)=="]"?this.match.replace(/^\[|\]$/g,""):this.match;
var model;if(each.indexOf("::")>-1){var parsed=each.split("::");if(!apf.xPathAxis[parsed[0]]){model=parsed[0];
each=parsed[1];}}var search=[],word,words,fields=this.$fields||["text()"];for(var i=0,l=keywords.length;
i<l;i++){words=[],word=keywords[i];for(var j=0,jl=fields.length;j<jl;j++){words.push("contains(translate("+fields[j]+", 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), '"+word+"')");
}search.push(words.join(" or "));}var filter="("+search.join(") and (")+")";var groups=this["filter-groups"]?this["filter-groups"].split("|"):[];
each=each.split("|");var newEach=[];for(i=0,l=each.length;i<l;i++){if(!groups.contains(each[i])){newEach.push(each[i]+"["+filter+"]");
}}var subEach=newEach.join("|");for(i=0;i<groups.length;i++){newEach.push(groups[i]+"["+subEach+"]");
}return newEach.join("|");};this.$propHandlers.filter=function(value,prop){if(!this.$amlLoaded){return;
}this.$updateEach(this.$getFilteredMatch(value));};this.$propHandlers["filter-fields"]=function(value,prop){this.$fields=value.splitSafe(",");
};this.addEventListener("prop.match",function(e){if(!this.$amlLoaded){return;}if(this.filter){this.$propHandlers.filter.call(this,this.filter);
}else{this.$updateEach(this.match);}});var f;this.addEventListener("DOMNodeInserted",f=function(e){if(e.currentTarget!=this){return;
}var match=this.$getFilteredMatch(this.filter);var pNode=this.parentNode;if(pNode.localName=="bindings"){pNode.addEventListener("noderegister",this.$noderegister);
var nodes=pNode.$amlNodes,i=0,l=nodes.length;for(;i<l;++i){nodes[i].$handleBindingRule(match,"each");
nodes[i].$sort=this.sort?new apf.Sort(this):null;}}else{pNode.$handleBindingRule(match,"each");
pNode.$sort=this.sort?new apf.Sort(this):null;}});this.addEventListener("DOMNodeRemoved",function(e){if(e.currentTarget!=this){return;
}var pNode=this.parentNode;if(pNode.localName=="bindings"){pNode.removeEventListener("noderegister",this.$noderegister);
var nodes=pNode.$amlNodes,i=0,l=nodes.length;for(;i<l;++i){delete nodes[i].$sort;
}}else{delete pNode.$sort;}});this.addEventListener("DOMNodeInsertedIntoDocument",f);
}).call(apf.BindingEachRule.prototype=new apf.BindingRule());apf.aml.setElement("each",apf.BindingEachRule);
apf.BindingLoadRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){this.$attrExcludePropBind=apf.extend({get:1},this.$attrExcludePropBind);
this.$propHandlers.get=function(value,prop){delete this["c"+prop];};}).call(apf.BindingLoadRule.prototype=new apf.BindingRule());
apf.aml.setElement("load",apf.BindingLoadRule);apf.aml.setElement("insert",apf.BindingLoadRule);
apf.BindingQuicksandRule=function(struct,tagName){this.$init(tagName,apf.NODE_HIDDEN,struct);
};(function(){function getFilteredNodes(pNode){pNode=pNode||this.$parent;var attr,tmp,res=[],dataIDs=[],xmlNodes=pNode.$getDataNode("quicksand",pNode.xmlRoot,false,null,true),domNodes=pNode.$ext.childNodes,i=0,l=xmlNodes.length;
if(!domNodes.length||!l){return res;}for(;i<l;++i){dataIDs.push(xmlNodes[i].getAttribute("a_id"));
}for(i=0,l=domNodes.length;i<l;++i){if(!domNodes[i]||!(attr=domNodes[i].getAttribute("id"))){continue;
}tmp=attr.split("|");tmp.pop();if(dataIDs.indexOf(tmp.join("|"))>-1){res.push(domNodes[i]);
}}return res;}function nodeInFilter(node,filtered){var i=0,l=filtered.length,s=node.getAttribute("id");
for(;i<l;++i){if(filtered[i].getAttribute("id")==s){return filtered[i];}}return null;
}function quicksand(parent,customOptions){parent=this.$parent.$ext;var i,l,dest,src,offset,_self=this,coll=getFilteredNodes.call(this),parentOffset=apf.getAbsolutePosition(parent),offsets=[],callbackFunction=typeof(arguments[1])=="function"?arguments[1]:typeof arguments[2]=="function"?arguments[2]:apf.K,postCallback=function(){_self.dispatchEvent("afterquicksand");
callbackFunction.call(_self);},options={steps:60,anim:apf.tween.easeInOutQuad,onfinish:postCallback,adjustHeight:true};
apf.extend(options,customOptions);if(apf.isIE&&apf.isIE<7){parent.innerHTML="";
for(i=0,l=coll.length;i<l;i++){parent.appendChild(coll[i]);}return;}var $source=parent.childNodes;
var correctionOffset=[0,0];parent.style.height=parent.offsetHeight+"px";apf.tween.clearQueue(parent,true);
for(i=0,l=$source.length;i<l;++i){src=$source[i];offsets[i]=apf.getAbsolutePosition(src,parent,false);
}for(i=0,l=$source.length;i<l;++i){src=$source[i];with(src.style){position="absolute";
margin="0";top=(offsets[i][1]-parentOffset[1])+"px";left=(offsets[i][0]-parentOffset[0])+"px";
}}var $dest=parent.cloneNode(false);$dest.setAttribute("id","");for(i=0,l=coll.length;
i<l;++i){$dest.appendChild(coll[i].cloneNode(true));coll[i].$offset=apf.getAbsolutePosition(coll[i]);
}parent.parentNode.insertBefore($dest,parent);with($dest.style){zIndex=1;opacity=0;
margin=0;position="absolute";top=parentOffset[1]-correctionOffset[1]+"px";left=parentOffset[0]-correctionOffset[0]+"px";
}if(false){apf.tween.single(parent,{steps:options.steps,anim:options.anim,type:"height",from:parent.offsetHeight,to:$dest.offsetHeight});
}var insets=[];for(i=0,l=$source.length;i<l;++i){src=$source[i];if(dest=nodeInFilter(src,coll)){offset=insets.shift()||offsets[i];
options.tweens=[{type:"top",from:dest.$offset[1]-parentOffset[1],to:offset[1]-parentOffset[1]},{type:"left",from:dest.$offset[0]-parentOffset[0],to:offset[0]-parentOffset[0]},{type:"opacity",from:apf.getStyle(src,"opacity"),to:1}];
if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:0,to:1});
}apf.tween.multi(src,options);}else{options.tweens=[{type:"opacity",from:apf.getStyle(src,"opacity"),to:0}];
if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:1,to:0});
}insets.push(offsets[i]);apf.tween.multi(src,options);}}for(i=0,l=coll.length;i<l;
++i){var item=coll[i];if(!nodeInFilter(item,$source)){dest=nodeInFilter(item,coll);
options.tweens=[{type:"opacity",from:0,to:1}];if(!apf.isIE){}offset=apf.getAbsolutePosition(dest);
dest=dest.cloneNode(true);with(dest.style){position="absolute";margin="0";top=(offset[1]-parentOffset[1])+"px";
left=(offset[0]-parentOffset[0])+"px";opacity="0";transform="scale(.0)";}parent.appendChild(dest);
apf.tween.multi(dest,options);}}}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pNode=this;
while(pNode&&pNode.$bindingRule){pNode=pNode.parentNode;}this.$parent=pNode;if(!pNode){return;
}var _self=this;setTimeout(function(){quicksand.call(_self);});});}).call(apf.BindingQuicksandRule.prototype=new apf.BindingRule());
apf.aml.setElement("quicksand",apf.BindingQuicksandRule);apf.bindings=function(struct,tagName){this.$init(tagName||"bindings",apf.NODE_HIDDEN,struct);
this.$bindings=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;
this.register=function(amlNode){if(amlNode.localName=="smartbinding"){this.$smartbinding=amlNode;
this.$smartbinding.add(this);return;}if(!amlNode.hasFeature(apf.__DATABINDING__)){return;
}this.$amlNodes[amlNode.$uniqueId]=amlNode;if(!this.$amlLoaded){return;}if(!this.$bindings.$isCompiled){this.$cbindings=this.$bindings.compile();
}amlNode.$bindings=this.$bindings;amlNode.$cbindings=this.$cbindings;amlNode.$bindingsElement=this;
amlNode.dispatchEvent("bindingsload",{bindings:this.$bindings,compiled:this.$cbindings});
this.dispatchEvent("noderegister",{amlNode:amlNode});amlNode.$checkLoadQueue();
};this.unregister=function(amlNode){this.$amlNodes[amlNode.$uniqueId]=null;delete this.$amlNodes[amlNode.$uniqueId];
amlNode.$bindingsElement=amlNode.$bindings=amlNode.$cbindings=false;amlNode.dispatchEvent("bindingsunload",{bindings:this.$bindings,compiled:this.$cbindings});
};this.reload=function(){for(var id in this.$amlNodes){this.$amlNodes[id].reload();
}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var nodes=this.childNodes;
for(var node,i=0,l=nodes.length;i<l;i++){if(!(node=nodes[i]).$amlLoaded&&node.nodeType==1){node.dispatchEvent("DOMNodeInsertedIntoDocument");
}}this.register(this.parentNode);for(var id in this.$amlNodes){this.register(this.$amlNodes[id]);
}});}).call(apf.bindings.prototype=new apf.AmlElement());apf.ruleList=function(){this.$compiled={};
};apf.ruleList.prototype={$isCompiled:false,getRule:function(name,xmlNode){var rules=this[name];
if(!rules){return false;}for(var func,rule,i=0,l=rules.length;i<l;i++){rule=rules[i];
if(!rule.match){return rule;}func=rule.cmatch||rule.compile("match",{injectself:true,xpathmode:2});
if(func&&func(xmlNode)){return rule;}}},compile:function(name){var rules,s,c=this.$compiled,hasAml=false;
if(name){s=[];rules=this[name];for(var rule,i=0,l=rules.length;i<l;i++){if(!(rule=rules[i]).match&&!rule.value){continue;
}s.push(rule.match,rule.value);if(!hasAml&&rule.value){hasAml=rule.hasaml||rule.value.indexOf("<a:")>-1;
}}c[name]=apf.lm.compileMatch(s);c[name].hasAml=hasAml;return c;}for(name in this){if(name=="each"){continue;
}rules=this[name];if(rules.dataType!=apf.ARRAY){continue;}s=[],hasAml=false;for(var rule,i=0,l=rules.length;
i<l;i++){if(!(rule=rules[i]).match&&!rule.value){continue;}s.push(rule.match,rule.value);
if(!hasAml&&rule.value){hasAml=rule.hasaml||rule.value.indexOf("<a:")>-1;}}c[name]=apf.lm.compileMatch(s);
c[name].hasAml=hasAml;}this.$isCompiled=true;return c;},getRuleIndex:function(name,index){var rule=this[name][index];
if(rule.value){if(!rule.cvalue){rule.compile("value");}}else{if(rule.match){if(!rule.cmatch){rule.compile("match");
}}}return rule;},getDataNode:function(name,xmlNode,createNode,ruleList,multiple){var i,l,func,node,rule,rules=this[name];
if(!rules){return;}for(rule,i=0,l=rules.length;i<l;i++){rule=rules[i];func=rule.cvaluematch;
if(!func){if(rule.match&&rule.value&&rule.value.match(/^\[.*\]$/)){rule.valuematch="{_n = "+rule.match+"; %[child::"+rule.value.substr(1,rule.value.length-2).split("|").join("|child::")+"]}";
}else{rule.valuematch=rule.match||rule.value;}func=rule.$compile("valuematch",{xpathmode:multiple?4:3,injectself:rule.match?true:false});
}if(func&&(node=func(xmlNode,createNode))){if(ruleList){ruleList.push(rule);}return node;
}}return false;}};apf.aml.setElement("bindings",apf.bindings);apf.BindingSeriesRule=function(struct,tagName){this.$init(tagName||"series",apf.NODE_HIDDEN,struct);
};(function(){this.$attrExcludePropBind=apf.extend({formula:1},this.$attrExcludePropBind);
this.$propHandlers.formula=function(value,prop){delete this["c"+prop];};}).call(apf.BindingSeriesRule.prototype=new apf.BindingRule());
apf.aml.setElement("series",apf.BindingSeriesRule);apf.AmlConfig=function(){this.$init("config",apf.NODE_VISIBLE);
};(function(){this.focussable=false;this.$canLeechSkin=true;this.$draw=function(){this.$ext=this.$int=this.$getExternal(this.$isLeechingSkin?this.localName:"main");
};}).call(apf.AmlConfig.prototype=new apf.Presentation());apf.aml.setElement("config",apf.AmlConfig);
apf.browser=function(struct,tagName){this.$init(tagName||"browser",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.StandardBinding);this.$supportedProperties.push("value","src");
this.$propHandlers.src=this.$propHandlers.value=function(value,force){try{this.$browser.src=value||"about:blank";
}catch(e){this.$browser.src="about:blank";}};this.$propHandlers.border=apf.Presentation.prototype.$propHandlers.border;
this.getValue=function(){return this.value||this.src;};this.getURL=function(){return this.$browser.src;
};this.back=function(){this.$browser.contentWindow.history.back();};this.forward=function(){this.$browser.contentWindow.history.forward();
};this.reload=function(){this.$browser.src=this.$browser.src;};this.print=function(){this.$browser.contentWindow.print();
};this.runCode=function(str,noError){if(noError){try{this.$browser.contentWindow.eval(str);
}catch(e){}}else{this.$browser.contentWindow.eval(str);}};this.$draw=function(parentNode){if(!parentNode){parentNode=this.$pHtmlNode;
}if(apf.cannotSizeIframe){var _iframe=document.createElement("iframe");_iframe.setAttribute("frameborder","0");
this.$ext=parentNode.appendChild(document.createElement("DIV")).appendChild(_iframe).parentNode;
this.$ext.style.width="100px";this.$ext.style.height="100px";this.$browser=this.$ext.firstChild;
this.$browser.style.width="100%";this.$browser.style.height="100%";this.$browser.frameBorder=0;
}else{this.$ext=parentNode.appendChild(document.createElement("iframe"));this.$ext.style.width="100px";
this.$ext.style.height="100px";this.$browser=this.$ext;}this.$ext.className="apfbrowser";
var _self=this;apf.addListener(this.$browser,"load",function(){_self.dispatchEvent("load");
});apf.addListener(this.$browser,"error",function(){_self.dispatchEvent("error");
});this.$ext.host=this;};}).call(apf.browser.prototype=new apf.GuiElement());apf.aml.setElement("browser",apf.browser);
apf.submit=function(struct,tagName){this.$init(tagName||"submit",apf.NODE_VISIBLE,struct);
};apf.trigger=function(struct,tagName){this.$init(tagName||"trigger",apf.NODE_VISIBLE,struct);
};apf.reset=function(struct,tagName){this.$init(tagName||"reset",apf.NODE_VISIBLE,struct);
};apf.button=function(struct,tagName){this.$init(tagName||"button",apf.NODE_VISIBLE,struct);
};(function(){this.$useExtraDiv;this.$childProperty="caption";this.$inited=false;
this.$isLeechingSkin=false;this.$canLeechSkin=true;this.$focussable=apf.KEYBOARD;
this.value=null;this.$init(function(){var forceFocus,_self=this,lastDefaultParent;
this.$propHandlers["default"]=function(value){if(parseInt(value)!=value){value=apf.isTrue(value)?1:0;
}this["default"]=parseInt(value);if(!this.focussable&&value||forceFocus){this.setAttribute("focussable",forceFocus=value);
}if(lastDefaultParent){lastDefaultParent.removeEventListener("focus",setDefault);
lastDefaultParent.removeEventListener("blur",removeDefault);}if(!value){return;
}var pNode=this.parentNode;while(pNode&&!pNode.focussable&&value--){pNode=pNode.parentNode;
}if(pNode){pNode.addEventListener("focus",setDefault);pNode.addEventListener("blur",removeDefault);
}};function setDefault(e){if(e.defaultButtonSet||e.returnValue===false){return;
}e.defaultButtonSet=true;if(this.$useExtraDiv){_self.$ext.appendChild(apf.button.$extradiv);
}_self.$setStyleClass(_self.$ext,_self.$baseCSSname+"Default");if(e.srcElement!=_self&&_self.$focusParent){_self.$focusParent.addEventListener("keydown",btnKeyDown);
}}function removeDefault(e){if(this.$useExtraDiv&&apf.button.$extradiv.parentNode==_self.$ext){_self.$ext.removeChild(apf.button.$extradiv);
}_self.$setStyleClass(_self.$ext,"",[_self.$baseCSSname+"Default"]);if(e.srcElement!=_self&&_self.$focusParent){_self.$focusParent.removeEventListener("keydown",btnKeyDown);
}}function btnKeyDown(e){var ml;var f=apf.document.activeElement;if(f){if(f.hasFeature(apf.__MULTISELECT__)){return;
}ml=f.multiline;}if(!_self.$ext.onmouseup){return;}if(ml&&ml!="optional"&&e.keyCode==13&&e.ctrlKey||(!ml||ml=="optional")&&e.keyCode==13&&!e.ctrlKey&&!e.shiftKey&&!e.altKey){apf.preventDefault(e.htmlEvent);
_self.$ext.onmouseup(e.htmlEvent,true);}}this.addEventListener("focus",setDefault);
this.addEventListener("blur",removeDefault);this.$enable=function(){if(this["default"]){setDefault({});
if(apf.document.activeElement){apf.document.activeElement.focus(true);}}if(this.state&&this.value){this.$setState("Down",{});
}else{if(this.$mouseOver){this.$updateState({},"mouseover");}else{this.$doBgSwitch(1);
}}};this.$disable=function(){if(this["default"]){removeDefault({});}this.$doBgSwitch(4);
this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over",this.$baseCSSname+"Down"]);
};});this.$booleanProperties.state=true;this.$supportedProperties.push("icon","value","tooltip","state","color","caption","action","target","default","submenu","hotkey");
this.$propHandlers.icon=function(value){if(!this.oIcon){return;}if(value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");
}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,value,this.iconPath);
};this.$propHandlers.value=function(value){if(!this.state&&!this.submenu){return;
}if(value===undefined){value=!this.value;}this.value=value;if(this.value){this.$setState("Down",{});
}else{this.$setState("Out",{});}};this.$propHandlers.state=function(value){if(value){this.$setStateBehaviour(this.value);
}else{this.$setNormalBehaviour();}};this.$propHandlers.color=function(value){if(this.oCaption){this.oCaption.parentNode.style.color=value;
}};this.$propHandlers.caption=function(value){if(!this.oCaption){return;}if(value){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);
}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=String(value||"").trim();
}else{this.oCaption.nodeValue=String(value||"").trim();}};this.$propHandlers.hotkey=function(value){if(this.$hotkey){apf.setNodeValue(this.$hotkey,value);
}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(value){this.$lastHotkey=value;
var _self=this;apf.registerHotkey(value,function(e){_self.$setState("Over",{});
$setTimeout(function(){_self.$setState("Out",{});},200);if(_self.$clickHandler&&_self.$clickHandler()){_self.$updateState(e||event,"click");
}else{_self.dispatchEvent("click");}});}if(this.tooltip){apf.GuiElement.propHandlers.tooltip.call(this,this.tooltip);
}};function menuKeyHandler(e){return;var key=e.keyCode;var next,nr=apf.getChildNumber(this);
if(key==37){next=nr==0?this.parentNode.childNodes.length-1:nr-1;this.parentNode.childNodes[next].dispatchEvent("mouseover");
}else{if(key==39){next=(nr>=this.parentNode.childNodes.length-1)?0:nr+1;this.parentNode.childNodes[next].dispatchEvent("mouseover");
}}}function menuDown(e){var menu=self[this.submenu],$button1;this.value=!this.value;
if(this.value){this.$setState("Down",{});}var menuPressed=this.parentNode.menuIsPressed;
if(menuPressed&&menuPressed!=this){menuPressed.setValue(false);var oldMenu=self[menuPressed.submenu];
if(oldMenu!=self[this.submenu]){oldMenu.$propHandlers.visible.call(oldMenu,false,true);
}}if(!this.value){menu.hide();this.$setState("Over",{},"toolbarover");if($button1=this.parentNode.$button1){$button1.$setState("Over",{},"toolbarover");
}this.parentNode.menuIsPressed=false;if(this.parentNode.hasMoved){this.value=false;
}if(apf.hasFocusBug){apf.window.$focusfix();}return false;}this.parentNode.menuIsPressed=this;
menu.display(null,null,false,this,null,null,this.$ext.offsetWidth-2);this.parentNode.hasMoved=false;
if(e){apf.stopPropagation(e.htmlEvent);}return false;}function menuOver(){var menuPressed=this.parentNode.menuIsPressed;
if(!menuPressed||menuPressed==this){return;}var menu=self[this.submenu];if(menu.pinned){return;
}menuPressed.setValue(false);var oldMenu=self[menuPressed.submenu];oldMenu.$propHandlers.visible.call(oldMenu,false,true);
this.setValue(true);this.parentNode.menuIsPressed=this;var pos=apf.getAbsolutePosition(this.$ext,menu.$ext.offsetParent);
menu.display(pos[0],pos[1]+this.$ext.offsetHeight,true,this,null,null,this.$ext.offsetWidth-2);
this.$focus();this.parentNode.hasMoved=true;return false;}this.$propHandlers.submenu=function(value){if(!value){if(this.value&&this.parentNode){menuDown.call(this);
}this.$focussable=true;this.$setNormalBehaviour();this.removeEventListener("mousedown",menuDown);
this.removeEventListener("mouseover",menuOver);this.removeEventListener("keydown",menuKeyHandler,true);
return;}this.$focussable=false;this.$setStateBehaviour();this.addEventListener("mouseover",menuOver);
this.addEventListener("mousedown",menuDown);this.addEventListener("keydown",menuKeyHandler,true);
};this.setValue=function(value){this.setProperty("value",value,false,true);};this.showMenu=function(){if(this.submenu&&!this.value){menuDown.call(this);
}};this.hideMenu=function(){if(this.submenu&&this.value){menuDown.call(this);}};
this.setCaption=function(value){this.setProperty("caption",value,false,true);};
this.setIcon=function(url){this.setProperty("icon",url,false,true);};this.$setStateBehaviour=function(value){this.value=value||false;
this.isBoolean=true;this.$setStyleClass(this.$ext,this.$baseCSSname+"Bool");if(this.value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");
this.$doBgSwitch(this.states.Down);}};this.$setNormalBehaviour=function(){this.value=null;
this.isBoolean=false;this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Bool"]);
};this.$setState=function(state,e,strEvent){var parentNode=this.parentNode;if(strEvent&&this.dispatchEvent(strEvent,{htmlEvent:e})===false){return;
}if(parentNode&&parentNode.$button2&&parentNode.$button2.value&&!this.submenu){return;
}this.$doBgSwitch(this.states[state]);var bs=this.$baseCSSname;this.$setStyleClass(this.$ext,(state!="Out"?bs+state:""),[(this.value?"":bs+"Down"),bs+"Over"]);
if(this.submenu){bs=this.$baseCSSname+"menu";this.$setStyleClass(this.$ext,(state!="Out"?bs+state:""),[(this.value?"":bs+"Down"),bs+"Over"]);
}};this.$clickHandler=function(){if(this.isBoolean&&!this.submenu){this.setProperty("value",!this.value);
return true;}};this.$submenu=function(hide,force){if(hide){this.setValue(false);
this.$setState("Out",{},"mouseout");if(this.parentNode){this.parentNode.menuIsPressed=false;
}}};this.addEventListener("$skinchange",function(e){if(this.tooltip){apf.GuiElement.propHandlers.tooltip.call(this,this.tooltip);
}});this.$draw=function(){var pNode,isToolbarButton=(pNode=this.parentNode)&&pNode.parentNode.localName=="toolbar";
if(isToolbarButton){if(typeof this.focussable=="undefined"){this.focussable=false;
}this.$focussable=apf.KEYBOARD;}this.$ext=this.$getExternal();this.oIcon=this.$getLayoutNode("main","icon",this.$ext);
this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$useExtraDiv=apf.isTrue(this.$getOption("main","extradiv"));
if(!apf.button.$extradiv&&this.$useExtraDiv){(apf.button.$extradiv=document.createElement("div")).className="extradiv";
}if(this.localName=="submit"){this.action="submit";}else{if(this.localName=="reset"){this.action="reset";
}}this.$setupEvents();};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);
}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}this.$updateState({reset:1});
});this.addEventListener("click",function(e){var action=this.action;if(!action){action=this.localName;
}var _self=this;$setTimeout(function(){(apf.button.actions[action]||apf.K).call(_self);
});});}).call(apf.button.prototype=new apf.BaseButton());apf.submit.prototype=apf.trigger.prototype=apf.reset.prototype=apf.button.prototype;
apf.aml.setElement("submit",apf.submit);apf.aml.setElement("trigger",apf.trigger);
apf.aml.setElement("reset",apf.reset);apf.aml.setElement("button",apf.button);apf.submit.action=apf.trigger.actions=apf.reset.actions=apf.button.actions={undo:function(action){var tracker;
if(this.target&&self[this.target]){tracker=self[this.target].localName=="actiontracker"?self[this.target]:self[this.target].getActionTracker();
}else{var at,node=this;while(node.parentNode){at=(node=node.parentNode).$at;}}(tracker||apf.window.$at)[action||"undo"]();
},redo:function(){apf.button.actions.undo.call(this,"redo");},remove:function(){if(this.target&&self[this.target]){self[this.target].remove();
}},add:function(){if(this.target&&self[this.target]){self[this.target].add();}},rename:function(){if(this.target&&self[this.target]){self[this.target].startRename();
}},login:function(){var parent=this.target&&self[this.target]?self[this.target]:this.parentNode;
var vg=parent.$validgroup||new apf.ValidationGroup();if(!vg.childNodes.length){vg.childNodes=parent.childNodes.slice();
}var vars={};function loopChildren(nodes){for(var node,i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.hasFeature(apf.__VALIDATION__)&&!node.$validgroup&&!node.form){node.setProperty("validgroup",vg);
}if(node.type){vars[node.type]=node.getValue();}if(vars.username&&vars.password){return;
}if(node.childNodes.length){loopChildren(node.childNodes);}}}loopChildren(parent.childNodes);
if(!vg.isValid()){return;}if(!vars.username||!vars.password){return;}var auth=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(!auth){return;}auth.logIn(vars.username,vars.password);},logout:function(){var auth=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(!auth){return;}auth.logOut();},submit:function(doReset){var vg,model;var parent=this.target&&self[this.target]?self[this.target]:this.parentNode;
if(parent.$isModel){model=parent;}else{if(!parent.$validgroup){parent.$validgroup=parent.validgroup?self[parent.validgroup]:new apf.ValidationGroup();
}vg=parent.$validgroup;if(!vg.childNodes.length){vg.childNodes=parent.childNodes.slice();
}function loopChildren(nodes){for(var node,i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.getModel){model=node.getModel();if(model){return false;}}if(node.childNodes.length){if(loopChildren(node.childNodes)===false){return false;
}}}}loopChildren(parent.childNodes);if(!model){model=apf.globalModel;if(!model){return;
}}}if(doReset){model.reset();return;}if(vg&&!vg.isValid()){return;}model.submit();
},reset:function(){apf.button.actions.submit.call(this,true);},ok:function(){var node;
if(this.target){node=self[this.target];}else{var node=this.parentNode;while(node&&!node.hasFeature(apf.__TRANSACTION__)){node=node.parentNode;
}if(node&&!node.hasFeature(apf.__TRANSACTION__)){return;}}if(node.commit()&&node.close){node.close();
}},cancel:function(){var node;if(this.target){node=self[this.target];}else{var node=this.parentNode;
while(node&&!node.hasFeature(apf.__TRANSACTION__)){node=node.parentNode;}if(node&&!node.hasFeature(apf.__TRANSACTION__)){return;
}}node.rollback();if(node.close){node.close();}},apply:function(){var node;if(this.target){node=self[this.target];
}else{var node=this.parentNode;while(node&&!node.hasFeature(apf.__TRANSACTION__)){node=node.parentNode;
}if(node&&!node.hasFeature(apf.__TRANSACTION__)){return;}}if(node.autoshow){node.autoshow=-1;
}if(node.commit(true)){node.begin("update");}},close:function(){var parent=this.target&&self[this.target]?self[this.target]:this.parentNode;
while(parent&&!parent.close){parent=parent.parentNode;}if(parent&&parent.close){parent.close();
}}};apf.checkbox=function(struct,tagName){this.$init(tagName||"checkbox",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$focussable=apf.KEYBOARD;this.checked=false;
this.$booleanProperties.checked=true;this.$supportedProperties.push("value","checked","label","values");
this.$propHandlers.value=function(value){value=(typeof value=="string"?value.trim():value);
if(this.$values){this.checked=(typeof value!="undefined"&&value!==null&&value.toString()==this.$values[0].toString());
}else{this.checked=apf.isTrue(value);}if(this.checked){apf.setStyleClass(this.$ext,this.$baseCSSname+"Checked");
}else{apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);}};this.$propHandlers.checked=function(value){if(!this.$values){if(this.getAttribute("values")){this.$propHandler.values.call(this,this.getAttribute("values"));
}}this.setProperty("value",this.$values?this.$values[value?0:1]:true);};this.$propHandlers.label=function(value){if(!this.$ext){return;
}var lbl=this.$getLayoutNode("main","label",this.$ext);if(!lbl){return;}if(lbl.nodeType==1){lbl.innerHTML=value;
}else{lbl.nodeValue=value;}};this.$propHandlers.values=function(value){this.$values=typeof value=="string"?value.split("|"):(value||[1,0]);
this.$propHandlers.value.call(this,this.value);};this.setValue=function(value){if(!this.$values){return;
}this.setProperty("value",value,false,true);};this.getValue=function(){return this.xmlRoot?(this.$values?this.$values[this.checked?0:1]:this.checked):this.value;
};this.check=function(){this.setProperty("value",this.$values?this.$values[0]:true,false,true);
};this.uncheck=function(){this.setProperty("value",this.$values?this.$values[1]:false,false,true);
};this.addEventListener("$clear",function(){this.setProperty("value",this.$values?this.$values[1]:false);
});this.$enable=function(){if(this.$input){this.$input.disabled=false;}this.$doBgSwitch(1);
};this.$disable=function(){if(this.$input){this.$input.disabled=true;}this.$doBgSwitch(4);
};this.$setState=function(state,e,strEvent){this.$doBgSwitch(this.states[state]);
this.$setStyleClass(this.$ext,(state!="Out"?this.$baseCSSname+state:""),[this.$baseCSSname+"Down",this.$baseCSSname+"Over"]);
this.state=state;if(strEvent){this.dispatchEvent(strEvent,{htmlEvent:e});}};this.$clickHandler=function(){this.change(this.$values?this.$values[(!this.checked)?0:1]:!this.checked);
if(this.validate){this.validate(true);}return true;};this.$draw=function(){this.$ext=this.$getExternal();
this.$input=this.$getLayoutNode("main","input",this.$ext);this.$notfromext=this.$input&&this.$input!=this.$ext;
this.$setupEvents();};this.$childProperty="label";this.addEventListener("$skinchange",function(){if(this.label){this.$propHandlers.label.call(this,this.label);
}});}).call(apf.checkbox.prototype=new apf.BaseButton());apf.aml.setElement("checkbox",apf.checkbox);
if(!apf.hasRequireJS){apf.aml.setElement("codeeditor",apf.textbox);}else{define("apf/elements/codeeditor",["module","ace/editor","ace/edit_session","ace/virtual_renderer","ace/undomanager","ace/range","pilot/fixoldbrowsers"],function(module,Editor,EditSession,VirtualRenderer,UndoManager,Range){Editor=Editor.Editor;
EditSession=EditSession.EditSession;VirtualRenderer=VirtualRenderer.VirtualRenderer;
UndoManager=UndoManager.UndoManager;Range=Range.Range;apf.codeeditor=module.exports=function(struct,tagName){this.$init(tagName||"codeeditor",apf.NODE_VISIBLE,struct);
this.documents=[];this.$cache={};this.setProperty("line",1);this.setProperty("col",1);
};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$childProperty="value";
this.$isTextInput=true;this.value="";this.multiline=true;this.caching=true;this.$booleanProperties.activeline=true;
this.$booleanProperties.caching=true;this.$booleanProperties.readonly=true;this.$booleanProperties.activeline=true;
this.$booleanProperties.showinvisibles=true;this.$booleanProperties.showprintmargin=true;
this.$booleanProperties.overwrite=true;this.$booleanProperties.softtabs=true;this.$booleanProperties.gutter=true;
this.$booleanProperties.highlightselectedword=true;this.$booleanProperties.autohidehorscrollbar=true;
this.$booleanProperties.behaviors=true;this.$supportedProperties.push("value","syntax","activeline","selectstyle","caching","readonly","showinvisibles","showprintmargin","printmargincolumn","overwrite","tabsize","softtabs","debugger","model-breakpoints","scrollspeed","theme","gutter","highlightselectedword","autohidehorscrollbar","behaviors");
var cacheId=0;this.$getCacheKey=function(value){if(typeof value=="string"){var key=this.xmlRoot?this.xmlRoot.getAttribute(apf.xmldb.xmlIdTag):value;
}else{if(value.nodeType){var key=value.getAttribute(apf.xmldb.xmlIdTag);}}return key;
};this.clearCacheItem=function(xmlNode){if(!this.caching){return;}var key=this.$getCacheKey(xmlNode);
if(key){delete this.$cache[key];}};this.addEventListener("unloadmodel",function(e){this.syncValue();
});this.$propHandlers.value=function(value){var doc,key,_self=this;if(this.caching){key=this.$getCacheKey(value);
}if(value instanceof EditSession){doc=value;}if(!doc&&key){doc=this.$cache[key];
}if(!doc){if(value.nodeType){apf.xmldb.addNodeListener(value.nodeType==1?value:value.parentNode,this);
}doc=new EditSession(typeof value=="string"?value:(value.nodeType>1&&value.nodeType<5?value.nodeValue:value.firstChild&&value.firstChild.nodeValue||""));
doc.cacheId=key;doc.setUndoManager(new UndoManager());if(key){this.$cache[key]=doc;
}}else{if(typeof value=="string"&&!doc.hasValue){doc.setValue(value);this.$editor.moveCursorTo(0,0);
doc.hasValue=true;}}_self.$getMode(_self.syntax,function(mode){doc.setMode(mode);
});doc.setTabSize(parseInt(_self.tabsize,10));doc.setUseSoftTabs(_self.softtabs);
doc.setUseWrapMode(_self.wrapmode);doc.setWrapLimitRange(_self.wraplimitmin,_self.wraplimitmax);
_self.$removeDocListeners&&_self.$removeDocListeners();_self.$removeDocListeners=_self.$addDocListeners(doc);
_self.$editor.setShowPrintMargin(_self.showprintmargin);_self.$editor.setSession(doc);
_self.$updateMarker();_self.$updateBreakpoints(doc);};this.$addDocListeners=function(doc){var _self=this;
var onCursorChange=function(){var cursor=doc.getSelection().getCursor();_self.setProperty("line",cursor.row+1);
_self.setProperty("col",cursor.column+1);};doc.getSelection().addEventListener("changeCursor",onCursorChange);
onCursorChange();return function(){doc.getSelection().removeEventListener("changeCursor",onCursorChange);
};};this.$updateMarker=function(removeOnly){if(this.$marker){this.$editor.renderer.removeGutterDecoration(this.$lastRow[0],this.$lastRow[1]);
this.$editor.getSession().removeMarker(this.$marker);this.$marker=null;if(removeOnly){return;
}}if(!this.$debugger){return;}var frame=this.$debugger.activeframe;if(!frame){return;
}var script=this.xmlRoot;if(script.getAttribute("scriptid")!==frame.getAttribute("scriptid")){return;
}var head=this.$debugger.$mdlStack.queryNode("frame[1]");var isTop=frame==head;
var lineOffset=parseInt(script.getAttribute("lineoffset")||"0",10);var row=parseInt(frame.getAttribute("line"),10)-lineOffset;
var range=new Range(row,0,row+1,0);this.$marker=this.$editor.getSession().addMarker(range,isTop?"ace_step":"ace_stack","line");
var type=isTop?"arrow":"stack";this.$lastRow=[row,type];this.$editor.renderer.addGutterDecoration(row,type);
this.$editor.gotoLine(row+1,parseInt(frame.getAttribute("column"),10));};this.$updateBreakpoints=function(doc){doc=doc||this.$editor.getSession();
doc.setBreakpoints([]);if(!this.$breakpoints){return;}if(this.xmlRoot){var scriptName=this.xmlRoot.getAttribute("scriptname");
if(!scriptName){return;}var breakpoints=this.$breakpoints.queryNodes("//breakpoint[@script='"+scriptName+"']");
var rows=[];for(var i=0;i<breakpoints.length;i++){rows.push(parseInt(breakpoints[i].getAttribute("line"),10)-parseInt(breakpoints[i].getAttribute("lineoffset"),10));
}if(rows.length){doc.setBreakpoints(rows);}}};this.$toggleBreakpoint=function(row){this.$debugger.toggleBreakpoint(this.xmlRoot,row);
};this.$propHandlers.theme=function(value){this.$editor.setTheme(value);};this.$propHandlers.syntax=function(value){var _self=this;
this.$getMode(value,function(mode){_self.$editor.getSession().setMode(mode);});
};this.$modes={};this.$getMode=function(syntax,callback){syntax=(syntax||"text").toLowerCase();
if(syntax.indexOf("/")==-1){syntax="ace/mode/"+syntax;}if(this.$modes[syntax]){return callback(this.$modes[syntax]);
}var _self=this;require([syntax],function(modeModule){_self.$modes[syntax]=new modeModule.Mode();
callback(_self.$modes[syntax]);});};this.$propHandlers.activeline=function(value){this.$editor.setHighlightActiveLine(value);
};this.$propHandlers.selectstyle=function(value){this.$editor.setSelectionStyle(value);
};this.$propHandlers.showprintmargin=function(value,prop,initial){this.$editor.setShowPrintMargin(value);
};this.$propHandlers.printmargincolumn=function(value,prop,initial){this.$editor.setPrintMarginColumn(value);
};this.$propHandlers.showinvisibles=function(value,prop,initial){this.$editor.setShowInvisibles(value);
};this.$propHandlers.overwrite=function(value,prop,initial){this.$editor.setOverwrite(value);
};this.$propHandlers.readonly=function(value,prop,initial){this.$editor.setReadOnly(value);
};this.$propHandlers.tabsize=function(value,prop,initial){this.$editor.getSession().setTabSize(parseInt(value,10));
};this.$propHandlers.softtabs=function(value,prop,initial){this.$editor.getSession().setUseSoftTabs(value);
};this.$propHandlers.scrollspeed=function(value,prop,initial){this.$editor.setScrollSpeed(value||2);
};this.$propHandlers.gutter=function(value,prop,initial){this.$editor.renderer.setShowGutter(value);
};this.$propHandlers.fontsize=function(value,prop,initial){this.$ext.style.fontSize=value+"px";
};this.$propHandlers.wrapmode=function(value,prop,initial){this.$editor.getSession().setUseWrapMode(value);
};this.$propHandlers.wraplimitmin=function(value,prop,initial){this.$editor.getSession().setWrapLimitRange(value,this.wraplimitmax);
};this.$propHandlers.wraplimitmax=function(value,prop,initial){this.$editor.getSession().setWrapLimitRange(this.wraplimitmin,value);
};this.$propHandlers.highlightselectedword=function(value,prop,initial){this.$editor.setHighlightSelectedWord(value);
};this.$propHandlers.autohidehorscrollbar=function(value,prop,initial){this.$editor.renderer.setHScrollBarAlwaysVisible(!value);
};this.$propHandlers.behaviors=function(value,prop,initial){this.$editor.setBehavioursEnabled(value);
};this.$propHandlers["model-breakpoints"]=function(value,prop,inital){this.$debuggerBreakpoints=false;
if(this.$breakpoints){this.$breakpoints.removeEventListener("update",this.$onBreakpoint);
}this.$breakpoints=value;if(!this.$breakpoints){this.$updateBreakpoints();return;
}var _self=this;_self.$updateBreakpoints();this.$onBreakpoint=function(){_self.$updateBreakpoints();
};this.$breakpoints.addEventListener("update",this.$onBreakpoint);this.$updateBreakpoints();
};this.$propHandlers["debugger"]=function(value,prop,inital){if(this.$debugger){this.$debugger.removeEventListener("changeframe",this.$onChangeActiveFrame);
this.$debugger.removeEventListener("break",this.$onChangeActiveFrame);this.$debugger.removeEventListener("beforecontinue",this.$onBeforeContinue);
}if(typeof value==="string"){this.$debugger=apf.nameserver.get("debugger",value);
}else{this.$debugger=value;}if(!this.$breakpoints||this.$debuggerBreakpoints){this.setProperty("model-breakpoints",this.$debugger?this.$debugger.$mdlBreakpoints:null);
this.$debuggerBreakpoints=true;}if(!this.$debugger){this.$updateMarker();return;
}this.$updateMarker();var _self=this;this.$onChangeActiveFrame=function(e){_self.$updateMarker();
};this.$onBeforeContinue=function(){_self.$updateMarker(true);};this.$debugger.addEventListener("changeframe",this.$onChangeActiveFrame);
this.$debugger.addEventListener("break",this.$onChangeActiveFrame);this.$debugger.addEventListener("beforecontinue",this.$onBeforeContinue);
};var propModelHandler=this.$propHandlers.model;this.$propHandlers.model=function(value){propModelHandler.call(this,value);
this.$updateMarker();this.$updateBreakpoints();};this.addEventListener("xmlupdate",function(e){var id=e.xmlNode.getAttribute(apf.xmldb.xmlIdTag);
if(this.$cache[id]){}});this.setValue=function(value){return this.setProperty("value",value,false,true);
};this.clear=function(){this.$propHandlers.value.call(this,"",null,true);this.dispatchEvent("clear");
};this.getValue=function(){return this.$editor.getSession().getValue();};this.getDocument=this.getSession=function(){return this.$editor.getSession();
};this.getSelection=function(){return this.$editor.getSession().getSelection();
};this.getLastSearchOptions=function(){return this.$editor.getLastSearchOptions();
};this.select=function(){};this.deselect=function(){this.$editor.clearSelection();
};this.scrollTo=function(){};this.getDefaults=function(){return this.$defaults;
};this.$focus=function(e){if(!this.$ext||this.$ext.disabled){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");
this.$editor.focus();};this.syncValue=function(){var doc=this.$editor.getSession();
if(!doc.cacheId||doc.cacheId==this.$getCacheKey(this.value)){var value=this.getValue();
if(this.value!=value){this.setProperty("value",value);}}};this.$blur=function(e){if(!this.$ext){return;
}this.syncValue();this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);
this.$editor.blur();};this.addEventListener("keydown",function(e){},true);this.$isTextInput=function(e){return true;
};this.$draw=function(){this.$ext=this.$getExternal();this.$input=this.$getLayoutNode("main","content",this.$ext);
this.addEventListener("resize",function(e){this.$editor.resize();});this.$editor=new Editor(new VirtualRenderer(this.$input));
var ed=this.$editor;var _self=this;ed.addEventListener("changeOverwrite",function(e){_self.setProperty("overwrite",e.data);
});ed.addEventListener("gutterclick",function(e){_self.dispatchEvent("gutterclick",e);
if(_self.$debugger){_self.$toggleBreakpoint(e.row);}});ed.addEventListener("gutterdblclick",function(e){_self.dispatchEvent("gutterdblclick",e);
});apf.sanitizeTextbox(ed.renderer.container.getElementsByTagName("textarea")[0]);
};this.$loadAml=function(){var ed=this.$editor,doc=ed.getSession();if(this.syntax===undefined){this.syntax="Text";
}if(this.tabsize===undefined){this.tabsize=doc.getTabSize();}if(this.softtabs===undefined){this.softtabs=doc.getUseSoftTabs();
}if(this.scrollspeed===undefined){this.scrollspeed=ed.getScrollSpeed();}if(this.selectstyle===undefined){this.selectstyle=ed.getSelectionStyle();
}if(this.activeline===undefined){this.activeline=ed.getHighlightActiveLine();}if(this.readonly===undefined){this.readonly=ed.getReadOnly();
}if(this.showinvisibles===undefined){this.showinvisibles=ed.getShowInvisibles();
}if(this.showprintmargin===undefined){this.showprintmargin=ed.getShowPrintMargin();
}if(this.printmargincolumn===undefined){this.printmargincolumn=ed.getPrintMarginColumn();
}if(this.overwrite===undefined){this.overwrite=ed.getOverwrite();}if(this.fontsize===undefined){this.fontsize=12;
}var wraplimit=doc.getWrapLimitRange();if(this.wraplimitmin===undefined){this.wraplimitmin=wraplimit.min;
}if(this.wraplimitmax===undefined){this.wraplimitmax=wraplimit.max;}if(this.wrapmode===undefined){this.wrapmode=doc.getUseWrapMode();
}if(this.gutter===undefined){this.gutter=ed.renderer.getShowGutter();}if(this.highlightselectedword===undefined){this.highlightselectedword=ed.getHighlightSelectedWord();
}if(this.autohidehorscrollbar){this.autohidehorscrollbar=!ed.renderer.getHScrollBarAlwaysVisible();
}if(this.behaviors===undefined){this.behaviors=!ed.getBehavioursEnabled();}};}).call(apf.codeeditor.prototype=new apf.StandardBinding());
apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("codeeditor",apf.codeeditor);
});}apf.comment=function(){this.$init("comment",apf.NODE_HIDDEN);};apf.comment.prototype=new apf.AmlComment();
apf.aml.setElement("comment",apf.comment);apf.contextmenu=function(){this.$init("contextmenu",apf.NODE_HIDDEN);
};(function(){this.$amlNodes=[];this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);
this.register=function(amlParent){if(!amlParent.contextmenus){amlParent.contextmenus=[];
}amlParent.contextmenus.push(this);};this.unregister=function(amlParent){amlParent.contextmenus.remove(this);
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){this.register(this.parentNode);
});}).call(apf.contextmenu.prototype=new apf.AmlElement());apf.aml.setElement("contextmenu",apf.contextmenu);
apf.datagrid=function(struct,tagName){this.$init(tagName||"datagrid",apf.NODE_VISIBLE,struct);
this.$headings=[],this.$cssRules=[];this.$lastOpened={};this.$editors={};this.$dynCssClasses=[];
};(function(){var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4,treeState=this.$treeState;
this.implement(apf.DataAction);this.bufferselect=false;this.$useTable=false;this.$focussable=true;
this.$isWindowContainer=-1;this.$widthdiff=0;this.$defaultwidth=0;this.$useiframe=0;
this.$needsDepth=true;this.canrename=false;this.$booleanProperties.iframe=true;
this.$mode=0;this.$propHandlers.mode=function(value){if("check|radio".indexOf(value)>-1){if(!this.hasFeature(apf.__MULTICHECK__)){this.implement(apf.MultiCheck);
}this.addEventListener("afterrename",$afterRenameMode);this.multicheck=value=="check";
this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",$afterRenameMode);
this.$mode=0;}};function $afterRenameMode(){}this.$propHandlers.options=function(value){for(var i=0,l=this.$headings.length;
i<l;i++){this.$headings[i].setAttribute("options",value);}};function scrollIntoView(){var Q=(this.current||this.$selected),o=this.$container;
o.scrollTop=(Q.offsetTop)-21;}this.$getCaptionElement=function(){if(!this.$selected){return false;
}var nodes=this.$head.childNodes,htmlNodes=this.$selected.childNodes,i=0;nodeIter=htmlNodes[i];
while(nodeIter){if(nodeIter.nodeType!=1){nodeIter=nodeIter.nextSibling;continue;
}h=apf.all[nodes[i].getAttribute("hid")];if(h.tree||h.rename){return this.$getLayoutNode(h.tree?"treecell":"cell","caption",nodeIter)||nodeIter;
}i++;nodeIter=nodeIter.nextSibling;}throw new Error("Datagrid without rename column specified");
};this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;
}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}};this.$blur=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);
}hideEditor.call(this);};this.addEventListener("bindingsload",this.$loaddatabinding=function(e){var rules=e.bindings.column;
if(!rules||!rules.length){return;}this.$headings=rules;var fixed=0,found=false;
for(var h,i=0,l=rules.length;i<l;i++){h=rules[i];if(!h.$isPercentage){fixed+=parseFloat(h.$width)||0;
}else{found=true;}}if(!found){this.$isFixedGrid=true;this.$setStyleClass(this.$ext,"fixed");
if(this.$useiframe){this.$setStyleClass(this.oDoc.documentElement,"fixed");}}else{}if(fixed>0&&!this.$isFixedGrid){var vLeft=fixed;
this.$cssRules.push(["."+this.$baseCSSname+" .row"+this.$uniqueId,"padding-right:"+vLeft+"px;margin-right:-"+vLeft+"px"]);
this.$container.style.paddingRight=this.$head.style.paddingRight=vLeft+"px";}this.$fixed=fixed;
this.$first=0;this.$withContainer=e.bindings.description?true:false;apf.importStylesheet(this.$cssRules,window);
if(this.$useiframe){apf.importStylesheet(this.$cssRules,this.oWin);}});this.$initNode=function(xmlNode,state,Lid,depth){this.$getNewContext("item");
var oRow=this.$getLayoutNode("item");oRow.setAttribute("id",Lid);oRow.setAttribute("class",oRow.getAttribute("class")+" "+treeState[state]+" item"+this.$uniqueId);
this.$setStyleClass(this.$getLayoutNode("item","container"),treeState[state]);oRow.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");o.choose(null, true);"+(this.$withContainer?"o.slideToggle(this, null, true);":"")+(this.celledit&&!this.namevalue?"o.startRename(null, null, true);":""));
if(this.hasFeature(apf.__DRAGDROP__)){oRow.setAttribute("onmouseout","this.hasPassedDown = false;");
oRow.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, isSelected);":""));
oRow.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");
}else{oRow.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var wasSelected = o.$selected == this;                o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, wasSelected);":""));
}for(var cellType,cell,h,i=0;i<this.$headings.length;i++){h=this.$headings[i];if(h.tree&&h.check){cellType="treecheckcell";
this.$getNewContext("treecheckcell");cell=this.$getLayoutNode("treecheckcell");
var oc=this.$getLayoutNode("treecheckcell","openclose");oc.setAttribute("style","margin-left:"+(((depth||0))*15+4)+"px;");
oc.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.slideToggle(this, null, null, true);                    event.cancelBubble = true;                    apf.window.$mousedown(event);");
oc.setAttribute("ondblclick","event.cancelBubble = true");}else{if(h.tree){cellType="treecell";
this.$getNewContext("treecell");cell=this.$getLayoutNode("treecell");var oc=this.$getLayoutNode("treecell","openclose");
oc.setAttribute("style","margin-left:"+(((depth||0))*15+4)+"px;");oc.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.slideToggle(this, null, null, true);                    event.cancelBubble = true;                    apf.window.$mousedown(event);");
oc.setAttribute("ondblclick","event.cancelBubble = true");}else{cellType=h.check?"checkcell":"cell";
this.$getNewContext(cellType);cell=this.$getLayoutNode(cellType);}}if(this.$mode&&h.check){var elCheck=this.$getLayoutNode(cellType,"check");
if(elCheck){elCheck.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                        o.checkToggle(this, true);o.$skipSelect = true;");
if(apf.isTrue(this.$applyBindRule("checked",xmlNode))){this.$checkedList.push(xmlNode);
this.$setStyleClass(oRow,"checked");}else{if(this.isChecked(xmlNode)){this.$setStyleClass(oRow,"checked");
}}}else{return false;}}apf.setStyleClass(cell,h.$className);if(h.css){apf.setStyleClass(cell,(apf.lm.compile(h.css))(xmlNode));
}if(h.icon){var node=this.$getLayoutNode(cellType,"caption",oRow.appendChild(cell));
node=(node.nodeType==1&&node||node.parentNode);node.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,((h.cicon||h.$compile("icon",{nostring:true}))(xmlNode)||""))+");");
this.$setStyleClass(node,"iconCell",[]);}if(h.value){if(!h.cvalue2){h.$compile("value",{nostring:true});
if(h.value){h.cvalue2.hasAml=h.value.indexOf("<a:")>-1;}}if(h.cvalue2.hasAml){var q=(this.$amlBindQueue||(this.$amlBindQueue={}));
var htmlEl=this.$getLayoutNode(cellType,"caption",oRow.appendChild(cell));htmlEl.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.column||(q.column=[])).push(xmlNode)-1));
apf.setNodeValue(htmlEl,"&nbsp");}else{apf.setNodeValue(this.$getLayoutNode(cellType,"caption",oRow.appendChild(cell)),h.cvalue2(xmlNode)||"&nbsp");
}}}if(this.$bindings&&this.$bindings.color){var colorRule=this.$getDataNode("color",xmlNode);
this.$setStyleClass(oRow,colorRule?"highlight":null,colorRule?["highlight"]:null);
}var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass){this.$setStyleClass(oRow,cssClass);
if(cssClass){this.$dynCssClasses.push(cssClass);}}return oRow;};this.$updateNode=function(xmlNode,htmlNode){if(!htmlNode){return;
}var nodes=this.$head.childNodes,htmlNodes=htmlNode.childNodes,cell,p;if(!this.namevalue&&this.$curBtn){p=this.$curBtn.parentNode;
}var nodeIter,h,i=0;nodeIter=htmlNodes[0];while(nodeIter){if(nodeIter.nodeType!=1){nodeIter=nodeIter.nextSibling;
continue;}h=apf.all[nodes[i].getAttribute("hid")];cell=this.$getLayoutNode(h.tree?"treecell":"cell","caption",nodeIter)||nodeIter;
if(h.css){apf.setStyleClass(cell,(apf.lm.compile(h.css))(xmlNode));}if(h.tree){}if(h.value){if(!h.cvalue2){h.$compile("value",{nostring:true});
if(h.value){h.cvalue2.hasAml=h.value.indexOf("<a:")>-1;}}if(!h.cvalue2.hasAml){cell.innerHTML=h.cvalue2(xmlNode)||"";
}}if(h.icon){(cell.nodeType==1&&cell||cell.parentNode).style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,((h.cicon||h.$compile("icon",{nostring:true}))(xmlNode)||""))+")";
}i++;nodeIter=nodeIter.nextSibling;}if(this.$bindings&&this.$bindings.color){var colorRule=this.$getDataNode("color",xmlNode);
this.$setStyleClass(htmlNode,colorRule?"highlight":null,colorRule?["highlight"]:null);
}var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass||this.$dynCssClasses.length){this.$setStyleClass(htmlNode,cssClass,this.$dynCssClasses);
if(cssClass&&!this.$dynCssClasses.contains(cssClass)){this.$dynCssClasses.push(cssClass);
}}};this.$dblclick=function(htmlNode){var _self=this,id,cell;while(!(id=htmlNode.getAttribute(apf.xmldb.htmlIdTag))||id.indexOf("|")==-1){htmlNode=(cell=htmlNode).parentNode;
if(htmlNode.nodeType!=1){return;}}if(this.$lastEditor&&this.$lastEditor[3]==htmlNode){return;
}var h,colId=cell.className.match(/(col\d+)/)[1];for(var i=0;i<this.$headings.length;
i++){if(this.$headings[i].$className==colId){h=this.$headings[i];break;}}if(!h.editor){return;
}var xmlNode=apf.xmldb.getNode(htmlNode);var editParent=h.tree?this.$getLayoutNode("cell","caption",cell):cell;
var oEditor,editor=h.editor;var ceditor=apf.lm.compile(editor,{xpathmode:2});var nodes=editParent.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(!nodes[i].host){if(nodes[i].nodeType==1){nodes[i].style.display="none";
}else{this.$lastTextValue=nodes[i].nodeValue;nodes[i].nodeValue="";}}}if(ceditor.type==2){if(!this.$editors[editor]){var constr=apf.namespaces[apf.ns.aml].elements[editor];
var info={htmlNode:editParent,style:"position:relative;z-index:10000",value:"[{"+this.id+".selected}::"+(v=h.value).substr(1,v.length-2)+"]",focussable:false};
if(!h.tree){info.width="100%-3";}if(constr.prototype.hasFeature(apf.__MULTISELECT__)){info.caption=h.eachcaption||"[text()]";
info.eachvalue=h.eachvalue;var model;if(model=h.getAttribute("model")){info.model=model;
info.each=h.each;}else{info.model="{"+this.id+".selected}";info.each=h.each;}}if(h.skin){info.skin=h.skin;
}oEditor=this.$editors[editor]=new constr(info);var box=apf.getBox(apf.getStyle(oEditor.$ext,"margin"));
if(box[1]||box[3]){oEditor.setAttribute("width","100%+2-"+(box[1]+box[3]));}oEditor.addEventListener("blur",function(){hideEditor.call(_self);
});oEditor.parentNode=this;oEditor.realtime=false;oEditor.$focusParent=this;oEditor.setAttribute("focussable","true");
oEditor.addEventListener("keydown",function(e){if(e.keyCode==13){hideEditor.call(_self);
_self.$focus();}else{if(e.keyCode==27){oEditor.removeAttribute("value");hideEditor.call(_self);
}}});oEditor.$executeAction=function(){this.parentNode.$executeAction.apply(this.parentNode,arguments);
};}else{oEditor=this.$editors[editor];if(oEditor.hasFeature(apf.__MULTISELECT__)&&!h.model){oEditor.setAttribute("value","[{"+this.id+".selected}::"+(v=h.value).substr(1,v.length-2)+"]");
}oEditor.setProperty("visible",true);editParent.appendChild(oEditor.$ext);oEditor.setAttribute("width",h.tree?"":"100%-3");
}}else{var obj=ceditor.call(this,this.xmlRoot);if(obj.localName=="template"){}else{}}if(oEditor.localName=="textbox"){oEditor.select();
}oEditor.focus();oEditor.$focus();this.$setStyleClass(htmlNode,"editing");this.$lastEditor=[oEditor,editParent,xmlNode,htmlNode,this.getActionTracker().undolength];
};this.addEventListener("mousedown",function(e){if(this.$lastEditor&&!apf.isChildOf(this.$lastEditor[1],e.htmlEvent.srcElement||e.htmlEvent.target,true)){hideEditor.call(this);
}});var hideEditor=function(e){if(this.$lastEditor){var ed=this.$lastEditor;this.$lastEditor=null;
if(ed[0].hasFeature(apf.__MULTISELECT__)){ed[0].$clearDynamicProperty("value");
}ed[0].setProperty("visible",false);var nodes=ed[1].childNodes;for(var i=0,l=nodes.length;
i<l;i++){if(!nodes[i].host){if(nodes[i].nodeType==1){nodes[i].style.display="";
}else{if(!ed[0].value){nodes[i].nodeValue=this.$lastTextValue;}}}}this.$setStyleClass(ed[3],"",["editing"]);
this.focus();}};this.addEventListener("beforeselect",hideEditor);this.getColumn=function(nr){return this.$headings[nr||this.$lastcol||0];
};this.resizeColumn=function(nr,newsize){var h=this.$headings[nr];h.resize(newsize);
};this.hideColumn=function(nr){var h=this.$headings[nr];h.hide();};this.showColumn=function(nr){var h=this.$headings[nr];
h.show();};this.sortColumn=function(hid){var h=this.$headings[nr];h.sort();};this.moveColumn=function(from,to){var h=this.$headings[nr];
h.move(to);};this.$draw=function(){this.$drawBase();var _self=this;this.$ext.onmousedown=function(e){_self.dispatchEvent("mousedown",{htmlEvent:e||event});
};this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);
if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$container.firstChild){this.$container.removeChild(this.$container.firstChild);
}var widthdiff=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";
this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);
if(this.$useiframe&&!this.oIframe){var sClass=this.$container.className;this.oIframe=this.$container.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));
this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;
this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');
this.$container=this.oDoc.body;this.$container.className=sClass;this.oDoc.documentElement.className=this.$ext.className;
apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);
if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,"overflowY")=="auto"){this.oIframe.onresize=function(){_self.$head.style.marginRight=_self.oDoc.documentElement.scrollHeight>_self.oDoc.documentElement.offsetHeight?"16px":"0";
};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);
}this.oDoc.documentElement.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.oDoc.documentElement.scrollLeft;
}};}else{if(apf.getStyle(this.$container,"overflowY")=="auto"){this.$resize=function(){_self.$head.style.marginRight=_self.$container.scrollHeight>_self.$container.offsetHeight?"16px":"0";
};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");
apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);
}this.$container.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.$container.scrollLeft;
}};}this.$container[this.clickedit?"onmousedown":"ondblclick"]=function(e){if(!e){e=event;
}_self.$dblclick(e.srcElement||e.target);};};this.$destroy=function(){this.$ext.onclick=this.$container.onresize=null;
apf.layout.removeRule(this.$container,"dg"+this.$uniqueId);apf.layout.activateRules(this.$container);
};}).call(apf.datagrid.prototype=new apf.BaseTree());apf.aml.setElement("datagrid",apf.datagrid);
apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);
apf.aml.setElement("contents",apf.BindingRule);if(apf.hasRequireJS){define("apf/elements/debugger",["module"],function(module){apf.dbg=module.exports=function(struct,tagName){this.$init(tagName||"debugger",apf.NODE_HIDDEN,struct);
};(function(){this.$host=null;this.$debugger=null;this.$supportedProperties.push("state-running","state-attached","model-sources","model-stacks","model-breakpoints","activeframe");
this.$createModelPropHandler=function(name,xml,callback){return function(value){if(!value){return;
}this[name]=apf.setReference(value,apf.nameserver.register("model",value,new apf.model()));
this[name].id=this[name].name=value;this[name].load(xml);};};this.$createStatePropHandler=function(name){return function(value){if(!value){return;
}this[name]=apf.setReference(value,apf.nameserver.register("state",value,new apf.state()));
this[name].id=this[name].name=value;this[name].deactivate();};};this.$propHandlers["model-sources"]=this.$createModelPropHandler("$mdlSources","<sources />");
this.$propHandlers["model-stack"]=this.$createModelPropHandler("$mdlStack","<frames />");
this.$propHandlers["model-breakpoints"]=this.$createModelPropHandler("$mdlBreakpoints","<breakpoints />");
this.$propHandlers["state-running"]=this.$createStatePropHandler("$stRunning");
this.$propHandlers["state-attached"]=this.$createStatePropHandler("$stAttached");
this.$propHandlers.activeframe=function(value){if(this.$debugger){this.$ignoreFrameEvent=true;
this.$debugger.setFrame(value);this.$ignoreFrameEvent=false;}this.dispatchEvent("changeframe",{data:value});
};this.attach=function(host,tab){var _self=this;host.$attach(this,tab,function(err,dbgImpl){_self.$host=host;
_self.$debugger=dbgImpl;dbgImpl.addEventListener("afterCompile",_self.$onAfterCompile.bind(_self));
_self.$stAttached.activate();_self.$stRunning.setProperty("active",dbgImpl.isRunning());
dbgImpl.addEventListener("changeRunning",_self.$onChangeRunning.bind(_self));dbgImpl.addEventListener("break",_self.$onBreak.bind(_self));
dbgImpl.addEventListener("detach",_self.$onDetach.bind(_self));dbgImpl.addEventListener("changeFrame",_self.$onChangeFrame.bind(_self));
_self.$loadSources(function(){dbgImpl.setBreakpoints(_self.$mdlBreakpoints,function(){_self.$debugger.backtrace(_self.$mdlStack,function(){var frame=_self.$mdlStack.queryNode("frame[1]");
if(frame){var scriptId=frame.getAttribute("scriptid");var scriptName=_self.$mdlSources.queryValue("file[@scriptid='"+scriptId+"']/@scriptname");
if(scriptName){var line=frame.getAttribute("line");var bp=_self.$mdlBreakpoints.queryNode("breakpoint[@script='"+scriptName+"' and @line='"+line+"']");
}if(!scriptName||!bp){_self.$debugger.continueScript();}}});});});});};this.$onChangeRunning=function(){var isRunning=this.$debugger&&this.$debugger.isRunning();
if(this.$stRunning.active&&!isRunning){this.$onBreak();}this.$stRunning.setProperty("active",isRunning);
};this.$onBreak=function(){var _self=this;if(!this.$debugger||this.$debugger.isRunning()){return;
}this.$debugger.backtrace(this.$mdlStack,function(){_self.dispatchEvent("break");
});};this.$onAfterCompile=function(e){var id=e.script.getAttribute("id");var oldNode=this.$mdlSources.queryNode("//file[@id='"+id+"']");
if(oldNode){this.$mdlSources.removeXml(oldNode);}this.$mdlSources.appendXml(e.script);
};this.$onDetach=function(){if(this.$debugger){this.$debugger.destroy();this.$debugger=null;
}this.$host=null;this.$mdlSources.load("<sources />");this.$mdlStack.load("<frames />");
this.$stAttached.deactivate();this.setProperty("activeframe",null);};this.$onChangeFrame=function(){if(!this.$ignoreFrameEvent){this.setProperty("activeframe",this.$debugger.getActiveFrame());
}};this.changeFrame=function(frame){this.$debugger.setFrame(frame);};this.detach=function(callback){this.continueScript();
if(this.$host){this.$host.$detach(this.$debugger,callback);}else{this.$onDetach();
}};this.$loadSources=function(callback){this.$debugger.scripts(this.$mdlSources,callback);
};this.loadScript=function(script,callback){this.$debugger.loadScript(script,callback);
};this.loadObjects=function(item,callback){this.$debugger.loadObjects(item,callback);
};this.loadFrame=function(frame,callback){this.$debugger.loadFrame(frame,callback);
};this.toggleBreakpoint=function(script,row){var model=this.$mdlBreakpoints;if(this.$debugger){this.$debugger.toggleBreakpoint(script,row,model);
}else{var scriptName=script.getAttribute("scriptname");var bp=model.queryNode("breakpoint[@script='"+scriptName+"' and @line='"+row+"']");
if(bp){model.removeXml(bp);}else{var bp=apf.n("<breakpoint/>").attr("script",scriptName).attr("line",row).attr("text",script.getAttribute("path")+":"+row).attr("lineoffset",0).node();
model.appendXml(bp);}}};this.continueScript=function(callback){this.dispatchEvent("beforecontinue");
if(this.$debugger){this.$debugger.continueScript(callback);}else{callback&&callback();
}};this.stepInto=function(){this.dispatchEvent("beforecontinue");this.$debugger&&this.$debugger.stepInto();
};this.stepNext=function(){this.dispatchEvent("beforecontinue");this.$debugger&&this.$debugger.stepNext();
};this.stepOut=function(){this.dispatchEvent("beforecontinue");this.$debugger&&this.$debugger.stepOut();
};this.suspend=function(){this.$debugger&&this.$debugger.suspend();};this.evaluate=function(expression,frame,global,disableBreak,callback){this.$debugger&&this.$debugger.evaluate(expression,frame,global,disableBreak,callback);
};this.changeLive=function(scriptId,newSource,previewOnly,callback){this.$debugger&&this.$debugger.changeLive(scriptId,newSource,previewOnly,callback);
};}).call(apf.dbg.prototype=new apf.AmlElement());apf.aml.setElement("debugger",apf.dbg);
window.adbg={exec:function(method,args,callback,options){if(method=="loadScript"){var dbg=args[0];
var script=args[1];dbg.loadScript(script,function(source){if(options&&options.callback){options.callback(apf.escapeXML(source),apf.SUCCESS);
}else{callback("<file><![CDATA["+source.replace("]]>","]] >")+"]]></file>",apf.SUCCESS);
}});}else{if(method=="loadObjects"){var dbg=args[0];var item=args[1];dbg.loadObjects(item,function(xml){if(options&&options.callback){options.callback(xml,apf.SUCCESS);
}else{callback(xml,apf.SUCCESS);}});}else{if(method=="loadFrame"){var dbg=args[0];
var frame=args[1];dbg.loadFrame(frame,function(xml){if(options&&options.callback){options.callback(xml,apf.SUCCESS);
}else{callback(xml,apf.SUCCESS);}});}}}}};(apf.$asyncObjects||(apf.$asyncObjects={}))["adbg"]=1;
});}if(apf.hasRequireJS){define("apf/elements/debughost",["module","apf/elements/dbg/chromedebughost","apf/elements/dbg/v8debughost","apf/elements/dbg/v8websocketdebughost"],function(module,ChromeDebugHost,V8DebugHost,V8WebSocketDebugHost){apf.debughost=module.exports=function(struct,tagName){this.$init(tagName||"debughost",apf.NODE_HIDDEN,struct);
};(function(){this.port=9222;this.server="localhost";this.type="chrome";this.autoinit=false;
this.$modelTabs=null;this.$stateConnected=null;this.$host=null;this.$booleanProperties.autostart=true;
this.$supportedProperties.push("port","server","type","autoinit","model-tabs","state-connected","strip");
this.$propHandlers["model-tabs"]=function(value){if(!value){return;}this.$modelTabs=apf.nameserver.get("model",value)||apf.setReference(value,apf.nameserver.register("model",value,new apf.model()));
this.$modelTabs.id=this.$modelTabs.name=value;this.$modelTabs.load("<tabs/>");};
this.$propHandlers["state-connected"]=function(value){if(!value){return;}this.$stateConnected=apf.nameserver.get("state",value)||apf.setReference(value,apf.nameserver.register("state",value,new apf.state()));
this.$stateConnected.id=this.$stateConnected.name=value;this.$stateConnected.deactivate();
};this.init=function(){if(this.$host){return;}if(this.type=="chrome"||this.type=="v8"||this.type=="v8-ws"){if(!apf.debughost.$o3obj&&this.type!=="v8-ws"){apf.debughost.$o3obj=window.o3Obj||o3.create("8A66ECAC-63FD-4AFA-9D42-3034D18C88F4",{oninstallprompt:function(){alert("can't find o3 plugin");
},product:"O3Demo"});}if(this.type=="chrome"){this.$host=new ChromeDebugHost(this.server,this.port,apf.debughost.$o3obj);
}else{if(this.type=="v8"){this.$host=new V8DebugHost(this.server,this.port,apf.debughost.$o3obj);
}else{if(this.type=="v8-ws"){var socket=this.dispatchEvent("socketfind");if(!socket){throw new Error("no socket found!");
}this.$host=new V8WebSocketDebugHost(socket);}else{if(this.type=="chrome-ws"){var socket=this.dispatchEvent("socketfind");
if(!socket){throw new Error("no socket found!");}this.$host=new ChromeDebugHost(null,null,null,socket);
}}}}var self=this;this.$host.addEventListener("connect",function(){self.dispatchEvent("connect");
self.$stateConnected.activate();});this.$host.addEventListener("disconnect",function(){self.dispatchEvent("disconnect");
self.$stateConnected.deactivate();});this.loadTabs();}};this.loadTabs=function(){if(!this.$host){this.init();
}var self=this;this.$host.loadTabs(this.$modelTabs,function(){self.$dispatchEvent("tabsloaded");
});};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.autoinit){this.init();
}});this.$attach=function(dbg,tab,callback){if(!this.$host){this.init();}var id=tab?tab.getAttribute("id"):null;
var _self=this;this.$host.attach(id,function(err,dbg){dbg.setStrip(_self.strip||"");
callback(err,dbg);});};this.$detach=function(dbgImpl,callback){if(!this.$host){return;
}this.$host.detach(dbgImpl,callback);};this.disconnect=function(){if(!this.$host){return;
}this.$host.disconnect();this.$host=null;};}).call(apf.debughost.prototype=new apf.AmlElement());
apf.aml.setElement("debughost",apf.debughost);});}apf.defaults=function(struct,tagName){this.$init(tagName||"services",apf.NODE_HIDDEN,struct);
};(function(){this.$parsePrio="002";this.$propHandlers["for"]=function(value){if(this.$lastFor){apf.nameserver.remove("defaults_"+this.$lastFor,this);
}apf.nameserver.add("defaults_"+value,this);this.$lastFor=value;};this.addEventListener("DOMNodeRemovedFromDocument",function(e){apf.nameserver.remove("defaults_"+this.$lastFor,this);
});}).call(apf.defaults.prototype=new apf.AmlElement());apf.aml.setElement("defaults",apf.defaults);
apf.divider=function(struct,tagName){this.$init(tagName||"divider",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.implement(apf.ChildValue);this.$childProperty="caption";
this.addEventListener("AMLReparent",function(beforeNode,pNode,withinParent){if(!this.$amlLoaded){return;
}if(!withinParent&&this.skinName!=pNode.skinName){this.loadAml();}});this.$supportedProperties.push("caption","value","for","textalign");
this.$propHandlers.caption=function(value){if(this.$caption){this.$setStyleClass(this.$ext,this.$baseCSSname+"Caption");
this.$caption.innerHTML=value;}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Caption"]);
}};this.$canLeechSkin=true;this.$draw=function(){if(this.parentNode.isPaged&&this.parentNode.$buttons){this.$pHtmlNode=this.parentNode.$buttons;
}if(this.$isLeechingSkin){this.$ext=apf.insertHtmlNode(this.parentNode.$getLayoutNode("divider"),this.$pHtmlNode);
}else{this.$ext=this.$getExternal("main");this.$caption=this.$getLayoutNode("main","caption",this.$ext);
}};}).call(apf.divider.prototype=new apf.Presentation);apf.aml.setElement("divider",apf.divider);
apf.dropdown=function(struct,tagName){this.$init(tagName||"dropdown",apf.NODE_VISIBLE,struct);
};(function(){this.$animType=1;this.$animSteps=5;this.$animSpeed=20;this.$itemSelectEvent="onmouseup";
this.dragdrop=false;this.reselectable=true;this.$focussable=apf.KEYBOARD;this.autoselect=false;
this.multiselect=false;this.disableremove=true;this.delayedselect=false;this.maxitems=5;
this.$booleanProperties.disableremove=true;this.$supportedProperties.push("maxitems","disableremove","initial-message","fill");
this.$propHandlers.maxitems=function(value){this.sliderHeight=value?(Math.min(this.maxitems||100,value)*this.itemHeight):10;
this.containerHeight=value?(Math.min(this.maxitems||100,value)*this.itemHeight):10;
};this.addEventListener("prop.class",function(e){this.$setStyleClass(this.oSlider,e.value);
});this.slideToggle=function(e,userAction){if(!e){e=event;}if(userAction&&this.disabled){return;
}if(this.isOpen){this.slideUp();}else{this.slideDown(e);}};this.slideDown=function(e){if(this.dispatchEvent("slidedown")===false){return false;
}this.isOpen=true;this.$propHandlers.maxitems.call(this,this.xmlRoot&&this.each?this.getTraverseNodes().length:this.childNodes.length);
this.oSlider.style.display="block";if(!this.ignoreOverflow){this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="visible";
this.$container.style.overflowY="hidden";}this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");
this.oSlider.style.height=(this.sliderHeight-1)+"px";this.oSlider.style.width=(this.$ext.offsetWidth-2-this.widthdiff)+"px";
var _self=this;var _popupCurEl=apf.popup.getCurrentElement();apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,container:this.$getLayoutNode("container","contents",this.oSlider),ref:this.$ext,width:this.$ext.offsetWidth-this.widthdiff,height:this.containerHeight,allowTogether:(_popupCurEl&&apf.isChildOf(_popupCurEl.$ext,_self.$ext)),callback:function(container){if(!_self.ignoreOverflow){_self.$container.style.overflowY="auto";
}}});};this.slideUp=function(){if(this.isOpen==2){return false;}if(this.dispatchEvent("slideup")===false){return false;
}this.isOpen=false;if(this.selected){var htmlNode=apf.xmldb.findHtmlNode(this.selected,this);
if(htmlNode){this.$setStyleClass(htmlNode,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);
apf.popup.hide();return false;};this.$setLabel=function(value){this.oLabel.innerHTML=value||this["initial-message"]||"";
this.$setStyleClass(this.$ext,value?"":this.$baseCSSname+"Initial",!value?[]:[this.$baseCSSname+"Initial"]);
};this.addEventListener("afterselect",function(e){if(!e){e=event;}this.slideUp();
if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(e.selection.length?this.$applyBindRule("caption",this.selected):"");
});function setMaxCount(){if(this.isOpen==2){this.slideDown();}}this.addEventListener("afterload",setMaxCount);
this.addEventListener("xmlupdate",function(){setMaxCount.call(this);this.$setLabel(this.$applyBindRule("caption",this.selected));
});this.$blur=function(){this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$setClearMessage=function(msg){this.$setLabel(msg);
};this.$removeClearMessage=function(){this.$setLabel("");};this.addEventListener("popuphide",this.slideUp);
this.addEventListener("keydown",function(e){var key=e.keyCode;if(!this.xmlRoot){return;
}var node;switch(key){case 32:this.slideToggle(e.htmlEvent);break;case 38:if(e.altKey){this.slideToggle(e.htmlEvent);
return;}if(!this.selected){return;}node=this.getNextTraverseSelected(this.caret||this.selected,false);
if(node){this.select(node);}break;case 40:if(e.altKey){this.slideToggle(e.htmlEvent);
return;}if(!this.selected){node=this.getFirstTraverseNode();if(!node){return;}}else{node=this.getNextTraverseSelected(this.selected,true);
}if(node){this.select(node);}break;default:if(key==9||!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>1000){this.lookup={str:"",date:new Date()};
}this.lookup.str+=String.fromCharCode(key);var caption,nodes=this.getTraverseNodes();
for(var i=0;i<nodes.length;i++){caption=this.$applyBindRule("caption",nodes[i]);
if(caption&&caption.indexOf(this.lookup.str)>-1){this.select(nodes[i]);return;}}return;
}return false;},true);this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");
this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";
this.$ext=this.$getExternal(null,null,function(oExt){oExt.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');o.$setStyleClass(o.$ext, o.$baseCSSname + "Over", null, true);');
oExt.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');if(o.isOpen) return;o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"], true);');
var oButton=this.$getLayoutNode("main","button",oExt);if(oButton){oButton.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");
}var oLabel=this.$getLayoutNode("main","label",oExt);if(this.clickOpen=="both"){oLabel.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");
}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;
}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);
}this.oSlider=apf.insertHtmlNode(this.$getLayoutNode("container"),document.body);
this.$container=this.$getLayoutNode("container","contents",this.oSlider);this.$container.host=this;
this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));
this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;this.itemHeight=this.$getOption("main","item-height")||18.5;
this.widthdiff=this.$getOption("main","width-diff")||0;this.ignoreOverflow=apf.isTrue(this.$getOption("main","ignore-overflow"))||false;
};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");
}if(!this.selected&&this["initial-message"]){this.$setLabel();}});this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);
apf.destroyHtmlNode(this.oSlider);this.oSlider=null;};}).call(apf.dropdown.prototype=new apf.BaseList());
apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("dropdown",apf.dropdown);
apf.errorbox=function(struct,tagName){this.$init(tagName||"errorbox",apf.NODE_VISIBLE,struct);
};(function(){this.$positioning="basic";this.display=function(host){this.host=host;
var refHtml=host.validityState&&host.validityState.$errorHtml||host.$ext;document.body.appendChild(this.$ext);
var x=(parseFloat(host.$getOption&&host.$getOption("main","erroffsetx")||0)),y=(parseFloat(host.$getOption&&host.$getOption("main","erroffsety")||0));
this.show();apf.popup.show(this.$uniqueId,{x:x,y:y,animate:false,ref:refHtml,allowTogether:true});
this.$setStyleClass(this.$ext,x+this.$ext.offsetWidth>this.$ext.offsetParent.offsetWidth?"rightbox":"leftbox",["leftbox","rightbox"]);
};this.setMessage=function(value){if(value&&value.indexOf(";")>-1){value=value.split(";");
value="<strong>"+value.shift()+"</strong>"+value.join(";");}this.$int.innerHTML=value||"";
};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
this.oClose=this.$getLayoutNode("main","close",this.$ext);if(this.oClose){var _self=this;
this.oClose.onclick=function(){_self.hide();if(apf.document.activeElement){apf.document.activeElement.focus(true,{mouse:true});
}};}this.$ext.onmousedown=function(e){(e||event).cancelBubble=true;if(apf.hasFocusBug){apf.window.$focusfix();
}};apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(x){if(!apf.isTrue(this.getAttribute("visible"))){this.hide();
}};this.$destroy=function(){if(this.oClose){this.oClose.onclick=null;}this.$ext.onmousedown=null;
apf.popup.removeContent(this.$uniqueId);};}).call(apf.errorbox.prototype=new apf.Presentation());
apf.aml.setElement("errorbox",apf.errorbox);apf.event=function(struct,tagName){this.$init(tagName||"event",apf.NODE_HIDDEN,struct);
};(function(){this.$hasInitedWhen=false;this.$booleanProperties.repeat=true;this.$supportedProperties.push("when","message","icon","repeat");
this.$propHandlers.when=function(value){if(this.$hasInitedWhen&&value&&this.parentNode&&this.parentNode.popup){var _self=this;
$setTimeout(function(){_self.parentNode.popup(_self.message,_self.icon,_self);});
}this.$hasInitedWhen=true;if(this.repeat){delete this.when;}};this.$loadAml=function(x){};
}).call(apf.event.prototype=new apf.AmlElement());apf.aml.setElement("event",apf.event);
apf.filler=function(struct,tagName){this.$init(tagName||"filler",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.flex=1;this.$draw=function(){this.$ext=this.$pHtmlNode.appendChild(this.$pHtmlNode.ownerDocument.createElement("div"));
};}).call(apf.filler.prototype=new apf.GuiElement());apf.aml.setElement("filler",apf.filler);
apf.panel=function(struct,tagName){this.$init(tagName||"panel",apf.NODE_VISIBLE,struct);
};apf.fieldset=function(struct,tagName){this.$init(tagName||"fieldset",apf.NODE_VISIBLE,struct);
};apf.frame=function(struct,tagName){this.$init(tagName||"submit",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.BaseStateButtons);this.$focussable=false;this.$supportedProperties.push("caption","url");
this.$propHandlers.caption=function(value){if(!this.oCaption){return;}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=value;
}else{this.oCaption.nodeValue=value;}};this.$propHandlers.icon=function(value){var oIcon=this.$getLayoutNode("main","icon",this.$ext);
if(!oIcon){return;}if(oIcon.nodeType==1){oIcon.style.display=value?"block":"none";
}apf.skins.setIcon(oIcon,value,this.iconPath);};this.$propHandlers.url=function(value){var node=this.oCaption;
if(node.tagName=="A"||node.nodeType!=1){node=node.parentNode;}node.innerHTML="<a href='"+value+"' "+(value.match(/^http:\/\//)?"target='_blank'":"")+">"+this.caption+"</a>";
this.oCaption=this.oCaption.firstChild;};this.setTitle=function(value){this.setProperty("title",value);
};this.$draw=function(){this.$ext=this.$getExternal(null,null,function(oExt){this.$initButtons(oExt);
});this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$int=this.$getLayoutNode("main","container",this.$ext);
this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);};this.$loadAml=function(x){};
}).call(apf.frame.prototype=new apf.Presentation());apf.panel.prototype=apf.fieldset.prototype=apf.frame.prototype;
apf.aml.setElement("panel",apf.panel);apf.aml.setElement("fieldset",apf.fieldset);
apf.aml.setElement("frame",apf.frame);apf.hbox=function(struct,tagName){this.$init(tagName||"hbox",apf.NODE_VISIBLE,struct);
};apf.vbox=function(struct,tagName){this.$init(tagName||"vbox",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$useLateDom=true;this.$box=true;this.$layout=true;
var MOZSTACK="-moz-stack";var input={INPUT:1,SELECT:1,TEXTAREA:1};this.$booleanProperties.splitters=true;
this.$supportedProperties.push("padding","reverse","edge","pack","align","splitters");
this.$propHandlers.padding=function(value){this.padding=parseInt(value);var node,nodes=this.childNodes,elms=[];
for(var i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeFunc==apf.NODE_VISIBLE&&node.$amlLoaded&&node.visible!==false){elms.push(node);
}}if(!elms.length){return;}for(var last,b,el,i=elms.length-2;i>=0;i--){b=(el=elms[i]).margin&&apf.getBox(el.margin)||[0,0,0,0];
if((!last||!last.$splitter)&&!el.$splitter){b[this.$vbox?2:1]+=this.padding;if(!apf.hasFlexibleBox&&i!=0&&this.align=="stretch"&&this.$vbox){b[0]+=this.padding;
}}el.$ext.style.margin=b.join("px ")+"px";last=el;}b=(el=elms[elms.length-1]).margin&&apf.getBox(el.margin)||[0,0,0,0];
el.$ext.style.margin=b.join("px ")+"px";if(!apf.hasFlexibleBox){this.$resize();
}};this.$propHandlers.reverse=function(value){if(apf.hasFlexibleBox){this.$int.style[apf.CSSPREFIX+"BoxDirection"]=value?"reverse":"normal";
}else{}};this.$propHandlers.edge=function(value){var el=!apf.hasFlexibleBox&&this.$vbox?this.$ext:this.$int;
el.style.padding=(this.$edge=apf.getBox(value)).join("px ")+"px";if(!apf.hasFlexibleBox){this.$resize();
}};this.$propHandlers.pack=function(value){if(apf.hasFlexibleBox){this.$int.style[apf.CSSPREFIX+"BoxPack"]=value||"start";
}else{if(this.$amlLoaded){if(this.$vbox){this.$int.style.verticalAlign=value=="center"?"middle":(value=="end"?"bottom":"top");
}else{this.$int.style.textAlign="";var nodes=this.childNodes;for(var i=0,l=nodes.length;
i<l;i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||!node.$amlLoaded){continue;
}node.$ext.style.textAlign=apf.getStyle(node.$ext,"textAlign")||"left";}this.$int.style.textAlign=value=="center"?"center":(value=="end"?"right":"left");
}}}};this.$propHandlers.align=function(value){if(apf.hasFlexibleBox){this.$int.style[apf.CSSPREFIX+"BoxAlign"]=value||"stretch";
if(apf.isGecko){this.$int.style.overflow="visible";}var stretch=!value||value=="stretch";
var nodes=this.childNodes;var size=this.$vbox?"width":"height";var isInFixed=false,loopNode=this;
while(!isInFixed&&loopNode){isInFixed=loopNode[size]||loopNode.anchors||(loopNode.$vbox?loopNode.top&&loopNode.bottom:loopNode.left&&loopNode.right);
if(!loopNode.flex){break;}loopNode=loopNode.parentNode||loopNode.$parentNode;}for(var i=0,l=nodes.length;
i<l;i++){if(!(node=nodes[i]).$ext||node.$ext.nodeType!=1){continue;}if(stretch&&!node[size]){node.$ext.style[size]=apf.isGecko&&(this.flex||node.flex)?(isInFixed?"1px":"auto"):(apf.isWebkit&&input[node.$ext.tagName]?"100%":(apf.isWebkit&&node[this.$vbox?"minwidth":"minheight"]&&this.flex?"0px":"auto"));
}else{if(node[size]){handlers["true"][size].call(node,node[size]);}}}}else{if(this.$amlLoaded){var stretch=!value||value=="stretch";
if(!this.$vbox){var nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||!node.$amlLoaded){continue;
}node.$ext.style.verticalAlign=value=="center"?"middle":(value=="end"?"bottom":"top");
}}else{var el=!apf.hasFlexibleBox&&this.$vbox?this.$ext:this.$int;el.style.textAlign="";
var nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||!node.$amlLoaded){continue;
}if(node.visible!==false){node.$ext.style.display=value=="stretch"?"block":apf.INLINE;
node.$br.style.display=value=="stretch"?"none":"";if(apf.needZoomForLayout){node.$ext.style.zoom=1;
}}node.$ext.style.textAlign=apf.getStyle(node.$ext,"textAlign")||"left";}el.style.textAlign=value=="center"?"center":(value=="end"?"right":"left");
}}}};function visibleHandler(e){if(this.parentNode.splitters&&!this.$splitter){if(!e.value){if(this.nextSibling&&this.nextSibling.$splitter){this.nextSibling.removeNode();
}else{if(this.previousSibling&&this.previousSibling.$splitter){this.previousSibling.removeNode();
}}}else{var isLast=isLastVisibleChild(this);if(!isLast){if(!this.nextSibling.$splitter&&!this.nextSibling.nosplitter){this.parentNode.insertBefore(this.ownerDocument.createElementNS(apf.ns.aml,"splitter"),this.nextSibling);
}}else{if(this.previousSibling&&!this.previousSibling.$splitter&&!this.previousSibling.nosplitter){this.parentNode.insertBefore(this.ownerDocument.createElementNS(apf.ns.aml,"splitter"),this);
}}}}this.parentNode.$propHandlers.padding.call(this.parentNode,this.parentNode.padding);
apf.layout.forceResize(this.parentNode.$int);if(apf.hasFlexibleBox){if(this.$altExt){this.$altExt.style.display=e.value?(apf.isGecko?MOZSTACK:apf.CSSPREFIX2+"-box"):"none";
}return;}if(e.value){this.$ext.style.display=this.parentNode.$vbox&&this.parentNode.align=="stretch"?"block":apf.INLINE;
if(apf.needZoomForLayout){this.$ext.style.zoom=1;}if(this.$br){this.$br.style.display=this.parentNode.align=="stretch"?"none":"";
}}else{if(this.$br){this.$br.style.display="none";}}this.parentNode.$resize();}function resizeHandler(){if(!this.flex){if(this.$isRszHandling||this.$lastSizeChild&&this.$lastSizeChild[0]==this.$ext.offsetWidth&&this.$lastSizeChild[1]==this.$ext.offsetHeight){return;
}this.parentNode.$resize(true);this.$lastSizeChild=[this.$ext.offsetWidth,this.$ext.offsetHeight];
}}var handlers={"true":{optimize:function(value){this.optimize=apf.isTrue(value);
},width:function(value){(this.$altExt||this.$ext).style.width=value?(parseFloat(value)==value?value+"px":value):"";
},height:function(value){(this.$altExt||this.$ext).style.height=value?(parseFloat(value)==value?value+"px":value):(apf.isGecko&&this.flex&&this.parentNode.$vbox?"auto":"");
},margin:function(value){var b=apf.getBox(value);if(!isLastVisibleChild(this)){b[this.parentNode.$vbox?2:1]+=this.parentNode.padding;
}this.$ext.style.margin=b.join("px ")+"px";},flex:function(value){this.flex=value=parseInt(value);
if(value){if(!this.optimize&&!this.$altExt){this.$altExt=this.$ext.ownerDocument.createElement("div");
this.parentNode.$int.replaceChild(this.$altExt,this.$ext);this.$altExt.appendChild(this.$ext);
this.$altExt.style[apf.CSSPREFIX+"BoxSizing"]="border-box";this.$altExt.style.display=apf.CSSPREFIX2+"-box";
this.$altExt.style[apf.CSSPREFIX+"BoxOrient"]="vertical";this.$ext.style[apf.CSSPREFIX+"BoxFlex"]=1;
var size=this.parentNode.$vbox?"height":"width";if(apf.isWebkit){if(!this.preventforcezero){this.$altExt.style[size]="0px";
}}else{if(apf.isGecko){this.$altExt.style[size]="0px";if(!this.$box){this.$altExt.style.overflow="hidden";
}if(apf.getStyle(this.$ext,"overflow")=="visible"){this.$ext.style.overflow="hidden";
}this.$ext.style[size]="1px";this.$altExt.style.minHeight=this.$ext.style.minHeight;
this.$altExt.style.maxHeight=this.$ext.style.maxHeight;this.$altExt.style.minWidth=this.$ext.style.minWidth;
this.$altExt.style.maxWidth=this.$ext.style.maxWidth;}}}(this.$altExt||this.$ext).style[apf.CSSPREFIX+"BoxFlex"]=parseInt(value)||1;
}else{if(this.$altExt){this.parentNode.$int.replaceChild(this.$ext,this.$altExt);
this.$ext.style[apf.CSSPREFIX+"BoxFlex"]="";if(apf.isGecko){this.$ext.style.overflow="";
}delete this.$altExt;}}}},"false":{width:function(value){this.$ext.style.width=value?(parseFloat(value)==value?Math.max(0,value-apf.getWidthDiff(this.$ext))+"px":value):"";
},height:function(value){this.$ext.style.height=value?(parseFloat(value)==value?Math.max(0,value-apf.getHeightDiff(this.$ext))+"px":value):"";
},margin:function(value){var b=apf.getBox(value);if(this.padding){if(!isLastVisibleChild(this)){b[this.parentNode.$vbox?2:1]+=this.padding;
}if(this!=this.parentNode.firstChild&&this.parentNode.align=="stretch"&&this.parentNode.$vbox){b[0]+=this.padding;
}}this.$ext.style.margin=b.join("px ")+"px";},flex:function(value){this.flex=parseInt(value);
if(this.$amlLoaded){this.parentNode.$resize(true);}}}};function isLastVisibleChild(amlNode){var lastChild=amlNode.parentNode.lastChild;
while(lastChild&&(lastChild.nodeFunc!=apf.NODE_VISIBLE||lastChild.visible===false||lastChild.visible==2&&apf.isFalse(lastChild.getAttribute("visible")))){lastChild=lastChild.previousSibling;
}return lastChild&&lastChild==amlNode;}this.register=function(amlNode,insert){if(amlNode.$altExt){return;
}amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=apf.K;
var propHandlers=handlers[apf.hasFlexibleBox];for(var prop in propHandlers){amlNode.$propHandlers[prop]=propHandlers[prop];
}if(amlNode.nodeFunc==apf.NODE_VISIBLE){if(apf.hasFlexibleBox){if(amlNode.$ext.tagName=="INPUT"||apf.isWebkit&&input[amlNode.$ext.tagName]){var doc=amlNode.$ext.ownerDocument;
amlNode.$altExt=doc.createElement("div");amlNode.parentNode.$int.replaceChild(amlNode.$altExt,amlNode.$ext);
amlNode.$altExt.style[apf.CSSPREFIX+"BoxSizing"]="border-box";amlNode.$altExt.appendChild(amlNode.$ext);
if(apf.isWebkit){var d=apf.getDiff(amlNode.$ext);amlNode.$altExt.style.height="100%";
amlNode.$altExt.style.width="0";amlNode.$altExt.style.lineHeight=0;amlNode.$altExt.style.margin="-1px 0 0 0";
amlNode.$ext.style.width="100%";amlNode.$ext.style.height="100%";amlNode.$ext.style.top="1px";
amlNode.$ext.style.position="relative";}else{amlNode.$altExt.style.display=apf.CSSPREFIX2+"-box";
amlNode.$altExt.style[apf.CSSPREFIX+"BoxOrient"]="horizontal";amlNode.$altExt.style[apf.CSSPREFIX+"BoxAlign"]="stretch";
amlNode.$ext.style[apf.CSSPREFIX+"BoxFlex"]=1;}}else{if(apf.getStyle(amlNode.$ext,"display")=="inline"){amlNode.$ext.style.display="block";
}}amlNode.$ext.style[apf.CSSPREFIX+"BoxSizing"]="border-box";}else{if(this.$vbox){amlNode.$br=this.$int.insertBefore(amlNode.$ext.ownerDocument.createElement("br"),amlNode.$ext.nextSibling);
if(amlNode.visible===false){amlNode.$br.style.display="none";}}else{if(amlNode.visible!==false){amlNode.$ext.style.display=apf.INLINE;
if(apf.needZoomForLayout){amlNode.$ext.style.zoom=1;}}this.$int.style.whiteSpace="";
amlNode.$ext.style.whiteSpace=apf.getStyle(amlNode.$ext,"whiteSpace")||"normal";
this.$int.style.whiteSpace="nowrap";}this.$int.style.fontSize="0";if(!amlNode.$box){var fontSize=apf.getStyle(amlNode.$ext,"fontSize");
if(fontSize=="0px"){amlNode.$ext.style.fontSize="";var pNode=this.$int.parentNode;
while(apf.getStyle(pNode,"fontSize")=="0px"){pNode=pNode.parentNode;}fontSize=apf.getStyle(pNode,"fontSize");
}amlNode.$ext.style.fontSize=fontSize;}amlNode.addEventListener("resize",resizeHandler);
}amlNode.addEventListener("prop.visible",visibleHandler);this.$noResize=true;if(amlNode.height){propHandlers.height.call(amlNode,amlNode.height);
}if(amlNode.width){propHandlers.width.call(amlNode,amlNode.width);}if(amlNode.margin){propHandlers.margin.call(amlNode,amlNode.margin);
}if(amlNode.flex){propHandlers.flex.call(amlNode,amlNode.flex);}var isLast=isLastVisibleChild(amlNode);
if(isLast||insert){this.$propHandlers.padding.call(this,this.padding);this.$propHandlers.align.call(this,this.align);
if(!apf.hasFlexibleBox){this.$propHandlers.pack.call(this,this.pack);}if(amlNode.visible!==false){visibleHandler.call(amlNode,{value:true});
}if(insert&&amlNode.previousSibling){var prev=amlNode.previousSibling;while(prev&&(prev.nodeType!=1||prev.localName=="splitter")){prev=prev.previousSibling;
}if(prev){visibleHandler.call(prev,{value:true});}}}else{if(this.splitters&&!amlNode.$splitter&&amlNode.visible!==false&&!amlNode.nosplitter){if(amlNode.$ext.nextSibling!=(amlNode.nextSibling&&(amlNode.nextSibling.$altExt||amlNode.nextSibling.$ext))){var _self=this;
setTimeout(function(){_self.insertBefore(_self.ownerDocument.createElementNS(apf.ns.aml,"splitter"),amlNode.nextSibling);
});}else{this.insertBefore(this.ownerDocument.createElementNS(apf.ns.aml,"splitter"),amlNode.nextSibling);
}}}delete this.$noResize;if(!apf.hasFlexibleBox&&isLast){this.$resize();}}};this.unregister=function(amlNode){amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=null;
var propHandlers=handlers[apf.hasFlexibleBox];for(var prop in propHandlers){delete amlNode.$propHandlers[prop];
}if(amlNode.nodeFunc==apf.NODE_VISIBLE){if(amlNode.flex){var flex=amlNode.flex;
propHandlers.flex.call(amlNode,0);amlNode.flex=flex;}if(apf.hasFlexibleBox){amlNode.$ext.style[apf.CSSPREFIX+"BoxSizing"]="";
if(apf.isGecko){this.$int.style.overflow="visible";if(amlNode.$ext.style.display=="block"){amlNode.$ext.style.display="";
}}}else{amlNode.$ext.style.verticalAlign="";amlNode.$ext.style.textAlign="";amlNode.$ext.style.whiteSpace="";
if(amlNode.$br){amlNode.$br.parentNode.removeChild(amlNode.$br);delete amlNode.$br;
}amlNode.removeEventListener("resize",resizeHandler);}amlNode.removeEventListener("prop.visible",visibleHandler);
amlNode.$ext.style.display=amlNode.visible?"block":"none";if(amlNode.margin){amlNode.$ext.style.margin="";
}if(amlNode.width){amlNode.$ext.style.width="";}if(this.splitters&&!amlNode.$splitter){if(amlNode.nextSibling&&amlNode.nextSibling.$splitter){amlNode.nextSibling.removeNode();
}if(isLastVisibleChild(amlNode)&&amlNode.previousSibling&&amlNode.previousSibling.$splitter){amlNode.previousSibling.removeNode();
}}}};this.addEventListener("DOMNodeRemoved",function(e){if(e.$doOnlyAdmin||e.currentTarget==this){return;
}if(e.relatedNode==this){this.unregister(e.currentTarget);}});this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this||e.currentTarget.nodeType!=1){return;
}if(e.relatedNode==this&&!e.$isMoveWithinParent){e.currentTarget.$setLayout(this.localName,true);
if(e.currentTarget.$altExt){return false;}}});function myVisibleHandler(e){if(e.value){this.$int.style.display=apf.CSSPREFIX2+"-box";
}}function myHeightHandler(e){clearInterval(this.$heighttimer);if(e.value||this.align!="stretch"){delete this.$heighttimer;
}else{if(!this.$heighttimer){var _self=this;this.$heighttimer=$setInterval(function(){if(_self.$amlDestroyed){return;
}var nodes=_self.childNodes;for(var $int,i=0,l=nodes.length;i<l;i++){if(!($int=(node=nodes[i]).$int||node.$container)){continue;
}if(Math.min($int.scrollHeight,node.maxheight||10000)>$int.offsetHeight){return _self.$resize(true);
}}if(_self.flex){clearInterval(this.$heighttimer);}},this.flex?1:500);}}}this.$draw=function(){var doc=this.$pHtmlNode.ownerDocument;
this.$ext=this.$pHtmlNode.appendChild(doc.createElement("div"));this.$ext.className=this.localName;
this.$vbox=this.localName=="vbox";this.$int=apf.isGecko&&!this.parentNode.$box||!apf.hasFlexibleBox&&this.$vbox?this.$ext.appendChild(doc.createElement("div")):this.$ext;
this.$ext.host=this;if(apf.isGecko&&!this.parentNode.$box){this.$int.style.width="100%";
this.$int.style.height="100%";}else{if(!apf.hasFlexibleBox&&this.$vbox){this.$int.style.display=apf.INLINE;
if(apf.needZoomForLayout){this.$int.style.zoom=1;}this.$int.style.width="100%";
}}if(apf.hasFlexibleBox){this.$display="-"+apf.CSSPREFIX+"-box";this.$int.style.display=apf.CSSPREFIX2+"-box";
this.$int.style[apf.CSSPREFIX+"BoxOrient"]=this.localName=="hbox"?"horizontal":"vertical";
if(apf.isGecko){this.$int.style[apf.CSSPREFIX+"BoxSizing"]="border-box";}this.$int.style[apf.CSSPREFIX+"BoxAlign"]="stretch";
this.addEventListener("prop.visible",myVisibleHandler);}else{if(!this.$vbox){this.$int.style.whiteSpace="nowrap";
this.addEventListener("prop.height",myHeightHandler);}var spacer=(!apf.hasFlexibleBox&&this.$vbox?this.$ext:this.$int).appendChild(doc.createElement("strong"));
spacer.style.height="100%";spacer.style.display=apf.INLINE;if(apf.needZoomForLayout){spacer.style.zoom=1;
}spacer.style.verticalAlign="middle";this.addEventListener("resize",this.$resize);
}if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));
}this.$originalMin=[this.minwidth||0,this.minheight||0];};this.$resize=function(force){if(!this.$amlLoaded||this.$noResize){return;
}if(force!==true&&this.$lastSize&&this.$lastSize[0]==this.$int.offsetWidth&&this.$lastSize[1]==this.$int.offsetHeight){return;
}if(!apf.window.vManager.check(this,this.$uniqueId,this.$resize)){return;}this.$noResize=true;
this.$lastSize=[this.$int.offsetWidth,this.$int.offsetHeight];var total=0;var size=this.$vbox?"width":"height";
var minsize=this.$vbox?"minWidth":"minHeight";var osize=this.$vbox?"height":"width";
var scroll=this.$vbox?"scrollWidth":"scrollHeight";var offset=this.$vbox?"offsetWidth":"offsetHeight";
var ooffset=this.$vbox?"offsetHeight":"offsetWidth";var getDiff=this.$vbox?"getWidthDiff":"getHeightDiff";
var ogetDiff=this.$vbox?"getHeightDiff":"getWidthDiff";var inner=this.$vbox?"getHtmlInnerWidth":"getHtmlInnerHeight";
var oinner=this.$vbox?"getHtmlInnerHeight":"getHtmlInnerWidth";var borders=this.$vbox?"getVerBorders":"getHorBorders";
var nodes=this.childNodes,hNodes=[],fW=0,max=0;for(var node,i=0;i<nodes.length;
i++){if((node=nodes[i]).nodeFunc!=apf.NODE_VISIBLE||node.visible===false||!node.$amlLoaded){continue;
}hNodes.push(node);if(!node[size]){var m=node.margin&&apf.getBox(node.margin);if(m&&this.$vbox){m.unshift();
}var mdiff=(m?m[0]+m[2]:0);max=Math.max(max,mdiff+Math.min(node.$ext[scroll]+apf[borders](node.$ext),node["max"+size]||10000));
}if(parseInt(node.flex)){total+=parseFloat(node.flex);}else{var m=node.margin&&apf.getBox(node.margin);
if(m&&!this.$vbox){m.shift();}fW+=node.$ext[ooffset]+(m?m[0]+m[2]:0);}}if(!max&&this[size]){max=this[size]-apf[ogetDiff](this.$ext);
}if(this.align=="stretch"){var l=hNodes.length;var pH=max;for(var i=0;i<l;i++){node=hNodes[i];
if(!node[size]&&!this.$vbox||this.$vbox&&input[node.$ext.tagName]){var m=node.margin&&apf.getBox(node.margin);
if(m&&this.$vbox){m.unshift();}var mdiff=(m?m[0]+m[2]:0);if(max&&Math.min(node.$ext[scroll],node["max"+size]||10000)!=max){node.$ext.style[size]=Math.max(0,max-apf[getDiff](node.$ext)-mdiff)+"px";
}else{node.$ext.style[size]="";}}}}if(total>0){if(this.$vbox){this.$int.style.height="100%";
}this.$int.style.overflow="hidden";var splitterCount=apf.n(this).children("a:splitter").length()*2;
var rW=this.$int[ooffset]-apf[ogetDiff](this.$int)-fW-((hNodes.length-1-splitterCount)*this.padding);
var lW=rW,done=0;for(var i=0,l=hNodes.length;i<l;i++){if((node=hNodes[i]).flex){var v=(i%2==0?Math.floor:Math.ceil)((rW/total)*parseInt(node.flex));
done+=parseInt(node.flex);var m=node.margin&&apf.getBox(node.margin);if(m&&!this.$vbox){m.shift();
}node.$ext.style[osize]=Math.max(0,(done==total?lW:v)-apf[ogetDiff](node.$ext)-(m?m[0]+m[2]:0))+"px";
lW-=v;}}}else{if(this.$vbox){this.$int.style.height="";}this.$int.style.overflow="";
}this.$noResize=false;};this.$loadAml=function(x){if(this.padding==undefined){this.padding=0;
}if(this.edge==undefined){this.$propHandlers.edge.call(this,this.edge=0);}if(this.pack==undefined){this.$propHandlers.pack.call(this,this.edge="start");
}if(this.align==undefined){this.align="stretch";}if(!apf.hasFlexibleBox&&!this.$vbox&&!this.height&&this.align=="stretch"){myHeightHandler.call(this,{});
}};}).call(apf.vbox.prototype=new apf.GuiElement());apf.hbox.prototype=apf.vbox.prototype;
apf.aml.setElement("hbox",apf.hbox);apf.aml.setElement("vbox",apf.vbox);apf.img=function(struct,tagName){this.$init(tagName||"img",apf.NODE_VISIBLE,struct);
};apf.preview=function(struct,tagName){this.$init(tagName||"preview",apf.NODE_VISIBLE,struct);
};(function(){this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(value){return this.value;};this.$supportedProperties.push("value","src");
this.$propHandlers.src=this.$propHandlers.value=function(value){if(this.oImage.nodeType==1){this.oImage.style.backgroundImage="url("+value+")";
}else{this.oImage.nodeValue=value;}if(this.oImage.nodeType==2&&!this.$resize.done){if(this.oImg){var pNode=apf.hasSingleRszEvent?this.$pHtmlNode:this.$ext;
apf.layout.setRules(pNode,this.$uniqueId+"_image","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");
apf.layout.queue(pNode);this.oImg.onload=function(){apf.layout.forceResize(pNode);
};}this.$resize.done=true;}if(this.oImg){this.oImg.style.display=value?"block":"none";
}};this.refetch=function(){this.$propHandlers.value.call(this,"");this.$propHandlers.value.call(this,this.value||this.src);
};this.addEventListener("$clear",function(){this.value="";if(this.oImg){this.oImg.style.display="none";
}});this.$draw=function(){this.$ext=this.$getExternal();this.$ext.onclick=function(e){this.host.dispatchEvent("click",{htmlEvent:e||event});
};this.oImage=this.$getLayoutNode("main","image",this.$ext);if(this.oImage.nodeType==1){this.oImg=this.oImage.getElementsByTagName("img")[0];
}if(this.localName=="preview"){var _self=this;this.$ext.onclick=function(){if(!_self.sPreview){return;
}_self.$ext.innerHTML=_self.sPreview;this.onclick=null;};}var _self=this;apf.addListener(this.$ext,"mouseover",function(e){if(!_self.disabled){_self.dispatchEvent("mouseover",{htmlEvent:e});
}});apf.addListener(this.$ext,"mouseout",function(e){if(!_self.disabled){_self.dispatchEvent("mouseout",{htmlEvent:e});
}});};this.addEventListener("DOMNodeInsertedIntoDocument",function(){var node,val="",i=this.childNodes.length;
for(;i>=0;--i){if((node=this.childNodes[i])&&node.nodeName&&node.nodeName=="#cdata-section"){val=node.nodeValue;
node.removeNode();}}this.sPreview=val;});this.$resize=function(){var diff=apf.getDiff(this.$ext);
var wratio=1,hratio=1;this.oImg.style.width="";this.oImg.style.height="";if(this.oImg.offsetWidth>this.$ext.offsetWidth){wratio=this.oImg.offsetWidth/(this.$ext.offsetWidth-diff[0]);
}if(this.oImg.offsetHeight>this.$ext.offsetHeight){hratio=this.oImg.offsetHeight/(this.$ext.offsetHeight-diff[1]);
}if(wratio>hratio&&wratio>1){this.oImg.style.width="100%";}else{if(hratio>wratio&&hratio>1){this.oImg.style.height="100%";
}}this.oImg.style.top=((this.$ext.offsetHeight-apf.getHeightDiff(this.$ext)-this.oImg.offsetHeight)/2)+"px";
};}).call(apf.img.prototype=new apf.BaseSimple());apf.preview.prototype=apf.img.prototype;
apf.aml.setElement("img",apf.img);apf.aml.setElement("preview",apf.preview);apf.aml.setElement("name",apf.BindingRule);
apf.aml.setElement("image",apf.BindingRule);apf.item=function(struct,tagName){this.$init(tagName||"item",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$childProperty="caption";this.$canLeechSkin="item";
this.checked=false;this.selected=false;this.implement(apf.ChildValue);this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);
this.$supportedProperties.push("submenu","value","match","group","icon","checked","selected","disabled","caption","type");
this.$propHandlers.submenu=function(value){apf.setStyleClass(this.$ext,"submenu");
};this.$propHandlers.select=function(value){this.select=value?"self::"+value.split("|").join("|self::"):value;
};this.$propHandlers.group=function(value){if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);
}if(!value){this.$group=null;return;}var group=typeof value=="string"?apf.nameserver.get("radiogroup",value):value;
if(!group){group=apf.nameserver.register("radiogroup",value,new apf.$group());group.setAttribute("id",value);
group.dispatchEvent("DOMNodeInsertedIntoDocument");group.parentNode=this;}this.$group=group;
this.$group.$addRadio(this);};this.$propHandlers.hotkey=function(value){if(this.$hotkey){apf.setNodeValue(this.$hotkey,apf.isMac?apf.hotkeys.toMacNotation(value):value);
}if(this.$lastHotkey){apf.hotkeys.remove(this.$lastHotkey);}if(value){this.$lastHotkey=value;
var _self=this;apf.hotkeys.register(value,function(){if(_self.disabled||!_self.visible){return;
}var buttons=apf.document.getElementsByTagNameNS(apf.ns.aml,"button");for(var i=0;
i<buttons.length;i++){if(buttons[i].submenu==_self.parentNode.name){var btn=buttons[i];
btn.$setState("Over",{});$setTimeout(function(){btn.$setState("Out",{});},200);
break;}}_self.$down();_self.$up();_self.$click();});}};this.$propHandlers.icon=function(value){if(this.$icon){apf.skins.setIcon(this.$icon,value,this.parentNode.iconPath);
}};this.$propHandlers.caption=function(value){if(this.$caption){apf.setNodeValue(this.$caption,value);
}};this.$propHandlers.type=function(value){apf.setStyleClass(this.$ext,value,["item","check","radio"]);
};this.$values=[1,0];this.$propHandlers.values=function(value){this.$values=value&&value.split("|");
};this.$propHandlers.value=function(value){if(this.type!="check"){return;}this.setProperty("checked",this.$values.indexOf(value)==0);
};this.$propHandlers.checked=function(value){if(this.type!="check"){return;}if(apf.isTrue(value)){apf.setStyleClass(this.$ext,"checked");
}else{apf.setStyleClass(this.$ext,"",["checked"]);}if(this.$values&&this.$values[value?0:1]!=this.value){return this.setProperty("value",this.$values[value?0:1]);
}};this.select=function(){this.parentNode.select(this.group,this.value||this.caption);
};this.check=function(){this.setProperty("checked",true);};this.uncheck=function(){this.setProperty("checked",false);
};this.$check=function(){apf.setStyleClass(this.$ext,"selected");};this.$uncheck=function(){apf.setStyleClass(this.$ext,"",["selected"]);
};this.$propHandlers.selected=function(value){if(this.type!="radio"){return;}if(this.$group){this.$group.setProperty("value",this.value);
}if(apf.isTrue(value)){this.$check();}else{this.$uncheck();}};this.$propHandlers.disabled=function(value){if(apf.isTrue(value)||value==-1){apf.setStyleClass(this.$ext,"disabled");
}else{apf.setStyleClass(this.$ext,"",["disabled"]);}};this.addEventListener("AMLReparent",function(beforeNode,pNode,withinParent){if(!this.$amlLoaded){return;
}if(!withinParent&&this.skinName!=pNode.skinName){this.loadAml();}});this.$down=function(){};
this.$up=function(){if(this.type=="radio"){this.parentNode.select(this.group,this.value||this.caption);
}else{if(this.type=="check"){this.setProperty("checked",!this.checked);}}if(this.submenu){this.$over(null,true);
return;}this.parentNode.$hideTree=true;this.parentNode.hide();this.parentNode.dispatchEvent("itemclick",{value:this.value||this.caption,relatedNode:this,checked:this.checked,selected:this.selected});
this.dispatchEvent("click",{xmlContext:this.parentNode.xmlReference,opener:this.parentNode.opener});
};this.$click=function(){};var timer;this.$out=function(e){if(apf.isChildOf(this.$ext,e.toElement||e.explicitOriginalTarget)||apf.isChildOf(this.$ext,e.srcElement||e.target)){return;
}clearTimeout(timer);if(!this.submenu||this.$submenu(true)){apf.setStyleClass(this.$ext,"",["hover"]);
var sel=this.parentNode.$selected;if(sel&&sel!=this){apf.setStyleClass(sel.$ext,"",["hover"]);
}this.parentNode.$selected=null;}};this.$over=function(e,force){if(this.parentNode.$selected==this&&e){return;
}if(this.parentNode.$selected){apf.setStyleClass(this.parentNode.$selected.$ext,"",["hover"]);
}apf.setStyleClass(this.$ext,"hover");this.parentNode.$selected=this;if(!force&&(apf.isChildOf(this.$ext,e.toElement||e.explicitOriginalTarget)||apf.isChildOf(this.$ext,e.fromElement||e.target))){return;
}var _self=this,ps=this.parentNode.$showingSubMenu;if(ps&&ps.name==this.submenu){this.parentNode.$selected=null;
this.parentNode.$showingSubMenu=null;_self.$submenu();return;}clearTimeout(timer);
function submenu(){if(ps&&ps.visible){ps.hide();if(_self.parentNode.$showingSubMenu==ps){_self.parentNode.$showingSubMenu=null;
}}if(_self.submenu&&_self.parentNode.opener&&_self.parentNode.opener.visible){_self.$submenu();
}}if(force){submenu();}else{timer=$setTimeout(function(){submenu();timer=null;},210);
}};this.$submenu=function(hide,force){if(!this.submenu){return true;}var menu=self[this.submenu];
if(!menu){return;}if(!hide){this.parentNode.$showingSubMenu=menu;var pos=apf.getAbsolutePosition(this.$ext,this.parentNode.$ext.offsetParent);
menu.display(pos[0]+this.$ext.offsetWidth-3,pos[1]+3,true,this,this.parentNode.xmlReference,this.parentNode.$uniqueId);
menu.setAttribute("zindex",(this.parentNode.zindex||1)+1);}else{if(menu.visible&&!force){return false;
}if(this.parentNode.$showingSubMenu==menu){this.parentNode.$showingSubMenu=null;
}apf.setStyleClass(this.$ext,"",["hover"]);menu.hide();return true;}};this.$draw=function(isSkinSwitch){var p=this.parentNode;
while(p.$canLeechSkin=="item"){p=p.parentNode;}if(p.hasFeature(apf.__MULTISELECT__)){var _self=this;
if(!this.$hasSetSkinListener){var f;this.parentNode.addEventListener("$skinchange",f=function(){if(_self.$amlDestroyed){return;
}if(_self.$ext.parentNode){this.$deInitNode(_self,_self.$ext);}var oInt=p==_self.parentNode?p.$container:_self.parentNode.$container;
var node=oInt.lastChild;p.$add(_self,_self.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,_self.parentNode,oInt!=p.$container&&oInt,null);
p.$fill();if(p.$isTreeArch){_self.$container=p.$getLayoutNode("item","container",_self.$ext=node&&node.nextSibling||oInt.firstChild);
}else{_self.$ext=node&&node.nextSibling||oInt.firstChild;}var ns=_self;while((ns=ns.nextSibling)&&ns.nodeType!=1){}if(!ns||ns.$canLeechSkin!="item"){p.dispatchEvent("afterload");
}});this.addEventListener("DOMNodeRemoved",function(e){if(e.currentTarget==this){this.parentNode.removeEventListener("$skinchange",f);
}});this.$hasSetSkinListener=true;}if(!p.$itemInited){p.canrename=false;p.$removeClearMessage();
p.$itemInited=[p.getTraverseNodes,p.getFirstTraverseNode,p.getTraverseParent];p.getTraverseNodes=function(xmlNode){return(xmlNode||p).getElementsByTagNameNS(apf.ns.apf,"item");
};p.getFirstTraverseNode=function(xmlNode){return(xmlNode||p).getElementsByTagNameNS(apf.ns.apf,"item")[0];
};p.getTraverseParent=function(xmlNode){return xmlNode&&xmlNode.parentNode;};p.each=(this.prefix?this.prefix+":":"")+"item";
p.$preventDataLoad=true;p.$initingModel=true;p.$setDynamicProperty("icon","[@icon]");
p.$setDynamicProperty("image","[@image]");p.$setDynamicProperty("caption","[label/text()|@caption|text()]");
p.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");p.$canLoadDataAttr=false;
if(!p.xmlRoot){p.xmlRoot=p;}}this.$loadAml=function(){if(!this.getAttribute("caption")){this.setAttribute("caption",this.caption);
}var oInt=p==this.parentNode?p.$container:this.parentNode.$container;var node=oInt.lastChild;
if(!p.documentId){p.documentId=apf.xmldb.getXmlDocId(this);}p.$add(this,apf.xmldb.nodeConnect(p.documentId,this,null,p),this.parentNode,oInt!=p.$container&&oInt,null);
p.$fill();if(p.$isTreeArch){this.$container=p.$getLayoutNode("item","container",this.$ext=node&&node.nextSibling||oInt.firstChild);
}else{this.$ext=node&&node.nextSibling||oInt.firstChild;}var ns=this;while((ns=ns.nextSibling)&&ns.nodeType!=1){}if(!ns||ns.$canLeechSkin!="item"){p.dispatchEvent("afterload");
if(p.autoselect){p.$selectDefault(this.parentNode);}}};return;}this.$ext=this.$getExternal(this.$isLeechingSkin?"item":"main",null,function($ext){var o="var o = apf.lookup("+this.$uniqueId+"); if (o.disabled) return; o";
$ext.setAttribute("onmouseup",o+".$up(event)");$ext.setAttribute("onmousemove",o+".$over(event)");
$ext.setAttribute("onmouseout",o+".$out(event)");$ext.setAttribute("onmousedown",o+".$down()");
$ext.setAttribute("onclick",o+".$click()");});this.$caption=this.$getLayoutNode("item","caption",this.$ext);
this.$icon=this.$getLayoutNode("item","icon",this.$ext);this.$hotkey=this.$getLayoutNode("item","hotkey",this.$ext);
if(!isSkinSwitch&&this.nextSibling&&this.nextSibling.$ext){this.$ext.parentNode.insertBefore(this.$ext,this.nextSibling.$ext);
}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var isSkinSwitch=this.$ext?true:false;
if(isSkinSwitch){if(typeof this.checked!=="undefined"){this.$handlePropSet("checked",this.checked);
}else{if(typeof this.selected!=="undefined"){this.$handlePropSet("selected",this.selected);
}}if(this.disabled){this.$handlePropSet("disabled",this.disabled);}if(this.caption){this.$handlePropSet("caption",this.caption);
}}});}).call(apf.item.prototype=new apf.Presentation());apf.aml.setElement("item",apf.item);
apf.junction=function(){this.$init("junction",apf.NODE_HIDDEN);};(function(){this.$focussable=false;
this.autoshow=true;this.$booleanProperties.autoshow=true;this.$propHandlers["for"]=function(value){if(this.$amlLoaded){init.call(this);
}};function init(e){var _self=this;if(apf.window.vManager.permanent(this.parentNode,function(){_self.$reparent();
},function(){})){this.$reparent();}}this.$reparent=function(){var amlNode=self[this["for"]];
if(!amlNode){return;}if(this.autoshow){amlNode.show();}this.parentNode.insertBefore(amlNode,this);
};this.addEventListener("DOMNodeInsertedIntoDocument",init);}).call(apf.junction.prototype=new apf.AmlElement());
apf.aml.setElement("junction",apf.junction);apf.label=function(struct,tagName){this.$init(tagName||"label",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction,apf.ChildValue);var _self=this;this.$focussable=false;
var forElement;this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.value;};this.$supportedProperties.push("caption","for","textalign");
this.$propHandlers.caption=function(value){this.$caption.innerHTML=value;};this.$propHandlers["for"]=function(value){forElement=typeof value=="string"?self[value]:value;
};this.$propHandlers.textalign=function(value){this.$caption.style.textAlign=value||"";
};this.$draw=function(){this.$ext=this.$getExternal();this.$caption=this.$getLayoutNode("main","caption",this.$ext);
if(this.$caption.nodeType!=1){this.$caption=this.$caption.parentNode;}this.$ext.onmousedown=function(){if(forElement&&forElement.$focussable&&forElement.focussable){forElement.focus();
}};var _self=this;apf.addListener(this.$ext,"click",function(e){if(!_self.disabled){_self.dispatchEvent("click",{htmlEvent:e});
}});apf.addListener(this.$ext,"mouseover",function(e){if(!_self.disabled){_self.dispatchEvent("mouseover",{htmlEvent:e});
}});apf.addListener(this.$ext,"mouseout",function(e){if(!_self.disabled){_self.dispatchEvent("mouseout",{htmlEvent:e});
}});};this.$childProperty="caption";}).call(apf.label.prototype=new apf.BaseSimple());
apf.aml.setElement("label",apf.label);apf.list=function(struct,tagName){this.$init(tagName||"list",apf.NODE_VISIBLE,struct);
};apf.thumbnail=function(struct,tagName){this.$init(tagName||"thumbnail",apf.NODE_VISIBLE,struct);
};apf.select=function(struct,tagName){this.$init(tagName||"select",apf.NODE_VISIBLE,struct);
};apf.select1=function(struct,tagName){this.$init(tagName||"selectl",apf.NODE_VISIBLE,struct);
};(function(){this.morePos="end";if(!apf.isIphone){this.implement(apf.Rename);}this.$getCaptionElement=function(){if(!(this.$caret||this.$selected)){return;
}var x=this.$getLayoutNode("item","caption",this.$caret||this.$selected);if(!x){return;
}return x.nodeType==1?x:x.parentNode;};this.$supportedProperties.push("appearance","mode","more","thumbsize","morepos");
this.$propHandlers.morepos=function(value){this.morePos=value;};this.$propHandlers.thumbsize=function(value){var className=this.thumbclass;
if(apf.isIE){className=className.splitSafe(",");for(var i=0;i<className.length;
i++){apf.setStyleRule(className[i],"width",value+"px");apf.setStyleRule(className[i],"height",value+"px");
}return;}apf.setStyleRule(className,"width",value+"px");apf.setStyleRule(className,"height",value+"px");
};this.$propHandlers.appearance=function(value){};this.$propHandlers.more=function(value){if(value){this.delayedselect=false;
this.addEventListener("xmlupdate",$xmlUpdate);this.addEventListener("afterload",$xmlUpdate);
this.$addMoreItem=function(msg){if(!this.moreItem){this.$fill();}if(this.morePos=="begin"){this.$container.insertBefore(this.moreItem,this.$container.firstChild);
}else{this.$container.appendChild(this.moreItem);}};this.$updateClearMessage=function(){};
this.$removeClearMessage=function(){};}else{this.removeEventListener("xmlupdate",$xmlUpdate);
this.removeEventListener("afterload",$xmlUpdate);}};function $xmlUpdate(e){if((!e.action||"insert|add|synchronize|move".indexOf(e.action)>-1)&&this.moreItem){if(this.morePos=="begin"){this.$container.insertBefore(this.moreItem,this.$container.firstChild);
}else{this.$container.appendChild(this.moreItem);}}}this.addEventListener("keydown",this.$keyHandler,true);
this.$draw=function(){this.appearance=this.getAttribute("appearance")||"compact";
this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);
if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var _self=this;
this.$ext.onclick=function(e){_self.dispatchEvent("click",{htmlEvent:e||event});
};this.listtype=parseInt(this.$getOption("main","type"))||1;this.behaviour=parseInt(this.$getOption("main","behaviour"))||1;
this.thumbsize=this.$getOption("main","thumbsize");this.thumbclass=this.$getOption("main","thumbclass");
};this.$loadAml=function(x){};this.$destroy=function(){if(this.$ext){this.$ext.onclick=null;
}apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.list.prototype=new apf.BaseList());
apf.thumbnail.prototype=apf.select.prototype=apf.select1.prototype=apf.list.prototype;
apf.aml.setElement("thumbnail",apf.thumbnail);apf.aml.setElement("select",apf.select);
apf.aml.setElement("select1",apf.select1);apf.aml.setElement("list",apf.list);apf.loader=function(){this.$init("loader",apf.NODE_HIDDEN);
this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";
};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pHtmlNode;
if(!(pHtmlNode=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,pHtmlNode,null,(this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize()).replace(/^<[^>]*>\s*|\s*<[^>]*>$/g,""));
if(!apf.loaded){var _self=this;apf.addEventListener("load",function(){if(apf.config.autoHideLoading){apf.queue.empty();
_self.hide();}});}});};apf.loader.prototype=new apf.AmlElement();apf.aml.setElement("loader",apf.loader);
apf.menu=function(struct,tagName){this.$init(tagName||"menu",apf.NODE_VISIBLE,struct);
this.animate=apf.enableAnim;};(function(){this.$focussable=apf.KEYBOARD;this.$positioning="basic";
this.zindex=10000000;this.visible=false;this.matchhide=false;this.$booleanProperties.animate=true;
this.$booleanProperties.pinned=true;this.$booleanProperties.matchhide=true;this.$propHandlers.visible=function(value,prop,force,nofocus,hideOpener){if(value){this.$ext.style.display="block";
if(this.opener&&this.opener.localName.indexOf("item")>-1){this.opener.parentNode.$showingSubMenu=this;
}}else{this.$ext.style.display="none";var lastFocus=apf.menu.lastFocus;if(lastFocus!=this.opener&&this.opener&&this.opener.$blur){this.opener.$blur();
}if(this.opener&&this.opener.parentNode&&this.opener.parentNode.localName=="menu"){if(!this.$hideTree){this.$hideTree=-1;
}this.opener.parentNode.focus();}else{if(lastFocus){if(apf.window.$settingFocus){if(apf.window.$settingFocus!=lastFocus&&lastFocus.$blur){lastFocus.$blur();
}this.$blur();if(apf.window.$settingFocus.localName!="menu"){apf.menu.lastFocus=null;
}}else{if(!apf.window.hasFocus()){if(lastFocus.$blur){lastFocus.$blur();}this.$blur();
apf.document.activeElement=lastFocus;if(lastFocus.$focusParent){lastFocus.$focusParent.$lastFocussed=lastFocus;
}apf.menu.lastFocus=null;}else{if(this.$hideTree){if(!this.$hideTree){this.$hideTree=-1;
}var visTest=(lastFocus.disabled||!lastFocus.visible)&&lastFocus!=apf.document.documentElement;
if(nofocus||visTest){if(lastFocus.$blur){lastFocus.$blur();}this.$blur();apf.document.activeElement=null;
if(visTest&&apf.window.moveNext()===false){apf.window.$focusRoot();}}else{lastFocus.focus(null,null,true);
}apf.menu.lastFocus=null;}}}}}clearTimeout(this.$submenuTimer);if(this.$showingSubMenu){this.$showingSubMenu.hide();
this.$showingSubMenu=null;}if(this.opener&&this.opener.$submenu){this.opener.$submenu(true,true);
if(this.$hideTree===true&&this.opener&&this.opener.parentNode&&this.opener.parentNode.localName=="menu"){this.opener.parentNode.$hideTree=true;
this.opener.parentNode.hide();}this.opener=null;}this.$hideTree=null;if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);
this.$selected=null;}}};var lastFocus;this.display=function(x,y,noanim,opener,xmlNode,openMenuId,btnWidth){this.opener=opener;
if(xmlNode&&!this.disabled){var last,i,node,nodes=this.childNodes,c=0,l=nodes.length,result;
for(i=0;i<l;i++){node=nodes[i];if(node.nodeType!=1||node.localName!="item"){continue;
}result=!xmlNode||!node.match||(node.cmatch||(node.cmatch=apf.lm.compile(node.match,{xpathmode:3,injectself:true})))(xmlNode);
if(result){if(this.matchhide){node.show();}else{node.enable();}if(node.localName=="divider"&&this.matchhide){last=node;
if(c==0){node.hide();}c=0;}else{c++;}}else{if(this.matchhide){node.hide();}else{node.disable();
}if(!node.nextSibling&&c==0&&last){last.hide();}}}}if(this.oOverlay){if(btnWidth){this.oOverlay.style.display="block";
this.oOverlay.style.width=btnWidth+"px";}else{this.oOverlay.style.display="none";
}}function afterRender(){this.dispatchEvent("display",{opener:opener});if(x===null){apf.popup.show(this.$uniqueId,{x:0,y:this.ref?0:opener.$ext.offsetHeight,animate:noanim||!this.animate?false:"fade",steps:10,ref:(this.ref||opener).$ext,allowTogether:openMenuId,autohide:!this.pinned,noleft:this.left!==undefined});
}else{var bodyPos=apf.getAbsolutePosition(document.body);apf.popup.show(this.$uniqueId,{x:x-bodyPos[0],y:y-bodyPos[1]-(apf.isIE&&apf.isIE<8?1:0),animate:noanim||!this.animate?false:"fade",steps:10,allowTogether:openMenuId,autohide:!this.pinned});
}var lastFocus=apf.menu.lastFocus=opener&&opener.$focussable===true?opener:apf.menu.lastFocus||apf.document.activeElement;
apf.popup.last=null;this.focus();if(lastFocus&&lastFocus!=this&&lastFocus.$focus){lastFocus.$focus();
}this.xmlReference=xmlNode;}this.visible=false;if(this.$rendered!==false){this.show();
afterRender.call(this);}else{this.addEventListener("afterrender",afterRender);this.show();
}};this.getValue=function(group){return this.getSelected(group).value||"";};this.getSelected=function(group){var nodes=this.childNodes;
var i,l=nodes.length;for(i=0;i<l;i++){if(nodes[i].group!=group){continue;}if(nodes[i].selected){return nodes[i];
}}return false;};this.select=function(group,value){var nodes=this.childNodes;var i,l=nodes.length;
for(i=0;i<l;i++){if(nodes[i].group!=group){continue;}if(nodes[i].value==value||!nodes[i].value&&nodes[i].caption==value){nodes[i].$handlePropSet("selected",true);
}else{if(nodes[i].selected){nodes[i].$handlePropSet("selected",false);}}}};this.addEventListener("keydown",function(e){var node,key=e.keyCode;
switch(key){case 13:if(!this.$selected){return;}node=this.$selected;node.$down();
node.$up();node.$click();break;case 27:this.hide();break;case 38:node=this.$selected&&this.$selected.previousSibling||this.lastChild;
if(node&&node.localName=="divider"){node=node.previousSibling;}if(!node){return;
}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(node.$ext,"hover");
this.$selected=node;break;case 40:node=this.$selected&&this.$selected.nextSibling||this.firstChild;
if(node&&node.localName=="divider"){node=node.nextSibling;}if(!node){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);
}apf.setStyleClass(node.$ext,"hover");this.$selected=node;break;case 37:if(!this.opener){return;
}if(this.opener.localName=="button"){node=this.opener.previousSibling;while(node&&!node.submenu){node=node.previousSibling;
}if(node){node.dispatchEvent("mouseover");var btnMenu=node.parentNode.menuIsPressed;
if(btnMenu){self[btnMenu.submenu].dispatchEvent("keydown",{keyCode:40});}}}else{if(this.opener.parentNode.localName=="menu"){var op=this.opener;
this.hide();apf.setStyleClass(op.$ext,"hover");op.parentNode.$showingSubMenu=null;
}}break;case 39:if(this.$selected&&this.$selected.submenu){this.$selected.$submenu(null,true);
this.$showingSubMenu.dispatchEvent("keydown",{keyCode:40});return;}if(this.opener){var op=this.opener;
while(op&&op.parentNode&&op.parentNode.localName=="menu"){op=op.parentNode.opener;
}if(op&&op.localName=="button"){node=op.nextSibling;while(node&&!node.submenu){node=node.nextSibling;
}if(node){node.dispatchEvent("mouseover");var btnMenu=node.parentNode.menuIsPressed;
if(btnMenu){self[btnMenu.submenu].dispatchEvent("keydown",{keyCode:40});}return;
}}}if(!this.$selected){arguments.callee.call(this,{keyCode:40});}break;default:return;
}return false;},true);function forceHide(e){if(this.$showingSubMenu||this.pinned||apf.isChildOf(e.fromElement,e.toElement)||apf.isChildOf(this,e.toElement)||!e.toElement){return;
}if(this.$hideTree!=-1){this.$hideTree=true;this.hide();}return false;}this.addEventListener("focus",function(){apf.popup.last=this.$uniqueId;
});this.addEventListener("blur",forceHide);this.addEventListener("popuphide",forceHide);
this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal();
this.oOverlay=this.$getLayoutNode("main","overlay",this.$ext);apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);
};this.$loadAml=function(x){this.$int=this.$getLayoutNode("main","container",this.$ext);
};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);};}).call(apf.menu.prototype=new apf.Presentation());
apf.aml.setElement("menu",apf.menu);apf.method=function(struct,tagName){this.$init(tagName||"method",apf.NODE_HIDDEN,struct);
this.async=true;this.caching=false;this["ignore-offline"]=false;};(function(){this.$parsePrio="002";
this.$booleanProperties.async=true;this.$booleanProperties.caching=true;this.$booleanProperties["ignore-offline"]=true;
this.$supportedProperties.push("name","receive","async","caching","ignore-offline","method-name","type","url");
this.$propHandlers["ignore-offline"]=function(value){this.ignoreOffline=value;};
this.$propHandlers["method-name"]=function(value){this.methodName=value;};this.addEventListener("DOMNodeInserted",function(e){if(this.parentNode.$addMethod&&e.currentTarget==this){this.parentNode.$addMethod(this);
}});this.addEventListener("DOMNodeRemoved",function(e){if(this.parentNode.$removeMethod&&e.currentTarget==this){this.parentNode.$removeMethod(this);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode.$addMethod){this.parentNode.$addMethod(this);
}});}).call(apf.method.prototype=new apf.AmlElement());apf.aml.setElement("method",apf.method);
apf.WinServer={count:9000,wins:[],setTop:function(win,norecur){if(win.zindex||win.modal){return;
}if(win.$opened){if(win.$opened.visible){return;}else{delete win.$opened;}}var topmost;
if(!norecur&&this.wins.length){var topmost=this.wins[this.wins.length-1];if(topmost==win){return;
}if(!topmost.modal||!topmost.visible){topmost=null;}else{if(topmost&&win.modal){win.$opener=topmost;
topmost.$opened=win;topmost=null;}}}this.count+=2;win.setProperty("zindex",this.count);
this.wins.remove(win);this.wins.push(win);if(topmost){this.setTop(topmost,true);
}return win;},setNext:function(){if(this.wins.length<2){return;}var nwin,start=this.wins.shift();
do{if(this.setTop(nwin||start).visible){break;}nwin=this.wins.shift();}while(start!=nwin);
},setPrevious:function(){if(this.wins.length<2){return;}this.wins.unshift(this.wins.pop());
var nwin,start=this.wins.pop();do{if(this.setTop(nwin||start).visible){break;}nwin=this.wins.pop();
}while(start!=nwin);},remove:function(win){this.wins.remove(win);}};apf.toolwindow=function(struct,tagName){this.$init(tagName||"toolwindow",apf.NODE_VISIBLE,struct);
};apf.modalwindow=function(struct,tagName){this.$init(tagName||"modalwindow",apf.NODE_VISIBLE,struct);
};apf.AmlWindow=function(struct,tagName){this.$init(tagName||"window",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.BaseStateButtons);this.$isWindowContainer=true;
this.collapsedHeight=30;this.canHaveChildren=2;this.visible=false;this.showdragging=false;
this.kbclose=false;this.$focussable=apf.KEYBOARD;this.$editableCaption=["title"];
this.setTitle=function(caption){this.setProperty("title",caption,false,true);return this;
};this.setIcon=function(icon){this.setProperty("icon",icon,false,true);return this;
};this.show=function(callback){this.execAction=callback;this.setProperty("visible",true,false,true);
return this;};this.slideIn=function(sFrom,bSticky){if(!sFrom){sFrom="bottom";}var _center=this.center;
this.center=false;this.setProperty("visible",true);this.center=_center;var iFrom=0,iTo=0,innerW=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth),innerH=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight),cX=Math.max(0,((innerW-this.$ext.offsetWidth)/2)),cY=Math.max(0,((innerH-this.$ext.offsetHeight)/3)),sType="top",pad=10;
switch(sFrom){case"top":iFrom=-(this.$ext.offsetHeight)-pad;iTo=bSticky?0:cY;break;
case"left":iFrom=-(this.$ext.offsetWidth)-pad;iTo=bSticky?0:cX;sType="left";break;
case"bottom":iFrom=innerH+this.$ext.offsetHeight+pad;iTo=bSticky?innerH-this.$ext.offsetHeight:cY;
break;case"right":iFrom=innerW+this.$ext.offsetLeft+pad;iTo=bSticky?innerW-this.$ext.offsetWidth:cX;
sType="left";break;}apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:iFrom,to:iTo,type:sType,anim:apf.tween.EASEIN});
return this;};this.slideOut=function(sTo){if(!sTo){sTo="bottom";}var iFrom=0,iTo=0,sType="top",pad=10;
switch(sTo){case"top":iFrom=this.$ext.offsetTop;iTo=-(this.$ext.offsetHeight)-pad;
break;case"left":iFrom=this.$ext.offsetLeft;iTo=-(this.$ext.offsetWidth)-pad;sType="left";
break;case"bottom":iFrom=this.$ext.offsetTop;iTo=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight)+this.$ext.offsetHeight+pad;
break;case"right":iFrom=this.$ext.offsetLeft;iTo=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth)+this.$ext.offsetLeft+pad;
sType="left";break;}var _self=this;apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:iFrom,to:iTo,type:sType,anim:apf.tween.EASEOUT,onfinish:function(){_self.setProperty("visible",false);
}});return this;};this.bringToFront=function(){apf.WinServer.setTop(this);return this;
};this.$booleanProperties.modal=true;this.$booleanProperties.center=true;this.$booleanProperties.transaction=true;
this.$booleanProperties.hideselects=true;this.$booleanProperties.showdragging=true;
this.$booleanProperties.kbclose=true;this.$supportedProperties.push("title","icon","modal","minwidth","minheight","hideselects","center","kbclose","maxwidth","maxheight","showdragging","transaction");
this.$propHandlers.modal=function(value){if(value){if(this.visible){apf.plane.show(this.$ext,false,null,null,{color:"black",opacity:0.5,protect:this.$uniqueId});
}}else{apf.plane.hide(this.$uniqueId);}};this.$propHandlers.center=function(value){this.$ext.style.position="absolute";
};this.$propHandlers.title=function(value){if(this.oTitle){this.oTitle.nodeValue=value;
}};this.$propHandlers.icon=function(value){if(!this.oIcon){return;}this.oIcon.style.display=value?"":"none";
apf.skins.setIcon(this.oIcon,value,this.iconPath);};this.$afterRender=function(){if(this.center&&!this.left&&!this.top&&!this.right&&!this.bottom&&!this.anchors){apf.layout.processQueue();
var size=!this.$ext.offsetParent||this.$ext.offsetParent.tagName=="BODY"?[apf.getWindowWidth(),apf.getWindowHeight()]:[this.$ext.offsetParent.offsetWidth,this.$ext.offsetParent.offsetHeight,0,0];
if(size.length==2){size.push(document.documentElement.scrollLeft,document.documentElement.scrollTop);
}this.$ext.style.left=(Math.max(0,((size[0]-parseInt(this.$ext.offsetWidth||0))/2))+size[2])+"px";
this.$ext.style.top=(Math.max(0,((size[1]-parseInt(this.$ext.offsetHeight||0))/3))+size[3])+"px";
}if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});
}this.dispatchEvent("show");};var hEls=[],wasVisible;this.$propHandlers.visible=function(value){if(apf.isTrue(value)){if(this.dispatchEvent("beforeshow")===false){return(this.visible=false);
}if(this.modal){apf.plane.show(this.$ext,false,null,null,{color:"black",opacity:0.5,protect:this.$uniqueId});
}this.state=this.state.split("|").remove("closed").join("|");this.$ext.style.display="";
if(!apf.canHaveHtmlOverSelects&&this.hideselects){hEls=[];var nodes=document.getElementsByTagName("select");
for(var i=0;i<nodes.length;i++){var oStyle=apf.getStyle(nodes[i],"display");hEls.push([nodes[i],oStyle]);
nodes[i].style.display="none";}}if(apf.isIE){var cls=this.$ext.className;this.$ext.className="rnd"+Math.random();
this.$ext.className=cls;}if(this.$rendered===false){this.addEventListener("afterrender",this.$afterRender);
}else{this.$afterRender();}}else{if(this.modal){apf.plane.hide(this.$uniqueId);
}this.$ext.style.display="none";if(!apf.canHaveHtmlOverSelects&&this.hideselects){for(var i=0;
i<hEls.length;i++){hEls[i][0].style.display=hEls[i][1];}}if(this.hasFocus()){apf.window.moveNext(true,this,true);
}this.visible=false;this.dispatchEvent("hide");}if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);
}wasVisible=value;};this.$propHandlers.zindex=function(value){this.$ext.style.zIndex=value+1;
};this.addEventListener("keydown",function(e){var key=e.keyCode;var ctrlKey=e.ctrlKey;
var shiftKey=e.shiftKey;var retValue=false;switch(key){case 38:if(shiftKey&&this.resizable){this.setProperty("height",Math.max(this.minheight||0,this.$ext.offsetHeight-(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop-(ctrlKey?50:10));
}}break;case 37:if(shiftKey&&this.resizable){this.setProperty("width",Math.max(this.minwidth||0,this.$ext.offsetWidth-(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft-(ctrlKey?50:10));
}}break;case 39:if(shiftKey&&this.resizable){this.setProperty("width",Math.min(this.maxwidth||10000,this.$ext.offsetWidth+(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft+(ctrlKey?50:10));
}}break;case 40:if(shiftKey&&this.resizable){this.setProperty("height",Math.min(this.maxheight||10000,this.$ext.offsetHeight+(ctrlKey?50:10)));
}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop+(ctrlKey?50:10));
}}break;default:retValue=null;return;}if(apf.hasSingleRszEvent){apf.layout.forceResize(this.$int);
}return retValue;},true);this.addEventListener("keydown",function(e){if(e.keyCode==27&&this.buttons.indexOf("close")>-1&&(!this.dockable||!this.aData)&&this.kbclose){this.close();
}});this.$draw=function(){this.popout=apf.isTrue(this.getAttribute("popout"));if(this.popout){this.$pHtmlNode=document.body;
}this.$ext=this.$getExternal(null,null,function(oExt){this.$initButtons(oExt);});
this.oTitle=this.$getLayoutNode("main","title",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);
this.oDrag=this.$getLayoutNode("main","drag",this.$ext);this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);
if(this.popout){this.$ext.style.position="absolute";}if(this.oIcon){this.oIcon.style.display="none";
}var _self=this;if(this.oDrag){this.oDrag.host=this;this.oDrag.onmousedown=function(e){if(!e){e=event;
}if(!_self.$isWidget&&(!_self.aData||!_self.dockable||_self.aData.hidden==3)){apf.WinServer.setTop(_self);
}if(_self.$lastState.maximized){return false;}if(_self.aData&&_self.dockable){if(_self.$lastState.normal){_self.startDocking(e);
}return false;}};}this.$ext.onmousedown=function(){var p=apf.document.activeElement;
if(p&&p.$focusParent!=_self&&p.$focusParent.modal){return false;}if(!_self.$isWidget&&(!_self.aData||!_self.dockable||_self.aData.hidden==3)){apf.WinServer.setTop(_self);
}if(!_self.$lastState.normal){return false;}};this.$ext.onmousemove=function(){if(!_self.$lastState.normal){return false;
}};};this.$loadAml=function(x){apf.WinServer.setTop(this);this.$int=this.$getLayoutNode("main","container",this.$ext);
if(this.oTitle){var _self=this;(this.oTitle.nodeType!=1?this.oTitle.parentNode:this.oTitle).ondblclick=function(e){if(_self.state.indexOf("normal")==-1){_self.restore();
}else{if(_self.buttons.indexOf("max")>-1){_self.maximize();}else{if(_self.buttons.indexOf("min")>-1){_self.minimize();
}}}};}if(typeof this.draggable=="undefined"){(this.$propHandlers.draggable||apf.GuiElement.propHandlers.draggable).call(this,true);
this.draggable=true;}if(typeof this.buttons=="undefined"){this.buttons="";}if(this.modal===undefined){this.$propHandlers.modal.call(this,true);
this.modal=true;}if(!this.visible){this.$ext.style.display="none";}else{if(this.modal){var _self=this;
apf.queue.add("focus",function(){_self.focus(false,{mouse:true});});}}if(this.minwidth===undefined){this.minwidth=this.$getOption("Main","min-width");
}if(this.minheight===undefined){this.minheight=this.$getOption("Main","min-height");
}if(this.maxwidth===undefined){this.maxwidth=this.$getOption("Main","max-width");
}if(this.maxheight===undefined){this.maxheight=this.$getOption("Main","max-height");
}if(this.center&&this.visible){this.visible=false;this.$ext.style.display="none";
var _self=this;$setTimeout(function(){_self.setProperty("visible",true);});}};this.addEventListener("$skinchange",function(){if(this.title){this.$propHandlers.title.call(this,this.title);
}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$destroy=function(skinChange){if(this.oDrag){this.oDrag.host=null;
this.oDrag.onmousedown=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}this.oTitle=this.oIcon=null;
if(this.$ext&&!skinChange){this.$ext.onmousedown=null;this.$ext.onmousemove=null;
}};}).call(apf.modalwindow.prototype=new apf.Presentation());apf.AmlWindow.prototype=apf.toolwindow.prototype=apf.modalwindow.prototype;
apf.aml.setElement("toolwindow",apf.toolwindow);apf.aml.setElement("modalwindow",apf.modalwindow);
apf.aml.setElement("window",apf.modalwindow);apf.model=function(struct,tagName){this.$init(tagName||"model",apf.NODE_HIDDEN,struct);
this.$amlNodes={};this.$propBinds={};this.$listeners={};this.$proplisteners={};
if(!apf.globalModel){apf.globalModel=this;apf.nameserver.register("model","@default",this);
}};(function(){this.$parsePrio="020";this.$isModel=true;this.canHaveChildren=false;
this.enablereset=false;this.$state=0;this.$attrExcludePropBind=apf.extend({submission:1,src:1,session:1},this.$attrExcludePropBind);
this.$booleanProperties.whitespace=true;this.$booleanProperties.autoinit=true;this.$booleanProperties.enablereset=true;
this.$supportedProperties=["submission","src","session","autoinit","enablereset","remote","whitespace"];
this.$propHandlers.src=this.$propHandlers.get=function(value,prop){if(this.$amlLoaded){this.$loadFrom(value);
}};this.register=function(amlNode,xpath){if(!amlNode||!amlNode.load){return this;
}var isReloading=amlNode.$model==this;if(amlNode.$model&&!isReloading){amlNode.$model.unregister(amlNode);
}var item=this.$amlNodes[amlNode.$uniqueId]={amlNode:amlNode,xpath:xpath};amlNode.$model=this;
if(typeof amlNode.noloading=="undefined"&&amlNode.$setInheritedAttribute&&!amlNode.$setInheritedAttribute("noloading")){amlNode.noloading=false;
}if(this.$state==1){if(amlNode.clear&&!amlNode.noloading){amlNode.clear("loading");
}}else{if(this.data){this.$loadInAmlNode(item);}else{if(amlNode.hasFeature(apf.__CACHE__)){amlNode.clear("empty");
}}}var p,node,list=amlNode.$propsUsingMainModel,id=amlNode.$uniqueId;for(var prop in list){this.$unbindXmlProperty(amlNode,prop);
p=this.$bindXmlProperty(amlNode,prop,list[prop].xpath,list[prop].optimize);if(this.data){if(node=p.listen?this.data.selectSingleNode(p.listen):this.data){amlNode.$execProperty(prop,node);
}else{this.$waitForXml(amlNode,prop);}}}return this;};this.$register=function(amlNode,xpath){this.$amlNodes[amlNode.$uniqueId].xpath=xpath;
};this.unregister=function(amlNode){delete this.$amlNodes[amlNode.$uniqueId];var list=amlNode.$propsUsingMainModel;
for(var prop in list){this.$unbindXmlProperty(amlNode,prop);}amlNode.dispatchEvent("unloadmodel");
};this.getXpathByAmlNode=function(amlNode){var n=this.$amlNodes[amlNode.$uniqueId];
if(!n){return false;}return n.xpath;};this.$loadInAmlNode=function(item){var xmlNode;
var xpath=item.xpath;var amlNode=item.amlNode;if(this.data&&xpath){xmlNode=this.data.selectSingleNode(xpath);
}else{xmlNode=this.data||null;}if(xmlNode){delete this.$listeners[amlNode.$uniqueId];
amlNode.load(xmlNode);}else{this.$waitForXml(amlNode);}};this.$loadInAmlProp=function(id,xmlNode){var prop,node,p=this.$propBinds[id],amlNode=apf.all[id];
if(!amlNode){delete this.$propBinds[id];return;}if(amlNode.$noInitModel){delete amlNode.$noInitModel;
return;}for(prop in p){if(xmlNode&&(node=p[prop].listen?xmlNode.selectSingleNode(p[prop].listen):xmlNode)){apf.xmldb.addNodeListener(xmlNode,amlNode,"p|"+id+"|"+prop+"|"+this.$uniqueId);
delete this.$proplisteners[id+prop];amlNode.$execProperty(prop,node);}else{this.$waitForXml(amlNode,prop);
}}};this.$bindXmlProperty=function(amlNode,prop,xpath,optimize,listenRoot){var q,p,id=amlNode.$uniqueId;
if(!this.$propBinds[id]){this.$propBinds[id]={};}p=this.$propBinds[id][prop]={bind:xpath};
if(optimize&&false){if((q=this.$amlNodes[id])&&q.xpath){xpath=(p.root=q.xpath)+"/"+xpath;
}var l=xpath.split("/"),z=l.pop();if(z.indexOf("@")==0||z.indexOf("text()")>-1||z.indexOf("node()")>-1){p.listen=l.join("/");
}else{p.listen=xpath;}}else{if((q=this.$amlNodes[id])&&q.xpath){p.listen=q.xpath;
}}if(listenRoot){p.listen=".";}if(this.data){var xmlNode=amlNode.$noInitModel?amlNode.xmlRoot:(p.listen?this.data.selectSingleNode(p.listen):this.data);
if(xmlNode){apf.xmldb.addNodeListener(xmlNode,amlNode,"p|"+amlNode.$uniqueId+"|"+prop+"|"+this.$uniqueId);
return p;}}this.$waitForXml(amlNode,prop);return p;};this.$unbindXmlProperty=function(amlNode,prop){var id=amlNode.$uniqueId;
var p=this.$propBinds[id]&&this.$propBinds[id][prop];if(!p){return;}if(this.data){var xmlNode=p.listen?this.data.selectSingleNode(p.listen):this.data;
if(xmlNode){apf.xmldb.removeNodeListener(xmlNode,amlNode,"p|"+id+"|"+prop+"|"+this.$uniqueId);
}}delete this.$proplisteners[id+prop];delete this.$propBinds[id][prop];return p;
};this.getXml=function(){return this.data?apf.xmldb.cleanNode(this.data.cloneNode(true)):false;
};this.setQueryValue=function(xpath,value){if(!this.data){return false;}var node=apf.createNodeFromXpath(this.data,xpath);
if(!node){return null;}apf.setNodeValue(node,value,true);return node;};this.setQueryValues=function(xpath,value){if(!this.data){return[];
}var nodes=this.data.selectNodes(xpath);for(var i=0,l=nodes.length;i<l;i++){apf.setNodeValue(node,value,true);
}return nodes;};this.queryValue=function(xpath){if(!this.data){return false;}return apf.queryValue(this.data,xpath);
};this.queryValues=function(xpath){if(!this.data){return[];}return apf.queryValue(this.data,xpath);
};this.queryNode=function(xpath){if(!this.data){return null;}return this.data.selectSingleNode(xpath);
};this.queryNodes=function(xpath){if(!this.data){return[];}return this.data.selectNodes(xpath);
};this.appendXml=function(xmlNode,xpath){var insertNode=xpath?apf.createNodeFromXpath(this.data,xpath):this.data;
if(!insertNode){return null;}if(typeof xmlNode=="string"){xmlNode=apf.getXml(xmlNode);
}else{xmlNode=!xmlNode.nodeType?xmlNode.getXml():apf.xmldb.getCleanCopy(xmlNode);
}if(!xmlNode){return;}apf.xmldb.appendChild(insertNode,xmlNode);this.dispatchEvent("update",{xmlNode:xmlNode});
return xmlNode;};this.removeXml=function(xmlNode){if(typeof xmlNode=="string"){var xmlNodes=this.data.selectNodes(xmlNode);
}else{if(!xmlNode.length){xmlNodes=[xmlNode];}}if(xmlNodes.length){apf.xmldb.removeNodeList(xmlNodes);
}};this.clear=function(){this.load(null);doc=null;};this.reset=function(){var doc=this.data.ownerDocument;
this.data.parentNode.replaceChild(this.$copy,this.data);this.load(this.$copy);};
this.savePoint=function(){this.$copy=apf.xmldb.getCleanCopy(this.data);};this.reloadAmlNode=function(uniqueId){if(!this.data){return;
}var item=this.$amlNodes[uniqueId];var xmlNode=item.xpath?this.data.selectSingleNode(item.xpath):this.data;
item.amlNode.load(xmlNode);};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var x=this.$aml;
if(this.parentNode&&this.parentNode.hasFeature(apf.__DATABINDING__)){if(!this.name){this.setProperty("id","model"+this.parentNode.$uniqueId);
}this.register(this.parentNode);}if(!this.src){var strXml,xmlNode=x;if(xmlNode&&xmlNode.childNodes.length){if(apf.getNode(xmlNode,[0])){if((strXml=xmlNode.xml||xmlNode.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/)){strXml=RegExp.$1;
if(!apf.supportNamespaces){strXml=strXml.replace(/xmlns=\"[^"]*\"/g,"");}}if(this.whitespace===false){strXml=strXml.replace(/>[\s\n\r]*</g,"><");
}return this.load(apf.getXmlDom(strXml).documentElement);}else{if(apf.isJson(xmlNode.childNodes[0].nodeValue)){return this.load(apf.getXmlDom(xmlNode.childNodes[0].nodeValue).documentElement);
}}}if(this.submission){this.load("<data />");}}if(!apf.isFalse(this.autoinit)){this.init();
}return this;});this.init=function(callback){if(this.session){this.$loadFrom(this.session,{isSession:true});
}else{if(this.src){this.$loadFrom(this.src,{callback:callback});}}};this.$loadFrom=function(instruction,options){var data=instruction.split(":");
if(!options){options={};}if(!options.isSession){this.src=instruction;this.$srcOptions=[instruction,options];
}this.dispatchEvent("beforeretrieve");var uniqueId,item;for(uniqueId in this.$amlNodes){if(!(item=this.$amlNodes[uniqueId])||!item.amlNode){continue;
}if(!item.amlNode.noloading){item.amlNode.clear("loading");}}this.$state=1;if(!this.$callCount){this.$callCount=1;
}else{this.$callCount++;}var _self=this,callCount=this.$callCount,callback=options.callback;
options.callback=function(data,state,extra){if(callCount!=_self.$callCount){return;
}_self.dispatchEvent("afterretrieve");if(state!=apf.SUCCESS){var oError;oError=new Error(apf.formatErrorString(1032,_self,"Loading xml data","Could not load data\nInstruction: "+instruction+"\nUrl: "+extra.url+"\nInfo: "+extra.message+"\n\n"+data));
if(callback&&callback.apply(this,arguments)===true){return true;}if(extra.tpModule&&extra.tpModule.retryTimeout(extra,state,_self,oError)===true){return true;
}_self.$state=0;throw oError;}if(options&&options.isSession&&!data){if(this.src){return _self.$loadFrom(this.src);
}}else{if(options&&options.cancel){return;}_self.load(data);_self.dispatchEvent("receive",{data:data});
if(callback){callback.apply(this,arguments);}}};return apf.getData(instruction,options);
};this.reload=function(){if(!this.data){return;}if(this.$srcOptions){this.$loadFrom.apply(this,this.$srcOptions);
}else{if(this.src){this.$loadFrom(this.src);}}};this.load=function(xmlNode,options){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){if(xmlNode.substr(0,5).toUpperCase()=="<!DOC"){xmlNode=xmlNode.substr(xmlNode.indexOf(">")+1);
}if(!apf.supportNamespaces){xmlNode=xmlNode.replace(/xmlns\=\"[^"]*\"/g,"");}xmlNode=apf.getXmlDom(xmlNode,null,true).documentElement;
}else{if(apf.isJson(xmlNode)){xmlNode=apf.json2Xml(xmlNode).documentElement;}else{return this.$loadFrom(xmlNode,options);
}}}if(this.ownerDocument&&this.ownerDocument.$domParser.$shouldWait){var _self=this;
this.data=xmlNode;apf.xmldb.getXmlDocId(xmlNode,this);this.$queueLoading=true;apf.queue.add("modelload"+this.$uniqueId,function(){if(_self.ownerDocument&&_self.ownerDocument.$domParser.$shouldWait){apf.queue.add("modelload"+_self.$uniqueId,arguments.callee);
}else{_self.load(xmlNode,options);_self.$queueLoading=false;}});return;}else{if(this.$queueLoading){apf.queue.remove("modelload"+this.$uniqueId);
}}this.$state=0;if(this.dispatchEvent("beforeload",{xmlNode:xmlNode})===false){return false;
}var doc=xmlNode?xmlNode.ownerDocument:null;if(xmlNode){if(!apf.supportNamespaces){var xmlns=[],attr=xmlNode.attributes;
for(var i=0,l=attr.length;i<l;i++){if(attr[i].nodeName.substr(0,5)=="xmlns"){xmlns.push(attr[i].xml);
}}if(xmlns.length){doc.setProperty("SelectionNamespaces",xmlns.join(" "));}}apf.xmldb.addNodeListener(xmlNode,this);
apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(xmlNode,this),xmlNode,null,this);if((!options||!options.nocopy)&&this.enablereset){this.$copy=apf.xmldb.getCleanCopy(xmlNode);
}}this.data=xmlNode;this.dispatchEvent("afterload",{xmlNode:xmlNode});this.dispatchEvent("update",{xmlNode:xmlNode});
for(var id in this.$amlNodes){this.$loadInAmlNode(this.$amlNodes[id]);}for(id in this.$propBinds){this.$loadInAmlProp(id,xmlNode);
}return this;};this.$waitForXml=function(amlNode,prop){if(prop){this.$proplisteners[amlNode.$uniqueId+prop]={id:amlNode.$uniqueId,amlNode:amlNode,prop:prop};
}else{this.$listeners[amlNode.$uniqueId]=amlNode;}if(amlNode.xmlRoot){amlNode.clear();
}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){if(action=="replacenode"&&xmlNode==this.data.ownerDocument.documentElement){var _self=this;
setTimeout(function(){_self.load(xmlNode);});return;}var p,b;for(var id in this.$listeners){if(xmlNode=this.data.selectSingleNode(this.$amlNodes[id].xpath||".")){this.$listeners[id].load(xmlNode);
delete this.$listeners[id];}}for(id in this.$proplisteners){p=this.$proplisteners[id];
b=this.$propBinds[p.id][p.prop];if(xmlNode=b.listen?this.data.selectSingleNode(b.listen):this.data){delete this.$proplisteners[id];
apf.xmldb.addNodeListener(xmlNode,p.amlNode,"p|"+p.id+"|"+p.prop+"|"+this.$uniqueId);
p.amlNode.$execProperty(p.prop,b.root?this.data.selectSingleNode(b.root):this.data);
}}this.dispatchEvent("update",{xmlNode:xmlNode,action:action,undoObj:UndoObj});
};this.$insertFrom=function(instruction,options){if(!instruction){return false;
}this.dispatchEvent("beforeretrieve");var callback=options.callback,_self=this;
options.callback=function(data,state,extra){_self.dispatchEvent("afterretrieve");
if(!extra){extra={};}if(state!=apf.SUCCESS){var oError;if(extra.tpModule.retryTimeout(extra,state,options.amlNode||_self,oError)===true){return true;
}if(callback&&callback.call(this,extra.data,state,extra)===false){return;}throw oError;
}if(typeof options.insertPoint=="string"){options.insertPoint=_self.data.selectSingleNode(options.insertPoint);
}if(typeof options.clearContents=="undefined"&&extra.userdata){options.clearContents=apf.isTrue(extra.userdata[1]);
}if(options.whitespace==undefined){options.whitespace=_self.whitespace;}(options.amlNode||_self).insert(data,options);
if(callback){callback.call(this,extra.data,state,extra);}};apf.getData(instruction,options);
};this.insert=function(xmlNode,options){if(typeof xmlNode=="string"){if(xmlNode.charAt(0)=="<"){if(xmlNode.substr(0,5).toUpperCase()=="<!DOC"){xmlNode=xmlNode.substr(xmlNode.indexOf(">")+1);
}if(!apf.supportNamespaces){xmlNode=xmlNode.replace(/xmlns\=\"[^"]*\"/g,"");}if(this.whitespace===false){xmlNode=xmlNode.replace(/>[\s\n\r]*</g,"><");
}xmlNode=apf.getXmlDom(xmlNode).documentElement;}else{if(apf.isJson(xmlNode)){xmlNode=apf.json2Xml(xmlNode).documentElement;
}else{return this.$insertFrom(xmlNode,options);}}}if(!options.insertPoint){options.insertPoint=this.data;
}if(typeof options.copyAttributes=="undefined"){options.copyAttributes=true;}var newNode=apf.mergeXml(xmlNode,options.insertPoint,options);
apf.xmldb.applyChanges("insert",options.insertPoint);return xmlNode;};this.convertXml=function(type){if(!type){return this.data.xml;
}return apf.convertXml(this.data,type);};this.submit=function(instruction,type,xmlNode,options){if(!instruction){instruction=this.submission;
}if(!xmlNode){xmlNode=this.data;}if(!type){type="form";}if(this.dispatchEvent("beforesubmit",{instruction:instruction})===false){return false;
}var model=this;function cbFunc(data,state,extra){if((state==apf.TIMEOUT||(model.retryOnError&&state==apf.ERROR))&&extra.retries<apf.maxHttpRetries){return extra.tpModule.retry(extra.id);
}else{if(state!=apf.SUCCESS){model.dispatchEvent("submiterror",extra);}else{model.dispatchEvent("submitsuccess",apf.extend({data:data},extra));
}}}var data;if(type.indexOf("xml")>-1){data=apf.getXmlString(xmlNode);}else{if(type.indexOf("form")>-1){data=apf.convertXml(apf.xmldb.getCleanCopy(xmlNode),"cgiobjects");
}else{if(type.indexOf("json")>-1){data=apf.convertXml(xmlNode,"json");}}}apf.saveData(instruction,apf.extend({xmlNode:xmlNode,data:data,callback:cbFunc},options));
this.dispatchEvent("aftersubmit");};this.$destroy=function(){if(this.session&&this.data){apf.saveData(this.session,{xmlNode:this.getXml()});
}};}).call(apf.model.prototype=new apf.AmlElement());apf.aml.setElement("model",apf.model);
apf.page=function(struct,tagName){this.$init(tagName||"page",apf.NODE_VISIBLE,struct);
};(function(){this.canHaveChildren=true;this.$focussable=false;this.closebtn=false;
this.setCaption=function(caption){this.setProperty("caption",caption,false,true);
};this.setIcon=function(icon){this.setProperty("icon",icon,false,true);};this.addEventListener("beforerender",function(){this.parentNode.dispatchEvent("beforerender",{page:this});
});this.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterrender",{page:this});
});this.$booleanProperties.visible=true;this.$booleanProperties.fake=true;this.$booleanProperties.closebtn=true;
this.$supportedProperties.push("fake","caption","icon","tooltip","type","buttons","closebtn","trans-in","trans-out");
this.$propHandlers.closebtn=function(value){this.closebtn=value;};this.$propHandlers.tooltip=function(value){if(!this.parentNode){return;
}var node=this.parentNode.$getLayoutNode("button","caption",this.$button);(node.nodeType==1?node:node.parentNode).setAttribute("title",value||"");
};this.$propHandlers.caption=function(value){if(!this.parentNode){return;}var node=this.parentNode.$getLayoutNode("button","caption",this.$button);
if(node.nodeType==1){node.innerHTML=value;}else{node.nodeValue=value;}};this.$propHandlers.icon=function(value){if(!this.parentNode){return;
}var node=this.parentNode.$getLayoutNode("button","icon",this.$button);if(node&&node.nodeType==1){apf.skins.setIcon(node,value,this.parentNode.iconPath);
}};this.$propHandlers.visible=function(value){if(!this.parentNode){return;}if(value){if(this.$fake){this.parentNode.set(this.$fake);
this.visible=false;return;}this.$ext.style.display="";if(this.parentNode.$hasButtons){this.$button.style.display="block";
}if(!this.parentNode.$activepage){this.parentNode.set(this);}}else{if(this.$active){this.$deactivate();
var nextPage=this.parentNode.activepagenr+1;var pages=this.parentNode.getPages();
var len=pages.length;while(nextPage<len&&!pages[nextPage].visible){nextPage++;}if(nextPage==len){nextPage=this.parentNode.activepagenr-1;
while(nextPage>=0&&len&&!pages[nextPage].visible){nextPage--;}}if(nextPage>=0){this.parentNode.set(nextPage);
}else{this.parentNode.activepage=this.parentNode.activepagenr=this.parentNode.$activepage=null;
}}this.$ext.style.display="none";if(this.parentNode.$hasButtons){this.$button.style.display="none";
}}};this.$propHandlers.fake=function(value){if(this.$ext){apf.destroyHtmlNode(this.$ext);
this.$int=this.$ext=null;}};this.$propHandlers.type=function(value){this.setProperty("fake",true);
if(this.relPage&&this.$active){this.relPage.$deactivate();}this.relPage=this.parentNode.getPage(value);
if(this.$active){this.$activate();}};this.addEventListener("DOMNodeRemoved",function(e){if(e&&e.currentTarget!=this){return;
}if(this.$button){if(this.$position&1){this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);
}if(this.$position&2){this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);
}}if(!e.$doOnlyAdmin){if(this.$button){this.$button.parentNode.removeChild(this.$button);
}if(this.parentNode&&this.parentNode.$activepage==this){if(this.$button){this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);
}this.parentNode.$setStyleClass(this.$ext,"",["curpage"]);}}});this.addEventListener("DOMNodeInserted",function(e){if(e&&e.currentTarget!=this||!this.$amlLoaded){return;
}if(!e.$isMoveWithinParent&&this.skinName!=this.parentNode.skinName){this.$destroy();
}else{if(this.$button&&(!e.$oldParent||e.$oldParent.$hasButtons)&&this.parentNode.$buttons){this.parentNode.$buttons.insertBefore(this.$button,e.$beforeNode&&e.$beforeNode.$button||null);
}}},true);this.$position=0;this.$first=function(remove){if(remove){this.$isFirst=false;
this.$position-=1;this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);
}else{this.$isFirst=true;this.$position=this.$position|1;this.parentNode.$setStyleClass(this.$button,"firstbtn"+(this.parentNode.$activepage==this?" firstcurbtn":""));
}};this.$last=function(remove){if(remove){this.$isLast=false;this.$position-=2;
this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}else{this.$isLast=true;
this.$position=this.$position|2;this.parentNode.$setStyleClass(this.$button,"lastbtn");
}};this.$deactivate=function(fakeOther){this.$active=false;if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"",["firstcurbtn"]);
}this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}if((!this.fake||this.relPage)&&!fakeOther){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"",["curpage"]);
if(this.fake){if(!this.relPage.visible){this.relPage.$ext.style.display="none";
}this.relPage.dispatchEvent("prop.visible",{value:false});}this.dispatchEvent("prop.visible",{value:false});
}};this.$activate=function(){this.$active=true;if(!this.$drawn){var f;this.addEventListener("DOMNodeInsertedIntoDocument",f=function(e){this.removeEventListener("DOMNodeInsertedIntoDocument",f);
if(!this.$active){return;}this.$activate();});return;}if(this.parentNode.$hasButtons){if(this.$isFirst){this.parentNode.$setStyleClass(this.$button,"firstcurbtn");
}this.parentNode.$setStyleClass(this.$button,"curbtn");}if(!this.fake||this.relPage){if(this.fake){if(this.relPage){this.relPage.$ext.style.display="";
this.parentNode.$setStyleClass(this.relPage.$ext,"curpage");this.relPage.$fake=this;
if(this.relPage.$render){this.relPage.$render();}this.relPage.dispatchEvent("prop.visible",{value:true});
}}else{this.parentNode.$setStyleClass(this.$ext,"curpage");}if(apf.layout&&this.relPage){apf.layout.forceResize(this.fake?this.relPage.$int:this.$int);
}}if(this.$render){this.$render();}if(!this.fake){if(apf.isIE){var cls=this.$ext.className;
this.$ext.className="rnd"+Math.random();this.$ext.className=cls;}this.dispatchEvent("prop.visible",{value:true});
}};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);
}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$enable=function(){if(this.$button){this.$setStyleClass(this.$button,null,["btnDisabled"]);
}};this.$disable=function(){if(this.$button){this.$setStyleClass(this.$button,"btnDisabled");
}};this.$canLeechSkin=true;this.addEventListener("prop.class",function(e){apf.setStyleClass(this.$button,e.value,this.$lastClassValueBtn?[this.$lastClassValueBtn]:null);
this.$lastClassValueBtn=e.value;});this.$draw=function(isSkinSwitch){this.skinName=this.parentNode.skinName;
var sType=this.getAttribute("type");if(sType){this.fake=true;this.relPage=this.parentNode.getPage(sType)||null;
}if(this.parentNode.$hasButtons){this.parentNode.$getNewContext("button");var elBtn=this.parentNode.$getLayoutNode("button");
elBtn.setAttribute(this.parentNode.$getOption("main","select")||"onmousedown","var page = apf.lookup("+this.$uniqueId+');                 if (page.disabled) return;                 if (event.button == 2 &amp;&amp; page.parentNode.contextmenu) {                    page.parentNode.contextPage = page;                    return;                 }                 page.parentNode.set(page);                 page.canHaveChildren = 2;                 page.$setStyleClass(this, "down", null, true);');
elBtn.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+').parentNode.$setStyleClass(this, "", ["down"], true);');
elBtn.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+").parentNode;if(apf.lookup("+this.$uniqueId+') != o.$activepage) o.$setStyleClass(this, "over", null, true);');
elBtn.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+').parentNode;                  o.$setStyleClass(this, "", ["over"], true);                  var page = apf.lookup('+this.$uniqueId+");                  page.canHaveChildren = true;");
var closebtn=this.getAttribute("closebtn");if((apf.isTrue(closebtn)||((this.parentNode.buttons||"").indexOf("close")>-1&&!apf.isFalse(closebtn)))){var btncontainer=this.parentNode.$getLayoutNode("button","container");
this.parentNode.$getNewContext("btnclose");var elBtnClose=this.parentNode.$getLayoutNode("btnclose");
if(elBtnClose){apf.setStyleClass(elBtn,"btnclose");elBtnClose.setAttribute("onmousedown","apf.cancelBubble(event, apf.lookup("+this.$uniqueId+"));");
elBtnClose.setAttribute("onclick","var page = apf.lookup("+this.$uniqueId+");                         page.parentNode.remove(page, event);");
btncontainer.appendChild(elBtnClose);}}this.$button=apf.insertHtmlNode(elBtn,this.parentNode.$buttons);
if(this.parentNode.$scale){var w=apf.getHtmlInnerWidth(this.parentNode.$buttons);
var l=this.parentNode.getPages().length;this.$button.style.width=Math.round(Math.min(w/l,this.parentNode.$maxBtnWidth))+"px";
}if(!isSkinSwitch&&this.nextSibling&&this.nextSibling.$button){this.$button.parentNode.insertBefore(this.$button,this.nextSibling.$button);
}this.$button.host=this;}if(this.fake){return;}if(this.$ext){this.$ext.parentNode.removeChild(this.$ext);
}this.$ext=this.parentNode.$getExternal("page",this.parentNode.oPages,null,this);
this.$ext.host=this;this.$int=this.parentNode.$getLayoutNode("page","container",this.$ext);
if(this.$isLast){this.$last();}if(this.$isFirst){this.$first();}};this.$destroy=function(){if(this.$button){if(!this.parentNode.$amlDestroyed){this.$button.parentNode.removeChild(this.$button);
}this.$button.host=null;this.$button=null;}};}).call(apf.page.prototype=new apf.Presentation());
apf.aml.setElement("page",apf.page);apf.pager=function(struct,tagName){this.$init(tagName||"pager",apf.NODE_VISIBLE,struct);
};(function(){this.previous="Previous";this.next="Next";this.range=5;this.curpage=1;
this.totalpages=0;this.autohide=false;this.oEmpty=null;this.$attrExcludePropBind=apf.extend({pageload:1},this.$attrExcludePropBind);
this.$supportedProperties.push("range","curpage","totalpages","previous","next","autohide","pageload");
this.$booleanProperties.autohide=true;this.$propHandlers.curpage=function(value){this.gotoPage(value);
};this.gotoPage=function(pageNr,pageDelta,userAction){if(userAction&&this.disabled){return;
}var lastCurpage=this.curpage;this.curpage=pageNr||this.curpage+pageDelta;if(lastCurpage!=this.curpage){this.setProperty("curpage",this.curpage);
}if(this.curpage<1){this.curpage=1;}else{if(this.totalpages&&this.curpage>this.totalpages){this.curpage=this.totalpages;
}}if(this.dispatchEvent("beforepagechange",{page:this.curpage})===false){return false;
}var model=this.getModel(true),_self=this;if(model){model.$loadFrom(this.pageload,{xmlNode:this.xmlRoot,page:this.curpage,callback:function(){_self.dispatchEvent("afterpagechange",{page:_self.curpage});
}});}else{$setTimeout(function(){var model=_self.getModel(true);if(model){model.$loadFrom(_self.pageload,{xmlNode:_self.xmlRoot,page:_self.curpage,callback:function(){_self.dispatchEvent("afterpagechange",{page:_self.curpage});
}});}_self.removeEventListener("afterload",arguments.callee);});}};this.addEventListener("$clear",function(e){return false;
});this.$setClearMessage=function(msg,type){if(!this.$empty){this.$empty=this.$container.ownerDocument.createElement("span");
this.$setStyleClass(this.$empty,"loader");}if(type=="loading"){this.$setStyleClass(this.$ext,this.$baseCSSname+"Loading");
this.$container.appendChild(this.$empty);}};this.$removeClearMessage=function(){if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);
this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Loading"]);}};this.$draw=function(){this.$ext=this.$getExternal("main");
this.$container=this.$getLayoutNode("main","container",this.$ext);};this.$load=function(xmlRoot){this.setProperty("curpage",parseInt(this.$applyBindRule("current",xmlRoot)));
this.setProperty("totalpages",parseInt(this.$applyBindRule("total",xmlRoot)));var curpage=this.curpage,totalpages=this.totalpages,nodes=[],btn;
this.$container.innerHTML="";if(!totalpages){return;}if(curpage!=1||!this.autohide){this.$getNewContext("button");
btn=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=this.previous;
this.$setStyleClass(btn,"previous");if(curpage!=1){btn.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage(null, -1, true)");
btn.setAttribute("onmousedown",'apf.setStyleClass(this, "down");');btn.setAttribute("onmouseup",'apf.setStyleClass(this,"", ["down"]);');
}else{this.$setStyleClass(btn,"disabled");}nodes.push(btn);}var rlow=Math.floor(this.range/2),start=Math.max(1,curpage-rlow),end=Math.min(totalpages+1,start+this.range),i;
if(end-start<this.range&&start!=1){start=Math.max(end-this.range,1);}for(i=start;
i<end;i++){this.$getNewContext("button");btn=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=i;
btn.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage("+i+", null, true)");
btn.setAttribute("onmousedown",'apf.setStyleClass(this, "down");');btn.setAttribute("onmouseup",'apf.setStyleClass(this,"", ["down"]);');
nodes.push(btn);if(i==curpage){this.$setStyleClass(btn,"current");}}if(curpage!=totalpages||!this.autohide){this.$getNewContext("button");
btn=this.$getLayoutNode("button");this.$getLayoutNode("button","caption").nodeValue=this.next;
this.$setStyleClass(btn,"next");if(curpage!=totalpages){btn.setAttribute("onclick","apf.lookup("+this.$uniqueId+").gotoPage(null, 1, true)");
btn.setAttribute("onmousedown",'apf.setStyleClass(this, "down");');btn.setAttribute("onmouseup",'apf.setStyleClass(this,"", ["down"]);');
}else{this.$setStyleClass(btn,"disabled");}nodes.push(btn);}apf.insertHtmlNodes(nodes,this.$container);
if(this.$empty){this.$container.appendChild(this.$empty);}};}).call(apf.pager.prototype=new apf.StandardBinding());
apf.aml.setElement("pager",apf.pager);apf.aml.setElement("total",apf.BindingRule);
apf.aml.setElement("current",apf.BindingRule);apf.param=function(struct,tagName){this.$init(tagName||"param",apf.NODE_HIDDEN,struct);
};apf.param.prototype=new apf.AmlElement();apf.param.prototype.$parsePrio="002";
apf.aml.setElement("variable",apf.param);apf.aml.setElement("param",apf.param);
apf.propedit=function(struct,tagName){this.$init(tagName||"propedit",apf.NODE_VISIBLE,struct);
this.$nodes=[];this.$editors={};this.$dynCssClasses=[];};(function(){this.$init(function(){this.addEventListener("keydown",keyHandler,true);
});this.implement(apf.Cache);this.implement(apf.DataAction);this.$focussable=true;
this.$isTreeArch=true;this.$isWindowContainer=-1;this.startClosed=true;this.$animType=apf.tween.NORMAL;
this.$animSteps=3;this.$animSpeed=20;this.$useiframe=0;this.$attrExcludePropBind=apf.extend({properties:3},this.$attrExcludePropBind);
this.$booleanProperties.iframe=true;this.$propHandlers.properties=function(value){if(!value){return this.clear();
}var _self=this;var propLoadObj={load:function(data){_self.$loadingProps=false;
if(typeof data=="string"){data=apf.getXml(data);}_self.$properties=data;_self.$allowLoad=true;
if(_self.$loadqueue){_self.$checkLoadQueue();}else{if(_self.xmlRoot){_self.load(_self.xmlRoot);
}}delete _self.$allowLoad;},clear:function(){_self.$loadingProps=false;},xmlRoot:this.xmlRoot};
var xml;this.$loadingProps=true;if(typeof value=="string"){if(value.substr(0,1)=="<"){propLoadObj.load(value);
}else{apf.setModel(value,propLoadObj);}}else{if(value.$isModel){value.register(propLoadObj);
}else{if(this.$properties==value&&!this.caching){return;}propLoadObj.load(value);
}}if(this.$properties){this.$prevProperties=this.$properties;}delete this.$properties;
};this.addEventListener("prop.properties",function(e){if(!e.changed&&this.$loadqueue){this.$propHandlers.properties.call(this,e.value);
}});this.$columns=["50%","50%"];this.$propHandlers.columns=function(value){this.$columns=value&&value.splitSafe(",")||["50%","50%"];
if(this.$headings){this.$headings[0].setProperty("width",this.$columns[0]);this.$headings[1].setProperty("width",this.$columns[1]);
}};this.$propHandlers.filter=function(value){if(!value){this.$allowLoad=2;var xmlRoot=this.xmlRoot;
this.clear();if(this.$searchProperties){this.$properties=this.$searchProperties;
delete this.$searchProperties;}this.load(xmlRoot);delete this.$allowLoad;return;
}var p=(this.$searchProperties||(this.$searchProperties=this.$getProperties())).cloneNode(true);
var nodes=p.selectNodes("//node()[not(local-name()='group' or contains(translate(@caption, 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), '"+value+"'))]");
for(var i=nodes.length-1;i>=0;i--){nodes[i].parentNode.removeChild(nodes[i]);}nodes=p.selectNodes("//node()[local-name()='group' and not(node())]");
var parent;for(var i=nodes.length-1;i>=0;i--){parent=nodes[i].parentNode;parent.removeChild(nodes[i]);
if(!parent.childNodes.length&&parent.parentNode){parent.parentNode.removeChild(parent);
}}var xmlRoot=this.xmlRoot;this.clear();this.$properties=p;this.$allowLoad=2;this.load(xmlRoot,{force:true});
delete this.$allowLoad;};function scrollIntoView(){var Q=(this.current||this.$selected),o=this.$body;
o.scrollTop=(Q.offsetTop)-21;}this.$findHtmlNode=function(id){return this.$pHtmlDoc.getElementById(id);
};function keyHandler(e){var key=e.keyCode,ctrlKey=e.ctrlKey,shiftKey=e.shiftKey;
var selXml=this.$lastEditor&&this.$lastEditor[2],oInt=this.$useiframe?this.oDoc.documentElement:this.$body,margin,node,hasScroll,hasScrollX,hasScrollY,items,lines;
switch(key){case 36:return false;case 35:return false;case 107:break;case 37:this.$slideToggle(this.$selected.firstChild);
return false;case 107:case 39:this.$slideToggle(this.$selected.firstChild);return false;
case 38:var node=selXml;var sNode=selXml.previousSibling;while(sNode&&sNode.nodeType!=1){sNode=sNode.previousSibling;
}if(sNode){var last=sNode,nodes;while((nodes=last.selectNodes("prop")).length){last=nodes[nodes.length-1];
}sNode=last;}else{sNode=node.parentNode;if(sNode[apf.TAGNAME]!="prop"){sNode=sNode.previousSibling;
while(sNode&&sNode.nodeType!=1){sNode=sNode.previousSibling;}if(sNode&&sNode[apf.TAGNAME]!="prop"){sNode=(nodes=sNode.selectNodes("prop"))[nodes.length-1];
while(sNode&&sNode.nodeType!=1){sNode=sNode.previousSibling;}}}}if(!sNode){return;
}var selHtml=apf.xmldb.findHtmlNode(sNode,this);while(!selHtml.offsetWidth){selHtml=apf.xmldb.findHtmlNode(sNode=sNode.parentNode,this);
}var top=apf.getAbsolutePosition(selHtml,this.$body)[1]-(selHtml.offsetHeight/2);
if(top<=this.$ext.scrollTop){this.$ext.scrollTop=top;}this.select(selHtml);return false;
case 40:var node,sNode=(node=selXml).selectSingleNode("prop")||node.nextSibling;
do{while(sNode&&(sNode.nodeType!=1||sNode[apf.TAGNAME]!="prop")){sNode=sNode.nextSibling;
}if(!sNode){sNode=node.parentNode.nextSibling;if(sNode&&sNode[apf.TAGNAME]!="prop"){sNode=sNode.selectSingleNode("prop");
}}}while(sNode&&sNode.nodeType!=1);if(!sNode){return;}var selHtml=apf.xmldb.findHtmlNode(sNode,this);
while(!selHtml.offsetWidth){selHtml=apf.xmldb.findHtmlNode(sNode=sNode.parentNode,this);
}if(sNode==node){sNode=node.nextSibling;while(sNode&&(sNode.nodeType!=1||sNode[apf.TAGNAME]!="prop")){sNode=sNode.nextSibling;
}var selHtml=apf.xmldb.findHtmlNode(sNode,this);}var top=apf.getAbsolutePosition(selHtml,this.$body)[1]+(selHtml.offsetHeight/2);
if(top>this.$ext.scrollTop+this.$ext.offsetHeight){this.$ext.scrollTop=top-this.$ext.offsetHeight;
}this.select(selHtml);return false;}}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;
}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}if(this.$lastEditor){this.$lastEditor[0].$focus();}};this.$blur=function(){if(this.renaming){this.stopRename(null,true);
}if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);
if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);
}if(this.$lastEditor){this.$lastEditor[0].$blur();}};this.$slideToggle=function(htmlNode){container=htmlNode.parentNode.lastChild;
if(apf.getStyle(container,"display")=="block"){htmlNode.className=htmlNode.className.replace(/min/,"plus");
this.$slideClose(container);}else{htmlNode.className=htmlNode.className.replace(/plus/,"min");
this.$slideOpen(container);}};this.$slideOpen=function(container){container.style.display="";
apf.tween.single(container,{type:"scrollheight",from:3,diff:-2,to:container.scrollHeight,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(container){container.style.overflow="visible";
container.style.height="auto";}});};this.$slideClose=function(container){container.style.height=container.offsetHeight;
container.style.overflow="hidden";apf.tween.single(container,{type:"scrollheight",from:container.scrollHeight,diff:-2,to:0,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(container,data){container.style.display="none";
}});};this.$findContainer=function(htmlNode){var node=htmlNode.nextSibling;if(!node){return htmlNode;
}return node.nodeType==1?node:node.nextSibling;};this.addEventListener("bindingsload",this.$loaddatabinding=function(e){var rules=e.bindings.properties;
if(!rules||!rules.length){return;}for(var i=0,l=rules.length;i<l;i++){}});this.$unloaddatabinding=function(){};
this.getColumn=function(nr){return this.$headings[nr||this.$lastcol||0];};this.resizeColumn=function(nr,newsize){var h=this.$headings[nr];
h.resize(newsize);};this.hideColumn=function(nr){var h=this.$headings[nr];h.hide();
};this.showColumn=function(nr){var h=this.$headings[nr];h.show();};this.$getProperties=function(xmlNode){if(this.properties){return this.$properties||false;
}else{if(this.$bindings.properties){var props=this.$bindings.properties;for(var i=0;
i<props.length;i++){if(!props[i].match){return xx;}}}}return false;};this.$canLoadData=function(){if(this.$allowLoad||!this.$attrBindings.properties){return this.$getProperties()?true:false;
}else{if(false){var _self=this;apf.queue.add("load"+this.$uniqueId,function(){_self.$allowLoad=true;
_self.$checkLoadQueue();delete _self.$allowLoad;});return false;}}};this.$generateCacheId=function(xmlNode){var node=this.$getProperties();
return node?node.getAttribute(apf.xmldb.xmlIdTag)||apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(node),node):0;
};this.$getCurrentFragment=function(){var fragment=this.$container.ownerDocument.createDocumentFragment();
fragment.properties=this.$searchProperties||this.$prevProperties||this.$properties;
while(this.$container.childNodes.length){fragment.appendChild(this.$container.childNodes[0]);
}this.clearSelection();return fragment;};this.$setCurrentFragment=function(fragment){this.$container.appendChild(fragment);
if(!apf.window.hasFocus(this)){this.blur();}apf.xmldb.addNodeListener(this.xmlRoot,this);
if(this.filter&&this.$allowLoad!=2){delete this.$searchProperties;this.$prevProperties=fragment.properties;
this.$propHandlers.filter.call(this,this.filter);}else{this.$xmlUpdate(null,this.xmlRoot);
this.$properties=fragment.properties;this.select(apf.xmldb.findHtmlNode(this.$properties.selectSingleNode(".//prop"),this));
}};this.$load=function(xmlNode){var p=this.$getProperties();if(!p){return false;
}var output=[];var docId=this.documentId=apf.xmldb.getXmlDocId(p);apf.xmldb.addNodeListener(xmlNode,this);
var _self=this,doc=p.ownerDocument;(function walk(nodes,parent,depth){for(var u,s,cell,sLid,pnode,html,node,i=0,l=nodes.length;
i<l;i++){node=nodes[i];_self.$getNewContext("row");html=_self.$getLayoutNode("row");
if(node[apf.TAGNAME]=="group"){_self.$getNewContext("cell");apf.setStyleClass(html,"heading");
cell=html.appendChild(_self.$getLayoutNode("cell"));apf.setNodeValue(_self.$getLayoutNode("cell","caption",cell),(node.getAttribute("caption")||"").trim()||"");
pnode=html.appendChild(doc.createElement("blockquote"));walk(node.selectNodes("prop"),pnode,depth);
html.insertBefore(u=doc.createElement("u"),html.firstChild).appendChild(doc.createTextNode(" "));
u.setAttribute("class","min");}else{apf.xmldb.nodeConnect(docId,node,html,_self);
_self.$getNewContext("cell");h=_self.$headings[0];cell=html.appendChild(_self.$setStyleClass(_self.$getLayoutNode("cell"),h.$className));
apf.setNodeValue(_self.$getLayoutNode("cell","caption",cell),(node.getAttribute("caption")||"").trim()||"");
if(depth){cell.firstChild.setAttribute("style","padding-left:"+(depth*15)+"px");
}_self.$getNewContext("cell");h=_self.$headings[1];cell=html.appendChild(_self.$setStyleClass(_self.$getLayoutNode("cell"),h.$className));
apf.setNodeValue(_self.$getLayoutNode("cell","caption",cell),((apf.lm.compile(node.getAttribute("value"),{nostring:true}))(_self.xmlRoot)||"")||"");
if((s=node.selectNodes("prop")).length){pnode=html.appendChild(doc.createElement("blockquote"));
pnode.setAttribute("style","display:none;overflow:hidden;height:0;");walk(s,_self.$getLayoutNode("heading","container",pnode),depth+1);
html.insertBefore(u=doc.createElement("u"),html.firstChild).appendChild(doc.createTextNode(" "));
u.setAttribute("class","plus");}}if(!parent){output.push(html);}else{parent.appendChild(html);
}}})(p.selectNodes("group|prop"),null,0);apf.insertHtmlNodes(output,this.$body);
this.setProperty("root",this.xmlRoot);var prop=p.selectSingleNode(".//prop");if(prop){this.select(this.$findHtmlNode(prop.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));
}if(this.filter&&this.$allowLoad!=2){delete this.$searchProperties;this.$propHandlers.filter.call(this,this.filter);
}};this.$xmlUpdate=function(action,xmlNode,listenNode,UndoObj){if(xmlNode!=this.xmlRoot){return;
}if(UndoObj&&this.$lastEditor[0]==UndoObj.amlNode){this.$lastEditor[1].firstChild.innerHTML=((apf.lm.compile(this.$lastEditor[2].getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";
}else{var p=this.$getProperties();if(!p){return;}var node,htmlNode,nodes=p.selectNodes(".//group/prop");
for(var i=0,l=nodes.length;i<l;i++){node=nodes[i];htmlNode=this.$findHtmlNode(node.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);
htmlNode.childNodes[htmlNode.firstChild.tagName=="U"?2:1].firstChild.innerHTML=((apf.lm.compile(node.getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";
}}};this.$hideEditor=function(remove){if(this.$lastEditor){this.$lastEditor[0].setProperty("visible",false);
if(remove){var pNode=this.$lastEditor[0].$ext.parentNode;pNode.removeChild(this.$lastEditor[0].$ext);
pNode.removeAttribute("id");delete pNode.onresize;}var nodes=this.$lastEditor[1].childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(!nodes[i].host){nodes[i].style.display="";
}}delete this.$lastEditor;}};this.clearSelection=function(){this.$setStyleClass(this.$selected,"",["selected"]);
delete this.$selected;this.$hideEditor();};this.select=function(htmlNode){if(this.disabled){return;
}if(this.$selected==htmlNode){return;}if(this.$selected){this.$setStyleClass(this.$selected,"",["selected"]);
}this.$setStyleClass(htmlNode,"selected");this.$selected=htmlNode;this.$hideEditor();
var prop=apf.xmldb.getNode(htmlNode);var _self=this;this.setProperty("selected",prop);
var editParent=this.$selected.childNodes[this.$selected.firstChild.tagName=="U"?2:1];
var oEditor,editor=prop.getAttribute("editor");var ceditor=apf.lm.compile(editor,{xpathmode:2});
if(ceditor.type==2){if(!this.$editors[editor]){var constr=apf.namespaces[apf.ns.aml].elements[editor];
var isTextbox="textarea|textbox|secret".indexOf(editor)>-1;var info={htmlNode:editParent,width:"100%+2",height:19,style:"position:relative;",value:"[{"+this.id+".root}::"+(v=prop.getAttribute("value")).substr(1,v.length-2)+"]",focussable:false,realtime:!isTextbox};
if(isTextbox){info.focusselect=true;info.onkeydown=function(e){if(e.keyCode==13){this.change(this.getValue());
}};}else{if(editor=="checkbox"){info.values="true|false";}}if(constr.prototype.hasFeature(apf.__MULTISELECT__)){info.caption="[text()]";
info.eachvalue="[@value]";info.each="item";info.model="{apf.xmldb.getElementById('"+prop.getAttribute(apf.xmldb.xmlIdTag)+"')}";
}oEditor=this.$editors[editor]=new constr(info);var box=apf.getBox(apf.getStyle(oEditor.$ext,"margin"));
if(box[1]||box[3]){oEditor.setAttribute("width","100%+2-"+(box[1]+box[3]));}else{if(!box[3]){oEditor.$ext.style.marginLeft="-1px";
}}oEditor.parentNode=this;oEditor.$focusParent=this;oEditor.setAttribute("focussable","true");
oEditor.$parentId=editParent.getAttribute("id");oEditor.$parentRsz=editParent.onresize;
oEditor.$executeAction=function(atAction,args,action,xmlNode,noevent,contextNode,multiple){if(atAction=="setAttribute"&&!args[2]){atAction="removeAttribute";
}this.parentNode.$executeAction.call(this.parentNode,atAction,args,action,xmlNode,noevent,contextNode,multiple);
};}else{oEditor=this.$editors[editor];if(oEditor.hasFeature(apf.__MULTISELECT__)){oEditor.setAttribute("model","{apf.xmldb.getElementById('"+prop.getAttribute(apf.xmldb.xmlIdTag)+"')}");
}oEditor.setAttribute("value","[{"+this.id+".root}::"+(v=prop.getAttribute("value")).substr(1,v.length-2)+"]");
oEditor.setProperty("visible",true);if(oEditor.$ext.parentNode&&oEditor.$ext.parentNode.nodeType==1&&!apf.hasSingleResizeEvent){if(!oEditor.$parentRsz){oEditor.$parentRsz=oEditor.$ext.parentNode.onresize;
}oEditor.$ext.parentNode.removeAttribute("id");delete oEditor.$ext.parentNode.onresize;
}editParent.appendChild(oEditor.$ext);editParent.setAttribute("id",editParent.$parentId);
if(oEditor.$parentRsz&&!apf.hasSingleResizeEvent){editParent.onresize=oEditor.$parentRsz;
editParent.onresize();}}}else{var obj=ceditor.call(this,this.xmlRoot);if(obj.localName=="template"){}else{}}var nodes=editParent.childNodes;
for(var i=0,l=nodes.length;i<l;i++){if(!nodes[i].host){nodes[i].style.display="none";
}}this.$lastEditor=[oEditor,editParent,prop];};this.addEventListener("$clear",function(e){this.$hideEditor(true);
});this.$draw=function(){this.$ext=this.$getExternal();this.$body=this.$getLayoutNode("main","body",this.$ext);
this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);
this.$container=this.$body;if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);
}if(this.$body.firstChild){this.$body.removeChild(this.$body.firstChild);}var widthdiff=this.$widthdiff=this.$getOption("main","widthdiff")||0;
this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);
var _self=this;if(this.$useiframe&&!this.oIframe){var sClass=this.$body.className;
this.oIframe=this.$body.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));
this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;
this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');
this.$body=this.oDoc.body;this.$body.className=sClass;this.oDoc.documentElement.className=this.$ext.className;
apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);
if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");
}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,"overflowY")=="auto"){this.oIframe.onresize=function(){_self.$head.style.marginRight=_self.oDoc.documentElement.scrollHeight>_self.oDoc.documentElement.offsetHeight?"16px":"0";
};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);
}this.oDoc.documentElement.onmousedown=function(e){if(!e){e=_self.oWin.event;}if((e.srcElement||e.target).tagName=="HTML"){apf.popup.forceHide();
}};this.oDoc.documentElement.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.oDoc.documentElement.scrollLeft;
}};}else{if(apf.getStyle(this.$body,"overflowY")=="auto"){this.$resize=function(){_self.$head.style.marginRight=_self.$body.scrollHeight>_self.$body.offsetHeight?"16px":"0";
};this.addEventListener("resize",this.$resize);this.addEventListener("afterload",this.$resize);
this.addEventListener("xmlupdate",this.$resize);}this.$body.onmousedown=function(e){if(!e){e=event;
}if((e.srcElement||e.target)==this){apf.popup.forceHide();}};this.$body.onscroll=function(){if(_self.$isFixedGrid){_self.$head.scrollLeft=_self.$body.scrollLeft;
}};}var _self=this;this.$body.onmousedown=function(e){if(!e){e=event;}var target=e.srcElement||e.target;
if(target==this){return;}if(target.tagName=="U"){_self.$slideToggle(target);return;
}while(target.host||(target.getAttribute(apf.xmldb.htmlIdTag)||"").indexOf("|")==-1){target=target.parentNode;
if(target==this){return;}}_self.select(target);};};this.$loadAml=function(x){this.$headings=[new apf.BindingColumnRule().$draw(this,"Property",this.$columns[0],"first"),new apf.BindingColumnRule().$draw(this,"Value",this.$columns[1])];
};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);for(var prop in this.$editors){this.$editors[prop].destroy();
}this.$ext.onclick=null;};}).call(apf.propedit.prototype=new apf.DataBinding());
apf.aml.setElement("propedit",apf.propedit);apf.aml.setElement("column",apf.BindingColumnRule);
apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);
apf.radiobutton=function(struct,tagName){this.$init(tagName||"radiobutton",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.ChildValue);this.$childProperty="label";this.$focussable=apf.KEYBOARD;
this.$booleanProperties.checked=true;this.$supportedProperties.push("value","background","group","label","checked","tooltip","icon");
this.$propHandlers.group=function(value){if(!this.$amlLoaded){return;}if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);
}if(!value){this.$group=null;return;}var group=typeof value=="string"?apf.nameserver.get("group",value):value;
if(!group){group=apf.nameserver.register("group",value,new apf.$group());group.setAttribute("id",value);
group.dispatchEvent("DOMNodeInsertedIntoDocument");group.parentNode=this;}this.$group=group;
if(this.oInput){this.oInput.setAttribute("name",value);}this.$group.$addRadio(this);
};this.$propHandlers.tooltip=function(value){this.$ext.setAttribute("title",value);
};this.$propHandlers.icon=function(value){if(!this.oIcon){return;}if(value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");
}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,value,this.iconPath);
};this.$propHandlers.label=function(value){if(value){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);
}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oLabel){this.oLabel.innerHTML=value;
}};this.$propHandlers.checked=function(value){if(!this.$group){return;}if(value){this.$group.setProperty("value",this.value);
}};this.$propHandlers.selected=function(value){this.setProperty("checked",value);
};this.addEventListener("prop.model",function(e){if(this.$group){this.$group.setProperty("model",e.value);
}});this.$propHandlers.background=function(value){var oNode=this.$getLayoutNode("main","background",this.$ext);
if(value){var b=value.split("|");this.$background=b.concat(["vertical",2,16].slice(b.length-1));
oNode.style.backgroundImage="url("+this.mediaPath+b[0]+")";oNode.style.backgroundRepeat="no-repeat";
}else{oNode.style.backgroundImage="";oNode.style.backgroundRepeat="";this.$background=null;
}};this.setValue=function(value){this.setProperty("value",value,false,true);};this.getValue=function(){return this.value;
};this.select=this.check=function(){this.setProperty("checked",true,false,true);
};this.uncheck=function(){this.setProperty("checked",false,false,true);};this.getGroup=function(){return this.$group;
};this.$check=function(visually){this.$setStyleClass(this.$ext,this.$baseCSSname+"Checked");
this.checked=true;if(this.oInput){this.oInput.checked=true;}this.doBgSwitch(2);
};this.$uncheck=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);
this.checked=false;if(this.oInput){this.oInput.checked=false;}this.doBgSwitch(1);
};this.$enable=function(){if(this.oInput){this.oInput.disabled=false;}var _self=this;
this.$ext.onclick=function(e){if(!e){e=event;}if((e.srcElement||e.target)==this){return;
}_self.dispatchEvent("click",{htmlEvent:e});_self.$group.change(_self.value);};
this.$ext.onmousedown=function(e){if(!e){e=event;}if((e.srcElement||e.target)==this){return;
}apf.setStyleClass(this,_self.$baseCSSname+"Down");};this.$ext.onmouseover=function(e){if(!e){e=event;
}if((e.srcElement||e.target)==this){return;}apf.setStyleClass(this,_self.$baseCSSname+"Over");
};this.$ext.onmouseout=this.$ext.onmouseup=function(){apf.setStyleClass(this,"",[_self.$baseCSSname+"Down",_self.$baseCSSname+"Over"]);
};};this.$disable=function(){if(this.oInput){this.oInput.disabled=true;}this.$ext.onclick=this.$ext.onmousedown=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onmouseup=null;
};this.doBgSwitch=function(nr){if(this.bgswitch&&(this.bgoptions[1]>=nr||nr==4)){if(nr==4){nr=this.bgoptions[1]+1;
}var strBG=this.bgoptions[0]=="vertical"?"0 -"+(parseInt(this.bgoptions[2])*(nr-1))+"px":"-"+(parseInt(this.bgoptions[2])*(nr-1))+"px 0";
this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=strBG;
}};this.$focus=function(){if(!this.$ext){return;}if(this.oInput&&this.oInput.disabled){return false;
}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(!this.$ext){return;
}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.addEventListener("keydown",function(e){var key=e.keyCode;
if(key==13||key==32){this.$group.change(this.value);return false;}else{if(key==38){var node=this;
while(node&&node.previousSibling){node=node.previousSibling;if(node.localName=="radiobutton"&&!node.disabled&&node.$group==this.$group){node.check();
node.focus();return;}}}else{if(key==40){var node=this;while(node&&node.nextSibling){node=node.nextSibling;
if(node.localName=="radiobutton"&&!node.disabled&&node.$group==this.$group){node.check();
node.focus();return;}}}}}},true);this.$draw=function(){this.$ext=this.$getExternal();
this.oInput=this.$getLayoutNode("main","input",this.$ext);this.oLabel=this.$getLayoutNode("main","label",this.$ext);
this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.oLabel&&this.oLabel.nodeType!=1){this.oLabel=this.oLabel.parentNode;
}this.$enable();};this.$childProperty="label";this.$loadAml=function(x){if(this.group){this.$propHandlers.group.call(this,this.group);
}else{if(this.parentNode.localName=="group"){this.$propHandlers.group.call(this,this.parentNode);
}}if(!this.$group){this.$propHandlers.group.call(this,"group"+this.parentNode.$uniqueId);
}};this.$destroy=function(){if(this.$group){this.$group.$removeRadio(this);}};}).call(apf.radiobutton.prototype=new apf.Presentation());
apf.aml.setElement("radiobutton",apf.radiobutton);apf.$group=function(struct,tagName){this.$init(tagName||"group",apf.NODE_VISIBLE,struct);
this.implement(apf.StandardBinding,apf.DataAction);var radiobuttons=[];this.$supportedProperties.push("value","selectedItem");
this.$propHandlers.value=function(value){for(var i=0;i<radiobuttons.length;i++){if(radiobuttons[i].value==value){return this.setProperty("selectedItem",radiobuttons[i]);
}}return this.setProperty("selectedItem",null);};var lastSelected;this.$propHandlers.selectedItem=function(rb){if(lastSelected){lastSelected.$uncheck();
}if(!rb){return;}rb.$check();lastSelected=rb;for(var i=0;i<radiobuttons.length;
i++){radiobuttons[i].setProperty("selectedItem",rb);}};this.$addRadio=function(rb){var id=radiobuttons.push(rb)-1;
if(!rb.value){rb.setProperty("value",id);}if(this.value&&rb.value==this.value){this.setProperty("selectedItem",rb);
}else{if(rb.checked){this.setProperty("value",rb.value);}}};this.$removeRadio=function(rb){radiobuttons.remove(rb);
if(rb.value===rb.id){rb.setProperty("value","");}if(rb.selectedItem==rb){this.setProperty("value",null);
}};this.setValue=function(value){this.setProperty("value",value);};this.getValue=function(){return this.value;
};this.$draw=function(){this.$ext=this.$int=this.$pHtmlNode;};};apf.$group.prototype=new apf.GuiElement();
apf.aml.setElement("group",apf.$group);apf.rpc=function(struct,tagName){this.$init(tagName||"rpc",apf.NODE_HIDDEN,struct);
if(!this.supportMulticall){this.multicall=false;}this.stack={};this.urls={};this.$methods={};
};(function(){this.useHTTP=true;this.namedArguments=false;this["route-server"]=apf.host+"/cgi-bin/rpcproxy.cgi";
this.autoroute=false;this.$auth=false;this.$booleanProperties.multicall=true;this.$supportedProperties.push("protocol","type","multicall","http-method");
this.$propHandlers["route-server"]=function(value){this.autoroute=value?true:false;
};this.$propHandlers.protocol=function(value){if(!value){return;}if(!apf[value]){return;
}var _self=this;$setTimeout(function(){_self.implement(apf[value]);});};this.$propHandlers.type=function(value){this.$useXml=(typeof value=="string"&&value.toUpperCase()=="XML");
};this.setCallback=function(name,func){this.$methods[name].callback=func;};this.setUrl=function(name,url){this.$methods[name].setProperty("url",url);
};this.$convertArgs=function(name,args){if(!this.namedArguments){return Array.prototype.slice.call(args);
}var nodes=this.$methods[name].names;if(!nodes||!nodes.length){return{};}var value,j,i,l,result={};
for(j=0,i=0,l=nodes.length;i<l;i++){name=nodes[i].name;value=nodes[i].value;if(value){value=apf.parseExpression(value);
}else{value=args[j++];if(apf.isNot(value)&&nodes[i]["default"]){value=apf.parseExpression(nodes[i]["default"]);
}}value=apf.isTrue(nodes[i].encoded)?encodeURIComponent(value):value;result[name]=value;
}return result;};function getCallback(node){var p,f;if(typeof node.callback=="string"){p=node.callback.split("."),f=self[p.shift()];
while(f&&p.length){f=f[p.shift()];}}else{f=node.callback;}return f||apf.K;}this.call=function(name,args,options){var callback,node=this.$methods[name];
if(typeof args[args.length-1]=="function"){args=Array.prototype.slice.call(args);
callback=args.pop();}else{callback=getCallback(node);}args=this.$convertArgs(name,args);
if(this.multicall){if(!this.stack[this.url]){this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];
}this.getSingleCall(name,args,this.stack[this.url]);return true;}var _self=this,data=options&&options.message?options.message:this.createMessage(node["method-name"]||name,args);
function pCallback(data,state,extra){extra.data=data;if(state!=apf.SUCCESS){callback.call(_self,null,state,extra);
}else{if(_self.isValid&&!_self.isValid(extra)){callback.call(_self,null,apf.ERROR,extra);
}else{callback.call(_self,_self.unserialize(extra.data),state,extra);}}}var auth,url=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url),o=apf.extend({callback:pCallback,async:node.async,userdata:node.userdata,nocache:(this.nocache===false)?false:true,data:data,useXML:this.$useXml||node.type=="xml",caching:node.caching,ignoreOffline:node["ignore-offline"]},options);
if(node.auth&&this.$auth){if(auth=this.$auth.$credentials){o.username=auth.username;
o.password=auth.password;}else{return this.$auth.authRequired(function(){auth=_self.$auth.$credentials;
o.username=auth.username;o.password=auth.password;_self.$get(url,o);});}}return this.$get(url,o);
};this.purge=function(callback,userdata,async,extradata){var data=this.createMessage("multicall",[this.stack[this.url]]),url=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url);
if(extradata){for(var vars=[],i=0;i<extradata.length;i++){vars.push(encodeURIComponent(extradata[i][0])+"="+encodeURIComponent(extradata[i][1]||""));
}url=url+(url.match(/\?/)?"&":"?")+vars.join("&");}var info=this.$get(url,{callback:callback,async:async,userdata:userdata,nocache:true,data:data,useXML:this.$useXml});
this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];};this.revert=function(modConst){this.stack[modConst.url]=this.getMulticallObject?this.getMulticallObject():[];
};this.getStackLength=function(){return this.stack[this.url]?this.stack[this.url].length:0;
};this.$addMethod=function(amlNode){if(amlNode.localName!="method"){return false;
}var name=amlNode.name,cb=amlNode.receive||this.receive,i=0,l=amlNode.childNodes.length,node;
this[name]=function(){return this.call(name,arguments);};if(cb){amlNode.callback=cb;
}this.$methods[name]=amlNode;if(!amlNode.names){amlNode.names=[];}for(;i<l;i++){node=amlNode.childNodes[i];
if(node.localName=="param"||node.localName=="variable"){amlNode.names.push(node);
}}return true;};this.$removeMethod=function(amlNode){var name=amlNode.name;delete this[name];
delete this.$methods[name];};this.$setAuth=function(amlNode){this.$auth=amlNode;
};this.exec=function(method,args,callback,options){if(!options){options={};}if(options.multicall){this.forceMulticall=true;
}var props=this.$methods[method];if(options.userdata){props.userdata=options.userdata;
}if(!this.multicall){props.callback=callback;}var retvalue=this.call(method,args,options);
if(this.multicall){return this.purge(callback,"&@^%!@");}else{if(options.multicall){this.forceMulticall=false;
return this;}}if(!this.multicall&&!props.async&&callback){callback(retvalue,apf.SUCCESS,{tpModule:this});
}};}).call(apf.rpc.prototype=new apf.Teleport());apf.config.$inheritProperties.baseurl=1;
apf.aml.setElement("rpc",apf.rpc);apf.script=function(){this.$init("script",apf.NODE_HIDDEN);
};(function(){this.$propHandlers.src=function(value){if(!this.type){this.type=this.getAttribute("type");
}if(!this.type||this.type=="text/javascript"){if(apf.isOpera){$setTimeout(function(){apf.window.loadCodeFile(apf.hostPath+value);
},1000);}else{apf.window.loadCodeFile(apf.getAbsolutePath(apf.hostPath,value));
}}else{var _self=this;apf.ajax(value,{callback:function(data,state,extra){if(state!=apf.SUCCESS){return apf.console.warn("Could not load script "+value);
}_self.$execute(data);}});}};this.$execute=function(code,e){if(!this.type||this.type=="text/javascript"){apf.jsexec(code);
}else{if(this.type.indexOf("livemarkup")>-1||this.type.indexOf("lm")>-1){var func=apf.lm.compile(code,{event:true,parsecode:true,funcglobal:true,nostring:true});
func(e||{});}}};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget.nodeType==3||e.currentTarget.nodeType==4){this.$execute(e.currentTarget.nodeValue,apf.isIE&&window.event);
}});this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var nodes=this.childNodes,s=[];
for(var i=0,l=nodes.length;i<l;i++){s[s.length]=nodes[i].nodeValue;}var code=s.join("\n");
this.$execute(code);});}).call(apf.script.prototype=new apf.AmlElement());apf.aml.setElement("script",apf.script);
apf.scrollbar=function(struct,tagName){this.$init(tagName||"scrollbar",apf.NODE_VISIBLE,struct);
};(function(){this.realtime=true;this.visible=false;this.$visible=true;this.overflow="scroll";
this.$scrollSizeValue=0;this.$stepValue=0.03;this.$bigStepValue=0.1;this.$curValue=0;
this.$timer=null;this.$scrollSizeWait;this.$slideMaxSize;this.addEventListener("focus",function(){if(this.$host.focus&&this.$host.$isWindowContainer!==true){this.$host.focus();
}});this.$propHandlers.overflow=function(value){if(value=="auto"){this.$ext.style.display="none";
this.$resize();}else{if(value=="scroll"){this.setProperty("visible",true);}}};this.$propHandlers["for"]=function(value){if(value){var amlNode=typeof value=="string"?self[value]:value;
if(!amlNode||!amlNode.$amlLoaded){var _self=this;apf.queue.add("scrollbar"+this.$uniqueId,function(){if(!amlNode){amlNode=typeof value=="string"?self[value]:value;
if(!amlNode){throw new Error(apf.formatErrorString(0,_self,"Attaching scrollbar to element","Could not find element to attach scrollbar to: "+value));
}}_self.$attach(amlNode);});}else{this.$attach(amlNode);}}};this.addEventListener("prop.visible",function(e){if(!this.$updating){this.$visible=e.value;
}});this.$detach=function(){};this.attach=function(oHtml,o,scroll_func){this.$attach(o);
this.addEventListener("scroll",scroll_func);};this.$getHtmlHost=function(){var h=this.$host&&(this.$host.$int||this.$host.$container);
return(h&&(h.tagName=="BODY"||h.tagName=="HTML")?(apf.isSafari||apf.isChrome?document.body:h.parentNode):h);
};this.$getViewPort=function(oHtml){return oHtml.tagName=="HTML"||oHtml.tagName=="BODY"?apf[this.$windowSize]():oHtml[this.$offsetSize];
};this.$getScrollHeight=function(oHtml){return(apf.isIE&&oHtml.lastChild?oHtml.lastChild[this.$offsetPos]+oHtml.lastChild[this.$offsetSize]+apf.getBox(apf.getStyle(oHtml,"padding"))[2]+(parseInt(apf.getStyle(oHtml,"marginBottom"))||0):oHtml[this.$scrollSize]);
};this.$attach=function(amlNode){if(!amlNode){return apf.console.warn("Scrollbar could not connect to amlNode");
}if(amlNode.host){amlNode=amlNode.host;}if(!amlNode.nodeFunc&&amlNode.style){this.$host={empty:true,$int:amlNode};
}else{this.$host=amlNode;}this.$recalc();var scrollFunc=function(e){if(e.returnValue===false){return;
}scrolling=apf.isIE;var oHtml=_self.$getHtmlHost();var div=(_self.$getScrollHeight(oHtml)-_self.$getViewPort(oHtml));
if(div){if(oHtml[_self.$scrollPos]==0&&e.delta>0){if(_self.$lastScrollState===0){return;
}setTimeout(function(){_self.$lastScrollState=0;},300);}else{if(oHtml[_self.$scrollPos]==_self.$getScrollHeight(oHtml)-oHtml[_self.$offsetSize]&&e.delta<0){if(_self.$lastScrollState===1){return;
}setTimeout(function(){_self.$lastScrollState=1;},300);}}delete _self.$lastScrollState;
_self.$curValue=(oHtml[_self.$scrollPos]+-1*e.delta*Math.min(45,apf[_self.$getInner](oHtml)/10))/div;
_self.setScroll();e.preventDefault();}};var _self=this,scrolling;if(!this.$host.empty){amlNode.addEventListener("resize",function(){_self.$update();
});if(amlNode.hasFeature(apf.__DATABINDING__)){amlNode.addEventListener("afterload",function(){_self.$update();
});amlNode.addEventListener("xmlupdate",function(){_self.$update();});}amlNode.addEventListener("prop.value",function(){_self.$update();
});if(amlNode.$isTreeArch){amlNode.addEventListener("collapse",function(){_self.$update();
});amlNode.addEventListener("expand",function(){_self.$update();});}if(!this.horizontal){amlNode.addEventListener("mousescroll",scrollFunc);
}}else{if(!this.horizontal){apf.addEventListener("mousescroll",function(e){if(amlNode==e.target||(amlNode==document.documentElement&&e.target==document.body)){scrollFunc(e);
}});}}var oHtml=_self.$getHtmlHost();oHtml.onscroll=function(){if(_self.animating||!_self.$visible){return;
}if(!scrolling){var oHtml=_self.$getHtmlHost();var m=_self.$getScrollHeight(oHtml)-_self.$getViewPort(oHtml);
var p=oHtml[_self.$scrollPos]/m;if(Math.abs(_self.$curValue-p)>1/m){_self.$curValue=p;
_self.setScroll();}return false;}scrolling=false;};if("HTML|BODY".indexOf(oHtml.tagName)>-1){var lastHeight=oHtml.scrollHeight;
setInterval(function(){if(lastHeight!=oHtml.scrollHeight){lastHeight=oHtml.scrollHeight;
_self.$recalc();_self.$update();}},100);}this.$update();return this;};this.$resize=function(){var oHtml=this.$getHtmlHost();
if(!oHtml||!oHtml.offsetHeight){return;}this.$recalc();this.$update();this.setScroll(null,true,true);
};this.$recalc=function(){var oHtml=this.$getHtmlHost();if(!oHtml){return;}this.$viewheight=this.$getViewPort(oHtml);
this.$scrollSizeheight=this.$viewheight;this.$scrollSizeWait=0;this.$stepValue=(this.$viewheight/this.$scrollSizeheight)/20;
this.$bigStepValue=this.$stepValue*3;this.$slideMaxSize=this.$caret.parentNode[this.$offsetSize]-(this.$btnDown?this.$btnDown[this.$offsetSize]:0)-(this.$btnUp?this.$btnUp[this.$offsetSize]:0);
};this.$update=function(){var oHtml=this.$getHtmlHost();if(!oHtml||!oHtml.offsetHeight){return;
}this.$updating=true;var vp=this.$getViewPort(oHtml);var sz=this.$getScrollHeight(oHtml);
if(vp>=sz){if(this.overflow=="scroll"){this.$caret.style.display="none";this.disable();
}else{if(this.visible){this.hide();}}}else{if(this.overflow=="scroll"){this.$caret.style.display="block";
this.enable();}else{if(!this.visible){this.show();}}if(!this.$slideMaxSize){this.$recalc();
}if(!this.$slideMaxSize){return;}this.$caret.style[this.$size]=(Math.max(5,(vp/sz*this.$slideMaxSize))-apf[this.$getDiff](this.$caret))+"px";
this.$curValue=oHtml[this.$scrollPos]/(sz-vp);var bUpHeight=this.$btnUp?this.$btnUp[this.$offsetSize]:0;
this.$caret.style[this.$pos]=(bUpHeight+(apf[this.$getInner](this.$caret.parentNode)-(bUpHeight*2)-this.$caret[this.$offsetSize])*this.$curValue)+"px";
}this.$updating=false;};this.setScroll=function(timed,noEvent,noUpdateParent){if(this.$curValue>1){this.$curValue=1;
}if(this.$curValue<0){this.$curValue=0;}if(this.$curValue==NaN){return;}var bUpHeight=this.$btnUp?this.$btnUp[this.$offsetSize]:0;
this.$caret.style[this.$pos]=(bUpHeight+(apf[this.$getInner](this.$caret.parentNode)-(bUpHeight*2)-this.$caret[this.$offsetSize])*this.$curValue)+"px";
if(this.animating||!this.$visible){return;}var oHtml,from,viewport,to;if(this.$host){oHtml=this.$getHtmlHost();
from=oHtml[this.$scrollPos];viewport=this.$getViewPort(oHtml);to=(this.$getScrollHeight(oHtml)-viewport)*this.$curValue;
}if(!noUpdateParent){if(this.$host){oHtml[this.$scrollPos]=to;}}if(!noEvent){(this.$host&&this.$host.dispatchEvent?this.$host:this).dispatchEvent("scroll",{timed:timed,viewportSize:viewport,scrollPos:to,scrollSize:this.$getScrollHeight(oHtml),from:from,pos:this.pos});
}this.pos=this.$curValue;};this.scrollUp=function(v){if(v>this.$caret[this.$offsetPos]){return this.$ext.onmouseup();
}this.$curValue-=this.$bigStepValue;this.setScroll();if(this.$slideFast){this.$slideFast.style[this.$size]=Math.max(1,this.$caret[this.$offsetPos]-this.$btnUp[this.$offsetSize])+"px";
this.$slideFast.style[this.$pos]=this.$btnUp[this.$offsetSize]+"px";}};this.scrollDown=function(v){if(v<this.$caret[this.$offsetPos]+this.$caret[this.$offsetSize]){return this.$ext.onmouseup();
}this.$curValue+=this.$bigStepValue;this.setScroll();if(this.$slideFast){this.$slideFast.style[this.$pos]=(this.$caret[this.$offsetPos]+this.$caret[this.$offsetSize])+"px";
this.$slideFast.style[this.$size]=Math.max(1,apf[this.$getInner](this.$caret.parentNode)-this.$slideFast[this.$offsetPos]-this.$btnUp[this.$offsetSize])+"px";
}};this.getPosition=function(){return this.pos;};this.setPosition=function(pos,noEvent){this.$curValue=pos;
this.setScroll(null,noEvent);};this.updatePos=function(){if(this.animating||!this.$visible){return;
}var o=this.$host;var indHeight=Math.round(Math.max(10,(((o.limit-1)/o.length)*this.$slideMaxSize)));
this.$caret.style[this.$pos]=(this.$curValue*(this.$slideMaxSize-indHeight)+this.$btnUp[this.$offsetSize])+"px";
};this.$onscroll=function(timed,perc){this.$host[this.$scrollPos]=(this.$host[this.$scrollSize]-this.$host[this.$offsetSize]+4)*this.$curValue;
};this.$draw=function(){this.$getNewContext("main");this.$ext=this.$getExternal();
this.$caret=this.$getLayoutNode("main","indicator",this.$ext);this.$slideFast=this.$getLayoutNode("main","slidefast",this.$ext);
this.$btnUp=this.$getLayoutNode("main","btnup",this.$ext);this.$btnDown=this.$getLayoutNode("main","btndown",this.$ext);
this.horizontal=apf.isTrue(this.$getOption("main","horizontal"));this.$windowSize=this.horizontal?"getWindowWidth":"getWindowHeight";
this.$offsetSize=this.horizontal?"offsetWidth":"offsetHeight";this.$size=this.horizontal?"width":"height";
this.$offsetPos=this.horizontal?"offsetLeft":"offsetTop";this.$pos=this.horizontal?"left":"top";
this.$scrollSize=this.horizontal?"scrollWidth":"scrollHeight";this.$scrollPos=this.horizontal?"scrollLeft":"scrollTop";
this.$getDiff=this.horizontal?"getWidthDiff":"getHeightDiff";this.$getInner=this.horizontal?"getHtmlInnerWidth":"getHtmlInnerHeight";
this.$eventDir=this.horizontal?(apf.isIE||apf.isWebkit?"offsetX":"layerX"):(apf.isIE||apf.isWebkit?"offsetY":"layerY");
this.$clientDir=this.horizontal?"clientX":"clientY";this.$posIndex=this.horizontal?0:1;
this.$startPos=false;this.$caret.ondragstart=function(){return false;};var _self=this;
if(this.$btnUp){this.$btnUp.onmousedown=function(e){if(_self.disabled){return;}if(!e){e=event;
}this.className="btnup btnupdown";clearTimeout(_self.$timer);_self.$curValue-=_self.$stepValue;
_self.setScroll();apf.stopPropagation(e);_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.$curValue-=_self.$stepValue;
_self.setScroll();},20);},300);};this.$btnUp.onmouseout=this.$btnUp.onmouseup=function(){if(_self.disabled){return;
}this.className="btnup";clearInterval(_self.$timer);};}if(this.$btnDown){this.$btnDown.onmousedown=function(e){if(_self.disabled){return;
}if(!e){e=event;}this.className="btndown btndowndown";clearTimeout(_self.$timer);
_self.$curValue+=_self.$stepValue;_self.setScroll();apf.stopPropagation(e);_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.$curValue+=_self.$stepValue;
_self.setScroll();},20);},300);};this.$btnDown.onmouseout=this.$btnDown.onmouseup=function(){if(_self.disabled){return;
}this.className="btndown";clearInterval(_self.$timer);};}this.$caret.onmousedown=function(e){if(_self.disabled){return;
}if(!e){e=event;}var tgt=e.target||e.srcElement;var pos=tgt!=this?[tgt.offsetLeft,tgt.offsetTop]:[0,0];
var relDelta=e[_self.$eventDir]+pos[_self.$posIndex];_self.$startPos=relDelta+(_self.$btnUp?_self.$btnUp[_self.$offsetSize]:0);
if(this.setCapture){this.setCapture();}_self.$setStyleClass(_self.$ext,_self.$baseCSSname+"Down");
_self.dispatchEvent("mousedown",{});document.onmousemove=function(e){if(!e){e=event;
}if(_self.$startPos===false){return false;}var bUpHeight=_self.$btnUp?_self.$btnUp[_self.$offsetSize]:0;
var next=bUpHeight+(e[_self.$clientDir]-_self.$startPos+(apf.isWebkit?document.body:document.documentElement)[_self.$scrollPos]-apf.getAbsolutePosition(_self.$caret.parentNode)[_self.horizontal?0:1]);
var min=bUpHeight;if(next<min){next=min;}var max=(apf[_self.$getInner](_self.$caret.parentNode)-bUpHeight-_self.$caret[_self.$offsetSize]);
if(next>max){next=max;}_self.$curValue=(next-min)/(max-min);_self.setScroll(true);
};document.onmouseup=function(){_self.$startPos=false;if(!_self.realtime){_self.setScroll();
}if(this.releaseCapture){this.releaseCapture();}_self.$setStyleClass(_self.$ext,"",[_self.$baseCSSname+"Down"]);
_self.dispatchEvent("mouseup",{});document.onmouseup=document.onmousemove=null;
};apf.stopPropagation(e);return false;};this.$ext.onmousedown=function(e){if(_self.disabled){return;
}if(!e){e=event;}clearInterval(_self.$timer);var offset;if(e[_self.$eventDir]>_self.$caret[_self.$offsetPos]+_self.$caret[_self.$offsetSize]){_self.$curValue+=_self.$bigStepValue;
_self.setScroll(true);if(_self.$slideFast){_self.$slideFast.style.display="block";
_self.$slideFast.style[_self.$pos]=(_self.$caret[_self.$offsetPos]+_self.$caret[_self.$offsetSize])+"px";
_self.$slideFast.style[_self.$size]=(apf[_self.$getInner](_self.$caret.parentNode)-_self.$slideFast[_self.$offsetPos]-_self.$btnUp[_self.$offsetSize])+"px";
}offset=e[_self.$eventDir];_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.scrollDown(offset);
},20);},300);}else{if(e[_self.$eventDir]<_self.$caret[_self.$offsetPos]){_self.$curValue-=_self.$bigStepValue;
_self.setScroll(true);if(_self.$slideFast){_self.$slideFast.style.display="block";
_self.$slideFast.style[_self.$pos]=_self.$btnUp[_self.$offsetSize]+"px";_self.$slideFast.style[_self.$size]=(_self.$caret[_self.$offsetPos]-_self.$btnUp[_self.$offsetSize])+"px";
}offset=e[_self.$eventDir];_self.$timer=$setTimeout(function(){_self.$timer=setInterval(function(){_self.scrollUp(offset);
},20);},300);}}};this.$ext.onmouseup=function(){if(_self.disabled){return;}clearInterval(_self.$timer);
if(!_self.realtime){_self.setScroll();}if(_self.$slideFast){_self.$slideFast.style.display="none";
}};this.$ext.onmouseover=function(e){_self.dispatchEvent("mouseover",{htmlEvent:e||event});
};this.$ext.onmouseout=function(e){_self.dispatchEvent("mouseout",{htmlEvent:e||event});
};};this.$loadAml=function(){if(this.overflow=="scroll"){this.disable();}else{this.$caret.style.display="block";
this.enable();}this.addEventListener("resize",this.$resize);this.$update();};}).call(apf.scrollbar.prototype=new apf.Presentation());
apf.aml.setElement("scrollbar",apf.scrollbar);apf.services=function(struct,tagName){this.$init(tagName||"services",apf.NODE_VISIBLE,struct);
this.addEventListener("DOMNodeInsertedIntoDocument",function(aml){var pNode=this.parentNode;
if(pNode.register){pNode.register(this);}});};apf.services.prototype=new apf.AmlElement();
apf.aml.setElement("services",apf.services);apf.skin=function(struct,tagName){this.$init(tagName||"skin",apf.NODE_HIDDEN,struct);
};apf.aml.setElement("skin",apf.skin);(function(){this.$parsePrio="002";this.$includesRemaining=0;
this.$propHandlers.src=function(value){if(value.trim().charAt(0)=="<"){apf.skins.Init(apf.getXml(value),this,this.$path);
return;}this.$path=apf.getAbsolutePath(apf.hostPath,value);getSkin.call(this,this.$path);
};this.$propHandlers.name=function(value){if(!this.attributes.getNamedItem("src")){this.$path=apf.getAbsolutePath(apf.hostPath,value)+"/index.xml";
getSkin.call(this,this.$path);}};function checkForAmlNamespace(xmlNode){if(!xmlNode.ownerDocument.documentElement){return false;
}var nodes=xmlNode.ownerDocument.documentElement.attributes;for(var found=false,i=0;
i<nodes.length;i++){if(nodes[i].nodeValue==apf.ns.aml){found=true;break;}}return found;
}function getSkin(path){var domParser=this.ownerDocument.$domParser;if(!apf.skins.$first){apf.skins.$first=this;
}var defer=this.attributes.getNamedItem("defer");if(!defer||!apf.isTrue(defer.nodeValue)){domParser.$shouldWait++;
this.$parseContext=domParser.$parseContext||[this.ownerDocument.documentElement];
}loadSkinFile.call(this,path);}function finish(xmlNode){if(xmlNode){apf.skins.Init(xmlNode,this,this.$path);
}if(!this.defer){var domParser=this.ownerDocument.$domParser;domParser.$continueParsing.apply(domParser,this.$parseContext);
}}function loadSkinInclude(includeNode,xmlNode,path){var _self=this;apf.getData(apf.getAbsolutePath(path,includeNode.getAttribute("src")),{callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,_self,"Loading skin includes","Could not load skin include: "+extra.url));
}var newPart=apf.getXml(xmlString.substr(0,8)=="<a:skin "?xmlString:'<a:skin xmlns:a="http://ajax.org/2005/aml">'+xmlString+"</a:skin>");
apf.mergeXml(newPart,xmlNode,{beforeNode:includeNode});includeNode.parentNode.removeChild(includeNode);
var includeNodes=$xmlns(newPart,"include",apf.ns.aml);_self.$includesRemaining+=includeNodes.length;
if(includeNodes.length){var path=apf.getDirname(extra.url);for(var i=0;i<includeNodes.length;
i++){loadSkinInclude.call(_self,includeNodes[i],xmlNode,path);}}else{if(--_self.$includesRemaining==0){finish.call(_self,xmlNode);
}}}});}function loadSkinFile(path){var _self=this;apf.getData(path,{callback:function(xmlString,state,extra){if(state!=apf.SUCCESS){var oError=new Error(apf.formatErrorString(1007,_self,"Loading skin file","Could not load skin file '"+(path||_self.src)+"'\nReason: "+extra.message));
if(extra.tpModule.retryTimeout(extra,state,null,oError)===true){return true;}if(this.autoload){apf.console.warn("Could not autload skin.");
return finish.call(_self);}throw oError;}xmlString=xmlString.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"").replace(/xmlns\=\"[^"]*\"/g,"");
if(!xmlString){throw new Error(apf.formatErrorString(0,_self,"Loading skin","Empty skin file. Maybe the file does not exist?",_self));
}var xmlNode=apf.getXml(xmlString);if(!xmlNode){throw new Error(apf.formatErrorString(0,_self,"Loading skin","Could not parse skin. Maybe the file does not exist?",_self));
}xmlNode.setAttribute("filename",extra.url);var includeNodes=$xmlns(xmlNode,"include",apf.ns.aml);
_self.$includesRemaining+=includeNodes.length;if(includeNodes.length){var path=apf.getDirname(extra.url);
for(var i=0;i<includeNodes.length;i++){loadSkinInclude.call(_self,includeNodes[i],xmlNode,path);
}return;}else{finish.call(_self,xmlNode);}},async:true,ignoreOffline:true});}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.src||this.name){return;
}apf.skins.Init(this.$aml||this);});}).call(apf.skin.prototype=new apf.AmlElement());
apf.smartbinding=function(struct,tagName){this.$init(tagName||"smartbinding",apf.NODE_HIDDEN,struct);
this.$bindNodes={};};(function(){this.$supportedProperties=["bindings","actions","model"];
this.$handlePropSet=function(prop,value,force){switch(prop){case"model":if(typeof value=="string"){value=apf.nameserver.get("model",value);
}this.model=apf.nameserver.register("model",this.name,value);var amlNode;for(var uniqueId in this.$bindNodes){amlNode=this.$bindNodes[uniqueId];
this.model.unregister(amlNode);this.model.register(amlNode,this.$modelXpath[amlNode.getHost?amlNode.getHost().$uniqueId:amlNode.$uniqueId]||this.modelBaseXpath);
}break;case"bindings":if(this.$bindings){this.remove(this.$bindings);}this.$bindings=typeof value=="object"?value:apf.nameserver.lookup("bindings",value);
this.add(this.$bindings);break;case"actions":if(this.$actions){this.remove(this.$actions);
}this.$actions=typeof value=="object"?value:apf.nameserver.lookup("actions",value);
this.add(this.$actions);break;}this[prop]=value;};this.add=function(node){for(var uId in this.$bindNodes){node.register(this.$bindNodes[uId]);
}this["$"+node.localName]=node;};this.remove=function(node){for(var uId in this.$bindNodes){node.unregister(this.$bindNodes[uId]);
}};this.register=function(amlNode){this.$bindNodes[amlNode.$uniqueId]=amlNode;if(this.$bindings){this.$bindings.register(amlNode);
}if(this.$actions){this.$actions.register(amlNode);}if(this.$model){this.$model.register(amlNode);
}};this.unregister=function(amlNode){this.$bindNodes[amlNode.$uniqueId]=null;delete this.$bindNodes[amlNode.$uniqueId];
if(this.$bindings){this.$bindings.unregister(amlNode);}if(this.$actions){this.$actions.unregister(amlNode);
}if(this.$model){this.$model.unregister(amlNode);}};this.load=function(xmlNode){new apf.model().register(this).load(xmlNode);
};this.clear=function(state){};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode.hasFeature(apf.__DATABINDING__)){this.register(this.parentNode);
}});}).call(apf.smartbinding.prototype=new apf.AmlElement());apf.aml.setElement("smartbinding",apf.smartbinding);
apf.source=function(struct,tagName){this.$init(tagName||"source",apf.NODE_HIDDEN,struct);
};(function(){this.$supportedProperties.push("src","type");this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.parentNode.$addSource){this.parentNode.$addSource(this);
}});}).call(apf.source.prototype=new apf.AmlElement());apf.aml.setElement("source",apf.source);
apf.spinner=function(struct,tagName){this.$init(tagName||"spinner",apf.NODE_VISIBLE,struct);
this.max=64000;this.min=-64000;this.focused=false;this.value=0;this.realtime=false;
};(function(){this.implement(apf.DataAction);this.$supportedProperties.push("width","value","max","min","caption","realtime");
this.$booleanProperties.realtime=true;this.$propHandlers.value=function(value){value=parseInt(value)||0;
this.value=this.oInput.value=(value>this.max?this.max:(value<this.min?this.min:value));
};this.$propHandlers.min=function(value){if(!(value=parseInt(value))){return;}this.min=value;
if(value>this.value){this.change(value);}};this.$propHandlers.max=function(value){if(!(value=parseInt(value))){return;
}this.max=value;if(value<this.value){this.change(value);}};this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.value;};this.increment=function(){this.change(parseInt(this.oInput.value)+1);
};this.decrement=function(){this.change(parseInt(this.oInput.value)-1);};this.$enable=function(){this.oInput.disabled=false;
this.$setStyleClass(this.oInput,"",["inputDisabled"]);};this.$disable=function(){this.oInput.disabled=true;
this.$setStyleClass(this.oInput,"inputDisabled");};this.$focus=function(e){if(!this.$ext||this.focused){return;
}if(apf.hasFocusBug){apf.sanitizeTextbox(this.oInput);}this.focused=true;this.$setStyleClass(this.oInput,"focus");
this.$setStyleClass(this.$buttonPlus,"plusFocus");this.$setStyleClass(this.$buttonMinus,"minusFocus");
if(this.oLeft){this.$setStyleClass(this.oLeft,"leftFocus");}};this.$blur=function(e){if(!this.$ext&&!this.focused){return;
}this.$setStyleClass(this.oInput,"",["focus"]);this.$setStyleClass(this.$buttonPlus,"",["plusFocus"]);
this.$setStyleClass(this.$buttonMinus,"",["minusFocus"]);if(this.oLeft){this.$setStyleClass(this.oLeft,""["leftFocus"]);
}this.setValue(this.oInput.value);this.focused=false;};this.addEventListener("keydown",function(e){var key=e.keyCode,keyAccess=(key<8||(key>9&&key<37&&key!==12)||(key>40&&key<46)||(key>46&&key<48)||(key>57&&key<96)||(key>105&&key<109&&key!==107)||(key>109&&key!==189));
if(keyAccess){return false;}switch(key){case 38:this.increment();break;case 40:this.decrement();
break;}},true);this.addEventListener("keyup",function(e){},true);this.increment=function(){this.change(parseInt(this.oInput.value)+1);
};this.decrement=function(){this.change(parseInt(this.oInput.value)-1);};this.$draw=function(){var _self=this;
this.$ext=this.$getExternal(null,null,function(oExt){oExt.setAttribute("onmousedown",'if (!this.host.disabled)                     this.host.dispatchEvent("mousedown", {htmlEvent : event});');
oExt.setAttribute("onmouseup",'if (!this.host.disabled)                     this.host.dispatchEvent("mouseup", {htmlEvent : event});');
oExt.setAttribute("onclick",'if (!this.host.disabled)                     this.host.dispatchEvent("click", {htmlEvent : event});');
});this.$int=this.$getLayoutNode("main","container",this.$ext);this.oInput=this.$getLayoutNode("main","input",this.$ext);
this.$buttonPlus=this.$getLayoutNode("main","buttonplus",this.$ext);this.$buttonMinus=this.$getLayoutNode("main","buttonminus",this.$ext);
this.oLeft=this.$getLayoutNode("main","left",this.$ext);apf.sanitizeTextbox(this.oInput);
var timer,doc=(!document.compatMode||document.compatMode=="CSS1Compat")?document.html:document.body,z=0;
this.oInput.value=this.value;this.oInput.onmousedown=function(e){if(_self.disabled){return;
}e=e||window.event;clearTimeout(timer);var newval,value=parseInt(this.value)||0,step=0,cy=e.clientY,ot=_self.$int.offsetTop,ol=_self.$int.offsetLeft,ow=_self.$int.offsetWidth,oh=_self.$int.offsetHeight,func=function(){clearTimeout(timer);
timer=$setTimeout(func,10);if(!step){return;}newval=value+step;if(newval<=_self.max&&newval>=_self.min){value+=step;
value=Math.round(value);_self.oInput.value=value;if(_self.realtime){_self.change(value);
}}else{_self.oInput.value=step<0?_self.min:_self.max;}};func();function calcStep(e){e=e||window.event;
var x=e.pageX||e.clientX+(doc?doc.scrollLeft:0),y=e.pageY||e.clientY+(doc?doc.scrollTop:0),nrOfPixels=cy-y;
if((y>ot&&x>ol)&&(y<ot+oh&&x<ol+ow)){step=0;return;}step=Math.pow(Math.min(200,Math.abs(nrOfPixels))/10,2)/10;
if(nrOfPixels<0){step=-1*step;}}document.onmousemove=calcStep;document.onmouseup=function(e){clearTimeout(timer);
var value=parseInt(_self.oInput.value);if(value!=_self.value){_self.change(value);
}document.onmousemove=document.onmouseup=null;};};var buttonDown=false;this.$buttonPlus.onmousedown=function(e){if(_self.disabled){return;
}e=e||window.event;buttonDown=true;var value=(parseInt(_self.oInput.value)||0)+1,func=function(){clearTimeout(timer);
timer=$setTimeout(func,50);z++;value+=Math.pow(Math.min(200,z)/10,2)/10;value=Math.round(value);
_self.oInput.value=value<=_self.max?value:_self.max;if(_self.realtime){_self.change(value<=_self.max?value:_self.max);
}};apf.setStyleClass(this,"plusDown",["plusHover"]);func();};this.$buttonMinus.onmousedown=function(e){if(_self.disabled){return;
}e=e||window.event;buttonDown=true;var value=(parseInt(_self.oInput.value)||0)-1,func=function(){clearTimeout(timer);
timer=$setTimeout(func,50);z++;value-=Math.pow(Math.min(200,z)/10,2)/10;value=Math.round(value);
_self.oInput.value=value>=_self.min?value:_self.min;if(_self.realtime){_self.change(value>=_self.min?value:_self.min);
}};apf.setStyleClass(this,"minusDown",["minusHover"]);func();};this.$buttonMinus.onmouseout=function(e){if(_self.disabled){return;
}clearTimeout(timer);z=0;var value=parseInt(_self.oInput.value);if(value!=_self.value){_self.change(value);
}apf.setStyleClass(this,"",["minusHover"]);if(!_self.focused){_self.$blur(e);}};
this.$buttonPlus.onmouseout=function(e){if(_self.disabled){return;}clearTimeout(timer);
z=0;var value=parseInt(_self.oInput.value);if(value!=_self.value){_self.change(value);
}apf.setStyleClass(this,"",["plusHover"]);if(!_self.focused){_self.$blur(e);}};
this.$buttonMinus.onmouseover=function(e){if(_self.disabled){return;}apf.setStyleClass(this,"minusHover");
};this.$buttonPlus.onmouseover=function(e){if(_self.disabled){return;}apf.setStyleClass(this,"plusHover");
};this.$buttonPlus.onmouseup=function(e){if(_self.disabled){return;}e=e||event;
apf.cancelBubble(e,this);apf.setStyleClass(this,"plusHover",["plusDown"]);clearTimeout(timer);
z=0;var value=parseInt(_self.oInput.value);if(!buttonDown){value++;_self.oInput.value=value;
}else{buttonDown=false;}if(value!=_self.value){_self.change(value);}};this.$buttonMinus.onmouseup=function(e){if(_self.disabled){return;
}e=e||event;apf.cancelBubble(e,this);apf.setStyleClass(this,"minusHover",["minusDown"]);
clearTimeout(timer);z=0;var value=parseInt(_self.oInput.value);if(!buttonDown){value--;
_self.oInput.value=value;}else{buttonDown=false;}if(value!=_self.value){_self.change(value);
}};this.oInput.onselectstart=function(e){e=e||event;e.cancelBubble=true;};this.oInput.host=this;
};this.$destroy=function(){this.oInput.onkeypress=this.oInput.onmousedown=this.oInput.onkeydown=this.oInput.onkeyup=this.oInput.onselectstart=this.$buttonPlus.onmouseover=this.$buttonPlus.onmouseout=this.$buttonPlus.onmousedown=this.$buttonPlus.onmouseup=this.$buttonMinus.onmouseover=this.$buttonMinus.onmouseout=this.$buttonMinus.onmousedown=this.$buttonMinus.onmouseup=null;
};}).call(apf.spinner.prototype=new apf.StandardBinding());apf.aml.setElement("spinner",apf.spinner);
apf.splitbutton=function(struct,tagName){this.$init(tagName||"splitbutton",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$propHandlers.caption=function(value){this.$button1.setProperty("caption",value);
};this.$propHandlers.icon=function(value){this.$button1.setProperty("icon",value);
};this.$propHandlers.disabled=function(value){this.$button1.setProperty("disabled",value);
this.$button2.setProperty("disabled",value);};this.$propHandlers.submenu=function(value){this.$button2.setProperty("submenu",value);
var _self=this;self[value].addEventListener("display",function(){this.$ext.style.marginLeft="-"+_self.$button1.$ext.offsetWidth+"px";
});};this.$draw=function(){var _self=this;this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));
this.$ext.style.overflow="hidden";var skin=this.getAttribute("skin")||this.localName;
this.$button1=new apf.button({htmlNode:this.$ext,parentNode:this,skin:skin,"class":"main",onmouseover:function(){apf.setStyleClass(this.$ext,"primary");
_self.$button2.$setState("Over",{});},onmouseout:function(){apf.setStyleClass(this.$ext,"",["primary"]);
_self.$button2.$setState("Out",{});},onclick:function(e){_self.dispatchEvent("click");
}});this.$button2=new apf.button({htmlNode:this.$ext,parentNode:this,skin:skin,"class":"arrow",onmouseover:function(){apf.setStyleClass(this.$ext,"primary");
_self.$button1.$setState("Over",{});},onmouseout:function(){if(!_self.$button2.value){apf.setStyleClass(this.$ext,"",["primary"]);
_self.$button1.$setState("Out",{});}else{apf.setStyleClass(this.$ext,"primary");
_self.$button1.$setState("Over",{});}}});};this.$loadAml=function(x){};}).call(apf.splitbutton.prototype=new apf.GuiElement());
apf.aml.setElement("splitbutton",apf.splitbutton);apf.splitter=function(struct,tagName){this.$init(tagName||"splitter",apf.NODE_VISIBLE,struct);
};(function(){this.$scale=0;this.$focussable=false;this.$splitter=true;this.$booleanProperties.realtime=true;
this.$propHandlers.realtime=function(value){this.$setStyleClass(this.$ext,value&&(this.$baseCSSname+"Realtime")||"",[this.$baseCSSname+"Realtime"]);
};this.$propHandlers.scale=function(value){this.$scale=value=="left"||value=="top"?1:(value=="right"||"bottom "?2:0);
};this.$propHandlers.type=function(value){this.$setStyleClass(this.$ext,value,[value=="horizontal"?"vertical":"horizontal"]);
if(value=="vertical"){this.$setStyleClass(this.$ext,"w-resize",["n-resize"]);}else{this.$setStyleClass(this.$ext,"n-resize",["w-resize"]);
}if(value=="horizontal"){this.$info={pos:"top",opos:"left",size:"width",osize:"height",offsetPos:"offsetTop",offsetSize:"offsetHeight",oOffsetPos:"offsetLeft",oOffsetSize:"offsetWidth",clientPos:"clientY",d1:1,d2:0,x1:0,x2:2};
}else{this.$info={pos:"left",opos:"top",size:"height",osize:"width",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oOffsetPos:"offsetTop",oOffsetSize:"offsetHeight",clientPos:"clientX",d1:0,d2:1,x1:3,x2:1};
}};this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget!=this){return;
}this.init();});this.update=function(newPos,finalPass){with(this.$info){var max=this.$previous.$ext[offsetSize]+this.$next.$ext[offsetSize];
var method=finalPass?"setAttribute":"setProperty";if(apf.hasFlexibleBox){newPos-=apf.getAbsolutePosition(this.$previous.$ext,this.parentNode.$int)[d1];
}if((this.$previous.flex||this.$previous.flex===0)&&(this.$next.flex||this.$next.flex===0)){if(!finalPass&&!this.realtime){newPos-=this.$ext[offsetSize];
}if(!this.$scale||this.$scale==1){this.$previous[method]("flex",newPos);}if(!this.$scale||this.$scale==2){this.$next[method]("flex",this.$totalFlex-newPos);
}}else{if(!this.$next.flex&&(!this.$scale||this.$scale==2)){this.$next[method](osize,max-newPos);
}if(!this.$previous.flex&&(!this.$scale||this.$scale==1)){this.$previous[method](osize,newPos);
}}}if(apf.hasSingleResizeEvent){apf.layout.forceResize(this.$ext.parentNode);}};
this.$setSiblings=function(){this.$previous=this.previousSibling;while(this.$previous&&(this.$previous.nodeType!=1||this.$previous.visible===false||this.$previous.nodeFunc!=apf.NODE_VISIBLE)){this.$previous=this.$previous.previousSibling;
}this.$next=this.nextSibling;while(this.$next&&(this.$next.nodeType!=1||this.$next.visible===false||this.$next.nodeFunc!=apf.NODE_VISIBLE)){this.$next=this.$next.nextSibling;
}};this.init=function(size,refNode,oItem){this.$setSiblings();this.$thickness=null;
if(this.parentNode.$box){this.setProperty("type",this.parentNode.localName=="vbox"?"horizontal":"vertical");
this.$thickness=parseInt(this.parentNode.padding);}if(!this.$previous||!this.$next){return this;
}with(this.$info){var diff=apf.getDiff(this.$ext);if(!this.parentNode.$box){var iSize=Math.max(this.$previous.$ext[offsetSize],this.$next.$ext[offsetSize]);
this.$ext.style[size]=(iSize-diff[d1])+"px";}var iThick=this[osize]=this.$thickness||(this.$next[oOffsetPos]-this.$previous[oOffsetPos]-this.$previous[oOffsetSize]);
this.$ext.style[osize]=(iThick-diff[d2])+"px";}return this;};this.$draw=function(){this.$ext=this.$getExternal();
var _self=this;this.$ext.onmousedown=function(e){if(!e){e=event;}_self.$setSiblings();
var changedPosition,pHtml=_self.parentNode.$int;if("absolute|fixed|relative".indexOf(apf.getStyle(pHtml,"position"))==-1){pHtml.style.position="relative";
changedPosition=true;}_self.$totalFlex=0;with(_self.$info){var posPrev=apf.getAbsolutePosition(_self.$previous.$ext,_self.parentNode.$int);
var min=_self.$scale?0:posPrev[d1]||0;var posNext=apf.getAbsolutePosition(_self.$next.$ext,_self.parentNode.$int);
var max=posNext[d1]+_self.$next.$ext[offsetSize]-this[offsetSize];if((_self.$previous.flex||_self.$previous.flex===0)&&(_self.$next.flex||_self.$next.flex===0)){var set=[],nodes=_self.parentNode.childNodes,padding=0;
for(var node,i=0,l=nodes.length;i<l;i++){if((node=nodes[i]).visible===false||node.nodeFunc!=apf.NODE_VISIBLE||node.$splitter){continue;
}if(node.flex){set.push(node,node.$ext[offsetSize]+(apf.hasFlexibleBox&&!_self.realtime&&node==_self.$previous?2*_self.parentNode.padding:0));
}}for(var i=0,l=set.length;i<l;i+=2){set[i].setAttribute("flex",set[i+1]);}}_self.$totalFlex+=_self.$next.flex+_self.$previous.flex;
var startPos,startOffset;if(apf.hasFlexibleBox){var coords=apf.getAbsolutePosition(this);
startPos=e[clientPos]-coords[d1];if(!_self.realtime){if(apf.hasFlexibleBox){if(_self.$previous.flex&&!_self.$next.flex){var mBox=apf.getBox(_self.$next.margin);
mBox[x1]=_self.parentNode.padding;_self.$next.$ext.style.margin=mBox.join("px ")+"px";
}else{var mBox=apf.getBox(_self.$previous.margin);mBox[x2]=_self.parentNode.padding;
_self.$previous.$ext.style.margin=mBox.join("px ")+"px";}}var diff=apf.getDiff(this);
this.style.left=coords[0]+"px";this.style.top=coords[1]+"px";this.style.width=(this.offsetWidth-diff[0])+"px";
this.style.height=(this.offsetHeight-diff[1])+"px";this.style.position="absolute";
}}else{var coords=apf.getAbsolutePosition(this.offsetParent);startOffset=apf.getAbsolutePosition(_self.$previous.$ext)[d1];
startPos=e[clientPos]-coords[d1];if(!_self.realtime){this.style.left="0px";this.style.top="0px";
this.style.position="relative";}min=-1000;}}e.returnValue=false;e.cancelBubble=true;
apf.plane.show(this);_self.$setStyleClass(this,_self.$baseCSSname+"Moving");_self.$setStyleClass(document.body,_self.type=="vertical"?"w-resize":"n-resize",[_self.type=="vertical"?"n-resize":"w-resize"]);
document.onmouseup=function(e){if(!e){e=event;}with(_self.$info){var newPos;if(e[clientPos]>=0){var coords=apf.getAbsolutePosition(_self.$ext.offsetParent);
newPos=(Math.min(max,Math.max(min,(e[clientPos]-coords[d1])-(apf.hasFlexibleBox?startPos:startOffset))));
}}_self.$setStyleClass(_self.$ext,"",[_self.$baseCSSname+"Moving"]);_self.$setStyleClass(document.body,"",["n-resize","w-resize"]);
if(changedPosition){pHtml.style.position="";}if(apf.hasFlexibleBox&&!_self.realtime){(_self.$previous.flex&&!_self.$next.flex?_self.$next:_self.$previous).$ext.style.margin=apf.getBox(_self.$previous.margin).join("px ")+"px";
}if(newPos){_self.update(newPos,true);}apf.plane.hide();if(!_self.realtime){_self.$ext.style.left="";
_self.$ext.style.top="";_self.$ext.style[_self.$info.size]="";_self.$ext.style.position="";
}document.onmouseup=document.onmousemove=null;};document.onmousemove=function(e){if(!e){e=event;
}with(_self.$info){var newPos;if(e[clientPos]>=0){var coords=apf.getAbsolutePosition(_self.$ext.offsetParent);
newPos=(Math.min(max,Math.max(min,(e[clientPos]-coords[d1])-(apf.hasFlexibleBox||!_self.realtime?startPos:startOffset))));
if(_self.realtime){_self.update(newPos);}else{_self.$ext.style[pos]=newPos+"px";
}}}e.returnValue=false;e.cancelBubble=true;};};apf.queue.add("splitter"+this.$uniqueId,function(){_self.init();
});};this.$loadAml=function(x){if(this.realtime!==false){this.$propHandlers.realtime.call(this,this.realtime=true);
}};}).call(apf.splitter.prototype=new apf.Presentation());apf.aml.setElement("splitter",apf.splitter);
apf.stateGroup=function(){this.$init("state-group",apf.NODE_HIDDEN);};apf.aml.setElement("state-group",apf.stateGroup);
(function(){this.$handlePropSet=function(prop,value,force){if(prop=="id"){return;
}var node,nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){node=nodes[i];
if(node.nodeType!=1||node.localName!="state"){continue;}if(!node[prop]||node.$inheritProperties[prop]==2){node.$inheritProperties[prop]=2;
node.setProperty(prop,value);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(!this.id){this.id="stategroup"+this.$uniqueId;
}var nodes=this.childNodes;for(var i=0,l=nodes.length;i<l;i++){nodes[i].setProperty("group",this.id);
}});}).call(apf.stateGroup.prototype=new apf.AmlElement());apf.StateServer={states:{},groups:{},locs:{},removeGroup:function(name,elState){this.groups[name].remove(elState);
if(!this.groups[name].length){if(self[name]){self[name].destroy();self[name]=null;
}delete this.groups[name];}},addGroup:function(name,elState,pNode){if(!this.groups[name]){this.groups[name]=[];
var pState=new apf.state({id:name});pState.parentNode=pNode;pState.toggle=function(){for(var next=0,i=0;
i<apf.StateServer.groups[name].length;i++){if(apf.StateServer.groups[name][i].active){next=i+1;
break;}}apf.StateServer.groups[name][(next==apf.StateServer.groups[name].length)?0:next].activate();
};this.groups[name].pState=self[name]=pState;}if(elState){this.groups[name].push(elState);
}return this.groups[name].pState;},removeState:function(elState){delete this.states[elState.name];
},addState:function(elState){this.states[elState.name]=elState;}};apf.state=function(struct,tagName){this.$init(tagName||"state",apf.NODE_HIDDEN,struct);
this.$signalElements=[];this.$groupAdded={};this.$locationAdded="";};(function(){this.$supportedProperties.push("active");
this.$booleanProperties.active=true;this.$propHandlers.active=function(value){if(apf.isTrue(value)){if(this.group){var nodes=apf.StateServer.groups[this.group];
if(!nodes){apf.StateServer.addGroup(this.group,this);nodes=apf.StateServer.groups[this.group];
}for(var i=0;i<nodes.length;i++){if(nodes[i]!=this&&nodes[i].active!==false){nodes[i].deactivate();
}}}var q=this.$signalElements;for(var i=0;i<q.length;i++){if(!self[q[i][0]]||!self[q[i][0]].setProperty){continue;
}self[q[i][0]].setProperty(q[i][1],this[q[i].join(".")]);}if(this.group){var attr=this.attributes;
for(var i=0;i<attr.length;i++){if(attr[i].nodeName.match(/^on|^(?:group|id)$|^.*\..*$/)){continue;
}self[this.group].setProperty(attr[i].nodeName,attr[i].nodeValue);}apf.StateServer.groups[this.group].pState.dispatchEvent("change");
}this.dispatchEvent("activate");}else{this.setProperty("active",false);this.dispatchEvent("deactivate");
}};this.setValue=function(value){this.active=9999;this.setProperty("active",value,false,true);
};this.activate=function(){this.active=9999;this.setProperty("active",true,false,true);
};this.deactivate=function(){this.setProperty("active",false,false,true);};this.$propHandlers.group=function(value){if(value){apf.StateServer.addGroup(value,this);
this.$groupAdded={value:value,elState:this};}else{apf.StateServer.removeGroup(this.$groupAdded.value,this.$groupAdded.elState);
this.$groupAdded={};}};this.$propHandlers.location=function(value){if(value){apf.StateServer.locs[value]=this;
this.$locationAdded=value;}else{delete apf.StateServer.locs[this.$locationAdded];
this.$locationAdded="";}};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){apf.StateServer.addState(this);
var attr=this.attributes;for(var s,i=0;i<attr.length;i++){s=attr[i].nodeName.split(".");
if(s.length==2){this.$signalElements.push(s);}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$signalElements=null;
apf.StateServer.removeState(this);if(this.group){apf.StateServer.removeGroup(this.group,this);
}});}).call(apf.state.prototype=new apf.AmlElement());apf.aml.setElement("state",apf.state);
apf.statusbar=function(struct,tagName){this.$init(tagName||"statusbar",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;var insertChild;this.addEventListener("AMLRemoveChild",function(amlNode,doOnlyAdmin){if(doOnlyAdmin){return;
}});this.addEventListener("AMLInsert",insertChild=function(amlNode,beforeNode,withinParent){if(amlNode.tagName!="bar"){return;
}amlNode.$propHandlers.caption=function(value){apf.setNodeValue(this.$getLayoutNode("bar","caption",this.$ext),value);
};amlNode.$propHandlers.icon=function(value){var oIcon=this.$getLayoutNode("bar","icon",this.$ext);
if(!oIcon){return;}if(value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");
}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}if(oIcon.tagName=="img"){oIcon.setAttribute("src",value?this.iconPath+value:"");
}else{oIcon.style.backgroundImage=value?"url("+this.iconPath+value+")":"";}};});
this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);
};this.$loadAml=function(x){var nodes=this.childNodes;for(var i=nodes.length-1;
i>=0;i--){if(nodes[i].localName=="section"){nodes[i].addEventListener("DOMNodeInsertedIntoDocument",function(){this.$setStyleClass(this.$ext,this.$baseCSSname+"Last");
});break;}}};}).call(apf.statusbar.prototype=new apf.Presentation());apf.aml.setElement("statusbar",apf.statusbar);
apf.style=function(struct,tagName){this.$init(tagName||"style",apf.NODE_HIDDEN,struct);
};(function(){this.$focussable=false;this.$propHandlers.src=function(value){apf.getData(value,{callback:function(data,state){if(state==apf.SUCCESS){apf.importCssString(data);
}}});};this.addEventListener("DOMNodeInsertedIntoDocument",function(e){if(this.type!="text/chartcss"&&this.firstChild){apf.importCssString(this.firstChild.nodeValue);
}});}).call(apf.style.prototype=new apf.AmlElement());apf.aml.setElement("style",apf.style);
apf.xhtml.setElement("style",apf.style);apf["switch"]=function(struct,tagName){this.$hasButtons=false;
this.$init(tagName||"switch",apf.NODE_VISIBLE,struct);};apf.pages=function(struct,tagName){this.$hasButtons=false;
this.$init(tagName||"pages",apf.NODE_VISIBLE,struct);this.$focussable=false;};apf.tab=function(struct,tagName){this.$hasButtons=true;
this.$init(tagName||"tab",apf.NODE_VISIBLE,struct);};(function(){this.$focussable=apf.KEYBOARD;
this.$draw=function(bSkinChange){this.$ext=this.$getExternal();this.$loadChildren();
};}).call(apf.tab.prototype=new apf.BaseTab());apf["switch"].prototype=apf.pages.prototype=apf.tab.prototype;
apf.aml.setElement("switch",apf["switch"]);apf.aml.setElement("pages",apf.pages);
apf.aml.setElement("tab",apf.tab);apf.table=function(struct,tagName){this.$init(tagName||"table",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$useLateDom=true;this.$layout=true;this.columns=null;
this.padding=2;this.$edge=[5,5,5,5];this.cellheight=19;this.$supportedProperties.push("columns","padding","edge","cellheight","span");
this.$propHandlers.columns=function(value){if(!value.match(/^((?:\d+\%?|\*)\s*(?:,\s*|\s*$))+$/)){return;
}var col,colsize=this.$columns=value.splitSafe(",");var total=0,cols=this.$table.getElementsByTagName("col");
if(cols.length){for(var sz,i=0,l=Math.min(cols.length,colsize.length);i<l;i++){cols[i].style.width=(sz=colsize[i]).indexOf("%")>-1?sz:sz+"px";
total+=parseInt(sz);}}var start=cols.length-colsize.length;if(start>0){for(var i=cols.length-start;
i<cols.length;i++){cols[i].parentNode.removeChild(cols[i]);}}else{if(start<0){for(var i=colsize.length+start;
i<colsize.length;i++){col=this.$table.appendChild(document.createElement("col"));
col.style.width=(sz=colsize[i]).indexOf("%")>-1?sz:sz+"px";col.setAttribute("valign","top");
total+=parseInt(sz);}}}this.$table.style.width=String(value).indexOf("%")>-1?"auto":(total+((colsize.length-1)*this.padding)+this.$edge[0]+this.$edge[2])+"px";
var cells=this.$tbody.firstChild.getElementsByTagName("td");for(var i=cells.length-1;
i>=0;i--){cells[i].parentNode.removeChild(cells[i]);}for(var sz,c,i=0;i<colsize.length;
i++){c=this.$tbody.firstChild.appendChild(document.createElement("td"));c.style.width=(sz=colsize[i]).indexOf("%")>-1?sz:sz+"px";
}if(start&&this.$amlLoaded){visibleHandler({sync:true,parentNode:this});}this.$resize();
};this.$propHandlers.padding=function(value){if(!this.$columns){return;}var cells=this.$table.getElementsByTagName("td");
var lastCol,lastRow,cell,lRow=this.$tbody.lastChild;for(var i=this.$columns.length,l=cells.length;
i<l;i++){lastCol=(cell=cells[i]).parentNode.lastChild==cell;lastRow=cell.parentNode==lRow;
cell.style.padding="0px "+(lastCol?0:value)+"px "+(lastRow?0:value)+"px 0px";}this.$resize();
};this.$propHandlers.edge=function(value){this.$table.style.padding=(this.$edge=apf.getBox(value)).join("px ")+"px";
this.$resize();};function visibleHandler(e){var table=e.parentNode||this.parentNode;
if(e.sync||e.value&&!this.$altExt||!e.value&&this.$altExt){var nodes=table.childNodes;
var cells=apf.getArrayFromNodelist(table.$tbody.getElementsByTagName("td"));var rows=table.$tbody.getElementsByTagName("tr");
var empty=[],row=1,cs,rs,collen=table.$columns.length;var z=table.$columns.length,lastCol;
for(var node,td,last,l=nodes.length,i=0;i<l;i++){if((node=nodes[i]).visible===false){continue;
}td=node.$altExt=last=cells[z++];if(!td){break;}if(!rows[row]){table.$tbody.appendChild(document.createElement("tr"));
}rows[row].appendChild(td);td.appendChild(node.$ext);td.setAttribute("colspan",cs=Math.min(collen-(empty[0]||0),parseInt(node.colspan||node.span||1)));
td.setAttribute("rowspan",rs=parseInt(node.rowspan||1));if(!empty[0]){empty[0]=0;
}empty[0]+=cs;if(rs>1){for(var k=1;k<rs;k++){if(!empty[k]){empty[k]=0;}empty[k]+=cs;
}}if(empty[0]>=collen){lastCol=true;empty.shift();row++;}else{lastCol=false;}td.style.padding="0px "+(lastCol?0:table.padding)+"px "+(i==l-1?0:table.padding)+"px 0px";
}var lastCells=rows[rows.length-1].getElementsByTagName("td");for(i=0,il=lastCells.length;
i<il;i++){lastCells[i].style.padding="0 "+(i==il-1?0:table.padding)+"px 0 0";}for(;
z<cells.length;z++){cells[z].parentNode.removeChild(cells[z]);}if(e.sync){return;
}if(e.value){table.$addTd(nodes[l-1]);}else{this.$altExt=null;}}}this.$addTd=function(amlNode){var cells=this.$table.getElementsByTagName("td");
var total=0,collen=this.$columns.length;for(var cell,i=0;i<cells.length;i++){total+=Math.min(collen,(parseInt((cell=cells[i]).getAttribute("colspan")||1)*parseInt(cell.getAttribute("rowspan")||1)));
}if(total%collen==0){var row=this.$tbody.appendChild(document.createElement("tr"));
}else{row=cells[cells.length-1].parentNode;}var cel=row.appendChild(document.createElement("td"));
cel.style.position="relative";if(amlNode.colspan||amlNode.span){cel.setAttribute("colspan",amlNode.colspan||amlNode.span);
}if(amlNode.rowspan){cel.setAttribute("rowspan",amlNode.rowspan);}cel.appendChild(amlNode.$ext);
amlNode.$altExt=cel;};var propHandlers={width:function(value){this.$ext.style.width="";
},height:function(value){this.$ext.style.height=value?Math.max(0,value-apf.getHeightDiff(this.$ext))+"px":"";
this.parentNode.$resize();},margin:function(value){this.$ext.style.margin=apf.getBox(value).join("px ")+"px";
this.parentNode.$resize();},colspan:function(value){if(!value){this.$altExt.removeAttribute("colspan");
}else{this.$altExt.setAttribute("colspan",value);}visibleHandler.call(this,{sync:true});
this.parentNode.$resize();},rowspan:function(value){if(!value){this.$altExt.removeAttribute("rowspan");
}else{this.$altExt.setAttribute("rowspan",value);}visibleHandler.call(this,{sync:true});
this.parentNode.$resize();},valign:function(value){this.$altExt.valign=value;},align:function(value){if("left|right".indexOf(value)==-1){return;
}this.$altExt.align=value;}};propHandlers.span=propHandlers.colspan;this.register=function(amlNode){if(amlNode.$altExt){return;
}amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=apf.K;
for(var prop in propHandlers){amlNode.$propHandlers[prop]=propHandlers[prop];}amlNode.addEventListener("prop.visible",visibleHandler);
this.$addTd(amlNode);this.$noResize=true;if(amlNode.margin){propHandlers.margin.call(amlNode,amlNode.margin);
}if(amlNode.$ext.tagName=="INPUT"){}else{amlNode.$ext.style.width="auto";}if(this.lastChild==amlNode){this.$propHandlers.padding.call(this,this.padding);
}delete this.$noResize;};this.unregister=function(amlNode){amlNode.$propHandlers.left=amlNode.$propHandlers.top=amlNode.$propHandlers.right=amlNode.$propHandlers.bottom=null;
for(var prop in propHandlers){delete amlNode.$propHandlers[prop];}amlNode.removeEventListener("prop.visible",visibleHandler);
visibleHandler.call(amlNode,{value:false});if(amlNode.margin){amlNode.$ext.style.margin="";
}if(amlNode.width){amlNode.$ext.style.width="";}};this.addEventListener("DOMNodeRemoved",function(e){if(e.$doOnlyAdmin||e.currentTarget==this){return;
}if(e.relatedNode==this){this.unregister(e.currentTarget);}});this.addEventListener("DOMNodeInserted",function(e){if(e.currentTarget==this||e.currentTarget.nodeType!=1){return;
}if(e.relatedNode==this){if(e.$isMoveWithinParent){visibleHandler.call(e.currentTarget,{sync:true});
}else{e.currentTarget.$setLayout("table");if(e.currentTarget.nextSibling){visibleHandler.call(e.currentTarget,{sync:true});
}}}});this.$draw=function(){this.$ext=apf.insertHtmlNode(null,this.$pHtmlNode,null,"<div><table cellSpacing='0' cellPadding='0'><tbody><tr class='first'></tr></tbody></table></div>");
this.$table=this.$ext.firstChild;this.$tbody=this.$table.firstChild;this.$ext.className="table "+(this.getAttribute("class")||"");
this.$int=this.$ext;this.$ext.host=this;if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));
}this.addEventListener("resize",this.$resize);this.$originalMin=[this.minwidth||0,this.minheight||0];
};this.$resize=function(){if(!this.$amlLoaded||this.$noResize){return;}if(this.$table.offsetWidth>=this.$ext.offsetWidth){this.$ext.style.minWidth=(this.minwidth=Math.max(0,this.$table.offsetWidth-apf.getWidthDiff(this.$ext)))+"px";
}else{this.$ext.style.minWidth="";this.minwidth=this.$originalMin[0];}if(this.$table.offsetHeight>=this.$ext.offsetHeight){this.$ext.style.minHeight=(this.minheight=Math.max(0,this.$table.offsetHeight-apf.getHeightDiff(this.$ext)))+"px";
}else{this.$ext.style.minHeight="";this.minheight=this.$originalMin[1];}};this.$loadAml=function(x){this.$amlLoaded=false;
if(!this.$columns){this.$propHandlers.columns.call(this,this.columns="150, 200");
}this.$amlLoaded=true;};}).call(apf.table.prototype=new apf.GuiElement());apf.aml.setElement("table",apf.table);
apf.aml.setElement("teleport",apf.AmlElement);apf.text=function(struct,tagName){this.$init(tagName||"text",apf.NODE_VISIBLE,struct);
this.$nodes=[];};(function(){this.implement(apf.Cache,apf.ChildValue);this.$focussable=true;
this.focussable=false;this.textselect=true;this.$hasStateMessages=true;this.$textTimer=this.$lastMsg=this.$lastClass=this.$changedHeight=null;
this.$booleanProperties.scrolldown=true;this.$booleanProperties.secure=true;this.$booleanProperties.textselect=true;
this.$supportedProperties.push("behavior","scrolldown","secure","value");this.$isTextInput=function(){return this.textselect;
};this.$propHandlers.scrolldown=function(value){var _self=this;if(value){this.$scrolldown=true;
this.$scrollArea.onscroll=function(){_self.$scrolldown=this.scrollTop>=this.scrollHeight-this.offsetHeight+apf.getVerBorders(this);
};this.addEventListener("scroll",this.$scroll);this.addEventListener("afterload",this.$scroll);
clearInterval(this.$textTimer);this.$textTimer=setInterval(function(){if(_self.$scrollArea&&_self.$scrolldown&&_self.scrolldown){_self.$scrollArea.scrollTop=_self.$scrollArea.scrollHeight;
}},1000);}else{this.removeEventListener("scroll",this.$scroll);this.removeEventListener("afterload",this.$scroll);
clearInterval(this.$textTimer);if(this.$scrollArea){this.$scrollArea.onscoll=null;
}}};this.$scroll=function(e){var html=this.$scrollArea;if(e.name=="afterload"){this.$scrolldown=true;
html.scrollTop=html.scrollHeight;return;}this.$scrolldown=html.scrollTop>=html.scrollHeight-html.offsetHeight+apf.getVerBorders(html);
};this.$propHandlers.value=function(value,prop,force,forceAdd){if(this.each){return;
}if(typeof value!="string"){if(value.nodeType){value=value.nodeType>1&&value.nodeType<5?value.nodeValue:value.firstChild&&value.firstChild.nodeValue||"";
}else{value=value?value.toString():"";}}if(this.secure){value=value.replace(/<a /gi,"<a target='_blank' ").replace(/<object.*?\/object>/g,"").replace(/<script.*?\/script>/g,"").replace(new RegExp("ondblclick|onclick|onmouseover|onmouseout|onmousedown|onmousemove|onkeypress|onkeydown|onkeyup|onchange|onpropertychange","g"),"ona");
}value=value.replace(/\<\?xml version="1\.0" encoding="UTF-16"\?\>/,"");if(forceAdd){apf.insertHtmlNodes(null,this.$container,null,value);
if(!this.value){this.value="";}this.value+=value;}else{this.$container.innerHTML=value;
}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";
}if(this.scrolldown&&this.$scrolldown){this.$scrollArea.scrollTop=this.$scrollArea.scrollHeight;
}};this.$eachHandler=function(value){this.$attrExcludePropBind=apf.extend({},this.$attrExcludePropBind);
this.$attrExcludePropBind.value=value?2:0;};this.addEventListener("prop.each",this.$eachHandler);
this.addEventListener("$clear",function(){this.$container.innerHTML="";this.value="";
this.dispatchEvent("prop.value",{value:""});});this.$moveNode=function(){};this.addValue=function(value){this.$propHandlers.value.call(this,value,null,null,true);
this.dispatchEvent("prop.value",{value:this.value});};this.setValue=function(value){this.setProperty("value",value,false,true);
};this.getValue=function(){return this.$container.innerHTML;};this.addEventListener("keydown",function(e){var key=e.keyCode;
switch(key){case 33:this.$container.scrollTop-=this.$container.offsetHeight;break;
case 34:this.$container.scrollTop+=this.$container.offsetHeight;break;case 35:this.$container.scrollTop=this.$container.scrollHeight;
break;case 36:this.$container.scrollTop=0;break;case 38:this.$container.scrollTop-=10;
break;case 40:this.$container.scrollTop+=10;break;default:return;}return false;
},true);this.$canLoadData=function(){return this.$attrBindings.value?true:false;
};this.$add=function(xmlNode,Lid,xmlParentNode,htmlParentNode,beforeNode){var f=this.$attrBindings.value.cvalue;
var html=f(xmlNode);html="<div id='"+Lid+"'>"+html+"</div>";if(htmlParentNode){if(beforeNode){beforeNode.insertAdjacentHTML("beforebegin",html);
}else{this.$container.insertAdjacentHTML("beforeend",html);}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";
}if(this.scrolldown&&this.$scrolldown){this.$scrollArea.scrollTop=this.$scrollArea.scrollHeight;
}}else{this.$nodes.push(html);}};this.$fill=function(){this.$container.insertAdjacentHTML("beforeend",this.$nodes.join(""));
this.$nodes=[];};this.$deInitNode=this.$updateNode=this.$moveNode=apf.K;this.$draw=function(){this.$ext=this.$getExternal();
this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!apf.getStyle(this.$container,"padding")){this.$fixScrollBug();
}this.$scrollArea=this.oFocus?this.oFocus.parentNode:this.$container;if(this.$container.tagName.toLowerCase()=="iframe"){if(apf.isIE){this.oIframe=this.$container;
var iStyle=this.skin.selectSingleNode("iframe_style");this.oIframe.contentWindow.document.write("<!DOCTYPE html>                    <head>                        <style>"+(iStyle?iStyle.firstChild.nodeValue:"")+"</style>                        <script>                            document.onkeydown = function(e){                                if (!e) e = event;                                if (top.apf.disableF5 && e.keyCode == 116) {                                    e.keyCode = 0;                                    return false;                                }                            }                        <\/script>                    </head>                    <body oncontextmenu='return false'></body>");
this.$container=this.oIframe.contentWindow.document.body;}else{var node=document.createElement("div");
this.$ext.parentNode.replaceChild(node,this.$ext);node.className=this.$ext.className;
this.$ext=this.$container=node;}}if(this.getAttribute("each")){this.$eachHandler();
}};this.addEventListener("DOMNodeRemovedFromDocument",function(){clearInterval(this.$textTimer);
apf.destroyHtmlNode(this.oDrag);if(this.$scrollArea){this.$scrollArea.onscoll=this.$scrollArea=null;
}this.oDrag=this.oIframe=this.oFocus=this.$container=this.$ext=null;});}).call(apf.text.prototype=new apf.MultiselectBinding());
apf.aml.setElement("text",apf.text);apf.input=function(struct,tagName){this.$init(tagName||"input",apf.NODE_VISIBLE,struct);
};apf.secret=function(struct,tagName){this.$init(tagName||"secret",apf.NODE_VISIBLE,struct);
};apf.password=function(struct,tagName){this.$init(tagName||"password",apf.NODE_VISIBLE,struct);
};apf.textarea=function(struct,tagName){this.$init(tagName||"textarea",apf.NODE_VISIBLE,struct);
this.multiline=true;};apf.email=function(struct,tagName){this.$init(tagName||"email",apf.NODE_VISIBLE,struct);
};apf.textbox=function(struct,tagName){this.$init(tagName||"textbox",apf.NODE_VISIBLE,struct);
};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$masking=false;
this.$autoComplete=false;this.$childProperty="value";this.value="";this.readonly=false;
this.$isTextInput=true;this.multiline=false;this.$booleanProperties.readonly=true;
this.$booleanProperties.focusselect=true;this.$booleanProperties.realtime=true;
this.$supportedProperties.push("value","mask","initial-message","focusselect","realtime","type");
this.$propHandlers.value=function(value,prop,force,initial){if(!this.$input||!initial&&this.getValue()==value){return;
}if(!initial&&!value&&!this.hasFocus()){return this.$clear();}else{if(this.isHTMLBox){if(this.$input.innerHTML!=value){this.$input.innerHTML=value;
}}else{if(this.$input.value!=value){this.$input.value=value;}}}if(!initial){apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);
}if(this.$button){this.$button.style.display=value&&!initial?"block":"none";}};
this.addEventListener("prop.maxlength",function(e){if(this.$input.tagName.toLowerCase().match(/input|textarea/)){this.$input.maxLength=parseInt(e.value)||null;
}});this.addEventListener("prop.editable",function(e){if(apf.isIE){this.$input.unselectable=e.value?"On":"Off";
}else{if(e.value){apf.addListener(this.$input,"mousedown",apf.preventDefault);}else{apf.removeListener(this.$input,"mousedown",apf.preventDefault);
}}});this.$propHandlers.mask=function(value){if(this.mask.toLowerCase()=="password"){return;
}if(!value){throw new Error("Not Implemented");}if(!this.$masking){this.$masking=true;
this.implement(apf.textbox.masking);this.focusselect=false;}this.setMask(this.mask);
};this.$propHandlers["initial-message"]=function(value){if(value){if(apf.hasFocusBug){this.$input.onblur();
}}if(!this.value){this.$clear(true);}if(this.type=="password"&&this.$inputInitFix){this.$inputInitFix.innerHTML=value;
apf.setStyleClass(this.$inputInitFix,"initFxEnabled");}};this.$propHandlers.focusselect=function(value){var _self=this;
this.$input.onmousedown=function(){_self.focusselect=false;};this.$input.onmouseup=this.$input.onmouseout=function(){_self.focusselect=value;
};};this.$propHandlers.type=function(value){if(value&&"password|username".indexOf(value)>-1&&typeof this.focusselect=="undefined"){this.focusselect=true;
this.$propHandlers.focusselect.call(this,true);}};this.$isTextInput=function(e){return true;
};this.setValue=function(value){return this.setProperty("value",value,false,true);
};this.clear=function(){this.setProperty("value","");};this.$clear=function(noEvent){if(this["initial-message"]){apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");
this.$propHandlers.value.call(this,this["initial-message"],null,null,true);}else{this.$propHandlers.value.call(this,"",null,null,true);
}if(!noEvent){this.dispatchEvent("clear");}};this.getValue=function(){var v=this.isHTMLBox?this.$input.innerHTML:this.$input.value;
return v==this["initial-message"]?"":v.replace(/\r/g,"");};this.select=function(){try{this.$input.select();
}catch(e){}};this.deselect=function(){this.$input.deselect();};this.$enable=function(){this.$input.disabled=false;
};this.$disable=function(){this.$input.disabled=true;};this.$insertData=function(str){return this.setValue(str);
};this.insert=function(text){if(apf.hasMsRangeObject){try{this.$input.focus();}catch(e){}var range=document.selection.createRange();
if(this.oninsert){text=this.oninsert(text);}range.pasteHTML(text);range.collapse(true);
range.select();}else{this.$input.value+=text;}};this.addEventListener("$clear",function(){this.value="";
if(this["initial-message"]&&apf.document.activeElement!=this){this.$propHandlers.value.call(this,this["initial-message"],null,null,true);
apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"");
}if(!this.$input.tagName.toLowerCase().match(/input|textarea/i)){if(apf.hasMsRangeObject){try{var range=document.selection.createRange();
range.moveStart("sentence",-1);range.select();}catch(e){}}}this.dispatchEvent("clear");
});this.$keyHandler=function(key,ctrlKey,shiftKey,altKey,e){if(this.$button&&key==27){if(this.value){this.change("");
e.stopPropagation();}}};this.$registerElement=function(oNode){if(!oNode){return;
}if(oNode.localName=="autocomplete"){this.$autoComplete=oNode;}};var fTimer;this.$focus=function(e){if(!this.$ext||this.$ext.disabled){return;
}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this["initial-message"]&&this.$input.value==this["initial-message"]){this.$propHandlers.value.call(this,"",null,null,true);
apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);}var _self=this;function delay(){try{if(!fTimer||document.activeElement!=_self.$input){_self.$input.focus();
}else{clearInterval(fTimer);return;}}catch(e){}if(_self.$masking){_self.setPosition();
}if(_self.focusselect){_self.select();}}if((!e||e.mouse)&&apf.isIE){clearInterval(fTimer);
fTimer=setInterval(delay,1);}else{delay();}};this.$blur=function(e){if(!this.$ext){return;
}if(!this.realtime){this.change(this.getValue());}if(e){e.cancelBubble=true;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus","capsLock"]);
if(this["initial-message"]&&this.$input.value==""){this.$propHandlers.value.call(this,this["initial-message"],null,null,true);
apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}try{if(apf.isIE||!e||e.srcElement!=apf.window){this.$input.blur();
}}catch(e){}if(this.oContainer){$setTimeout("var o = apf.lookup("+this.$uniqueId+");                o.oContainer.style.display = 'none'",100);
}clearInterval(fTimer);};this.$draw=function(){var _self=this,typedBefore=false;
if(this.localName=="codeeditor"){this.skin="textarea";this.$loadSkin();}this.$ext=this.$getExternal(null,null,function(oExt){var mask=this.getAttribute("mask");
if((typeof mask=="string"&&mask.toLowerCase()=="password")||"secret|password".indexOf(this.localName)>-1){this.type="password";
this.$getLayoutNode("main","input").setAttribute("type","password");}else{if(this.localName=="email"){this.datatype=(this.prefix?this.prefix+":":"")+"email";
this.$propHandlers.datatype.call(this,this.datatype,"datatype");}else{if(this.localName=="url"){this.datatype=(this.prefix?this.prefix+":":"")+"url";
this.$propHandlers.datatype.call(this,this.datatype,"datatype");}}}oExt.setAttribute("onmousedown","if (!this.host.disabled)                 this.host.dispatchEvent('mousedown', {htmlEvent : event});");
oExt.setAttribute("onmouseup","if (!this.host.disabled)                 this.host.dispatchEvent('mouseup', {htmlEvent : event});");
oExt.setAttribute("onclick","if (!this.host.disabled)                 this.host.dispatchEvent('click', {htmlEvent : event});");
});this.$input=this.$getLayoutNode("main","input",this.$ext);this.$button=this.$getLayoutNode("main","button",this.$ext);
this.$inputInitFix=this.$getLayoutNode("main","initialfix",this.$ext);if(this.type=="password"){this.$propHandlers.type.call(this,"password");
}if(!apf.hasContentEditable&&"input|textarea".indexOf(this.$input.tagName.toLowerCase())==-1){var node=this.$input;
this.$input=node.parentNode.insertBefore(document.createElement("textarea"),node);
node.parentNode.removeChild(node);this.$input.className=node.className;if(this.$ext==node){this.$ext=this.$input;
}}if(this.$button){this.$button.onmousedown=function(){_self.$clear();_self.change("");
_self.focus({mouse:true});};}if(this.$input.tagName.toLowerCase()=="textarea"){this.addEventListener("focus",function(e){});
}this.$input.onselectstart=function(e){if(!e){e=event;}e.cancelBubble=true;};this.$input.host=this;
this.$input.onkeydown=function(e){e=e||window.event;if(this.host.disabled){e.returnValue=false;
return false;}if(!_self.realtime){var value=_self.getValue();if(e.keyCode==13&&value!=_self.value){_self.change(value);
}}else{if(apf.isWebkit&&_self.xmlRoot&&_self.getValue()!=_self.value){$setTimeout("var o = apf.lookup("+_self.$uniqueId+");                    o.change(o.getValue())");
}}if(_self.readonly||_self.multiline=="optional"&&e.keyCode==13&&!e.shiftKey||e.ctrlKey&&(e.keyCode==66||e.keyCode==73||e.keyCode==85)){e.returnValue=false;
return false;}if(typedBefore&&this.getAttribute("type")=="password"&&this.value!=""){var hasClass=(_self.$ext.className.indexOf("capsLock")>-1),capsKey=(e.keyCode===20);
if(capsKey){apf.setStyleClass(_self.$ext,hasClass?null:"capsLock",hasClass?["capsLock"]:null);
}}if(_self.$autoComplete||_self.oContainer){var keyCode=e.keyCode;$setTimeout(function(){if(_self.$autoComplete){_self.$autoComplete.fillAutocomplete(keyCode);
}else{_self.fillAutocomplete(keyCode);}});}if(!_self.mask){return _self.$keyHandler(e.keyCode,e.ctrlKey,e.shiftKey,e.altKey,e);
}};this.$input.onkeyup=function(e){if(!e){e=event;}if(this.host.disabled){return false;
}var keyCode=e.keyCode;if(_self.$button){_self.$button.style.display=this.value?"block":"none";
}if(_self.realtime){$setTimeout(function(){var v;if(!_self.mask&&(v=_self.getValue())!=_self.value){_self.change(v);
}if(apf.isIE){_self.dispatchEvent("keyup",{keyCode:keyCode});}});}else{if(apf.isIE){_self.dispatchEvent("keyup",{keyCode:keyCode});
}}if(_self.isValid&&_self.isValid()&&e.keyCode!=13&&e.keyCode!=17){_self.clearError();
}};if(apf.hasFocusBug){apf.sanitizeTextbox(this.$input);}if(apf.hasAutocompleteXulBug){this.$input.setAttribute("autocomplete","off");
}if("INPUT|TEXTAREA".indexOf(this.$input.tagName)==-1){this.isHTMLBox=true;this.$input.unselectable="Off";
this.$input.contentEditable=true;this.$input.style.width="1px";this.$input.select=function(){var r=document.selection.createRange();
r.moveToElementText(this);r.select();};}this.$input.deselect=function(){if(!document.selection){return;
}var r=document.selection.createRange();r.collapse();r.select();};var f;apf.addListener(this.$input,"keypress",f=function(e){if(_self.$input.getAttribute("type")!="password"){return apf.removeListener(_self.$input,"keypress",f);
}e=e||window.event;var which=-1;if(e.which){which=e.which;}else{if(e.keyCode){which=e.keyCode;
}}var shift_status=false;if(e.shiftKey){shift_status=e.shiftKey;}else{if(e.modifiers){shift_status=!!(e.modifiers&4);
}}if(((which>=65&&which<=90)&&!shift_status)||((which>=97&&which<=122)&&shift_status)){apf.setStyleClass(_self.$ext,"capsLock");
}else{apf.setStyleClass(_self.$ext,null,["capsLock"]);}typedBefore=true;});};this.$loadAml=function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");
}if(typeof this.realtime=="undefined"){this.$setInheritedAttribute("realtime");
}};this.addEventListener("DOMNodeRemovedFromDocument",function(){if(this.$button){this.$button.onmousedown=null;
}if(this.$input){this.$input.onkeypress=this.$input.onmouseup=this.$input.onmouseout=this.$input.onmousedown=this.$input.onkeydown=this.$input.onkeyup=this.$input.onselectstart=null;
}});}).call(apf.textbox.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;
apf.config.$inheritProperties.realtime=1;apf.input.prototype=apf.secret.prototype=apf.password.prototype=apf.textarea.prototype=apf.email.prototype=apf.textbox.prototype;
apf.aml.setElement("input",apf.input);apf.aml.setElement("secret",apf.secret);apf.aml.setElement("password",apf.password);
apf.aml.setElement("textarea",apf.textarea);apf.aml.setElement("textbox",apf.textbox);
apf.toolbar=function(struct,tagName){this.$init(tagName||"toolbar",apf.NODE_VISIBLE,struct);
};(function(){this.$focussable=false;this.$draw=function(){this.$ext=this.$getExternal();
this.$int=this.$getLayoutNode("main","container",this.$ext);};}).call(apf.toolbar.prototype=new apf.Presentation());
apf.aml.setElement("toolbar",apf.toolbar);apf.tree=function(struct,tagName){this.$init(tagName||"tree",apf.NODE_VISIBLE,struct);
};(function(){var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4,treeState=this.$treeState;
this.$mode=0;this.$propHandlers.mode=function(value){if("check|radio".indexOf(value)>-1){if(!this.hasFeature(apf.__MULTICHECK__)){this.implement(apf.MultiCheck);
}this.addEventListener("afterrename",$afterRenameMode);this.multicheck=value=="check";
this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",$afterRenameMode);
this.$mode=0;}};function $afterRenameMode(){}this.$initNode=function(xmlNode,state,Lid){this.$getNewContext("item");
var hasChildren=state&HAS_CHILD||this.emptyMessage&&this.$applyBindRule("empty",xmlNode),oItem=this.$getLayoutNode("item");
oItem.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, 'hover', null, true);");
oItem.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, '', ['hover'], true);");
this.$setStyleClass(this.$getLayoutNode("item","class"),treeState[state]).setAttribute(apf.xmldb.htmlIdTag,Lid);
this.$setStyleClass(this.$getLayoutNode("item","container"),treeState[state]);var elOpenClose=this.$getLayoutNode("item","openclose");
if(elOpenClose){elOpenClose.setAttribute("children",hasChildren);elOpenClose.setAttribute("onmousedown","if (this.getAttribute('children') == false) return;                var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, null, null, true);                apf.cancelBubble(event, o);");
elOpenClose.setAttribute("ondblclick","event.cancelBubble = true");}if(this.$mode){var elCheck=this.$getLayoutNode("item","check");
if(elCheck){elCheck.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.checkToggle(this, true);o.$skipSelect = true;");
if(apf.isTrue(this.$applyBindRule("checked",xmlNode))){this.$checkedList.push(xmlNode);
this.$setStyleClass(oItem,"checked");}else{if(this.isChecked(xmlNode)){this.$setStyleClass(oItem,"checked");
}}}else{return false;}}var ocAction=this.opencloseaction||"ondblclick";var elIcon=this.$getLayoutNode("item","icon");
if(elIcon&&elIcon!=elOpenClose){if(ocAction!="ondblclick"){elIcon.setAttribute(ocAction,"var o = apf.lookup("+this.$uniqueId+");"+(ocAction=="onmousedown"?"o.select(this, event.ctrlKey, event.shiftKey, event.button);":"")+(true?"o.slideToggle(this, null, null, true);":""));
}if(ocAction!="onmousedown"){elIcon.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").select(this, event.ctrlKey, event.shiftKey, event.button);");
}elIcon.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");              o.choose(null, true);o.stopRename();"+(true&&!ocAction=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");
}var elSelect=this.$getLayoutNode("item","select"),strMouseDown;if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){strMouseDown="var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (event.button == 2)                     o.stopRename();                 else if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, event.button);                 apf.cancelBubble(event, o);";
elSelect.setAttribute("onmouseout","this.hasPassedDown = false;"+(elSelect.getAttribute("onmouseout")||""));
elSelect.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (this.dorename && !o.mode)                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, event.button);");
}else{strMouseDown="o.select(this, event.ctrlKey, event.shiftKey, event.button);                            apf.cancelBubble(event, o);";
}if(ocAction!="ondblclick"){elSelect.setAttribute(ocAction,"var o = apf.lookup("+this.$uniqueId+");"+(ocAction=="onmousedown"?strMouseDown:"")+(true?"o.slideToggle(this, null, null, true);":""));
}if(ocAction!="onmousedown"){elSelect.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");"+strMouseDown);
}elSelect.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");          o.choose(null, true);o.stopRename();this.dorename=false;"+(ocAction=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event, o);");
if(elIcon){var iconURL=this.$applyBindRule("icon",xmlNode);if(iconURL){if(elIcon.tagName.match(/^img$/i)){elIcon.setAttribute("src",apf.getAbsolutePath(this.iconPath,iconURL));
}else{elIcon.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,iconURL)+")");
}}}var elCaption=this.$getLayoutNode("item","caption");if(elCaption){if(elCaption.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var q=(this.$amlBindQueue||(this.$amlBindQueue={}));
elCaption.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((q.caption||(q.caption=[])).push(xmlNode)-1));
apf.setNodeValue(elCaption,"");}else{apf.setNodeValue(elCaption,this.$applyBindRule("caption",xmlNode));
}}var strTooltip=this.$applyBindRule("tooltip",xmlNode);if(strTooltip){oItem.setAttribute("title",strTooltip);
}var cssClass=this.$applyBindRule("css",xmlNode);if(cssClass){this.$setStyleClass(this.$getLayoutNode("item",null,oItem),cssClass);
this.$setStyleClass(this.$getLayoutNode("item","container",oItem),cssClass);this.$dynCssClasses.push(cssClass);
}return oItem;};this.$updateNode=function(xmlNode,htmlNode){var elIcon=this.$getLayoutNode("item","icon",htmlNode),iconURL=this.$applyBindRule("icon",xmlNode);
if(elIcon&&iconURL){if(elIcon.tagName&&elIcon.tagName.match(/^img$/i)){elIcon.src=apf.getAbsolutePath(this.iconPath,iconURL);
}else{elIcon.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,iconURL)+")";
}}var elCaption=this.$getLayoutNode("item","caption",htmlNode);if(elCaption){if(elCaption.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){elCaption.innerHTML=this.$applyBindRule("caption",xmlNode);
}}else{elCaption.nodeValue=this.$applyBindRule("caption",xmlNode);}}var strTooltip=this.$applyBindRule("tooltip",xmlNode);
if(strTooltip){htmlNode.setAttribute("title",strTooltip);}var cssClass=this.$applyBindRule("css",xmlNode);
if(cssClass||this.$dynCssClasses.length){this.$setStyleClass(htmlNode,cssClass,this.$dynCssClasses);
if(cssClass&&!this.$dynCssClasses.contains(cssClass)){this.$dynCssClasses.push(cssClass);
}}};this.$draw=function(){this.$drawBase();};}).call(apf.tree.prototype=new apf.BaseTree());
apf.aml.setElement("tree",apf.tree);apf.aml.setElement("checked",apf.BindingRule);
apf.webdav=function(struct,tagName){this.$init(tagName||"webdav",apf.NODE_HIDDEN,struct);
this.$locks={};this.$lockedStack=[];this.$lockId=0;this.$serverVars={};this.$fsCache={};
};(function(){this.useHTTP=true;this.method="GET";this.$showHidden=false;this.$booleanProperties.showhidden=true;
this.$supportedProperties.push("showhidden");this.$propHandlers.showhidden=function(value){this.$showHidden=value;
};this.$regVar=function(name,value){this.$serverVars[name]=value;return value;};
function unregister(){for(var i=0;i<arguments.length;i++){if(typeof this.$serverVars[arguments[i]]!="undefined"){this.$serverVars[arguments[i]]=null;
delete this.$serverVars[arguments[i]];}}}this.$getVar=function(name){return this.$serverVars[name]||"";
};this.doRequest=function(fCallback,sPath,sBody,oHeaders,bUseXml,oBinary,fCallback2){if(!this.$getVar("authenticated")){return onAuth.call(this,{method:this.doRequest,context:this,args:arguments});
}if(bUseXml){if(!oHeaders){oHeaders={};}oHeaders["Content-type"]="text/xml; charset=utf-8";
}var _self=this;return this.get(sPath||this.$server,{callback:function(data,state,extra){if(state!=apf.SUCCESS){var oError;
oError=WebDAVError.call(_self,"Url: "+extra.url+"\nInfo: "+extra.message);if(fCallback){return fCallback.call(_self,data,state,extra,fCallback2);
}else{throw oError;}}extra.headers=oHeaders;var iStatus=parseInt(extra.status);
if(iStatus==401){return;}var sResponse=(extra.http.responseText||"");if(sResponse.replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")!=""&&sResponse.indexOf("<?xml version=")==0){try{data=(extra.http.responseXML&&extra.http.responseXML.documentElement)?apf.xmlParseError(extra.http.responseXML):apf.getXmlDom(extra.http.responseText);
if(!apf.supportNamespaces){data.setProperty("SelectionLanguage","XPath");}data=data.documentElement;
extra.data=data;}catch(e){if(fCallback){return fCallback.call(_self,data,state,extra,fCallback2);
}else{throw WebDAVError.call(_self,"Received invalid XML\n\n"+e.message);}}}if(typeof fCallback=="function"){fCallback.call(_self,data,state,extra,fCallback2);
}},nocache:false,useXML:false,ignoreOffline:true,data:sBody||"",binary:oBinary||false,headers:oHeaders,username:this.$getVar("auth-username")||null,password:this.$getVar("auth-password")||null});
};function notAuth(msg){unregister.call(this,"auth-password");var extra={username:this.$getVar("auth-username"),server:this.$server,message:msg||"Access denied. Please check you username or password."};
var cb=this.$getVar("auth-callback");if(cb){cb(null,apf.ERROR,extra);unregister.call(this,"auth-callback");
}return this.dispatchEvent("authfailure",extra);}function connError(msg){unregister.call(this,"auth-password");
var extra={username:this.$getVar("auth-username"),server:this.$server,message:msg||"Could not connect to server, please contact your System Administrator."};
var cb=this.$getVar("auth-callback");if(cb){cb(null,apf.ERROR,extra);unregister.call(this,"auth-callback");
}return this.dispatchEvent("connectionerror",extra);}function WebDAVError(sMsg){return new Error(apf.formatErrorString(0,this,"WebDAV Communication error",sMsg));
}function onAuth(callback){var oDoc,authRequired=false;if(apf.isIE){try{oDoc=new ActiveXObject("Msxml2.DOMDocument");
}catch(e){}}else{if(document.implementation&&document.implementation.createDocument){try{oDoc=document.implementation.createDocument("","",null);
}catch(e){}}}try{if(apf.isIE){oDoc.async=false;oDoc.load(this.$rootPath);}}catch(e){authRequired=true;
}var auth=this.ownerDocument.getElementsByTagNameNS(apf.ns.apf,"auth")[0];if(authRequired){auth.authRequired(callback);
}else{this.$regVar("authenticated",true);if(callback&&callback.method){callback.method.apply(callback.context,callback.args);
}}}this.authenticate=function(username,password,callback){this.$regVar("auth-username",username);
this.$regVar("auth-password",password);this.$regVar("auth-callback",callback);var auth=apf.document.getElementsByTagNameNS(apf.ns.apf,"auth")[0];
if(!auth){return;}this.doRequest(function(data,state,extra){if(extra.status==401){return auth.authRequired();
}this.$regVar("authenticated",true);var cb=this.$getVar("auth-callback");if(cb){cb(null,state,extra);
unregister.call(this,"auth-callback");}},this.$rootPath,null,{},false,null);};this.reset=function(){unregister.call(this,"authenticated");
unregister.call(this,"auth-username");unregister.call(this,"auth-password");unregister.call(this,"auth-callback");
};this.exists=function(sPath,callback){this.getProperties(sPath,0,function(data,state,extra){callback(state===apf.SUCCESS);
});};this.readFile=this.read=function(sPath,callback){this.method="GET";this.doRequest(function(data,state,extra){var iStatus=parseInt(extra.status);
if(iStatus==403){var oError=WebDAVError.call(this,"Unable to read file. Server says: "+apf.webdav.STATUS_CODES["403"]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}else{callback?callback.call(this,extra.http.responseText,state,extra):this.dispatchEvent("onfilecontents",{data:extra.http.responseTex});
}},sPath);};this.readdir=function(sPath,callback){if(sPath.charAt(sPath.length-1)!="/"){sPath+="/";
}return this.getProperties(sPath,1,callback);};this.mkdir=function(sPath,bLock,callback){if(bLock){var oLock=this.lock(sPath);
if(!oLock.token){return updateLockedStack.call(this,oLock,"mkdir",arguments);}}var _self=this;
this.method="MKCOL";this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sPath);
var iStatus=parseInt(extra.status);if(iStatus==201){_self.readdir(sPath.substr(0,sPath.lastIndexOf("/")),callback);
}else{if(iStatus==400||iStatus==403||iStatus==405||iStatus==409||iStatus==415||iStatus==507){var oError=WebDAVError.call(this,"Unable to create directory '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&callback){callback(oError);
}}}},sPath,null,bLock&&oLock.token?{If:"<"+oLock.token+">"}:null,true);};this.list=function(sPath,callback){return this.getProperties(sPath,0,callback);
};this.writeFile=this.write=function(sPath,sContent,bLock,oBinary,callback){if(bLock){var oLock=this.lock(sPath);
if(!oLock.token){return updateLockedStack.call(this,oLock,"write",arguments);}}if(typeof callback=="undefined"&&typeof oBinary=="function"){callback=oBinary;
oBinary=null;}this.method="PUT";var _self=this;this.doRequest(function(data,state,extra){var iStatus=parseInt(extra.status);
if(state!=apf.SUCCESS){var oError=WebDAVError.call(this,"Unable to write to file. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}callback&&callback.call(this,data,apf.ERROR,extra);}else{_self.getProperties(sPath,0,callback);
}},sPath,sContent,bLock&&oLock.token?{If:"<"+oLock.token+">"}:null,null,oBinary);
};this.copy=function(sFrom,sTo,bOverwrite,bLock,callback){if(!sTo||sFrom==sTo){return(callback&&callback("",apf.SUCCESS,{}));
}if(bLock){var oLock=this.lock(sFrom);if(!oLock.token){return updateLockedStack.call(this,oLock,"copy",arguments);
}}this.method="COPY";var oHeaders={Destination:sTo||this.$server};if(typeof bOverwrite=="undefined"){bOverwrite=true;
}if(!bOverwrite){oHeaders.Overwrite="F";}if(bLock&&oLock.token){oHeaders.If="<"+oLock.token+">";
}this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sFrom);
var iStatus=parseInt(extra.status);if(iStatus==400||iStatus==403||iStatus==409||iStatus==412||iStatus==423||iStatus==424||iStatus==502||iStatus==507){var oError=WebDAVError.call(this,"Unable to copy file '"+sFrom+"' to '"+sTo+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}callback&&callback.call(this,data,state,extra);}else{this.getProperties(sTo,0,callback);
}},sFrom,null,oHeaders);};this.rename=this.move=function(sFrom,sTo,bOverwrite,bLock,callback){if(!sTo||sFrom==sTo){return(callback&&callback("",apf.SUCCESS,{}));
}if(bLock){var oLock=this.lock(sFrom);if(!oLock.token){return updateLockedStack.call(this,oLock,"move",arguments);
}}this.method="MOVE";var oHeaders={Destination:sTo||this.$server};if(typeof bOverwrite=="undefined"){bOverwrite=true;
}if(!bOverwrite){oHeaders.Overwrite="F";}if(bLock&&oLock.token){oHeaders.If="<"+oLock.token+">";
}this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sFrom);
var iStatus=parseInt(extra.status);if(iStatus==400||iStatus==403||iStatus==409||iStatus==412||iStatus==423||iStatus==424||iStatus==501||iStatus==502||iStatus==500){var oError=WebDAVError.call(this,"Unable to move file '"+sFrom+"' to '"+sTo+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}else{if(this.$fsCache[sFrom]){this.$fsCache[sTo]=this.$fsCache[sFrom];this.$fsCache[sTo].path=sTo;
delete this.$fsCache[sFrom];}}callback&&callback.call(this,data,state,extra);},sFrom,null,oHeaders);
};this.remove=function(sPath,bLock,callback){if(bLock){var oLock=this.lock(sPath);
if(!oLock.token){return updateLockedStack.call(this,oLock,"remove",arguments);}}this.method="DELETE";
this.doRequest(function(data,state,extra){bLock&&unregisterLock.call(this,sPath);
var iStatus=parseInt(extra.status);if(iStatus==400||iStatus==423||iStatus==424){var oError=WebDAVError.call(this,"Unable to remove file '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}callback&&callback.call(this,data,state,extra);},sPath,null,bLock&&oLock.token?{If:"<"+oLock.token+">"}:null);
};this.report=function(sPath,reportName,oProperties,callback){var aCont=['<?xml version="1.0" encoding="utf-8" ?>',"<D:"+reportName+' xmlns:D="',apf.webdav.NS.D,'">'];
if(oProperties){for(var prop in oProperties){aCont.push("<D:"+prop,(oProperties[prop]?">"+apf.xmlentities(apf.escapeXML(oProperties[prop]))+"</D:"+prop+">":"/>"));
}}aCont.push("</D:",reportName,">");this.method="REPORT";this.doRequest(function(data,state,extra){var iStatus=parseInt(extra.status);
if(state!=apf.SUCCESS){var oError=WebDAVError.call(this,"Unable to fetch report on '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false&&!callback){throw oError;
}}callback&&callback.call(this,data,state,extra);},sPath,aCont.join(""));};this.lock=function(sPath,iDepth,iTimeout,sLock,callback){var oLock=this.$locks[sPath];
if(oLock&&oLock.token){return oLock;}this.method="LOCK";iTimeout=iTimeout?"Infinite, Second-4100000000":"Second-"+iTimeout;
var oHeaders={Timeout:iTimeout};if(iDepth){oHeaders.Depth=iDepth||"Infinity";}if(sLock){oHeaders.If="<"+sLock+">";
}var xml='<?xml version="1.0" encoding="utf-8"?><D:lockinfo xmlns:D="'+apf.webdav.NS.D+'"><D:lockscope><D:exclusive /></D:lockscope><D:locktype><D:write /></D:locktype><D:owner><D:href>'+document.location.toString().escapeHTML()+ +"</D:href></D:owner></D:lockinfo>";
this.doRequest(registerLock,sPath,xml,oHeaders,true,null,callback);return newLock.call(this,sPath);
};this.unlock=function(oLock,callback){if(typeof oLock=="string"){oLock=this.$locks[oLock];
}if(!oLock||!oLock.token){return;}this.method="UNLOCK";this.doRequest(function(data,state,extra){unregisterLock.call(this,extra.url.replace(this.$server,""));
},oLock.path,null,{"Lock-Token":"<"+oLock.token+">"},true,callback);};function newLock(sPath){return this.$locks[sPath]={path:sPath,id:this.$lockId++,token:null};
}function registerLock(data,state,extra){var iStatus=parseInt(extra.status),sPath=extra.url.replace(this.$server,""),oLock=this.$locks[sPath]||newLock.call(this,sPath);
if(iStatus==400||iStatus==409||iStatus==423||iStatus==412){unregisterLock.call(this,extra.url.replace(this.$server,""));
var oError=WebDAVError.call(this,"Unable to apply lock to '"+sPath+"'. Server says: "+apf.webdav.STATUS_CODES[String(iStatus)]);
if(this.dispatchEvent("error",{error:oError,bubbles:true})===false){throw oError;
}}var NS=apf.webdav.NS,oOwner=$xmlns(data,"owner",NS.ns0)[0],oToken=$xmlns(data,"locktoken",NS.D)[0];
oLock.path=sPath;oLock.type="write";oLock.scope=$xmlns(data,"exclusive",NS.D).length?"exclusive":"shared";
oLock.depth=$xmlns(data,"depth",NS.D)[0].firstChild.nodeValue;oLock.owner=$xmlns(oOwner,"href",NS.ns0)[0].firstChild.nodeValue;
oLock.timeout=$xmlns(data,"timeout",NS.D)[0].firstChild.nodeValue;oLock.token=$xmlns(oToken,"href",NS.D)[0].firstChild.nodeValue.split(":")[1];
purgeLockedStack.call(this,oLock);}function unregisterLock(sPath){var oLock=this.$locks[sPath];
if(!oLock){return;}purgeLockedStack.call(this,oLock,true);this.$locks[sPath]=oLock=null;
delete this.$locks[sPath];}function updateLockedStack(oLock,sFunc,aArgs){return this.$lockedStack.push({lockId:oLock.id,func:sFunc,args:aArgs});
}function purgeLockedStack(oLock,bFailed){for(var i=this.$lockedStack.length-1;
i>=0;i--){if(this.$lockedStack[i].lockId!=oLock.id){continue;}if(!bFailed){this[this.$lockedStack[i].func].apply(this,this.$lockedStack[i].args);
}this.$lockedStack.remove(i);}}this.getProperties=function(sPath,iDepth,callback,oHeaders){this.method="PROPFIND";
var xml='<?xml version="1.0" encoding="utf-8" ?><D:propfind xmlns:D="'+apf.webdav.NS.D+'"><D:allprop /></D:propfind>';
oHeaders=oHeaders||{};oHeaders.Depth=typeof iDepth!="undefined"?iDepth:1;this.doRequest(parsePropertyPackets,sPath,xml,oHeaders,true,null,callback);
};this.setProperties=function(sPath,oPropsSet,oPropsDel,sLock){this.method="PROPPATCH";
this.doRequest(function(data,state,extra){},sPath,buildPropertiesBlock.call(this,oPropsSet,oPropsDel),sLock?{If:"<"+sLock+">"}:null,true);
};function buildPropertiesBlock(oPropsSet,oPropsDel){var aOut=['<?xml version="1.0" encoding="utf-8" ?>','<D:propertyupdate xmlns:D="',apf.webdav.NS.D,'">'];
var bHasProps=false,ns,i,j;for(ns in oPropsSet){bHasProps=true;break;}if(bHasProps){aOut.push("<D:set>");
for(ns in oPropsSet){for(i in oPropsSet[ns]){aOut.push("<D:prop>",oPropsSet[ns][i],"</D:prop>");
}}aOut.push("</D:set>");}bHasProps=false;for(ns in oPropsDel){bHasProps=true;break;
}if(bHasProps){aOut.push("<D:remove><D:prop>");for(ns in oPropsDel){for(i=0,j=oPropsDel[ns].length;
i<j;i++){aOut.push("<",oPropsDel[ns][i],' xmlns="',ns,'"/>');}}aOut.push("</D:prop></D:remove>");
}aOut.push("</D:propertyupdate>");return aOut.join("");}function parsePropertyPackets(oXml,state,extra,callback){var status=parseInt(extra.status);
if(status==403||status==401||!oXml){return callback?callback.call(this,null,state,extra):notAuth.call(this);
}if(typeof oXml=="string"){oXml=apf.getXml(oXml);}var aResp=$xmlns(oXml,"response",apf.webdav.NS.D),aOut=[];
if(aResp.length){this.$regVar("authenticated",true);}var sPath;for(var sa=[],data,i=0,j=aResp.length;
i<j;i++){sPath=decodeURIComponent($xmlns(aResp[i],"href",apf.webdav.NS.D)[0].firstChild.nodeValue);
if(sPath===extra.url){continue;}parseItem.call(this,aResp[i],data={});if(data.data){sa.push({toString:function(){return this.v;
},data:data.data,v:(data.data.type=="file"?1:0)+""+data.data.name.toLowerCase()});
}}sa.sort();for(var i=0,l=sa.length;i<l;i++){aOut.push(sa[i].data.xml);}callback&&callback.call(this,"<files>"+aOut.join("")+"</files>",state,extra);
}function parseItem(oNode,extra){var NS=apf.webdav.NS,sPath=decodeURIComponent($xmlns(oNode,"href",NS.D)[0].firstChild.nodeValue.replace(/[\\\/]+$/,"")),sName=sPath.split("/").pop(),bHidden=(sName.charAt(0)==".");
if(!this.$showHidden&&bHidden){return"";}var t,oItem,sType=$xmlns(oNode,"collection",NS.D).length>0?"folder":"file",aCType=$xmlns(oNode,"getcontenttype",NS.D),aExec=$xmlns(oNode,"executable",NS.lp2);
oItem=this.$fsCache[sPath]=apf.extend(this.$fsCache[sPath]||{},{path:sPath,type:sType,size:parseInt(sType=="file"?(t=$xmlns(oNode,"getcontentlength",NS.lp1)).length?t[0].firstChild.nodeValue:0:0),name:sName,contentType:(sType=="file"&&aCType.length?aCType[0].firstChild.nodeValue:""),creationDate:(t=$xmlns(oNode,"creationdate",NS.lp1)).length?t[0].firstChild.nodeValue:"",lastModified:(t=$xmlns(oNode,"getlastmodified",NS.lp1)).length?t[0].firstChild.nodeValue:"",etag:(t=$xmlns(oNode,"getetag",NS.lp1)).length?t[0].firstChild.nodeValue:"",lockable:($xmlns(oNode,"locktype",NS.D).length>0),executable:(aExec.length>0&&aExec[0].firstChild.nodeValue=="T")});
if(extra){extra.data=oItem;}return oItem.xml="<"+sType+" path='"+sPath+"'  type='"+sType+"' size='"+oItem.size+"' name='"+oItem.name+"' contenttype='"+oItem.contentType+"' modifieddate='"+oItem.lastModified+"' creationdate='"+oItem.creationDate+"' lockable='"+oItem.lockable.toString()+"' hidden='"+bHidden.toString()+"' executable='"+oItem.executable.toString()+"'/>";
}this.exec=function(method,args,callback){var cb=function(data,state,extra){extra.originalArgs=args;
if(typeof args[args.length-1]=="function"){args[args.length-1](data,state,extra);
}callback&&callback(data,state,extra);};switch(method){case"login":case"authenticate":this.authenticate(args[0],args[1],cb);
break;case"logout":this.reset();break;case"exists":this.exists(args[0],cb);break;
case"read":this.readFile(args[0],cb);break;case"create":var path=args[0]?args[0]:"";
if(path.charAt(path.length-1)!="/"){path=path+"/";}this.writeFile(path+args[1],args[2],args[3]||false,cb);
break;case"write":case"store":case"save":this.writeFile(args[0],args[1],args[2]||false,cb);
break;case"copy":case"cp":this.copy(args[0],args[1],args[2]||true,args[3]||false,cb);
break;case"rename":var sBasepath=args[1].substr(0,args[1].lastIndexOf("/")+1);this.rename(args[1],sBasepath+args[0],args[2]||false,args[3]||false,cb);
break;case"move":case"mv":path=args[1];if(path.charAt(path.length-1)!="/"){path=path+"/";
}this.rename(args[0],path+args[0].substr(args[0].lastIndexOf("/")+1),args[2]||false,args[3]||false,cb);
break;case"remove":case"rmdir":case"rm":this.remove(args[0],args[1]||false,cb);
break;case"readdir":case"scandir":this.readdir(args[0],cb);break;case"getroot":this.getProperties(this.$rootPath,0,cb);
break;case"mkdir":path=args[0]?args[0]:"";if(path.charAt(path.length-1)!="/"){path=path+"/";
}this.mkdir(path+args[1],args[2]||false,cb);break;case"lock":this.lock(args[0],null,null,null,cb);
break;case"unlock":this.unlock(args[0],cb);break;case"report":this.report(args[0],args[1],args[2],cb);
break;default:break;}};}).call(apf.webdav.prototype=new apf.Teleport());apf.aml.setElement("webdav",apf.webdav);
apf.webdav.NS={D:"DAV:",ns0:"DAV:",lp1:"DAV:",lp2:"http://apache.org/dav/props/"};
apf.webdav.STATUS_CODES={"100":"Continue","101":"Switching Protocols","102":"Processing","200":"OK","201":"Created","202":"Accepted","203":"None-Authoritive Information","204":"No Content","1223":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Time-out","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Request Entity Too Large","414":"Request-URI Too Large","415":"Unsupported Media Type","416":"Requested range not satisfiable","417":"Expectation Failed","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Time-out","505":"HTTP Version not supported","507":"Insufficient Storage"};
apf.UndoData=function(settings,at){this.localName="UndoData";this.extra={};apf.extend(this,settings);
if(!this.timestamp){this.timestamp=(new Date()).getUTCTime();}if(at){this.at=at;
}else{if(settings&&settings.tagName=="UndoData"){this.args=settings.args.slice();
}else{this.selNode=this.selNode||(this.action=="removeNode"?this.args[0]:(this.amlNode?this.amlNode.selected:null));
}}var options,_self=this;this.saveChange=function(undo,at,callback){if(this.action=="group"){var rpcNodes=this.args[1];
at.$addToQueue(rpcNodes,undo,true);return at.$queueNext(this);}var dataInstruction;
if(this.xmlActionNode){dataInstruction=this.xmlActionNode.getAttribute(undo?"undo":"set");
if(undo&&!dataInstruction){dataInstruction=this.xmlActionNode.getAttribute("set");
}}if(!dataInstruction){return at.$queueNext(this);}this.state=undo?"restoring":"saving";
if(!options.asyncs){return at.$receive(null,apf.SUCCESS,{amlNode:this.amlNode},this,callback);
}options.ignoreOffline=true;apf.saveData(dataInstruction,options);};this.preparse=function(undo,at,multicall,callback){var dataInstruction;
if(this.xmlActionNode){dataInstruction=this.xmlActionNode.getAttribute(undo?"undo":"set");
if(undo&&!dataInstruction){dataInstruction=this.xmlActionNode.getAttribute("set");
}}if(!dataInstruction){return this;}options=apf.extend({xmlNode:this.action=="multicall"?this.args[0].xmlNode:this.selNode||this.xmlNode,userdata:apf.isTrue(this.xmlActionNode.getAttribute("ignore-fail")),multicall:multicall,undo:undo,precall:true,callback:function(data,state,extra){if(options.asyncs){extra.amlNode=_self.amlNode;
return at.$receive(data,state,extra,_self,callback);}}},this.extra);apf.saveData(dataInstruction,options);
return this;};};apf.actiontracker.actions={setTextNode:function(undoObj,undo){var q=undoObj.args;
if(!undo){apf.xmldb.setTextNode(q[0],q[1],q[2],undoObj);}else{apf.xmldb.setTextNode(q[0],undoObj.extra.oldValue,q[2],undoObj);
}},setAttribute:function(undoObj,undo){var q=undoObj.args;if(!undo){undoObj.extra.name=q[1];
undoObj.extra.oldValue=q[0].getAttribute(q[1]);apf.xmldb.setAttribute(q[0],q[1],q[2],q[3],undoObj);
}else{if(!undoObj.extra.oldValue){apf.xmldb.removeAttribute(q[0],q[1],null,undoObj);
}else{apf.xmldb.setAttribute(q[0],q[1],undoObj.extra.oldValue,q[3],undoObj);}}},removeAttribute:function(undoObj,undo){var q=undoObj.args;
if(!undo){undoObj.extra.name=q[1];undoObj.extra.oldValue=q[0].getAttribute(q[1]);
apf.xmldb.removeAttribute(q[0],q[1],q[2],undoObj);}else{apf.xmldb.setAttribute(q[0],q[1],undoObj.extra.oldValue,q[2],undoObj);
}},replaceNode:function(undoObj,undo){var q=undoObj.args;if(!undo){apf.xmldb.replaceNode(q[0],q[1],q[2],undoObj);
}else{apf.xmldb.replaceNode(q[1],q[0],q[2],undoObj);}},addChildNode:function(undoObj,undo){var q=undoObj.args;
if(!undo){apf.xmldb.addChildNode(q[0],q[1],q[2],q[3],undoObj);}else{apf.xmldb.removeNode(undoObj.extra.addedNode,null,undoObj);
}},appendChild:function(undoObj,undo){var q=undoObj.args;if(!undo){apf.xmldb.appendChild(q[0],q[1],q[2],q[3],q[4],undoObj);
}else{apf.xmldb.removeNode(undoObj.xmlNode,null,undoObj);}},moveNode:function(undoObj,undo){var q=undoObj.args;
if(!undo){apf.xmldb.moveNode(q[0],q[1],q[2],q[3],undoObj);}else{apf.xmldb.moveNode(undoObj.extra.oldParent,q[1],undoObj.extra.beforeNode,q[3],undoObj);
}},removeNode:function(undoObj,undo){var q=undoObj.args;if(!undo){apf.xmldb.removeNode(q[0],q[1],undoObj);
}else{apf.xmldb.appendChild(undoObj.extra.parent,undoObj.extra.removedNode,undoObj.extra.beforeNode,null,null,undoObj);
}},removeNodeList:function(undoObj,undo){if(undo){var d=undoObj.extra.removeList;
for(var i=d.length-1;i>=0;i--){apf.xmldb.appendChild(d[i].pNode,d[i].removedNode,d[i].beforeNode,null,null,undoObj);
}}else{apf.xmldb.removeNodeList(undoObj.args,undoObj);}},group:function(undoObj,undo,at){if(!undoObj.$undostack){var done=undoObj.args[0];
undoObj.$undostack=done;undoObj.$redostack=[];}at[undo?"undo":"redo"](undoObj.$undostack.length,false,undoObj.$undostack,undoObj.$redostack);
},setValueByXpath:function(undoObj,undo){var newNode,q=undoObj.args;if(!undo){if(newNode=undoObj.extra.newNode){if(newNode.nodeType==2){apf.xmldb.setAttribute(undoObj.extra.ownerElement,newNode.nodeName,newNode.nodeValue);
undoObj.extra.newNode=undoObj.extra.ownerElement.getAttributeNode(newNode.nodeName);
}else{apf.xmldb.appendChild(undoObj.extra.parentNode,undoObj.extra.newNode,null,null,null,undoObj);
}}else{var newNodes=[];apf.setNodeValue(q[0],q[1],true,{undoObj:undoObj,xpath:q[2],newNodes:newNodes,forceNew:q[3]});
newNode=undoObj.extra.newNode=newNodes[0];if(newNode){if(newNode.nodeType==2){undoObj.extra.ownerElement=newNode.ownerElement||newNode.selectSingleNode("..");
}else{undoObj.extra.parentNode=undoObj.extra.newNode.parentNode;}}}}else{if(newNode=undoObj.extra.newNode){if(newNode.nodeType==2){apf.xmldb.removeAttribute(undoObj.extra.ownerElement,newNode.nodeName,null,undoObj);
}else{apf.xmldb.removeNode(undoObj.extra.newNode,null,undoObj);}}else{apf.setNodeValue(undoObj.extra.appliedNode,undoObj.extra.oldValue,true,{undoObj:undoObj});
}}},multicall:function(undoObj,undo,at){var q=undoObj.args;var dUpdate=apf.xmldb.delayUpdate;
apf.xmldb.delayUpdate=true;if(!undo){for(var i=0;i<q.length;i++){if(!q[i].extra){q[i].extra={};
}apf.actiontracker.actions[q[i].action](q[i],false,at);}}else{for(var i=q.length-1;
i>=0;i--){apf.actiontracker.actions[q[i].action](q[i],true,at);}}apf.xmldb.delayUpdate=dUpdate;
}};if(apf.hasRequireJS){define("apf/elements/dbg/chromedebughost",["module","debug/ChromeDebugMessageStream","debug/WSChromeDebugMessageStream","debug/DevToolsService","debug/V8DebuggerService","debug/V8Debugger","apf/elements/dbg/v8debugger"],function(module,ChromeDebugMessageStream,WSChromeDebugMessageStream,DevToolsService,V8DebuggerService,V8Debugger,APFV8Debugger){var ChromeDebugHost=module.exports=function(hostname,port,o3obj,ws){this.$hostname=hostname;
this.$port=port;this.$o3obj=o3obj;this.$ws=ws;this.$debuggers={};this.$init();this.$connect(function(){});
};(function(){this.$connect=function(callback){var self=this;if(this.state=="connected"){return callback.call(this);
}else{this.addEventListener("connect",function(){self.removeEventListener("connect",arguments.callee);
callback.call(self);});}if(this.state=="connecting"){return;}this.state="connecting";
if(!this.$ws){var socket=this.$socket=new O3Socket(this.$hostname,this.$port,this.$o3obj);
var msgStream=new ChromeDebugMessageStream(socket);}else{var msgStream=new WSChromeDebugMessageStream(this.$ws);
}msgStream.addEventListener("connect",function(){self.$dts=new DevToolsService(msgStream);
self.$v8ds=new V8DebuggerService(msgStream);self.state="connected";self.dispatchEvent("connect");
window.onunload=self.disconnect.bind(self);});msgStream.connect();};this.loadTabs=function(model){var self=this;
this.$connect(function(){self.$dts.listTabs(function(tabs){var xml=[];for(var i=0;
i<tabs.length;i++){xml.push("<tab id='",tabs[i][0],"' url='",apf.escapeXML(tabs[i][1]+""),"' />");
}model.load("<tabs>"+xml.join("")+"</tabs>");});});};this.attach=function(tabId,callback){var dbg;
if(dbg=this.$debuggers[tabId]){return callback(null,dbg);}var self=this;this.$connect(function(){self.$v8ds.attach(tabId,function(){dbg=new APFV8Debugger(new V8Debugger(tabId,self.$v8ds),this);
self.$debuggers[tabId]=dbg;callback(null,dbg);});});};this.detach=function(dbg,callback){var self=this;
for(var id in this.$debuggers){if(this.$debuggers[id]==dbg){this.$v8ds.detach(id,function(err){delete self.$debuggers[id];
dbg.dispatchEvent("detach");callback&&callback(err);});break;}}};this.disconnect=function(callback){var debuggers=[];
for(var id in this.$debuggers){debuggers.push(id);}var self=this;var detachNext=function(){if(debuggers.length){var id=debuggers.shift();
var dbg=self.$debuggers[id];self.$v8ds.detach(id,function(){detachNext();dbg.dispatchEvent("detach");
});}else{self.$socket.close();self.$debuggers={};self.dispatchEvent("disconnect",{});
callback&&callback();}};detachNext();};}).call(ChromeDebugHost.prototype=new apf.Class());
});}if(apf.hasRequireJS){define("apf/elements/dbg/v8debugger",["module","debug/Breakpoint"],function(module,Breakpoint){var V8Debugger=module.exports=function(dbg,host){this.$init();
this.$debugger=dbg;this.$host=host;this.$breakpoints={};var _self=this;dbg.addEventListener("changeRunning",function(e){_self.dispatchEvent("changeRunning",e);
if(dbg.isRunning()){_self.setFrame(null);}});dbg.addEventListener("break",function(e){_self.dispatchEvent("break",e);
});dbg.addEventListener("afterCompile",function(e){_self.dispatchEvent("afterCompile",{script:apf.getXml(_self.$getScriptXml(e.data.script))});
});this.setFrame(null);};(function(){var hasChildren={object:8,"function":4};this.stripPrefix="";
this.setStrip=function(stripPrefix){this.stripPrefix=stripPrefix;};this.$strip=function(str){if(!this.stripPrefix){return str;
}return str.indexOf(this.stripPrefix)===0?str.slice(this.stripPrefix.length):str;
};this.isRunning=function(){return this.$debugger.isRunning();};this.scripts=function(model,callback){var _self=this;
this.$debugger.scripts(4,null,false,function(scripts){var xml=[];for(var i=0,l=scripts.length;
i<l;i++){var script=scripts[i];if(script.name&&script.name.indexOf("chrome-extension://")===0){continue;
}xml.push(_self.$getScriptXml(script));}model.load("<sources>"+xml.join("")+"</sources>");
callback();});};this.$getScriptXml=function(script){return["<file scriptid='",script.id,"' scriptname='",apf.escapeXML(script.name||"anonymous"),"' text='",this.$strip(apf.escapeXML(script.text||"anonymous")),"' lineoffset='",script.lineOffset,"' debug='true' />"].join("");
};function getId(frame){return(frame.func.name||frame.func.inferredName||(frame.line+frame.position));
}this.$isEqual=function(xmlFrameSet,frameSet){if(xmlFrameSet.length!=frameSet.length){return false;
}var xmlFirst=xmlFrameSet[0];var first=frameSet[0];if(xmlFirst.getAttribute("scriptid")!=first.func.scriptId){return false;
}if(xmlFirst.getAttribute("id")!=getId(first)){return false;}return true;};this.$updateFrame=function(xmlFrame,frame){xmlFrame.setAttribute("line",frame.line);
xmlFrame.setAttribute("column",frame.column);var i,j,l;var vars=xmlFrame.selectNodes("vars/item");
var fVars=frame.arguments;for(i=1,j=0,l=fVars.length;j<l;j++){if(fVars[j].name){this.$updateVar(vars[i++],fVars[j]);
}}fVars=frame.locals;for(j=0,l=frame.locals.length;j<l;j++){if(fVars[j].name!==".arguments"){this.$updateVar(vars[i++],fVars[j]);
}}};this.$updateVar=function(xmlVar,fVar){xmlVar.setAttribute("value",this.$valueString(fVar.value));
xmlVar.setAttribute("type",fVar.value.type);xmlVar.setAttribute("ref",fVar.value.ref);
apf.xmldb.setAttribute(xmlVar,"children",hasChildren[fVar.value.type]?"true":"false");
};this.$buildFrame=function(frame,ref,xml){var script=ref(frame.script.ref);xml.push("<frame index='",frame.index,"' name='",apf.escapeXML(apf.escapeXML(this.$frameToString(frame))),"' column='",frame.column,"' id='",getId(frame),"' ref='",frame.ref,"' line='",frame.line,"' script='",this.$strip(script.name),"' scriptid='",frame.func.scriptId,"'>");
xml.push("<vars>");var receiver={name:"this",value:frame.receiver};xml.push(this.$serializeVariable(receiver));
var j,l;for(j=0,l=frame.arguments.length;j<l;j++){if(frame.arguments[j].name){xml.push(this.$serializeVariable(frame.arguments[j]));
}}for(j=0,l=frame.locals.length;j<l;j++){if(frame.locals[j].name!==".arguments"){xml.push(this.$serializeVariable(frame.locals[j]));
}}xml.push("<globals />");xml.push("</vars>");xml.push("<scopes>");var scopes=frame.scopes;
for(j=0,l=scopes.length;j<l;j++){var scope=scopes[j];xml.push("<scope index='",scope.index,"' type='",scope.type,"' />");
}xml.push("</scopes>");xml.push("</frame>");};this.backtrace=function(model,callback){var _self=this;
this.$debugger.backtrace(null,null,null,true,function(body,refs){function ref(id){for(var i=0;
i<refs.length;i++){if(refs[i].handle==id){return refs[i];}}return{};}var i,l;var frames=body.frames;
var xmlFrames=model.queryNodes("frame");if(xmlFrames.length&&_self.$isEqual(xmlFrames,frames)){for(i=0,l=frames.length;
i<l;i++){_self.$updateFrame(xmlFrames[i],frames[i]);}_self.setFrame(xmlFrames[0]);
}else{var xml=[];if(frames){for(i=0,l=frames.length;i<l;i++){_self.$buildFrame(frames[i],ref,xml);
}}model.load("<frames>"+xml.join("")+"</frames>");_self.setFrame(model.data.firstChild);
}callback();});};this.loadScript=function(script,callback){var id=script.getAttribute("scriptid");
var _self=this;this.$debugger.scripts(4,[id],true,function(scripts){if(!scripts.length){return;
}var script=scripts[0];callback(script.source);});};this.loadObjects=function(item,callback){var ref=item.getAttribute("ref");
var _self=this;this.$debugger.lookup([ref],false,function(body){var refs=[];var props=body[ref].properties;
for(var i=0,l=props.length;i<l;i++){refs.push(props[i].ref);}_self.$debugger.lookup(refs,false,function(body){var xml=["<item>"];
for(var i=0,l=props.length;i<l;i++){props[i].value=body[props[i].ref];xml.push(_self.$serializeVariable(props[i]));
}xml.push("</item>");callback(xml.join(""));});});};this.loadFrame=function(frame,callback){var scopes=frame.getElementsByTagName("scope");
var frameIndex=parseInt(frame.getAttribute("index"),10);var _self=this;var processed=0;
var expected=0;var xml=["<vars>"];for(var i=0,l=scopes.length;i<l;i++){var scope=scopes[i];
var type=parseInt(scope.getAttribute("type"),10);if(type>1){expected+=1;var index=parseInt(scope.getAttribute("index"),10);
this.$debugger.scope(index,frameIndex,true,function(body){var props=body.object.properties;
for(j=0,l2=props.length;j<l2;j++){xml.push(_self.$serializeVariable(props[j]));
}processed+=1;if(processed==expected){xml.push("</vars>");callback(xml.join(""));
}});}}if(expected===0){return callback("<vars />");}};this.setFrame=function(frame){this.$activeFrame=frame;
this.dispatchEvent("changeFrame",{data:frame});};this.getActiveFrame=function(){return this.$activeFrame;
};this.setBreakpoints=function(model,callback){var _self=this;var breakpoints=model.queryNodes("breakpoint");
_self.$debugger.listbreakpoints(function(v8Breakpoints){if(v8Breakpoints.breakpoints){var bp;
for(var bId in _self.$breakpoints){bp=_self.$breakpoints[bId];bp.destroy();if(bp.xml){apf.xmldb.removeNode(bp.xml);
delete bp.xml;}}_self.$breakpoints={};for(var i=0,l=v8Breakpoints.breakpoints.length;
i<l;i++){if(v8Breakpoints.breakpoints[i].type=="scriptId"){continue;}var breakpoint=Breakpoint.fromJson(v8Breakpoints.breakpoints[i],_self.$debugger);
var id=breakpoint.source+"|"+breakpoint.line;_self.$breakpoints[id]=breakpoint;
model.removeXml("breakpoint[@script='"+breakpoint.source+"' and @line='"+breakpoint.line+"']");
breakpoint.xml=model.appendXml(_self.$getBreakpointXml(breakpoint,0));}}var modelBps=model.queryNodes("breakpoint")||[];
apf.asyncForEach(Array.prototype.slice.call(modelBps,0),function(modelBp,next){var script=modelBp.getAttribute("script");
var line=modelBp.getAttribute("line");var id=script+"|"+line;var bp=_self.$breakpoints[id];
if(modelBp.parentNode){apf.xmldb.removeNode(modelBp);}if(!bp){bp=_self.$addBreakpoint({id:id,name:script,row:line,col:modelBp.getAttribute("column"),lineOffset:0,scriptId:null,data:{condition:modelBp.getAttribute("condition"),ignoreCount:parseInt(modelBp.getAttribute("ignorecount")||0,10),enabled:(modelBp.getAttribute("enabled")=="true")}},model,next);
}else{model.appendXml(_self.$getBreakpointXml(bp,0));next();}},callback);});};this.toggleBreakpoint=function(script,relativeRow,model){var name=script.getAttribute("scriptname");
var lineOffset=parseInt(script.getAttribute("lineoffset")||"0",10);var row=lineOffset+relativeRow;
var id=name+"|"+row;var breakpoint=this.$breakpoints[id];var _self=this;if(breakpoint){try{breakpoint.clear(function(){_self.$removeBreakpoint(breakpoint,model);
});}catch(ex){_self.$removeBreakpoint(breakpoint,model);}}else{breakpoint=this.$addBreakpoint({id:id,name:name,row:row,col:0,lineOffset:lineOffset,scriptId:script.getAttribute("scriptid")},model);
}};this.$removeBreakpoint=function(bp,model){if(bp.$id){var node,xpath="breakpoint[@id="+bp.$id+"]";
while(node=model.queryNode(xpath)){apf.xmldb.removeNode(node);}}delete this.$breakpoints[bp.id];
};this.$addBreakpoint=function(options,model,callback){var bp=this.$breakpoints[options.id]=new Breakpoint(options.name,options.row,options.col,options.dbg);
bp.id=options.id;if(options.data){apf.extend(bp,options.data);}var _self=this;bp.attach(this.$debugger,function(){model.appendXml(_self.$getBreakpointXml(bp,options.lineOffset,options.scriptId));
callback&&callback();});return bp;};this.$getBreakpointXml=function(breakpoint,lineOffset,scriptId){var xml=[];
xml.push("<breakpoint"," id='",breakpoint.$id,"' text='",this.$strip(apf.escapeXML(breakpoint.source)),":",breakpoint.line,"' script='",apf.escapeXML(breakpoint.source),scriptId?"' scriptid='"+scriptId:"","' lineoffset='",lineOffset||0,"' line='",breakpoint.line,"' condition='",apf.escapeXML(breakpoint.condition||""),"' ignorecount='",breakpoint.ignoreCount||0,"' enabled='",breakpoint.enabled,"' />");
return xml.join("");};this.continueScript=function(callback){this.$debugger.continueScript(null,null,callback);
};this.stepInto=function(callback){this.$debugger.continueScript("in",1,callback);
};this.stepNext=function(callback){this.$debugger.continueScript("next",1,callback);
};this.stepOut=function(callback){this.$debugger.continueScript("out",1,callback);
};this.suspend=function(){this.$debugger.suspend();};this.changeLive=function(scriptId,newSource,previewOnly,callback){this.$debugger.changelive(scriptId,newSource,previewOnly,callback);
};this.evaluate=function(expression,frame,global,disableBreak,callback){this.$debugger.evaluate(expression,frame,global,disableBreak,function(body,refs,error){var str=[];
var name=expression.trim().split(/;|\n/).pop().trim().replace(/"/g,"&quot;");if(error){str.push("<item type='.error' name=\"",apf.escapeXML(name),"\" value='",error.message,"' />");
}else{str.push('<item name="',apf.escapeXML(name),"\" value='",apf.escapeXML(body.text),"' type='",body.type,"' ref='",body.handle,body.constructorFunction?"' constructor='"+body.constructorFunction.ref:"",body.prototypeObject?"' prototype='"+body.prototypeObject.ref:"",body.properties&&body.properties.length?"' children='true":"","' />");
}callback(apf.getXml(str.join("")),body,refs,error);});};this.$valueString=function(value){switch(value.type){case"undefined":case"null":return value.type;
case"boolean":case"number":case"string":return value.value+"";case"object":return"["+value.className+"]";
case"function":return"function "+value.inferredName+"()";default:return value.type;
}};this.$frameToString=function(frame){var str=[];var args=frame.arguments;var argsStr=[];
str.push(frame.func.name||frame.func.inferredName||"anonymous","(");for(var i=0,l=args.length;
i<l;i++){var arg=args[i];if(!arg.name){continue;}argsStr.push(arg.name);}str.push(argsStr.join(", "),")");
return str.join("");};this.$serializeVariable=function(item,name){var str=["<item name='",apf.escapeXML(name||item.name),"' value='",apf.escapeXML(this.$valueString(item.value)),"' type='",item.value.type,"' ref='",typeof item.value.ref=="number"?item.value.ref:item.value.handle,hasChildren[item.value.type]?"' children='true":"","' />"];
return str.join("");};}).call(V8Debugger.prototype=new apf.Class());});}if(apf.hasRequireJS){define("apf/elements/dbg/v8debughost",["module","debug/StandaloneV8DebuggerService","debug/V8Debugger","apf/elements/dbg/v8debugger"],function(module,StandaloneV8DebuggerService,V8Debugger,APFV8Debugger){var V8DebugHost=module.exports=function(hostname,port,o3obj){this.$hostname=hostname;
this.$port=port;this.$o3obj=o3obj;this.$debugger=null;this.$init();};(function(){this.$connect=function(callback){var self=this;
if(this.state=="connected"){return callback.call(this);}else{this.addEventListener("connect",function(){self.removeEventListener("connect",arguments.callee);
callback.call(self);});}if(this.state=="connecting"){return;}this.state="connecting";
var socket=this.$socket=new O3Socket(this.$hostname,this.$port,this.$o3obj);this.$v8ds=new StandaloneV8DebuggerService(socket);
this.state="connected";this.dispatchEvent("connect");window.onunload=this.disconnect.bind(this);
callback.call(this);};this.loadTabs=function(model){model.load("<tabs><tab id='0'>V8</tab></tabs>");
};this.attach=function(tabId,callback){var dbg=this.$debugger;if(dbg){return callback(null,dbg);
}var self=this;this.$connect(function(){self.$v8ds.attach(0,function(){dbg=new APFV8Debugger(new V8Debugger(0,self.$v8ds),this);
self.$debugger=dbg;callback(null,dbg);});});};this.detach=function(dbg,callback){if(!dbg||this.$debugger!==dbg){return callback();
}this.$debugger=null;var self=this;this.$v8ds.detach(0,function(err){dbg.dispatchEvent("detach");
self.$socket.close();self.dispatchEvent("disconnect",{});callback&&callback(err);
});};this.disconnect=function(callback){this.detach(this.$debugger,callback);};
}).call(V8DebugHost.prototype=new apf.Class());});}if(apf.hasRequireJS){define("apf/elements/dbg/v8websocketdebughost",["module","debug/WSV8DebuggerService","debug/V8Debugger","apf/elements/dbg/v8debugger"],function(module,WSV8DebuggerService,V8Debugger,APFV8Debugger){var V8WebSocketDebugHost=module.exports=function(socket){this.$socket=socket;
this.$debugger=null;this.$init();};(function(){this.$connect=function(callback){if(this.state!="connected"){this.$v8ds=new WSV8DebuggerService(this.$socket);
}this.state="connected";this.dispatchEvent("connect");callback.call(this);};this.loadTabs=function(model){model.load("<tabs><tab id='0'>V8</tab></tabs>");
};this.attach=function(tabId,callback){var dbg=this.$debugger;if(dbg){return callback(null,dbg);
}var self=this;this.$connect(function(){self.$v8ds.attach(0,function(){dbg=new APFV8Debugger(new V8Debugger(0,self.$v8ds),this);
self.$debugger=dbg;callback(null,dbg);});});};this.detach=function(dbg,callback){if(!dbg||this.$debugger!==dbg){return callback();
}this.$debugger=null;var self=this;this.$v8ds.detach(0,function(err){dbg.dispatchEvent("detach");
self.dispatchEvent("disconnect",{});callback&&callback(err);});};this.disconnect=function(callback){this.detach(this.$debugger,callback);
};}).call(V8WebSocketDebugHost.prototype=new apf.Class());});}apf.cgi=function(){this.supportMulticall=false;
this.namedArguments=true;this.unserialize=function(str){return str;};this.getSingleCall=function(name,args,obj){obj.push(args);
};this.createMessage=function(functionName,args){var prop,vars=[];function recur(o,stack){if(o&&o.dataType==apf.ARRAY){for(var j=0;
j<o.length;j++){recur(o[j],stack+"%5B"+j+"%5D");}}else{if(o&&typeof o=="object"){if(o.nodeType){try{var s=o.outerHTML||o.serialize&&o.serialize()||apf.getCleanCopy(o).xml;
}catch(e){var s="Could not serialize object";}vars.push(stack+"="+encodeURIComponent(s));
}else{for(prop in o){if(typeof o[prop]=="function"){continue;}recur(o[prop],stack+"%5B"+encodeURIComponent(prop)+"%5D");
}}}else{if(typeof o!="undefined"&&o!==null){vars.push(stack+"="+encodeURIComponent(o));
}}}}if(this.multicall){vars.push("func="+this.mcallname);for(var i=0;i<args[0].length;
i++){recur(args[0][i],"f%5B"+i+"%5D");}}else{for(prop in args){recur(args[prop],prop);
}}if(!this.baseUrl){this.baseUrl=this.url;}this.url=this.$methods[functionName].url?this.$methods[functionName].url:this.baseUrl;
if(this.method!="GET"){return vars.join("&");}this.url=this.url+(vars.length?(this.url.indexOf("?")>-1?"&":"?")+vars.join("&"):"");
return"";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.method=(this["http-method"]||"GET").toUpperCase();
this.contentType=this.method=="GET"?null:"application/x-www-form-urlencoded";});
this.submitForm=function(form,callback){if(!this["postform"]){this.addMethod("postform",callback);
}var args=[];for(var i=0,l=form.elements.length;i<l;i++){if(!form.elements[i].name){continue;
}if(form.elements[i].tagname=="input"&&(form.elements[i].type=="checkbox"||form.elements[i].type=="radio")&&!form.elements[i].checked){continue;
}if(form.elements[i].tagname="select"&&form.elements[i].multiple){for(var j=0;j<form.elements[i].options.length;
j++){if(form.elements[i].options[j].selected){args.push(form.elements[i].name+"="+encodeURIComponent(form.elements[i].options[j].value));
}}}else{args.push(form.elements[i].name+"="+encodeURIComponent(form.elements[i].value));
}}var loc=(form.action||location.href);this.urls.postform=loc+(loc.indexOf("?")>-1?"&":"?")+args.join("&");
this["postform"].call(this);return false;};};apf.rest=function(){this.supportMulticall=false;
this.namedArguments=false;this.nocache=false;this.unserialize=function(str){return str;
};this.getSingleCall=function(name,args,obj){obj.push(args);};this.createMessage=function(functionName,args){if(!this.baseUrl){this.baseUrl=this.url;
}var options=this.$methods[functionName];var body="NOTIFY|SEND|POST|PUT".indexOf(options["http-method"].toUpperCase())>-1?args.pop():"",url;
this.method=options["http-method"];if(options["content-type"]){this.contentType=options["content-type"];
}var i=0,l=args.length;for(;i<l;++i){args[i]=encodeURIComponent(args[i]);}this.url=(url=options.url?options.url:this.baseUrl)+(l?(url.charAt(url.length-1)=="/"?"":"/")+args.join("/"):"");
this.contentType=body?"application/x-www-form-urlencoded":null;return body;};};
apf.textbox.masking=function(){var _FALSE_=9128748732;var _REF={"0":"\\d","1":"[12]","9":"[\\d ]","#":"[\\d +-]",L:"[A-Za-z]","?":"[A-Za-z ]",A:"[A-Za-z0-9]",a:"[A-Za-z0-9 ]",X:"[0-9A-Fa-f]",x:"[0-9A-Fa-f ]","&":"[^s]",C:"."};
var lastPos=-1;var masking=false;var oExt=this.$ext;var initial,pos=[],myvalue,format,fcase,replaceChar;
this.setPosition=function(setpos){setPosition(setpos||lastPos||0);};this.addEventListener("$clear",function(){this.value="";
if(this.mask){return this.setValue("");}});this.$propHandlers.value=function(value){var data="";
if(this.includeNonTypedChars){for(var i=0;i<initial.length;i++){if(initial.substr(i,1)!=value.substr(i,1)){data+=value.substr(i,1);
}}}this.$insertData(data||value);};var numpadKeys={"96":"0","97":"1","98":"2","99":"3","100":"4","101":"5","102":"6","103":"7","104":"8","105":"9","106":"*","107":"+","109":"-","110":".","110":"/"};
this.addEventListener("keydown",function(e){var key=e.keyCode,stop=false;switch(key){case 39:setPosition(lastPos+1);
stop=true;break;case 37:setPosition(lastPos-1);stop=true;break;case 35:case 34:setPosition(myvalue.length);
stop=true;break;case 33:case 36:setPosition(0);stop=true;break;case 8:deletePosition(lastPos-1);
setPosition(lastPos-1);stop=true;break;case 46:deletePosition(lastPos);setPosition(lastPos);
stop=true;break;default:if(key==67&&e.ctrlKey){window.clipboardData.setData("Text",this.getValue());
stop=true;}break;}var chr=numpadKeys[key]||String.fromCharCode(key);if(setCharacter(chr)){setPosition(lastPos+1);
}var value,pos=lastPos;if(this.realtime&&(value=this.getValue())!=this.value){this.change(value);
setPosition(pos);}if(apf.isCharacter(e.keyCode)||stop){return false;}},true);this.$initMasking=function(){this.$keyHandler=null;
masking=true;this.$ext[apf.isIphone?"onclick":"onmouseup"]=function(e){var pos=Math.min(calcPosFromCursor(),myvalue.length);
setPosition(pos);return false;};this.$ext.onpaste=function(e){e=e||window.event;
e.returnValue=false;this.host.setValue(window.clipboardData.getData("Text")||"");
$setTimeout(function(){setPosition(lastPos);},1);};this.getValue=function(){if(this.includeNonTypedChars){return initial==this.$ext.value?"":this.$ext.value.replace(new RegExp(replaceChar,"g"),"");
}else{return myvalue.join("");}};this.setValue=function(value){if(this.includeNonTypedChars){for(var data="",i=0;
i<initial.length;i++){if(initial.substr(i,1)!=value.substr(i,1)){data+=value.substr(i,1);
}}}this.$insertData(data);};};this.setMask=function(m){if(!masking){this.$initMasking();
}m=m.split(";");replaceChar=m.pop();this.includeNonTypedChars=parseInt(m.pop())!==0;
var mask=m.join("");var validation="",visual="",mode_case="-",strmode=false,startRight=false,chr;
pos=[],format="",fcase="";for(var looppos=-1,i=0;i<mask.length;i++){chr=mask.substr(i,1);
if(!chr.match(/[\!\'\"\>\<\\]/)){looppos++;}else{if(chr=="!"){startRight=true;}else{if(chr=="<"||chr==">"){mode_case=chr;
}else{if(chr=="'"||chr=='"'){strmode=!strmode;}}}continue;}if(!strmode&&_REF[chr]){pos.push(looppos);
visual+=replaceChar;format+=chr;fcase+=mode_case;validation+=_REF[chr];}else{visual+=chr;
}}this.$ext.value=visual;initial=visual;myvalue=[];replaceChar=replaceChar;};function checkChar(chr,p){var f=format.substr(p,1);
var c=fcase.substr(p,1);if(chr.match(new RegExp(_REF[f]))==null){return _FALSE_;
}if(c==">"){return chr.toUpperCase();}if(c=="<"){return chr.toLowerCase();}return chr;
}function setPosition(p){if(p<0){p=0;}if(apf.hasMsRangeObject){var range=oExt.createTextRange();
range.expand("textedit");range.select();if(pos[p]==null){range.collapse(false);
range.select();lastPos=pos.length;return false;}range.collapse();range.moveStart("character",pos[p]);
range.moveEnd("character",1);range.select();}else{if(typeof pos[p]=="undefined"){oExt.selectionStart=oExt.selectionEnd=pos[pos.length-1]+1;
lastPos=pos.length;return false;}oExt.selectionStart=pos[p];oExt.selectionEnd=pos[p]+1;
}lastPos=p;}function setCharacter(chr){if(pos.length&&pos[lastPos]==null){return false;
}chr=checkChar(chr,lastPos);if(chr==_FALSE_){return false;}if(apf.hasMsRangeObject){var range=oExt.createTextRange();
range.expand("textedit");range.collapse();range.moveStart("character",pos[lastPos]);
range.moveEnd("character",1);range.text=chr;if(apf.document.activeElement==this){range.select();
}}else{var val=oExt.value,start=oExt.selectionStart,end=oExt.selectionEnd;oExt.value=val.substr(0,start)+chr+val.substr(end);
oExt.selectionStart=start;oExt.selectionEnd=end;}myvalue[lastPos]=chr;return true;
}function deletePosition(p){if(pos[p]==null){return false;}if(apf.hasMsRangeObject){var range=oExt.createTextRange();
range.expand("textedit");range.collapse();range.moveStart("character",pos[p]);range.moveEnd("character",1);
range.text=replaceChar;range.select();}else{var val=oExt.value,start=pos[p],end=pos[p]+1;
oExt.value=val.substr(0,start)+replaceChar+val.substr(end);oExt.selectionStart=start;
oExt.selectionEnd=end;}myvalue[p]=" ";}this.$insertData=function(str){if(str==this.getValue()){return;
}var i,j;try{if(!apf.hasMsRangeObject&&oExt.selectionStart==oExt.selectionEnd){setPosition(0);
}}catch(ex){if(!str){return;}var chr,val;for(i=0,j=str.length;i<j;i++){lastPos=i;
if(pos[lastPos]==null){continue;}chr=checkChar(str.substr(i,1),i);if(chr==_FALSE_){continue;
}val=oExt.value;oExt.value=val.substr(0,pos[i])+chr+val.substr(pos[i]+1);}if(str.length){lastPos++;
}return;}str=this.dispatchEvent("insert",{data:str})||str;if(!str){if(!this.getValue()){return;
}for(i=this.getValue().length-1;i>=0;i--){deletePosition(i);}setPosition(0);return;
}for(i=0,j=str.length;i<j;i++){lastPos=i;setCharacter(str.substr(i,1));if(!apf.hasMsRangeObject){setPosition(i+1);
}}if(str.length){lastPos++;}};function calcPosFromCursor(){var range,lt=0;if(!apf.hasMsRangeObject){lt=oExt.selectionStart;
}else{range=document.selection.createRange();var r2=range.duplicate();r2.expand("textedit");
r2.setEndPoint("EndToStart",range);lt=r2.text.length;}for(var i=0;i<pos.length;
i++){if(pos[i]>lt){return(i==0)?0:i-1;}}return myvalue.length;}};apf.LiveMarkupPi=function(){this.$init();
};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.getDocument=function(){return this.$data&&this.$data.ownerDocument;
};this.clear=function(msg){if(msg=="loading"&&apf.getInheritedAttribute(this,"loading-message")){this.$propHandlers.calcdata.call(this,"<span class='loading'>Loading...</span>");
this.calcdata="";}};this.$propHandlers.calcdata=function(data){if(this.$skipChange){return;
}if(this.$data){if(this.$useXmlDiff){var newXml=apf.getXml("<a:application xmlns:a='"+apf.ns.apf+"'>"+apf.xmlentities(data)+"</a:application>",null,this.ownerDocument.$domParser.preserveWhiteSpace);
var oldXml=this.$data;apf.xmlDiff(oldXml,newXml);return;}var nodes=this.$data.childNodes;
for(var i=nodes.length-1;i>=0;i--){nodes[i].destroy(true);}}if(typeof data=="string"&&data.indexOf("<a:")>-1){this.$ext.innerHTML="";
var doc=this.ownerDocument.$domParser.parseFromString("<a:application xmlns:a='"+apf.ns.apf+"'>"+data+"</a:application>","text/xml",{htmlNode:this.$ext,host:this});
this.$data=doc.documentElement;}else{if(this.$data){var nodes=this.$data.childNodes;
for(var i=0;i<nodes.length;i++){nodes[i].destroy(true);}}if(this.$ext){this.$ext.innerHTML=data||"";
}}};}).call(apf.LiveMarkupPi.prototype=new apf.AmlProcessingInstruction(true));
apf.aml.setProcessingInstruction("lm",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("lm-debug",apf.LiveMarkupPi);
apf.aml.setProcessingInstruction("livemarkup",apf.LiveMarkupPi);if(document.all){var oldWinError=window.onerror,z;
window.onerror=z=function(m){apf.console.error("Error caught from early startup. Might be a html parser syntax error (not your fault). "+m);
if(!arguments.caller){return true;}};}apf.Init.addConditional(function(){if(document.all&&window.onerror==z){window.onerror=oldWinError;
}apf.dispatchEvent("domready");},null,["body","class"]);apf.addDomLoadEvent(function(){apf.Init.run("body");
});if(typeof requirejs!=="undefined"){var deps=[];deps.push("apf/elements/codeeditor");
deps.push("apf/elements/debugger","apf/elements/debughost");if(deps.length){require(deps,function(){apf.start();
});}else{apf.start();}}else{apf.start();}